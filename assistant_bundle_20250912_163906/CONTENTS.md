# Project contents (text files, truncated)


---
## assistant_bundle_20250912_163906/_meta/all_files.list

**size:** 10166 bytes &nbsp;&nbsp; **sha1:** `43a0c4a814608ff49006fccd9a86606b32e8c0cc`

```text
assistant_bundle_20250912_163906/_meta/all_files.list
.editorconfig
.env.example
.env.production
.github/workflows/pages.yml
.gitignore
.prettierrc.json
README.md
artisthub@1.0.0
assistant_bundle_20250912_153759/BINARIES.tsv
assistant_bundle_20250912_153759/CONTENTS.md
assistant_bundle_20250912_153759/MANIFEST.tsv
assistant_bundle_20250912_153759/PROJECT_TREE.txt
assistant_bundle_20250912_153759/README_FOR_CHAT.md
assistant_bundle_20250912_153759/_meta/all_files.list
assistant_bundle_20250912_153759/_meta/include_files.list
assistant_bundle_20250912_153759/_snapshot/.editorconfig
assistant_bundle_20250912_153759/_snapshot/.github/workflows/pages.yml
assistant_bundle_20250912_153759/_snapshot/.gitignore
assistant_bundle_20250912_153759/_snapshot/.prettierrc.json
assistant_bundle_20250912_153759/_snapshot/README.md
assistant_bundle_20250912_153759/_snapshot/artisthub@1.0.0
assistant_bundle_20250912_153759/_snapshot/assistant_bundle_20250912_153759/_meta/all_files.list
assistant_bundle_20250912_153759/_snapshot/concurrently
assistant_bundle_20250912_153759/_snapshot/eslint.config.js
assistant_bundle_20250912_153759/_snapshot/jsconfig.json
assistant_bundle_20250912_153759/_snapshot/node
assistant_bundle_20250912_153759/_snapshot/package-lock.json
assistant_bundle_20250912_153759/_snapshot/package.backup.json
assistant_bundle_20250912_153759/_snapshot/package.json
assistant_bundle_20250912_153759/_snapshot/plan.txt
assistant_bundle_20250912_153759/_snapshot/postcss.config.cjs
assistant_bundle_20250912_153759/_snapshot/reports/README-cleanup.md
assistant_bundle_20250912_153759/_snapshot/reports/unreachable_js.json
assistant_bundle_20250912_153759/_snapshot/reports/unused_selectors.json
assistant_bundle_20250912_153759/_snapshot/reports/zero_size_files.txt
assistant_bundle_20250912_153759/_snapshot/server/index.mjs
assistant_bundle_20250912_153759/_snapshot/server/search-fallback.mjs
assistant_bundle_20250912_153759/_snapshot/server/tts.mjs
assistant_bundle_20250912_153759/_snapshot/share.patch
assistant_bundle_20250912_153759/_snapshot/src/css/about.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artist.zoom.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.anim.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.base.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.card.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.controls.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.filters.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.grid.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.modal.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.pager.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.player.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.skeleton.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.toolbar.css
assistant_bundle_20250912_153759/_snapshot/src/css/artists/index.css
assistant_bundle_20250912_153759/_snapshot/src/css/assistant/chat.css
assistant_bundle_20250912_153759/_snapshot/src/css/base.css
assistant_bundle_20250912_153759/_snapshot/src/css/comments.css
assistant_bundle_20250912_153759/_snapshot/src/css/container.css
assistant_bundle_20250912_153759/_snapshot/src/css/footer.css
assistant_bundle_20250912_153759/_snapshot/src/css/header.css
assistant_bundle_20250912_153759/_snapshot/src/css/hero.css
assistant_bundle_20250912_153759/_snapshot/src/css/modal.css
assistant_bundle_20250912_153759/_snapshot/src/css/reset.css
assistant_bundle_20250912_153759/_snapshot/src/css/styles.css
assistant_bundle_20250912_153759/_snapshot/src/img/about/about-desk-2x.png
assistant_bundle_20250912_153759/_snapshot/src/img/about/about-desk.png
assistant_bundle_20250912_153759/_snapshot/src/img/about/about-mob-2x.png
assistant_bundle_20250912_153759/_snapshot/src/img/about/about-mob.png
assistant_bundle_20250912_153759/_snapshot/src/img/about/about-tabl-2x.png
assistant_bundle_20250912_153759/_snapshot/src/img/about/about-tabl.png
assistant_bundle_20250912_153759/_snapshot/src/img/hero/hero-desk-2x.png
assistant_bundle_20250912_153759/_snapshot/src/img/hero/hero-desk.png
assistant_bundle_20250912_153759/_snapshot/src/img/hero/hero-mob-2x.png
assistant_bundle_20250912_153759/_snapshot/src/img/hero/hero-mob.png
assistant_bundle_20250912_153759/_snapshot/src/img/hero/hero-tabl-2x.png
assistant_bundle_20250912_153759/_snapshot/src/img/hero/hero-tabl.png
assistant_bundle_20250912_153759/_snapshot/src/img/sprite.svg
assistant_bundle_20250912_153759/_snapshot/src/index.html
assistant_bundle_20250912_153759/_snapshot/src/js/api.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/api.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/grid.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/init.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/mixradio-menu.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/modal.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/player-patch.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/player.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/prefetch.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/router.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/state.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/yt-catalog-provider.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/zoom.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/index.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/lib/scroll-lock.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/lib/sound.js
assistant_bundle_20250912_153759/_snapshot/src/js/artists/lib/toast.js
assistant_bundle_20250912_153759/_snapshot/src/js/assistant/assistant-hooks.js
assistant_bundle_20250912_153759/_snapshot/src/js/assistant/bridge.js
assistant_bundle_20250912_153759/_snapshot/src/js/assistant/chat.js
assistant_bundle_20250912_153759/_snapshot/src/js/assistant/hooks.js
assistant_bundle_20250912_153759/_snapshot/src/js/comments.js
assistant_bundle_20250912_153759/_snapshot/src/js/footer.js
assistant_bundle_20250912_153759/_snapshot/src/js/global-sfx.js
assistant_bundle_20250912_153759/_snapshot/src/js/header.js
assistant_bundle_20250912_153759/_snapshot/src/js/hero.js
assistant_bundle_20250912_153759/_snapshot/src/js/modal.js
assistant_bundle_20250912_153759/_snapshot/src/js/shared/sprite.js
assistant_bundle_20250912_153759/_snapshot/src/main.js
assistant_bundle_20250912_153759/_snapshot/src/partials/about.html
assistant_bundle_20250912_153759/_snapshot/src/partials/artists.html
assistant_bundle_20250912_153759/_snapshot/src/partials/comments.html
assistant_bundle_20250912_153759/_snapshot/src/partials/footer.html
assistant_bundle_20250912_153759/_snapshot/src/partials/header.html
assistant_bundle_20250912_153759/_snapshot/src/partials/hero.html
assistant_bundle_20250912_153759/_snapshot/src/partials/modal.html
assistant_bundle_20250912_153759/_snapshot/src/public/logo-icon.svg
assistant_bundle_20250912_153759/_snapshot/stylelint.config.cjs
assistant_bundle_20250912_153759/_snapshot/tts_debug.json
assistant_bundle_20250912_153759/_snapshot/types/vite-plugins.d.ts
assistant_bundle_20250912_153759/_snapshot/vite
assistant_bundle_20250912_153759/_snapshot/vite.config.js
concurrently
eslint.config.js
export_for_chat.sh
jsconfig.json
node
package-lock.json
package.backup.json
package.json
plan.txt
postcss.config.cjs
render.yaml
reports/README-cleanup.md
reports/unreachable_js.json
reports/unused_selectors.json
reports/zero_size_files.txt
server/index.mjs
server/search-fallback.mjs
server/tts.mjs
share.patch
src/css/about.css
src/css/artists.css
src/css/artists/artist.zoom.css
src/css/artists/artists.anim.css
src/css/artists/artists.base.css
src/css/artists/artists.card.css
src/css/artists/artists.controls.css
src/css/artists/artists.filters.css
src/css/artists/artists.grid.css
src/css/artists/artists.modal.css
src/css/artists/artists.pager.css
src/css/artists/artists.player.css
src/css/artists/artists.skeleton.css
src/css/artists/artists.toolbar.css
src/css/artists/index.css
src/css/assistant/chat.css
src/css/base.css
src/css/comments.css
src/css/container.css
src/css/footer.css
src/css/header.css
src/css/hero.css
src/css/modal.css
src/css/reset.css
src/css/styles.css
src/img/about/about-desk-2x.png
src/img/about/about-desk.png
src/img/about/about-mob-2x.png
src/img/about/about-mob.png
src/img/about/about-tabl-2x.png
src/img/about/about-tabl.png
src/img/hero/hero-desk-2x.png
src/img/hero/hero-desk.png
src/img/hero/hero-mob-2x.png
src/img/hero/hero-mob.png
src/img/hero/hero-tabl-2x.png
src/img/hero/hero-tabl.png
src/img/sprite.svg
src/index.html
src/js/api.js
src/js/artists/features/api.js
src/js/artists/features/grid.js
src/js/artists/features/init.js
src/js/artists/features/mixradio-menu.js
src/js/artists/features/modal.js
src/js/artists/features/player-patch.js
src/js/artists/features/player.js
src/js/artists/features/prefetch.js
src/js/artists/features/router.js
src/js/artists/features/state.js
src/js/artists/features/yt-catalog-provider.js
src/js/artists/features/zoom.js
src/js/artists/index.js
src/js/artists/lib/scroll-lock.js
src/js/artists/lib/sound.js
src/js/artists/lib/toast.js
src/js/assistant/apiBase.js
src/js/assistant/assistant-hooks.js
src/js/assistant/bridge.js
src/js/assistant/chat.js
src/js/assistant/hooks.js
src/js/comments.js
src/js/footer.js
src/js/global-sfx.js
src/js/header.js
src/js/hero.js
src/js/modal.js
src/js/shared/sprite.js
src/main.js
src/partials/about.html
src/partials/artists.html
src/partials/comments.html
src/partials/footer.html
src/partials/header.html
src/partials/hero.html
src/partials/modal.html
src/public/logo-icon.svg
stylelint.config.cjs
tts_debug.json
types/vite-plugins.d.ts
vite
vite.config.js

```

---
## .editorconfig

**size:** 176 bytes &nbsp;&nbsp; **sha1:** `7625fcfed64b885d49d6cefda49dc5307b9a70c7`

```text
root = true

[*]
indent_style = space
indent_size = 2
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = false

[*.{json,md,yaml}]
indent_size = 2
```

---
## .env.example

**size:** 347 bytes &nbsp;&nbsp; **sha1:** `d881922bbc2fef78663d328a6d319f482b9c3ea4`

```text
# локально
PORT=8787

# PRO (OpenAI/совместимый)
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o-mini

# FREE (LM Studio/совместимый)
LMSTUDIO_BASE_URL=http://127.0.0.1:1234/v1
LMSTUDIO_API_KEY=lm-studio
LMSTUDIO_MODEL=qwen2.5-7b-instruct

# YouTube (опционально)
YT_API_KEY=

```

---
## .env.production

**size:** 63 bytes &nbsp;&nbsp; **sha1:** `2c3a8656fa10d1c5f7f582fd84a33e616a40ed40`

```text

VITE_AI_BASE_URL=https://<имя-сервиса>.onrender.com

```

---
## .github/workflows/pages.yml

**size:** 1170 bytes &nbsp;&nbsp; **sha1:** `c8810d54e53f77406d2ee521498aca0028b56a25`

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [main] # запускаем деплой при пуше в main
  workflow_dispatch: # и руками можно запустить из Actions

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: 'pages'
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      # Если есть package-lock.json — используем ci, иначе install
      - name: Install deps
        run: |
          if [ -f package-lock.json ]; then
            npm ci
          else
            npm install
          fi

      - name: Build
        run: npm run build

      - uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - id: deployment
        uses: actions/deploy-pages@v4

```

---
## .gitignore

**size:** 339 bytes &nbsp;&nbsp; **sha1:** `a7623cc3858df1dd74c48b1e2e590ad5b458db8b`

```text
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

# local archives
*.zip

# secrets
.env
.env.*.local


```

---
## .prettierrc.json

**size:** 195 bytes &nbsp;&nbsp; **sha1:** `3fed31356b2e6e44d4169242f01b7577b5f0d376`

```json
{
  "printWidth": 80,
  "useTabs": false,
  "semi": true,
  "singleQuote": true,
  "trailingComma": "es5",
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "proseWrap": "always"
}

```

---
## README.md

**size:** 3845 bytes &nbsp;&nbsp; **sha1:** `ec4e51d79b67ecac89954b6173274b7ce0862fef`

```markdown
# ArtistsHub — Force Tech 07

**Українська | [English below](#english-version)**

> Платформа для відкриття нових артистів. Ціль — довести користувача з першого
> екрана до релевантних виконавців за кілька кліків.

---

## Зміст

- [Огляд](#огляд)
- [Демо](#демо)
- [Ключові можливості](#ключові-можливості)
- [Технології](#технології)
- [Архітектура на рівні модулів](#архітектура-на-рівні-модулів)
- [Локальний запуск](#локальний-запуск)
- [Скрипти](#скрипти)
- [Структура проєкту](#структура-проєкту)
- [Доступність та продуктивність](#доступність-та-продуктивність)
- [Дорожня карта](#дорожня-карта)
- [Ліцензія](#ліцензія)

---

## Огляд

**ArtistsHub** — веб-додаток, що допомагає швидко знаходити нових улюблених
артистів.

- **Перший/головний екран (Hero):** миттєво читається меседж і помітний CTA
  **Explore Artists** із плавним скролом до каталогу.
- **Каталог:** рендер по **8 карток** — оптимальний баланс швидкості та
  читабельності.
- **Керування:** пошук, сортування, фільтр за жанрами, кнопка **Reset**.
- **Пагінація:** зрозумілий активний стан, скорочення діапазонів через «…».
- **Фокус на UX:** чиста типографіка, емоційний колаж, логічні флоу.

## Демо

Посилання на GitHub Pages: **_(додай URL репозиторію тут)_**

---

## Ключові можливості

- Плавний керований перехід з Hero до каталогу (smooth scroll).
- Батчинг даних і ліниве завантаження зображень.
- Зручна панель фільтрів з дебаунсом пошуку.
- Семантична розмітка та коректні focus states для клавіатурної навігації.
- Чиста пагінація для великих обсягів каталогу.

## Технології

- **Vite** — девсервер і білд
- **Vanilla JS (ES Modules)**
- **Axios** — HTTP-запити
- **iziToast** — нотифікації (опційно)
- **CSS / SCSS** — адаптивна сітка, змінні, темінг

---

## Архітектура на рівні модулів

- `src/js/api.js` — запити до API (`/api/artists?limit=8&page=n`,
  `/api/artists/:id`)
- `src/js/catalog/filters.js` — пошук, сортування, жанри, debounce
- `src/js/catalog/pagination.js` — логіка сторінок і відмальовування контролів
- `src/js/catalog/render.js` — шаблони карток, батчинг на 8 елементів
- `src/js/ux/smooth-scroll.js` — плавний скрол до каталогу з Hero
- `src/js/ux/a11y.js` — фокус-кільця, aria-атрибути
- `src/css/` — базові стилі, токени, адаптив

> За потреби базовий URL API змінюється прямо в `api.js`.

---

## Локальний запуск

**Вимоги:** Node.js 18+

```bash
npm install
npm run dev
```

```

---
## assistant_bundle_20250912_153759/BINARIES.tsv

**size:** 910 bytes &nbsp;&nbsp; **sha1:** `f1c7a35847946848c28a7d2700fc7e78c9d982ed`

```text
size_bytes	mimetype	path
0	inode/x-empty	artisthub@1.0.0
0	inode/x-empty	concurrently
0	inode/x-empty	node
0	inode/x-empty	share.patch
0	inode/x-empty	src/css/artists.css
0	inode/x-empty	src/css/modal.css
571832	image/png	src/img/about/about-desk-2x.png
171473	image/png	src/img/about/about-desk.png
89777	image/png	src/img/about/about-mob-2x.png
27979	image/png	src/img/about/about-mob.png
392728	image/png	src/img/about/about-tabl-2x.png
122595	image/png	src/img/about/about-tabl.png
726813	image/png	src/img/hero/hero-desk-2x.png
231697	image/png	src/img/hero/hero-desk.png
149726	image/png	src/img/hero/hero-mob-2x.png
45869	image/png	src/img/hero/hero-mob.png
545508	image/png	src/img/hero/hero-tabl-2x.png
166900	image/png	src/img/hero/hero-tabl.png
0	inode/x-empty	src/js/footer.js
4	text/plain	src/js/hero.js
0	inode/x-empty	src/js/modal.js
0	inode/x-empty	src/partials/modal.html
0	inode/x-empty	vite

```

---
## assistant_bundle_20250912_153759/CONTENTS.md (skipped, 452420 bytes > 204800)


---
## assistant_bundle_20250912_153759/MANIFEST.tsv

**size:** 7503 bytes &nbsp;&nbsp; **sha1:** `7b95da78a32e15a25eb75faa38e9b04551346762`

```text
size_bytes	sha1	path
2625	764acea5a48ab92577e6a7026cfa90d9a86d1a4c	assistant_bundle_20250912_153759/_meta/all_files.list
176	7625fcfed64b885d49d6cefda49dc5307b9a70c7	.editorconfig
1170	c8810d54e53f77406d2ee521498aca0028b56a25	.github/workflows/pages.yml
323	e1d9b3755cacb0f01a4760ce81d3b138cd8e314a	.gitignore
195	3fed31356b2e6e44d4169242f01b7577b5f0d376	.prettierrc.json
3845	ec4e51d79b67ecac89954b6173274b7ce0862fef	README.md
0	e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	artisthub@1.0.0
0	e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	concurrently
1141	9c4efdfb845a3572e005fd7700109cfdea0c83f2	eslint.config.js
5519	80365e44875935248818e016aeb29932b2f2b043	export_for_chat.sh
276	dfc9e9f061f6440d067178ce7c6f73838770c338	jsconfig.json
0	e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	node
326341	0c59bcbd7821123645908b6b30d275051042c836	package-lock.json
1937	87007a1ad8f8612617969e526e68c71b1d234ce3	package.backup.json
2039	47d3684c03c74db764584302b7e97b7e514005a6	package.json
7021	0f4e7786e299855212ad2d7025f0b5d6c7357d6f	plan.txt
1409	57d956a4b4a46e7097b33dd401f62227ced54ae9	postcss.config.cjs
1616	a12163f15d5580a6a8f5855b6572803aafa80fba	reports/README-cleanup.md
213	9dcffef1480390fafc583fdc62fb659308bfc497	reports/unreachable_js.json
2423	55edc78c9053d08cfd410a4107bb4df7be7c60ba	reports/unused_selectors.json
98	25590554437d01d9573019c965f5f588d2909d3a	reports/zero_size_files.txt
26168	73c4d4b3995b9f9cf50003be92e93a342315a3df	server/index.mjs
3640	c45bb210cac68dbf2fed93fd8245d308a4f9d25b	server/search-fallback.mjs
5840	7deb30b4e3dc1ef3c525a00e5b83405433f24fd3	server/tts.mjs
0	e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	share.patch
2075	6fbb4a107c1672a0642d0908b9a24cc5b1b32dd6	src/css/about.css
0	e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	src/css/artists.css
1457	e839755351b785bd9e42e4cd6909f6ce41d7dfd0	src/css/artists/artist.zoom.css
493	4ae5859eecaf0b8aa78e4a5e3149b465f6120fdc	src/css/artists/artists.anim.css
3319	a8c5d0d940fc643c7283dff94c3bd5befdd774b9	src/css/artists/artists.base.css
8813	9fb80d7aac83375892cc9b54162a3192bfdc0c97	src/css/artists/artists.card.css
6352	bc139747484f0b6909028952f4a11e2f3b38cbfc	src/css/artists/artists.controls.css
9835	ff00ece8f0f02dc6818cff0b7293ab322674e41c	src/css/artists/artists.filters.css
5097	fecc054a0a57b13c5b6e1550a000f5e892006466	src/css/artists/artists.grid.css
7035	c63082796d5fe6c7e7bb73726c43416c79168952	src/css/artists/artists.modal.css
1267	758a227b80c126a8f79cfa6e1cf9ca28807b2e23	src/css/artists/artists.pager.css
9951	a361fbb3d01a9fa5c2a34ca663003d89b047a5aa	src/css/artists/artists.player.css
1022	2a430670c7f3ab2bc8a83120c9ee1c14312f8253	src/css/artists/artists.skeleton.css
12219	08b8da54ea4473fcd1707cbb6b7b5dcb3ad960a0	src/css/artists/artists.toolbar.css
6517	a25af122fba29d9be3909efd1a2eb6ccc21c27a4	src/css/artists/index.css
9619	4a3dc7a2f7c24d976615344c88adf43fdbb5ad06	src/css/assistant/chat.css
1864	d9de513ed83f2080dd76474cb15e5a1e53e009b8	src/css/base.css
9298	e91e1e87c6aa4704f545fd0de4940fa6238d575a	src/css/comments.css
428	58f7008c5631ff5e6af879c0a0ebfaee222afbc6	src/css/container.css
3244	fcc2f534f8889fc9d1294d85d99e6f8a6b14e69d	src/css/footer.css
5538	6b57ad3b306de01cfd269f93b7c60a5694db4a7d	src/css/header.css
5064	93c0e5fc9d2d174716aae96fde61ce666fec1666	src/css/hero.css
0	e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	src/css/modal.css
318	5d43d070dc815f84dd324c88544c4e104f2dbb5f	src/css/reset.css
1273	1a88be1185c0312b902a9dc900758c79bbc534d4	src/css/styles.css
571832	6150548e61f1d0d46bf0b12744e47cd89bc2f1fe	src/img/about/about-desk-2x.png
171473	7cd7ee08c7b67ba8148d6e7b62be0d56a92d49fb	src/img/about/about-desk.png
89777	44315e1c5e31fc47b7cf585bb0fa4d2c3da974e5	src/img/about/about-mob-2x.png
27979	f2fe50cb9f99eedb62344c318799257b898088ba	src/img/about/about-mob.png
392728	bf31a13eca15142e012df68d1086b6d30409f919	src/img/about/about-tabl-2x.png
122595	c01e92bf134ed92f49113a2250f1d228d4d04684	src/img/about/about-tabl.png
726813	bdeb41f013677938eeeb3afe43952560b3a188bd	src/img/hero/hero-desk-2x.png
231697	9d753a4be4257d832b8c8b7d24b219c29d8e3ee0	src/img/hero/hero-desk.png
149726	134ed321dbb547a609b886b1e9a0c432bb08fa74	src/img/hero/hero-mob-2x.png
45869	b4b620c67ea3f7fff6cd5079e002c1a6fb3090a1	src/img/hero/hero-mob.png
545508	da90597aa1c04fb26e0b3f32ac95a2ddeef3b79a	src/img/hero/hero-tabl-2x.png
166900	d20915c351e529950b876969d9965f40e6157919	src/img/hero/hero-tabl.png
22883	e8b04210c4ceb37a06772d7c0cb844a866a88884	src/img/sprite.svg
1675	07669e8091c1d8989728b4f86da91f4ed3dd8103	src/index.html
6686	0c01a3e55f4b606e8245de5a3882d962f82ddf0b	src/js/api.js
2911	8b8f794ef5e6f95b6942fea6b99b6f94767a1fb8	src/js/artists/features/api.js
20625	e7ef9cfa1eff616e6819621efa552ffa51648d9f	src/js/artists/features/grid.js
749	04f7c5fee8d19fa8fe3ebe0354b60262af0a6913	src/js/artists/features/init.js
5940	cbcb3f4274d3ccf21a96811b1beab2cc95813238	src/js/artists/features/mixradio-menu.js
11692	5e400c38554e7ef0bcacb117a202700162e24285	src/js/artists/features/modal.js
7661	047646082143b5815c8006f9ae046de4106d082a	src/js/artists/features/player-patch.js
36050	76631a3becc3a7971606ebeeb94fe193b868b66f	src/js/artists/features/player.js
1367	886f15a116070d118e77fbe29e03f1187fa8a045	src/js/artists/features/prefetch.js
1419	a2572fe65e8b6bc170a4e4f76cc086a0344cc717	src/js/artists/features/router.js
4969	39bf1a97bd78559d76218eb4fd4002d91fa5809e	src/js/artists/features/state.js
6833	9d0c85b5f48a6e3c62db42044e08f2f91e9a598f	src/js/artists/features/yt-catalog-provider.js
8612	cc6d1e09b877394f9c34c4c08787c59e1549256c	src/js/artists/features/zoom.js
10071	ca5a1ea384009c5cdada763b7003b092d9027e7d	src/js/artists/index.js
1292	18ed610d66bd9f9b9602d1d40a1e018aef33c26b	src/js/artists/lib/scroll-lock.js
3822	08ad23667a1f493c41e3f2d95ec59d55c1ef502d	src/js/artists/lib/sound.js
1105	74b455fddcd2e40a485d4f95087f4a12afc24f45	src/js/artists/lib/toast.js
2251	3da9584bb2d1beda81451e495b4523eebaf5cfa4	src/js/assistant/assistant-hooks.js
5019	75dfcf1fef9e3fd09aea3ed96b39cd9d1e75d108	src/js/assistant/bridge.js
60807	178382235193088c9c9dc22c15f34e30c3ca2292	src/js/assistant/chat.js
1551	858b1de20e159de45ba5431b6fb3b7ac687c6225	src/js/assistant/hooks.js
10562	2cb2bce8223c513ad35109201787a2f160c55b64	src/js/comments.js
0	e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	src/js/footer.js
3160	53f2e663eed1e45124a8fcb78216f2dd2a2a3499	src/js/global-sfx.js
7165	cf6a27edff25b05b90c5dcf1345564ff4725794e	src/js/header.js
4	139597f9cb07c5d48bed18984ec4747f4b4f3438	src/js/hero.js
0	e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	src/js/modal.js
219	9a1fd48bf33ab7f30d5cd29568449bb5624e18b4	src/js/shared/sprite.js
517	69f42ec2151deeeb106b69c33541fe193d3ddf04	src/main.js
1403	d13913ebc3f51f7b64c71bd8ec46ca34e3e8af0c	src/partials/about.html
5277	d090c1a50f4408fd5a2126bc3c3ef84903a4c4ae	src/partials/artists.html
1840	65ab2f5df5a5dfb50dde6dae284a2467cb7d0ddb	src/partials/comments.html
2391	6ca23fb7de6845a1d498a3a6554b5f4ab255b1bd	src/partials/footer.html
2430	b5968c74b9b5c687ed5c90cc3cac8a30649350c0	src/partials/header.html
775	306efab19796514d6f8e52ba0044c485077d4ab5	src/partials/hero.html
0	e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	src/partials/modal.html
2890	82f4dea1e5064b6e5d92db46f9fa37bf762b0abf	src/public/logo-icon.svg
60	664ffad81fd9c04a42fb37518726da4ddfa933f2	stylelint.config.cjs
180	96ba8f869ef42c797bfef24e19dbd62cdbe3732d	tts_debug.json
170	ea028ac0626e3de8f886c06039b3666f63cc9a72	types/vite-plugins.d.ts
0	e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	vite
1897	4766f10771b2775c708c061dfe92722824782516	vite.config.js

```

---
## assistant_bundle_20250912_153759/PROJECT_TREE.txt

**size:** 2964 bytes &nbsp;&nbsp; **sha1:** `c67e07889d87380a7c3b5995886f5467d854d16c`

```text
# Project file list

 - assistant_bundle_20250912_153759/_meta/all_files.list
 - .editorconfig
 - .github/workflows/pages.yml
 - .gitignore
 - .prettierrc.json
 - README.md
 - artisthub@1.0.0
 - concurrently
 - eslint.config.js
 - export_for_chat.sh
 - jsconfig.json
 - node
 - package-lock.json
 - package.backup.json
 - package.json
 - plan.txt
 - postcss.config.cjs
 - reports/README-cleanup.md
 - reports/unreachable_js.json
 - reports/unused_selectors.json
 - reports/zero_size_files.txt
 - server/index.mjs
 - server/search-fallback.mjs
 - server/tts.mjs
 - share.patch
 - src/css/about.css
 - src/css/artists.css
 - src/css/artists/artist.zoom.css
 - src/css/artists/artists.anim.css
 - src/css/artists/artists.base.css
 - src/css/artists/artists.card.css
 - src/css/artists/artists.controls.css
 - src/css/artists/artists.filters.css
 - src/css/artists/artists.grid.css
 - src/css/artists/artists.modal.css
 - src/css/artists/artists.pager.css
 - src/css/artists/artists.player.css
 - src/css/artists/artists.skeleton.css
 - src/css/artists/artists.toolbar.css
 - src/css/artists/index.css
 - src/css/assistant/chat.css
 - src/css/base.css
 - src/css/comments.css
 - src/css/container.css
 - src/css/footer.css
 - src/css/header.css
 - src/css/hero.css
 - src/css/modal.css
 - src/css/reset.css
 - src/css/styles.css
 - src/img/about/about-desk-2x.png
 - src/img/about/about-desk.png
 - src/img/about/about-mob-2x.png
 - src/img/about/about-mob.png
 - src/img/about/about-tabl-2x.png
 - src/img/about/about-tabl.png
 - src/img/hero/hero-desk-2x.png
 - src/img/hero/hero-desk.png
 - src/img/hero/hero-mob-2x.png
 - src/img/hero/hero-mob.png
 - src/img/hero/hero-tabl-2x.png
 - src/img/hero/hero-tabl.png
 - src/img/sprite.svg
 - src/index.html
 - src/js/api.js
 - src/js/artists/features/api.js
 - src/js/artists/features/grid.js
 - src/js/artists/features/init.js
 - src/js/artists/features/mixradio-menu.js
 - src/js/artists/features/modal.js
 - src/js/artists/features/player-patch.js
 - src/js/artists/features/player.js
 - src/js/artists/features/prefetch.js
 - src/js/artists/features/router.js
 - src/js/artists/features/state.js
 - src/js/artists/features/yt-catalog-provider.js
 - src/js/artists/features/zoom.js
 - src/js/artists/index.js
 - src/js/artists/lib/scroll-lock.js
 - src/js/artists/lib/sound.js
 - src/js/artists/lib/toast.js
 - src/js/assistant/assistant-hooks.js
 - src/js/assistant/bridge.js
 - src/js/assistant/chat.js
 - src/js/assistant/hooks.js
 - src/js/comments.js
 - src/js/footer.js
 - src/js/global-sfx.js
 - src/js/header.js
 - src/js/hero.js
 - src/js/modal.js
 - src/js/shared/sprite.js
 - src/main.js
 - src/partials/about.html
 - src/partials/artists.html
 - src/partials/comments.html
 - src/partials/footer.html
 - src/partials/header.html
 - src/partials/hero.html
 - src/partials/modal.html
 - src/public/logo-icon.svg
 - stylelint.config.cjs
 - tts_debug.json
 - types/vite-plugins.d.ts
 - vite
 - vite.config.js

```

---
## assistant_bundle_20250912_153759/README_FOR_CHAT.md

**size:** 408 bytes &nbsp;&nbsp; **sha1:** `b32b585ffd4232ff61bb9efc9881713d69c84487`

```markdown
# Assistant export
- PROJECT_TREE.txt — дерево/список файлов.
- MANIFEST.tsv — размер/sha1/путь каждого файла.
- BINARIES.tsv — бинарные файлы.
- CONTENTS.md — содержимое текстовых файлов (с лимитами).
- _snapshot/ — копия проекта (без node_modules и т.п.) для оффлайн-обзора.

```

---
## assistant_bundle_20250912_153759/_meta/all_files.list

**size:** 2625 bytes &nbsp;&nbsp; **sha1:** `764acea5a48ab92577e6a7026cfa90d9a86d1a4c`

```text
assistant_bundle_20250912_153759/_meta/all_files.list
.editorconfig
.github/workflows/pages.yml
.gitignore
.prettierrc.json
README.md
artisthub@1.0.0
concurrently
eslint.config.js
export_for_chat.sh
jsconfig.json
node
package-lock.json
package.backup.json
package.json
plan.txt
postcss.config.cjs
reports/README-cleanup.md
reports/unreachable_js.json
reports/unused_selectors.json
reports/zero_size_files.txt
server/index.mjs
server/search-fallback.mjs
server/tts.mjs
share.patch
src/css/about.css
src/css/artists.css
src/css/artists/artist.zoom.css
src/css/artists/artists.anim.css
src/css/artists/artists.base.css
src/css/artists/artists.card.css
src/css/artists/artists.controls.css
src/css/artists/artists.filters.css
src/css/artists/artists.grid.css
src/css/artists/artists.modal.css
src/css/artists/artists.pager.css
src/css/artists/artists.player.css
src/css/artists/artists.skeleton.css
src/css/artists/artists.toolbar.css
src/css/artists/index.css
src/css/assistant/chat.css
src/css/base.css
src/css/comments.css
src/css/container.css
src/css/footer.css
src/css/header.css
src/css/hero.css
src/css/modal.css
src/css/reset.css
src/css/styles.css
src/img/about/about-desk-2x.png
src/img/about/about-desk.png
src/img/about/about-mob-2x.png
src/img/about/about-mob.png
src/img/about/about-tabl-2x.png
src/img/about/about-tabl.png
src/img/hero/hero-desk-2x.png
src/img/hero/hero-desk.png
src/img/hero/hero-mob-2x.png
src/img/hero/hero-mob.png
src/img/hero/hero-tabl-2x.png
src/img/hero/hero-tabl.png
src/img/sprite.svg
src/index.html
src/js/api.js
src/js/artists/features/api.js
src/js/artists/features/grid.js
src/js/artists/features/init.js
src/js/artists/features/mixradio-menu.js
src/js/artists/features/modal.js
src/js/artists/features/player-patch.js
src/js/artists/features/player.js
src/js/artists/features/prefetch.js
src/js/artists/features/router.js
src/js/artists/features/state.js
src/js/artists/features/yt-catalog-provider.js
src/js/artists/features/zoom.js
src/js/artists/index.js
src/js/artists/lib/scroll-lock.js
src/js/artists/lib/sound.js
src/js/artists/lib/toast.js
src/js/assistant/assistant-hooks.js
src/js/assistant/bridge.js
src/js/assistant/chat.js
src/js/assistant/hooks.js
src/js/comments.js
src/js/footer.js
src/js/global-sfx.js
src/js/header.js
src/js/hero.js
src/js/modal.js
src/js/shared/sprite.js
src/main.js
src/partials/about.html
src/partials/artists.html
src/partials/comments.html
src/partials/footer.html
src/partials/header.html
src/partials/hero.html
src/partials/modal.html
src/public/logo-icon.svg
stylelint.config.cjs
tts_debug.json
types/vite-plugins.d.ts
vite
vite.config.js

```

---
## assistant_bundle_20250912_153759/_meta/include_files.list

**size:** 2606 bytes &nbsp;&nbsp; **sha1:** `aa80931c70664d9cbebbb3fd92c90be44677c32b`

```text
assistant_bundle_20250912_153759/_meta/all_files.list
.editorconfig
.github/workflows/pages.yml
.gitignore
.prettierrc.json
README.md
artisthub@1.0.0
concurrently
eslint.config.js
jsconfig.json
node
package-lock.json
package.backup.json
package.json
plan.txt
postcss.config.cjs
reports/README-cleanup.md
reports/unreachable_js.json
reports/unused_selectors.json
reports/zero_size_files.txt
server/index.mjs
server/search-fallback.mjs
server/tts.mjs
share.patch
src/css/about.css
src/css/artists.css
src/css/artists/artist.zoom.css
src/css/artists/artists.anim.css
src/css/artists/artists.base.css
src/css/artists/artists.card.css
src/css/artists/artists.controls.css
src/css/artists/artists.filters.css
src/css/artists/artists.grid.css
src/css/artists/artists.modal.css
src/css/artists/artists.pager.css
src/css/artists/artists.player.css
src/css/artists/artists.skeleton.css
src/css/artists/artists.toolbar.css
src/css/artists/index.css
src/css/assistant/chat.css
src/css/base.css
src/css/comments.css
src/css/container.css
src/css/footer.css
src/css/header.css
src/css/hero.css
src/css/modal.css
src/css/reset.css
src/css/styles.css
src/img/about/about-desk-2x.png
src/img/about/about-desk.png
src/img/about/about-mob-2x.png
src/img/about/about-mob.png
src/img/about/about-tabl-2x.png
src/img/about/about-tabl.png
src/img/hero/hero-desk-2x.png
src/img/hero/hero-desk.png
src/img/hero/hero-mob-2x.png
src/img/hero/hero-mob.png
src/img/hero/hero-tabl-2x.png
src/img/hero/hero-tabl.png
src/img/sprite.svg
src/index.html
src/js/api.js
src/js/artists/features/api.js
src/js/artists/features/grid.js
src/js/artists/features/init.js
src/js/artists/features/mixradio-menu.js
src/js/artists/features/modal.js
src/js/artists/features/player-patch.js
src/js/artists/features/player.js
src/js/artists/features/prefetch.js
src/js/artists/features/router.js
src/js/artists/features/state.js
src/js/artists/features/yt-catalog-provider.js
src/js/artists/features/zoom.js
src/js/artists/index.js
src/js/artists/lib/scroll-lock.js
src/js/artists/lib/sound.js
src/js/artists/lib/toast.js
src/js/assistant/assistant-hooks.js
src/js/assistant/bridge.js
src/js/assistant/chat.js
src/js/assistant/hooks.js
src/js/comments.js
src/js/footer.js
src/js/global-sfx.js
src/js/header.js
src/js/hero.js
src/js/modal.js
src/js/shared/sprite.js
src/main.js
src/partials/about.html
src/partials/artists.html
src/partials/comments.html
src/partials/footer.html
src/partials/header.html
src/partials/hero.html
src/partials/modal.html
src/public/logo-icon.svg
stylelint.config.cjs
tts_debug.json
types/vite-plugins.d.ts
vite
vite.config.js

```

---
## assistant_bundle_20250912_153759/_snapshot/.editorconfig

**size:** 176 bytes &nbsp;&nbsp; **sha1:** `7625fcfed64b885d49d6cefda49dc5307b9a70c7`

```text
root = true

[*]
indent_style = space
indent_size = 2
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = false

[*.{json,md,yaml}]
indent_size = 2
```

---
## assistant_bundle_20250912_153759/_snapshot/.github/workflows/pages.yml

**size:** 1170 bytes &nbsp;&nbsp; **sha1:** `c8810d54e53f77406d2ee521498aca0028b56a25`

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [main] # запускаем деплой при пуше в main
  workflow_dispatch: # и руками можно запустить из Actions

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: 'pages'
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      # Если есть package-lock.json — используем ci, иначе install
      - name: Install deps
        run: |
          if [ -f package-lock.json ]; then
            npm ci
          else
            npm install
          fi

      - name: Build
        run: npm run build

      - uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - id: deployment
        uses: actions/deploy-pages@v4

```

---
## assistant_bundle_20250912_153759/_snapshot/.gitignore

**size:** 323 bytes &nbsp;&nbsp; **sha1:** `e1d9b3755cacb0f01a4760ce81d3b138cd8e314a`

```text
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

# local archives
*.zip

# secrets
.env

```

---
## assistant_bundle_20250912_153759/_snapshot/.prettierrc.json

**size:** 195 bytes &nbsp;&nbsp; **sha1:** `3fed31356b2e6e44d4169242f01b7577b5f0d376`

```json
{
  "printWidth": 80,
  "useTabs": false,
  "semi": true,
  "singleQuote": true,
  "trailingComma": "es5",
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "proseWrap": "always"
}

```

---
## assistant_bundle_20250912_153759/_snapshot/README.md

**size:** 3845 bytes &nbsp;&nbsp; **sha1:** `ec4e51d79b67ecac89954b6173274b7ce0862fef`

```markdown
# ArtistsHub — Force Tech 07

**Українська | [English below](#english-version)**

> Платформа для відкриття нових артистів. Ціль — довести користувача з першого
> екрана до релевантних виконавців за кілька кліків.

---

## Зміст

- [Огляд](#огляд)
- [Демо](#демо)
- [Ключові можливості](#ключові-можливості)
- [Технології](#технології)
- [Архітектура на рівні модулів](#архітектура-на-рівні-модулів)
- [Локальний запуск](#локальний-запуск)
- [Скрипти](#скрипти)
- [Структура проєкту](#структура-проєкту)
- [Доступність та продуктивність](#доступність-та-продуктивність)
- [Дорожня карта](#дорожня-карта)
- [Ліцензія](#ліцензія)

---

## Огляд

**ArtistsHub** — веб-додаток, що допомагає швидко знаходити нових улюблених
артистів.

- **Перший/головний екран (Hero):** миттєво читається меседж і помітний CTA
  **Explore Artists** із плавним скролом до каталогу.
- **Каталог:** рендер по **8 карток** — оптимальний баланс швидкості та
  читабельності.
- **Керування:** пошук, сортування, фільтр за жанрами, кнопка **Reset**.
- **Пагінація:** зрозумілий активний стан, скорочення діапазонів через «…».
- **Фокус на UX:** чиста типографіка, емоційний колаж, логічні флоу.

## Демо

Посилання на GitHub Pages: **_(додай URL репозиторію тут)_**

---

## Ключові можливості

- Плавний керований перехід з Hero до каталогу (smooth scroll).
- Батчинг даних і ліниве завантаження зображень.
- Зручна панель фільтрів з дебаунсом пошуку.
- Семантична розмітка та коректні focus states для клавіатурної навігації.
- Чиста пагінація для великих обсягів каталогу.

## Технології

- **Vite** — девсервер і білд
- **Vanilla JS (ES Modules)**
- **Axios** — HTTP-запити
- **iziToast** — нотифікації (опційно)
- **CSS / SCSS** — адаптивна сітка, змінні, темінг

---

## Архітектура на рівні модулів

- `src/js/api.js` — запити до API (`/api/artists?limit=8&page=n`,
  `/api/artists/:id`)
- `src/js/catalog/filters.js` — пошук, сортування, жанри, debounce
- `src/js/catalog/pagination.js` — логіка сторінок і відмальовування контролів
- `src/js/catalog/render.js` — шаблони карток, батчинг на 8 елементів
- `src/js/ux/smooth-scroll.js` — плавний скрол до каталогу з Hero
- `src/js/ux/a11y.js` — фокус-кільця, aria-атрибути
- `src/css/` — базові стилі, токени, адаптив

> За потреби базовий URL API змінюється прямо в `api.js`.

---

## Локальний запуск

**Вимоги:** Node.js 18+

```bash
npm install
npm run dev
```

```

---
## assistant_bundle_20250912_153759/_snapshot/assistant_bundle_20250912_153759/_meta/all_files.list

**size:** 2625 bytes &nbsp;&nbsp; **sha1:** `764acea5a48ab92577e6a7026cfa90d9a86d1a4c`

```text
assistant_bundle_20250912_153759/_meta/all_files.list
.editorconfig
.github/workflows/pages.yml
.gitignore
.prettierrc.json
README.md
artisthub@1.0.0
concurrently
eslint.config.js
export_for_chat.sh
jsconfig.json
node
package-lock.json
package.backup.json
package.json
plan.txt
postcss.config.cjs
reports/README-cleanup.md
reports/unreachable_js.json
reports/unused_selectors.json
reports/zero_size_files.txt
server/index.mjs
server/search-fallback.mjs
server/tts.mjs
share.patch
src/css/about.css
src/css/artists.css
src/css/artists/artist.zoom.css
src/css/artists/artists.anim.css
src/css/artists/artists.base.css
src/css/artists/artists.card.css
src/css/artists/artists.controls.css
src/css/artists/artists.filters.css
src/css/artists/artists.grid.css
src/css/artists/artists.modal.css
src/css/artists/artists.pager.css
src/css/artists/artists.player.css
src/css/artists/artists.skeleton.css
src/css/artists/artists.toolbar.css
src/css/artists/index.css
src/css/assistant/chat.css
src/css/base.css
src/css/comments.css
src/css/container.css
src/css/footer.css
src/css/header.css
src/css/hero.css
src/css/modal.css
src/css/reset.css
src/css/styles.css
src/img/about/about-desk-2x.png
src/img/about/about-desk.png
src/img/about/about-mob-2x.png
src/img/about/about-mob.png
src/img/about/about-tabl-2x.png
src/img/about/about-tabl.png
src/img/hero/hero-desk-2x.png
src/img/hero/hero-desk.png
src/img/hero/hero-mob-2x.png
src/img/hero/hero-mob.png
src/img/hero/hero-tabl-2x.png
src/img/hero/hero-tabl.png
src/img/sprite.svg
src/index.html
src/js/api.js
src/js/artists/features/api.js
src/js/artists/features/grid.js
src/js/artists/features/init.js
src/js/artists/features/mixradio-menu.js
src/js/artists/features/modal.js
src/js/artists/features/player-patch.js
src/js/artists/features/player.js
src/js/artists/features/prefetch.js
src/js/artists/features/router.js
src/js/artists/features/state.js
src/js/artists/features/yt-catalog-provider.js
src/js/artists/features/zoom.js
src/js/artists/index.js
src/js/artists/lib/scroll-lock.js
src/js/artists/lib/sound.js
src/js/artists/lib/toast.js
src/js/assistant/assistant-hooks.js
src/js/assistant/bridge.js
src/js/assistant/chat.js
src/js/assistant/hooks.js
src/js/comments.js
src/js/footer.js
src/js/global-sfx.js
src/js/header.js
src/js/hero.js
src/js/modal.js
src/js/shared/sprite.js
src/main.js
src/partials/about.html
src/partials/artists.html
src/partials/comments.html
src/partials/footer.html
src/partials/header.html
src/partials/hero.html
src/partials/modal.html
src/public/logo-icon.svg
stylelint.config.cjs
tts_debug.json
types/vite-plugins.d.ts
vite
vite.config.js

```

---
## assistant_bundle_20250912_153759/_snapshot/eslint.config.js

**size:** 1141 bytes &nbsp;&nbsp; **sha1:** `9c4efdfb845a3572e005fd7700109cfdea0c83f2`

```javascript
// eslint.config.js
import js from "@eslint/js";
import globals from "globals";

export default [
  // игнор сборок/отчётов
  { ignores: ["dist/**", "reports/**", "node_modules/**"] },

  // базовые рекомендации
  js.configs.recommended,

  // конфиги (Node-окружение)
  {
    files: ["vite.config.js", "postcss.config.cjs", "eslint.config.js"],
    languageOptions: {
      ecmaVersion: 2022,
      sourceType: "module",
      globals: { ...globals.node }
    }
  },

  // исходники (браузер)
  {
    files: ["src/**/*.js"],
    languageOptions: {
      ecmaVersion: 2022,
      sourceType: "module",
      globals: { ...globals.browser }
    },
    rules: {
      "no-undef": "error",
      // временно выключаем, чтобы пустые блоки не сыпались ошибками
      "no-empty": "off",
      // предупреждения за неиспользуемые — оставим мягко
      "no-unused-vars": ["warn", { argsIgnorePattern: "^_", varsIgnorePattern: "^_" }]
    }
  }
];

```

---
## assistant_bundle_20250912_153759/_snapshot/jsconfig.json

**size:** 276 bytes &nbsp;&nbsp; **sha1:** `dfc9e9f061f6440d067178ce7c6f73838770c338`

```json
{
  "compilerOptions": {
    "checkJs": true,
    "target": "ES2022",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "allowJs": true,
    "baseUrl": "./src"
  },
  "exclude": ["dist", "node_modules"]
}

```

---
## assistant_bundle_20250912_153759/_snapshot/package-lock.json (skipped, 326341 bytes > 204800)


---
## assistant_bundle_20250912_153759/_snapshot/package.backup.json

**size:** 1937 bytes &nbsp;&nbsp; **sha1:** `87007a1ad8f8612617969e526e68c71b1d234ce3`

```json
{
  "name": "Artisthub-continuation",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "author": "Sergii Pavlov",
  "license": "ISC",
  "browserslist": [
    ">=0.5%",
    "last 2 versions",
    "not dead"
  ],
  "scripts": {
    "dev": "vite",
        "api": "node server/index.mjs",
    "dev:all": "npm run api & npm run dev"
    "dev:host": "vite --host",
    "build": "vite build",
    "build:local": "cross-env VITE_BASE=/ vite build",
    "preview": "vite preview",
    "preview:local": "npm run build:local && vite preview",
    "preview:nopurge": "cross-env NO_PURGE=1 VITE_BASE=/ vite build && vite preview",
    "preview:nosort": "cross-env NO_MQ_SORT=1 VITE_BASE=/ vite build && vite preview",
    "lint:js": "eslint .",
    "lint:css": "stylelint \"src/**/*.css\"",
    "lint:fix": "eslint . --fix",
    "doctor": "npm run lint:js && npm run lint:css && vite build",
    "analyze": "cross-env ANALYZE=1 vite build && node -e \"console.log('Open dist/stats.html')\""
  },
  "dependencies": {
    "axios": "^1.11.0",
    "cors": "^2.8.5",
    "css-star-rating": "^1.3.1",
    "dotenv": "^17.2.2",
    "express": "^5.1.0",
    "izitoast": "^1.4.0",
    "openai": "^5.19.1",
    "swiper": "^11.2.10",
    "tui-pagination": "^3.4.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.11.0",
    "@types/node": "^24.3.1",
    "autoprefixer": "^10.4.20",
    "cross-env": "^10.0.0",
    "cssnano": "^6.1.2",
    "eslint": "^9.11.0",
    "glob": "^11.0.0",
    "globals": "^15.8.0",
    "postcss": "^8.4.41",
    "postcss-discard-duplicates": "^6.0.3",
    "postcss-sort-media-queries": "^5.2.0",
    "rollup-plugin-visualizer": "^6.0.3",
    "stylelint": "^16.8.1",
    "stylelint-config-standard": "^36.0.0",
    "vite": "^5.4.6",
    "vite-plugin-full-reload": "^1.2.0",
    "vite-plugin-html-inject": "^1.1.2",
    "vite-plugin-purgecss": "^0.2.13"
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/package.json

**size:** 2039 bytes &nbsp;&nbsp; **sha1:** `47d3684c03c74db764584302b7e97b7e514005a6`

```json
{
  "name": "artisthub",
  "version": "1.0.0",
  "type": "module",
  "private": true,
  "engines": {
    "node": ">=18.17"
  },
  "scripts": {
    "dev": "vite",
    "dev:host": "vite --host",
    "build": "vite build",
    "build:pages": "cross-env VITE_BASE=/Artisthub-continuation/ vite build",
    "build:local": "cross-env VITE_BASE=/ vite build",
    "preview": "vite preview",
    "preview:local": "npm run build:local && vite preview",
    "lint:js": "eslint \"src/**/*.js\" --fix",
    "lint:css": "stylelint \"src/**/*.scss\" --fix",
    "style": "sass src/scss/app.scss:dist/app.css --no-source-map --load-path=node_modules",
    "style:watch": "sass --watch src/scss/app.scss:dist/app.css --no-source-map --load-path=node_modules",
    "svgo": "svgo -f src/img/svg -o src/img/svg",
    "prepare": "husky install",
    "server": "node server/index.mjs",
    "server:watch": "node --watch server/index.mjs",
    "all": "concurrently -n FRONT,API -c cyan,magenta \"npm:dev\" \"npm:server\""
  },
  "overrides": {
    "strip-ansi": "7.1.0"
  },
  "dependencies": {
    "axios": "^1.11.0",
    "cookie-parser": "^1.4.7",
    "cors": "^2.8.5",
    "dotenv": "^16.6.1",
    "express": "^4.21.2",
    "izitoast": "^1.4.0",
    "node-fetch": "^3.3.2",
    "swiper": "^10.3.1"
  },
  "devDependencies": {
    "@csstools/postcss-sass": "^5.1.0",
    "@eslint/js": "^9.9.0",
    "autoprefixer": "^10.4.19",
    "concurrently": "^9.0.0",
    "cross-env": "^10.0.0",
    "eslint": "^9.9.0",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.29.1",
    "eslint-plugin-prettier": "^5.1.3",
    "glob": "^11.0.3",
    "husky": "^9.1.6",
    "postcss": "^8.4.38",
    "prettier": "^3.3.3",
    "sass": "^1.77.6",
    "stylelint": "^16.6.1",
    "stylelint-config-standard-scss": "^14.0.0",
    "svgo": "^3.3.2",
    "vite": "^5.4.2",
    "vite-plugin-full-reload": "^1.2.0",
    "vite-plugin-html-inject": "^1.1.2",
    "vite-plugin-purgecss": "^0.2.13"
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/plan.txt

**size:** 7021 bytes &nbsp;&nbsp; **sha1:** `0f4e7786e299855212ad2d7025f0b5d6c7357d6f`

```text
npm run all

План на продукт

Web-приложение сейчас, мобильное потом

Делаем сайт как PWA (офлайн-кэш аудио/UI, быстрый старт).

Потом оборачиваем тот же фронт в Capacitor/React Native → Android/iOS
 (общий кодовый базис, общий бэкенд).

Две ИИ-линии

Free (локальная/дешёвая): LM Studio или Ollama на вашей машине/сервере. 
Никакой поминутной оплаты, скорость/умность зависят от железа и выбранной модели 
(Qwen2 7–14B / Llama3 8B и т.п.).

Pro (облако): OpenAI (например, gpt-4o-mini по умолчанию, опция gpt-4o для “супер-умного”). 
Оплата по токенам — только на вашей стороне, ключ хранится на сервере.

Единый бэкенд с переключателем провайдера

В .env:

PROVIDER=openai|lmstudio|ollama
OPENAI_API_KEY=...
OPENAI_MODEL=gpt-4o-mini
LLM_BASE_URL=http://localhost:1234/v1     # LM Studio (OpenAI-совместим)
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama3:instruct


На сервере одна функция askLLM(messages, {mode}), которая внутри отправляет запрос 
либо в OpenAI, либо в LM Studio (тот же OpenAI-совместимый /v1/chat/completions), либо в Ollama (их формат).

На фронте — маленький переключатель: “Режим: БЕСПЛАТНЫЙ / ПРО” (или “Эконом/Умный”). 
Запрос уходит с флагом, сервер решает, к кому идти.

Память диалогов (короткая + долговременная)

Уже есть cookie-session и оперативная история. Добавим SQLite (или файл JSON) на бэкенде:

sessions(id, created_at, last_seen)

messages(session_id, role, content, ts)

profile(session_id, prefs_json) — жанры/артисты/язык/громкость и т.д.

Раз в N сообщений делаем сжатое резюме (“что любит пользователь, что уже слушал”) и 
подмешиваем в system → ассистент помнит “характер” диалога между заходами.

Кнопка “Очистить память” (GDPR-friendly).

Голос: минимально бесплатно + опции

Сейчас оставляем браузерный TTS/SR (нулевая цена, без серверных затрат).

Опционально для Pro:

STT: локальный Whisper (faster-whisper) или облачный (качественнее).

TTS: Piper (офлайн, RU-голоса ок) или облачный (лучшее качество/голоса).

Музыка/видео и надёжное воспроизведение

YouTube: уже делаем videoEmbeddable=true, чёрный список ID, автопропуск недоступных
 треков → очередь продолжает играть.

Для рекомендаций: ассистент возвращает JSON-действия (мы это примем и выполним),
 а при “включи X” сервер сам добывает ID через YouTube Data API.

Позже можно добавить альтернативные источники (Bandcamp/архивы с встраиванием) — 
главное, чтобы было легально и встраиваемо. Фильмы — отдельная лицензия/провайдер,
 предлагаю отложить до стабильной музыки.

UX и контроль качества

В чате переключатель: “Бесплатный / Умный”, индикатор провайдера (у вас уже есть бейдж “AI”).

Кнопка “Пояснить выбор” (модель даёт краткий мотив — у нас поле explain).

“Играть сразу” vs “Только предложить” — ассистент отдаёт autoplay:true/false.

Для мобильного: крупные кнопки транспорта, кнопка “Микс-радио”, быстрые жанровые пресеты.

Монетизация (на будущее)

Free: локальная модель + браузерный TTS, ограничение длины ответа/частоты.

Pro: OpenAI-модели, облачный TTS, длинные ответы, улучшенная память.

Технически — флаг в JWT/куке; по флагу сервер выбирает провайдера и лимиты.

Что делаем прямо сейчас (без переписывания ваших наработок)

Добавляю в ваш сервер “переключатель провайдера” (OpenAI/LM Studio/Ollama) — 
чтобы вы могли хоть сейчас тестить бесплатную локальную модель и моментально щёлкать в облако.

Оставляю ваш строгий JSON-протокол для действий плеера и автопропуск недоступных роликов — э
то уже работает и не ломаем.

Включаю долговременную память (SQLite-файл рядом с сервером) — с автосжатием истории.

Если готовы — скажите какой бесплатный вариант стартуем:

LM Studio (проще всего, тот же /v1/chat/completions)

Ollama (нужна отдельная ветка запроса, зато очень гибко)

Я подготовлю полные файлы (не урезанные), строго поверх ваших текущих:

server/index.mjs (с провайдерами + JSON-валидацией + долговременной памятью)

.env.example (все ключи/флаги)

при необходимости — минимальные правки в вашем chat.js только для добавления 
UI-переключателя “Бесплатный/Про” (весь файл целиком).

Так мы получим: бесплатный, удобный, расширяемый сайт уже сейчас — и понятный 
путь к “супер-умному” уровню и мобильным приложениям, когда решите включить ПРО-провайдера.

```

---
## assistant_bundle_20250912_153759/_snapshot/postcss.config.cjs

**size:** 1409 bytes &nbsp;&nbsp; **sha1:** `57d956a4b4a46e7097b33dd401f62227ced54ae9`

```text
// postcss.config.cjs
// Флаги (ставь через cross-env в npm-скриптах):
//   NO_MQ_SORT=1     — отключить сортировку медиазапросов
//   MEDIA_SORT=desktop-first | mobile-first (по умолчанию mobile-first)
//   NO_MINIFY=1      — отключить минификацию (cssnano)

function safeRequire(name) {
  try { return require(name); } catch { return null; }
}

const plugins = [];

// 1) Сортировка медиазапросов (может влиять на каскад)
if (process.env.NO_MQ_SORT !== '1') {
  const sortMq = safeRequire('postcss-sort-media-queries');
  if (sortMq) {
    const mode = (process.env.MEDIA_SORT || 'mobile-first').toLowerCase();
    plugins.push(sortMq({ sort: mode }));
  }
}

// 2) Удаление дублей
const discardDuplicates = safeRequire('postcss-discard-duplicates');
if (discardDuplicates) plugins.push(discardDuplicates);

// 3) Autoprefixer (не обязателен; подключится, только если установлен)
const autoprefixer = safeRequire('autoprefixer');
if (autoprefixer) plugins.push(autoprefixer());

// 4) Минификация
if (process.env.NO_MINIFY !== '1') {
  const cssnano = safeRequire('cssnano');
  if (cssnano) plugins.push(cssnano({ preset: 'default' }));
}

module.exports = { plugins };

```

---
## assistant_bundle_20250912_153759/_snapshot/reports/README-cleanup.md

**size:** 1616 bytes &nbsp;&nbsp; **sha1:** `a12163f15d5580a6a8f5855b6572803aafa80fba`

```markdown
# Cleanup v1 (auto)

Что сделано:
- Удалены пустые импорты в `src/main.js` (footer.js, modal.js).
- В `src/css/styles.css` удалён пустой импорт `./modal.css`.
- Добавлены базовые конфиги линтеров: ESLint, Stylelint, PostCSS (cssnano).
- Сгенерированы отчёты:
  - `reports/unused_selectors.json` — потенциально неиспользуемые классы/ID (оценка, возможны ложные).
  - `reports/unreachable_js.json` — JS-файлы вне импорт-графа (могут быть задействованы динамически).
  - `reports/zero_size_files.txt` — файлы нулевого размера.

**Примечание:** Никакие стили/модули не удалялись физически (кроме импорт-строк) — чтобы не сломать поведение. Для физического удаления рекомендуем пройтись по отчётам и удалить вручную или доверить ассистенту следующий шаг ("Cleanup v2 — безопасное удаление").

Изменения:
- src/main.js: removed imports of zero-size files (footer.js, modal.js)
- src/css/styles.css: removed empty @import './modal.css'
- eslint.config.js: added basic ESLint flat config
- stylelint.config.cjs: added Stylelint config
- postcss.config.cjs: added CSS minify/duplicate removal
- jsconfig.json: added to enable //@ts-check and better IDE hints

```

---
## assistant_bundle_20250912_153759/_snapshot/reports/unreachable_js.json

**size:** 213 bytes &nbsp;&nbsp; **sha1:** `9dcffef1480390fafc583fdc62fb659308bfc497`

```json
{
  "unreachable_js_files": [
    "src/js/artists/lib/toast.js",
    "src/js/footer.js",
    "src/js/modal.js",
    "src/js/shared/sprite.js"
  ],
  "note": "Dynamic imports/globals may not be detected."
}
```

---
## assistant_bundle_20250912_153759/_snapshot/reports/unused_selectors.json

**size:** 2423 bytes &nbsp;&nbsp; **sha1:** `55edc78c9053d08cfd410a4107bb4df7be7c60ba`

```json
{
  "unused_classes": [
    "01em",
    "02",
    "04",
    "04em",
    "05",
    "05s",
    "06",
    "08",
    "1",
    "12",
    "12s",
    "14",
    "15",
    "16",
    "175",
    "18",
    "1s",
    "2",
    "24",
    "25",
    "25s",
    "275",
    "28",
    "2s",
    "2vw",
    "3",
    "32",
    "35",
    "35s",
    "3s",
    "4",
    "42",
    "45",
    "4s",
    "4vw",
    "5",
    "55",
    "5em",
    "6",
    "65",
    "7",
    "75px",
    "8",
    "885",
    "8s",
    "9",
    "95",
    "98",
    "985",
    "98px",
    "am-album",
    "am-album__title",
    "am-bio",
    "am-meta",
    "am-meta__col",
    "am-meta__item",
    "am-player__bar",
    "am-player__frame",
    "am-player__host",
    "am-player__inner",
    "am-player__left",
    "am-player__progresswrap",
    "am-player__right",
    "am-player__skip",
    "am-player__time",
    "am-tags",
    "am-yt",
    "am-zoom",
    "amodal__albums",
    "amodal__albums-title",
    "amodal__content",
    "amodal__img",
    "amodal__info",
    "amodal__scrolltop",
    "amodal__title",
    "anim",
    "base",
    "card",
    "card--skel",
    "card__link",
    "card__media",
    "card__tags",
    "card__text",
    "card__title",
    "controls",
    "css",
    "customer-feedback",
    "customer-name",
    "dd__loading",
    "dd__spinner",
    "dots",
    "empty-reset",
    "feedback",
    "hidden-container",
    "img-fade",
    "is-visible",
    "lbl",
    "muted",
    "note",
    "player",
    "png",
    "required-text",
    "skel",
    "skel--media",
    "skel--tag",
    "skel--text",
    "skel--title",
    "skeleton",
    "swiper-dots",
    "swiper-slide",
    "tag",
    "tbl",
    "th",
    "toolbar",
    "tr",
    "val",
    "yt-ph",
    "zoom"
  ],
  "unused_ids": [
    "000",
    "060307",
    "06030700",
    "0d0d0d",
    "111",
    "141014",
    "1e1c1f",
    "1e1d24",
    "22132b",
    "25152f",
    "262626",
    "272630",
    "2d2b33",
    "383744",
    "3a2a4f",
    "3c2a58",
    "5f3376",
    "603177",
    "764191",
    "9770ad",
    "9aa0a6",
    "Artist1Button",
    "af0404",
    "artist1Button",
    "b8b9c0",
    "e74c3c",
    "e8e8ec",
    "fff",
    "mixRadioBtn"
  ],
  "note": "This is a static guess. Some selectors may be used dynamically at runtime."
}
```

---
## assistant_bundle_20250912_153759/_snapshot/reports/zero_size_files.txt

**size:** 98 bytes &nbsp;&nbsp; **sha1:** `25590554437d01d9573019c965f5f588d2909d3a`

```text
src/css/artists.css
src/css/modal.css
src/js/footer.js
src/js/modal.js
src/partials/modal.html
```

---
## assistant_bundle_20250912_153759/_snapshot/server/index.mjs

**size:** 26168 bytes &nbsp;&nbsp; **sha1:** `73c4d4b3995b9f9cf50003be92e93a342315a3df`

```text
// server/index.mjs — server-v4.5.4-2025-09-11
// Focus: selectable provider (Pro/OpenAI vs Free/LM Studio) via req.body.provider,
// lang-lock, few-shots, enrich recommend→play (no forced query→id), MixRadio,
// /api/yt/search with exclude/shuffle/cache, and TTS endpoint.

import 'dotenv/config';
import express from 'express';
import cors from 'cors';
import cookieParser from 'cookie-parser';
import { registerTTS } from './tts.mjs';
import { searchIdsFallback, filterEmbeddable } from './search-fallback.mjs';

const app = express();
const PORT = Number(process.env.PORT || 8787);
const VERSION = 'server-v4.5.4-2025-09-11';
const DEBUG_INTENT = String(process.env.DEBUG_INTENT || '') === '1';

// LLM configs (Pro/OpenAI vs Free/LM Studio)
const LLM = {
  pro: {
    base: (process.env.OPENAI_BASE_URL || 'https://api.openai.com/v1').replace(/\/+$/, ''),
    key: process.env.OPENAI_API_KEY || '',
    model: process.env.OPENAI_MODEL || 'gpt-4o-mini',
    name: 'openai',
  },
  free: {
    base: (process.env.LMSTUDIO_BASE_URL || 'http://127.0.0.1:1234/v1').replace(/\/+$/, ''),
    key: process.env.LMSTUDIO_API_KEY || 'lm-studio',
    model: process.env.LMSTUDIO_MODEL || 'qwen2.5-7b-instruct',
    name: 'lmstudio',
  },
};

// YouTube
const YT_API_KEY = process.env.YT_API_KEY || '';

// --- middleware
app.use(cors({ origin: true, credentials: true }));
app.use(express.json({ limit: '1mb' }));
app.use(cookieParser());

// ─── Server TTS (Piper) ────────────────────────────────────────────────
registerTTS(app);

app.get('/api/health', (_req, res) => {
  res.json({
    ok: true,
    version: VERSION,
    llm: {
      pro: { base: LLM.pro.base, model: LLM.pro.model, key_set: !!LLM.pro.key },
      free: { base: LLM.free.base, model: LLM.free.model, key_set: !!LLM.free.key },
    },
  });
});

/* ---------------- Память сессий ---------------- */
const memory = new Map(); // sid -> [{role, content}, ...]
const MAX_SRV_HISTORY = 8;

function getSid(req, res) {
  let sid = req.cookies?.sid;
  if (!sid) {
    sid = Math.random().toString(36).slice(2) + Date.now().toString(36);
    res.cookie('sid', sid, {
      httpOnly: true,
      sameSite: 'lax',
      secure: process.env.NODE_ENV === 'production',
      maxAge: 7 * 864e5,
    });
  }
  return sid;
}
function pushHistory(sid, role, content) {
  const arr = memory.get(sid) || [];
  arr.push({ role, content: String(content || '') });
  while (arr.length > MAX_SRV_HISTORY) arr.shift();
  memory.set(sid, arr);
}

/* ---------------- System + Few-shots (строгий JSON) ------------------ */
const SYSTEM_CORE = `Ты — ассистент музыкальной витрины ArtistsHub.
Отвечай СТРОГО одним JSON-объектом:
{
  "reply": "короткая фраза пользователю",
  "explain": "опционально",
  "actions": [
    {"type":"player","action":"play"|"pause"|"next"|"prev"|"stop"},
    {"type":"mixradio"},
    {"type":"recommend","mood":"happy|calm|sad|energetic","genre":"рок","like":"queen bohemian rhapsody","autoplay":true},
    {"type":"volume","delta":0.1},
    {"type":"play","id":"YOUTUBE_ID_11","query":"artist - song"},
    {"type":"ui","action":"minimize"|"expand"}
  ]
}
Правила:
- «включи <…>» → play.query или recommend.like + autoplay=true.
- «жанр <…>» → recommend.genre (+autoplay=true, если просят включить).
- «пауза/стоп» → player.pause/stop.
- «следующий/предыдущий» → player.next/prev.
- «громче/тише» → volume.delta ±0.1.
- «под настроение» → recommend.mood (+autoplay=true, если это просьба включить).
- «сверни/разверни плеер» → {"type":"ui","action":"minimize|expand"}.
- НЕ выдумывай YouTube ID. Если не уверен — ставь только "query", без "id".
- Никогда не добавляй текст вне JSON. Ответ — только JSON, без пояснений и без тройных бэктиков.
`;

const FEWSHOTS = {
  ru: [
    { role: 'user', content: 'включи джаз' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Включаю джаз.', actions: [{ type: 'recommend', genre: 'джаз', autoplay: true }] }) },
    { role: 'user', content: 'сделай паузу' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Пауза.', actions: [{ type: 'player', action: 'pause' }] }) },
    { role: 'user', content: 'громче' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Громче.', actions: [{ type: 'volume', delta: 0.1 }] }) },
  ],
  en: [
    { role: 'user', content: 'play some jazz' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Playing jazz.', actions: [{ type: 'recommend', genre: 'jazz', autoplay: true }] }) },
    { role: 'user', content: 'pause it' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Paused.', actions: [{ type: 'player', action: 'pause' }] }) },
    { role: 'user', content: 'louder' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Louder.', actions: [{ type: 'volume', delta: 0.1 }] }) },
  ],
  uk: [
    { role: 'user', content: 'увімкни джаз' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Вмикаю джаз.', actions: [{ type: 'recommend', genre: 'джаз', autoplay: true }] }) },
    { role: 'user', content: 'пауза' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Пауза.', actions: [{ type: 'player', action: 'pause' }] }) },
    { role: 'user', content: 'гучніше' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Гучніше.', actions: [{ type: 'volume', delta: 0.1 }] }) },
  ],
};

/* ---------------- Утилиты ---------------- */
function capitalize(s = '') {
  return s ? s[0].toUpperCase() + s.slice(1) : s;
}
function normalizeAggressive(s = '') {
  let t = String(s || '');
  try { t = t.normalize('NFC'); } catch {}
  t = t.replace(/[\u2010-\u2015\u2212]/g, '-').replace(/[“”«»„‟]/g, '"').replace(/[’‘‛]/g, "'");
  t = t.replace(/\u0438\u0306/g, '\u0439').replace(/\u0418\u0306/g, '\u0419');
  t = t.normalize('NFD').replace(/[\u0300-\u036f]/g, '').normalize('NFC');
  t = t.replace(/\u0451/g, '\u0435').replace(/\u0401/g, '\u0415');
  return t.toLowerCase();
}

/* ---------------- Вызов LLM ---------------- */
function pickLLM(provider) {
  const want = String(provider || '').toLowerCase();
  if (want === 'openai' || want === 'pro') {
    return LLM.pro.key ? LLM.pro : LLM.free;
  }
  if (want === 'lmstudio' || want === 'free') {
    return LLM.free;
  }
  // auto
  return LLM.pro.key ? LLM.pro : LLM.free;
}

async function askLLM(messages, cfg) {
  const base = cfg.base;
  const url = `${base}/chat/completions`;
  const payload = { model: cfg.model, messages, temperature: 0.2 };

  const ctrl = new AbortController();
  const to = setTimeout(() => ctrl.abort(), 15000);

  try {
    const r = await fetch(url, {
      method: 'POST',
      headers: { Authorization: `Bearer ${cfg.key || 'no-key'}`, 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
      signal: ctrl.signal,
    });
    clearTimeout(to);

    if (!r.ok) {
      const text = await r.text().catch(() => '');
      return { reply: '', explain: '', actions: [], _error: `LLM HTTP ${r.status}: ${text.slice(0, 200)}` };
    }

    const j = await r.json().catch(() => ({}));
    const content = j?.choices?.[0]?.message?.content ?? '';
    const clipped = String(content).slice(0, 25000);
    const maybeJson = extractJSONObject(clipped) || clipped;
    const repaired = softRepair(maybeJson);
    if (repaired && typeof repaired === 'object') {
      const reply = String(repaired.reply || '').slice(0, 500);
      const explain = String(repaired.explain || '');
      const actions = Array.isArray(repaired.actions) ? repaired.actions : [];
      return { reply, explain, actions };
    }
    return { reply: '', explain: '', actions: [], _error: 'no-json' };
  } catch (e) {
    clearTimeout(to);
    const msg = e && e.name === 'AbortError' ? 'timeout' : String(e.message || e);
    return { reply: '', explain: '', actions: [], _error: msg };
  }
}

/* ---------------- Soft-repair JSON ---------------- */
function extractJSONObject(s = '') {
  if (!s) return null;
  let inStr = false, esc = false, depth = 0, start = -1;
  for (let i = 0; i < s.length; i++) {
    const ch = s[i];
    if (esc) { esc = false; continue; }
    if (ch === '\\') { esc = true; continue; }
    if (ch === '"') { inStr = !inStr; continue; }
    if (inStr) continue;
    if (ch === '{') { if (depth === 0) start = i; depth++; }
    else if (ch === '}') { depth--; if (depth === 0 && start !== -1) return s.slice(start, i + 1); }
  }
  return null;
}
function softRepair(text = '') {
  if (!text || typeof text !== 'string') return null;
  let t = text.trim();
  t = t.replace(/^```(?:json)?/i, '').replace(/```$/, '');
  try { return JSON.parse(t); } catch {}
  t = t
    .replace(/([{,]\s*)'([^']+?)'(\s*:)/g, '$1"$2"$3')
    .replace(/:\s*'([^']*?)'/g, ': "$1"')
    .replace(/(\{|,)\s*actions\s*:/g, '$1 "actions":')
    .replace(/,\s*}/g, '}')
    .replace(/,\s*]/g, ']');
  try { return JSON.parse(t); } catch {}
  return null;
}

/* ---------------- Эвристики намерений ---------------- */
function inferActionsFromUser(text = '') {
  const t = normalizeAggressive(text).trim();
  const actions = [];
  if (DEBUG_INTENT) console.log('[intent:text]', t);

  // Транспорт
  if (/(пауза|стоп|останов|pause)/.test(t)) actions.push({ type: 'player', action: 'pause' });
  if (/выключ(и|ай)/.test(t)) actions.push({ type: 'player', action: 'stop' });
  if (/(следующ|друг(ую|ой)|ин(ую|ой)|нов(ую|ый)|another|next|skip|скип)/.test(t)) actions.push({ type: 'player', action: 'next' });
  if (/предыдущ|предыд|prev/.test(t)) actions.push({ type: 'player', action: 'prev' });

  // Громкость
  if (/(громче|louder|volume up|погромче|\bувелич(ь|и) громк)/.test(t)) actions.push({ type: 'volume', delta: +0.1 });
  if (/(тише|quieter|volume down|поменьше|\bуменьш(ь|и) громк)/.test(t)) actions.push({ type: 'volume', delta: -0.1 });

  // Радио и UI
  if (/(mix ?radio|микс ?радио|радио|random)/.test(t)) actions.push({ type: 'mixradio' });
  if (/сверн(и|уть)|minimi[sz]e/.test(t)) actions.push({ type: 'ui', action: 'minimize' });
  if (/(разверн|покажи плеер|открой плеер|expan[ds])/.test(t)) actions.push({ type: 'ui', action: 'expand' });

  const wantsPlay = /(включ|вруби|постав|поставь|запусти|play|сыграй)/.test(t);

  // Настроение
  const isCalm = /(спок|спокои|calm|lofi|lo-fi|chill|relax|ambient)/.test(t);
  if (isCalm) actions.push({ type: 'recommend', mood: 'calm', autoplay: wantsPlay });

  // Жанры
  const gsyn = [
    ['рок', 'рок|rock|альтернативн|альт|гранж|панк|metal|метал|hard rock|classic rock'],
    ['поп', 'поп|pop|dance pop|euro pop|эстрад'],
    ['рэп', 'рэп|rap|hip[- ]?hop|хип[ -]?хоп|drill'],
    ['электрон', 'электрон|electro|edm|house|techno|trance|dnb|drum and bass|dubstep|breakbeat'],
    ['джаз', 'джаз|jazz|swing|bebop'],
    ['блюз', 'блюз|blues'],
    ['классик', 'классик|classical|барокко|симфоническ|оркестр'],
    ['инди', 'инди|indie'],
    ['lofi', 'lofi|ло[- ]?фай'],
    ['ambient', 'ambient|эмбиент'],
    ['шансон', 'шансон'],
    ['folk', 'folk|фолк|кантри|country'],
    ['rnb', 'rnb|r&b|соул|soul'],
    ['latin', 'latin|латино|сальса|бачата|реггетон'],
    ['reggae', 'reggae|регги|ска|ska'],
    ['k-pop', 'k[- ]?pop|кей[ -]?поп'],
    ['j-pop', 'j[- ]?pop|джей[ -]?поп'],
    ['soundtrack', 'саундтрек|ost|original soundtrack'],
  ];
  for (const [canon, reStr] of gsyn) {
    const re = new RegExp(`\\b(?:${reStr})\\b`, 'i');
    if (re.test(t)) {
      actions.push({ type: 'recommend', genre: canon, autoplay: wantsPlay });
      break;
    }
  }

  // Десятилетия
  const d = t.match(/\b(50|60|70|80|90|2000|2010)(?:-?е|s|х)?\b/);
  if (d) {
    const s = d[1];
    const decade = /^\d{2}$/.test(s) ? `${s}s` : `${s}s`;
    actions.push({ type: 'recommend', decade, autoplay: wantsPlay });
  }

  // Похожее/включи ...
  const like1 = t.match(/(?:похож(ее|е)\s+на|как у|из\s+)(.+)$/i);
  const like2 = t.match(/(?:включи|вруби|поставь|постав|запусти|найди)\s+(.+)/i);
  const like = (like1 && like1[2]) || (like2 && like2[1]);
  if (like) actions.push({ type: 'recommend', like: like.trim(), autoplay: true });

  // Dedup
  const uniq = [];
  const seen = new Set();
  for (const a of actions) {
    const k = JSON.stringify(a);
    if (!seen.has(k)) {
      seen.add(k);
      uniq.push(a);
    }
  }
  return uniq;
}

/* --------- Last-chance fallback if still empty --------- */
function lastChanceActions(text = '') {
  const t = normalizeAggressive(text);
  if (/(спок|спокои|calm|lofi|lo-fi|chill|relax|ambient)/.test(t)) {
    return [{ type: 'play', id: '', query: 'lofi chill beats to relax' }];
  }
  if (/(включ|вруби|постав|поставь|play|сыграй|запусти)/.test(t)) {
    return [{ type: 'mixradio' }];
  }
  return [];
}
function replyForActions(actions = []) {
  if (!actions.length) return '';
  const a = actions[0];
  if (a.type === 'player') {
    if (a.action === 'pause') return 'Пауза.';
    if (a.action === 'stop') return 'Выключаю плеер.';
    if (a.action === 'next') return 'Следующий трек.';
    if (a.action === 'prev') return 'Предыдущий трек.';
    if (a.action === 'play') return 'Играю.';
  }
  if (a.type === 'mixradio') return 'Включаю микс-радио.';
  if (a.type === 'volume') return a.delta > 0 ? 'Громче.' : 'Тише.';
  if (a.type === 'ui') return a.action === 'minimize' ? 'Сворачиваю.' : 'Открываю плеер.';
  if (a.type === 'recommend') {
    if (a.genre) return `Включаю ${capitalize(a.genre)}.`;
    if (a.mood) return `Под настроение: ${capitalize(a.mood)}.`;
    if (a.like) return `Похоже на: ${a.like}.`;
  }
  if (a.type === 'play') return 'Играю.';
  return 'Готово.';
}

/* ---------------- YouTube helpers ---------------- */
async function ytSearchMany(q = '', max = 25) {
  if (!YT_API_KEY || !q) return [];
  const limit = Math.max(1, Math.min(50, Number(max || 25)));
  const u = new URL('https://www.googleapis.com/youtube/v3/search');
  u.searchParams.set('part', 'id');
  u.searchParams.set('type', 'video');
  u.searchParams.set('maxResults', String(limit));
  u.searchParams.set('order', 'relevance');
  u.searchParams.set('videoDuration', 'medium');
  u.searchParams.set('videoEmbeddable', 'true');
  u.searchParams.set('q', q);
  u.searchParams.set('key', YT_API_KEY);
  const r = await fetch(String(u)).catch(() => null);
  if (!r || !r.ok) return [];
  const j = await r.json().catch(() => ({}));
  const items = Array.isArray(j?.items) ? j.items : [];
  const ids = [];
  for (const it of items) {
    const id = it?.id?.videoId;
    if (id && /^[A-Za-z0-9_-]{11}$/.test(id)) ids.push(id);
  }
  return Array.from(new Set(ids)).slice(0, limit);
}

/* ---------------- Cache helpers ------------------ */
const __searchCache = new Map(); // key → { ids, exp }
const SEARCH_TTL_MS = 24 * 60 * 60 * 1000; // 24h
function cacheKey(q, max) { return `${q}\u0001${max}`; }
function cacheGet(k) {
  const rec = __searchCache.get(k);
  if (!rec) return null;
  if (Date.now() > rec.exp) { __searchCache.delete(k); return null; }
  return rec.ids || null;
}
function cacheSet(k, ids) { __searchCache.set(k, { ids, exp: Date.now() + SEARCH_TTL_MS }); }

app.get('/api/yt/cache/clear', (_req, res) => {
  const before = __searchCache.size;
  __searchCache.clear();
  res.json({ ok: true, before, after: __searchCache.size });
});
app.get('/api/yt/cache/stats', (_req, res) => {
  res.json({ ok: true, size: __searchCache.size, ttl_ms: SEARCH_TTL_MS });
});

/* ---------------- /api/yt/search ------------------ */
app.post('/api/yt/search', async (req, res) => {
  const t0 = Date.now();
  try {
    const q = String(req.body?.q || '').trim();
    const max = Math.max(1, Math.min(50, Number(req.body?.max || 25)));
    const exclude = Array.isArray(req.body?.exclude)
      ? req.body.exclude.filter((id) => /^[A-Za-z0-9_-]{11}$/.test(id))
      : [];
    const shuffle = !!req.body?.shuffle;
    if (!q) return res.status(400).json({ ids: [], error: 'no_query' });

    const key = cacheKey(q, max);
    const cached = cacheGet(key);
    let ids = cached ? [...cached] : null;

    if (!ids) {
      ids = [];
      if (typeof YT_API_KEY === 'string' && YT_API_KEY) {
        ids = await ytSearchMany(q, max);
      }
      if (!ids || ids.length < Math.max(3, Math.floor(max / 4))) {
        try {
          const extra = await searchIdsFallback(q, { max });
          const merged = Array.from(new Set([...(ids || []), ...extra]));
          ids = merged.slice(0, max);
        } catch (e) {
          console.warn('[yt.search] fallback failed', e?.message || e);
        }
      }
      try {
        ids = await filterEmbeddable(ids, { max });
      } catch {}
      cacheSet(key, ids);
    }

    let out = Array.isArray(ids) ? ids.filter((id) => !exclude.includes(id)) : [];
    if (shuffle && out.length > 1) {
      for (let i = out.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [out[i], out[j]] = [out[j], out[i]];
      }
    }
    out = out.slice(0, max);

    return res.json({ ids: out, q, took: Date.now() - t0, cached: !!cached, excluded: exclude.length });
  } catch (e) {
    console.error('[yt.search] error', e);
    return res.status(500).json({ ids: [], error: 'server_error', took: Date.now() - t0 });
  }
});

/* ---------------- Микс-сиды (рандом) ---------------- */
const MIX_SEEDS = [
  'lofi hip hop radio',
  'classic rock hits',
  'best jazz music relaxing',
  'indie rock playlist',
  'hip hop playlist',
  'edm house techno mix',
  'ambient music long playlist',
  'pop hits playlist',
  'latin hits playlist',
  'rnb soul classics playlist',
  'best reggae mix',
];
function randomMixSeed() {
  return MIX_SEEDS[(Math.random() * MIX_SEEDS.length) | 0];
}

/* ---------------- /api/chat ---------------- */
app.post('/api/chat', async (req, res) => {
  const t0 = Date.now();
  try {
    const sid = getSid(req, res);
    const userText = String(req.body?.message || '').trim();
    const clientHist = Array.isArray(req.body?.history) ? req.body.history : [];
    const provider = req.body?.provider; // 'openai'|'lmstudio'|undefined
    const cfg = pickLLM(provider);

    if (!userText) return res.json({ reply: 'Скажи, что включить.', actions: [], provider: cfg.name });

    // Жёсткая фиксация языка от клиента (RU/UK/EN)
    const langHint = String(req.body?.langHint || '').toLowerCase();
    const SYS_LANG =
      langHint === 'ru'
        ? 'Отвечай только по-русски. Не меняй язык при любых обстоятельствах.'
        : langHint === 'uk'
        ? 'Відповідай тільки українською. Не змінюй мову за жодних обставин.'
        : langHint === 'en'
        ? 'Answer only in English. Do not switch languages under any circumstances.'
        : 'Answer only in English. Do not switch languages under any circumstances.';

    const srvHist = memory.get(sid) || [];
    const combined = [...srvHist, ...clientHist.slice(-8)];
    const dedup = [];
    const seen = new Set();
    for (const m of combined) {
      const rec = { role: String(m.role || ''), content: String(m.content || '') };
      const k = JSON.stringify(rec);
      if (!seen.has(k)) {
        seen.add(k);
        dedup.push(rec);
      }
    }

    const shots = FEWSHOTS[langHint] || FEWSHOTS.en;
    const messages = [
      { role: 'system', content: SYSTEM_CORE },
      { role: 'system', content: 'Не используй китайский/японский/корейский. Отвечай только на RU/UK/EN.' },
      { role: 'system', content: SYS_LANG },
      ...shots,
      ...dedup.slice(-MAX_SRV_HISTORY),
      { role: 'user', content: userText },
    ];

    // 1) ответ модели
    let data = await askLLM(messages, cfg);

    // 2) эвристика, если пусто
    if (!Array.isArray(data.actions) || data.actions.length === 0) {
      const inferred = inferActionsFromUser(userText);
      if (inferred.length) {
        const reply = replyForActions(inferred);
        data = { reply: reply || data.reply || 'Готово.', explain: data.explain || '', actions: inferred };
        if (DEBUG_INTENT) console.log('[chat:fallback:inferred]', inferred);
      }
    }

    // 3) last-chance
    if (!Array.isArray(data.actions) || data.actions.length === 0) {
      const last = lastChanceActions(userText);
      if (last.length) {
        data = { reply: replyForActions(last) || 'Играю.', explain: data.explain || '', actions: last };
        if (DEBUG_INTENT) console.log('[chat:fallback:lastchance]', last);
      }
    }

    // 4) enrichment recommend→play (как в v4.4.1), БЕЗ принудительного query→id
    const actions = Array.isArray(data.actions) ? data.actions : [];
    const out = [];

    const ensureMoodQuery = (mood) => {
      const mm = normalizeAggressive(mood);
      const map = new Map([
        ['happy', 'upbeat feel good hits'],
        ['calm', 'lofi chill beats to relax'],
        ['sad', 'sad emotional songs playlist'],
        ['energetic', 'high energy workout rock mix'],
      ]);
      return map.get(mm) || 'music playlist';
    };
    const ensureLikeQuery = (like) => {
      const s = (like || '').trim();
      if (!s) return '';
      const words = s.split(/\s+/).filter(Boolean);
      if (words.length <= 2 && !/[-"«»“”„‟]/.test(s)) return `${s} greatest hits playlist`;
      return s;
    };
    const ensureGenreQuery = (genre) => {
      const g = normalizeAggressive(genre);
      const map = new Map([
        ['джаз', 'best jazz music relaxing'],
        ['рок', 'classic rock hits'],
        ['поп', 'pop hits playlist'],
        ['электрон', 'edm house techno mix'],
        ['lofi', 'lofi hip hop radio'],
        ['классик', 'classical symphony playlist'],
        ['рэп', 'hip hop playlist'],
        ['инди', 'indie rock playlist'],
        ['ambient', 'ambient music long playlist'],
        ['блюз', 'best blues songs playlist'],
        ['шансон', 'russian chanson mix'],
        ['folk', 'folk acoustic playlist'],
        ['rnb', 'rnb soul classics playlist'],
        ['latin', 'latin hits playlist'],
        ['reggae', 'best reggae mix'],
        ['k-pop', 'kpop hits playlist'],
        ['j-pop', 'jpop hits playlist'],
        ['soundtrack', 'movie soundtrack playlist'],
      ]);
      return map.get(g) || (g ? `${g} music playlist` : 'music playlist');
    };

    for (const a of actions) {
      if (a?.type === 'mixradio') {
        out.push({ type: 'play', id: '', query: randomMixSeed() });
        continue;
      }
      if (a?.type === 'recommend' && a.like && a.autoplay) {
        const like = ensureLikeQuery(a.like);
        out.push({ type: 'play', id: '', query: like });
        continue;
      }
      if (a?.type === 'recommend' && a.mood && a.autoplay) {
        out.push({ type: 'play', id: '', query: ensureMoodQuery(a.mood) });
        continue;
      }
      if (a?.type === 'recommend' && a.genre && a.autoplay) {
        out.push({ type: 'play', id: '', query: ensureGenreQuery(a.genre) });
        continue;
      }
      out.push(a);
    }

    // 5) запись истории и ответ
    pushHistory(sid, 'user', userText);
    pushHistory(sid, 'assistant', JSON.stringify({ reply: data.reply || replyForActions(out), actions: out }));

    console.log(
      `[chat] ${Date.now() - t0}ms  a=${out.length}  provider=${cfg.name}  err=${data._error || ''}`
    );
    res.json({ reply: data.reply || replyForActions(out) || 'Готово.', explain: data.explain || '', actions: out, provider: cfg.name });
  } catch (e) {
    console.error('[chat] ERROR', e);
    res.status(500).json({
      reply: 'Локальный ИИ не ответил. Я переключусь на простое управление.',
      actions: [],
      provider: 'error',
    });
  }
});

app.listen(PORT, () => {
  console.log(`AI server on http://localhost:${PORT}`);
  console.log(
    `Using PRO(base=${LLM.pro.base}, model=${LLM.pro.model}, key=${LLM.pro.key ? 'set' : 'no'}) | FREE(base=${LLM.free.base}, model=${LLM.free.model})  (${VERSION})`
  );
});

```

---
## assistant_bundle_20250912_153759/_snapshot/server/search-fallback.mjs

**size:** 3640 bytes &nbsp;&nbsp; **sha1:** `c45bb210cac68dbf2fed93fd8245d308a4f9d25b`

```text
// server/search-fallback.mjs — v1.1.1 (2025-09-10)
// YouTube fallback (Piped → HTML) + oEmbed-фильтр на «встраиваемость».
// Экспортирует: searchIdsFallback, filterEmbeddable

const DEFAULT_MAX = 25;
const VALID_ID = /^[A-Za-z0-9_-]{11}$/;

function uniq(arr) {
  const out = [];
  const seen = new Set();
  for (const x of arr) if (!seen.has(x)) { seen.add(x); out.push(x); }
  return out;
}

async function pipedSearch(q, max, signal) {
  const base = (process.env.PIPED_INSTANCE || '').replace(/\/+$/, '') || 'https://piped.video';
  const url = `${base}/api/v1/search?q=${encodeURIComponent(q)}&filter=videos`;
  const r = await fetch(url, { signal }).catch(() => null);
  if (!r || !r.ok) return [];
  const j = await r.json().catch(() => null);
  const items = Array.isArray(j?.items) ? j.items : [];
  const ids = [];
  for (const it of items) {
    const vid = (it?.id && VALID_ID.test(it.id)) ? it.id
      : (typeof it?.url === 'string' && (it.url.match(/v=([A-Za-z0-9_-]{11})/)?.[1] || ''));
    if (vid && VALID_ID.test(vid)) ids.push(vid);
    if (ids.length >= max) break;
  }
  return uniq(ids);
}

async function htmlSearch(q, max, signal) {
  const u = `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`;
  const r = await fetch(u, { headers: { 'Accept-Language': 'en' }, signal }).catch(() => null);
  if (!r || !r.ok) return [];
  const html = await r.text();
  const ids = [];
  // Прямые videoId в JSON
  const reJSON = /"videoId"\s*:\s*"([A-Za-z0-9_-]{11})"/g;
  let m;
  while ((m = reJSON.exec(html)) && ids.length < max) {
    const id = m[1];
    if (VALID_ID.test(id)) ids.push(id);
  }
  // Доп. путь: из ссылок
  if (ids.length < max) {
    const reLink = /\/watch\?v=([A-Za-z0-9_-]{11})/g;
    let m2;
    while ((m2 = reLink.exec(html)) && ids.length < max) {
      const id = m2[1];
      if (VALID_ID.test(id)) ids.push(id);
    }
  }
  return uniq(ids).slice(0, max);
}

// Быстрая проверка «встраиваемости» через oEmbed
async function isEmbeddable(id, signal) {
  const u = `https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`;
  const r = await fetch(u, { signal }).catch(() => null);
  return !!(r && r.ok);
}

// ⬇⬇⬇ ТЕПЕРЬ ЭКСПОРТИРУЕМ
export async function filterEmbeddable(ids, { max, timeoutMs = 6000, concurrency = 3 } = {}) {
  const out = [];
  let i = 0;
  async function worker(signal) {
    while (i < ids.length && out.length < max) {
      const idx = i++;
      const id = ids[idx];
      const ok = await isEmbeddable(id, signal).catch(() => false);
      if (ok) out.push(id);
    }
  }
  const ctrl = new AbortController();
  const to = setTimeout(() => ctrl.abort(), timeoutMs);
  try {
    await Promise.all(Array.from({ length: Math.max(1, concurrency) }, () => worker(ctrl.signal)));
  } finally {
    clearTimeout(to);
  }
  return out.slice(0, max);
}

export async function searchIdsFallback(q, { max = DEFAULT_MAX, timeoutMs = 6000 } = {}) {
  const ctrl = new AbortController();
  const to = setTimeout(() => ctrl.abort(), timeoutMs);
  try {
    const a = await pipedSearch(q, max, ctrl.signal);
    const base = a.length ? a : await htmlSearch(q, max, ctrl.signal);
    if (!base.length) return [];
    // Гарантируем, что вернём только «встраиваемые» ID
    return await filterEmbeddable(base, { max, timeoutMs });
  } finally {
    clearTimeout(to);
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/server/tts.mjs

**size:** 5840 bytes &nbsp;&nbsp; **sha1:** `7deb30b4e3dc1ef3c525a00e5b83405433f24fd3`

```text
// server/tts.mjs — v1.3.0 (2025-09-10)
// Piper → ВРЕМЕННЫЙ WAV → отдаём клиенту (никакого stdout-аудио).
//
// POST /api/tts  -> audio/wav
//   body: { text: "...", lang?: "ru"|"uk"|"en" }
//   query:
//     ?debug=1  — вернуть JSON-диагностику (без WAV)
//     ?stream=1 — отдавать файл как поток (чтение с диска), иначе буфером
//
// .env (важное):
//   PIPER_PATH=C:/piper/piper.exe
//   PIPER_VOICE_RU=...onnx
//   PIPER_VOICE_UK=...onnx
//   PIPER_VOICE_EN=...onnx
//   PIPER_VOICE=...onnx (fallback)
//   PIPER_LENGTH_SCALE=1.0
//   PIPER_NOISE_SCALE=0.50
//   PIPER_NOISE_W=0.20
//   PIPER_THREADS=1

import { spawn } from 'child_process';
import os from 'os';
import path from 'path';
import { promises as fs } from 'fs';

function pickLang(text = '') {
  const t = String(text || '');
  const hasUk  = /[ґєіїҐЄІЇ]/.test(t);
  const hasCyr = /[\u0400-\u04FF]/.test(t);
  if (hasUk) return 'uk';
  if (hasCyr) return 'ru';
  return 'en';
}

function voiceFromEnv(lang) {
  const {
    PIPER_VOICE_RU = '',
    PIPER_VOICE_UK = '',
    PIPER_VOICE_EN = '',
    PIPER_VOICE    = '',
  } = process.env;
  if (lang === 'ru' && PIPER_VOICE_RU) return PIPER_VOICE_RU;
  if (lang === 'uk' && PIPER_VOICE_UK) return PIPER_VOICE_UK;
  if (lang === 'en' && PIPER_VOICE_EN) return PIPER_VOICE_EN;
  return PIPER_VOICE || PIPER_VOICE_RU || PIPER_VOICE_EN || PIPER_VOICE_UK || '';
}

function makeTempPath(prefix = 'piper-', ext = '.wav') {
  const name = `${prefix}${Date.now()}-${Math.random().toString(36).slice(2)}${ext}`;
  return path.join(os.tmpdir(), name);
}

export function registerTTS(app) {
  const PIPER_PATH = process.env.PIPER_PATH || 'C:/piper/piper.exe';
  const LENGTH  = String(process.env.PIPER_LENGTH_SCALE || '1.0');
  const NOISE   = String(process.env.PIPER_NOISE_SCALE  || '0.50');
  const NOISE_W = String(process.env.PIPER_NOISE_W      || '0.20');
  const THREADS = String(process.env.PIPER_THREADS      || '1');

  app.post('/api/tts', async (req, res) => {
    const q = req.query || {};
    const debug  = String(q.debug || '').toLowerCase() === '1';
    const stream = String(q.stream || '').toLowerCase() === '1';

    const text = String(req.body?.text || '').trim();
  
       const lang =
      (String(req.body?.lang || '').trim() ||
       String((req.query?.lang || '')).trim() ||
       pickLang(text));


    if (!text) return res.status(400).json({ error: 'no_text' });

    const model = voiceFromEnv(lang);
    if (!model) return res.status(500).json({ error: 'no_voice_model' });

    const outFile = makeTempPath('piper-', '.wav'); // временный WAV
    let stderrBuf = '';

    try {
      const args = [
        '--quiet',
        '-m', model,
        '-f', outFile,                // ← ПИШЕМ В ФАЙЛ
        '--length_scale', LENGTH,
        '--noise_scale', NOISE,
        '--noise_w', NOISE_W,
        '-t', THREADS,
      ];

      const child = spawn(PIPER_PATH, args, { stdio: ['pipe', 'ignore', 'pipe'] });

      child.stderr.on('data', d => { stderrBuf += d.toString('utf8'); });
      child.on('error', e => {
        if (!res.headersSent) res.status(500).json({ error: 'spawn_error', message: String(e) });
      });

      // Текст в stdin (с переводом строки)
      const input = text.endsWith('\n') ? text : (text + '\n');
      child.stdin.write(input);
      child.stdin.end();

      // Ждём завершения Piper
      await new Promise((resolve) => child.once('close', () => resolve()));

      // DEBUG-режим: просто отдадим инфо
      if (debug) {
        let size = 0;
        try {
          const st = await fs.stat(outFile);
          size = st.size | 0;
        } catch {}
        if (!res.headersSent) {
          res.status(200).json({
            ok: size > 44, lang, model,
            file_size: size,
            note: 'WAV written to temp; not returned because debug=1',
            log: stderrBuf,
          });
        }
        try { await fs.unlink(outFile); } catch {}
        return;
      }

      // Проверка файла
      const stat = await fs.stat(outFile).catch(() => null);
      if (!stat || !stat.size || stat.size < 44) {
        if (!res.headersSent) res.status(500).json({ error: 'empty_output', log: stderrBuf });
        try { await fs.unlink(outFile); } catch {}
        return;
      }

      res.setHeader('Content-Type', 'audio/wav');
      res.setHeader('Cache-Control', 'no-store');

      if (stream) {
        // отдать как поток с диска
        res.setHeader('Content-Length', String(stat.size));
        const file = await fs.open(outFile, 'r');
        const streamR = file.createReadStream();
        streamR.pipe(res);
        streamR.on('close', async () => {
          try { await file.close(); } catch {}
          try { await fs.unlink(outFile); } catch {}
        });
        streamR.on('error', async () => {
          if (!res.writableEnded) { try { res.end(); } catch {} }
          try { await file.close(); } catch {}
          try { await fs.unlink(outFile); } catch {}
        });
      } else {
        // буфером
        const buf = await fs.readFile(outFile);
        res.setHeader('Content-Length', String(buf.length));
        res.end(buf);
        try { await fs.unlink(outFile); } catch {}
      }

    } catch (e) {
      if (!res.headersSent) {
        res.status(500).json({ error: 'server_error', message: String(e), log: stderrBuf });
      }
      try { await fs.unlink(outFile); } catch {}
    }
  });
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/about.css

**size:** 2075 bytes &nbsp;&nbsp; **sha1:** `6fbb4a107c1672a0642d0908b9a24cc5b1b32dd6`

```css
.about-section {
    padding: 64px 0;
}

.div-about-section {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 48px;
}

.img-container-about-section {
    border-radius: 16px;
    overflow: hidden;

}

.img-container-about-section img,
.img-container-about-section picture {
    display: block;
    width: 100%;
    height: auto;
}

.logo-svg {
    fill: currentColor;
    color: #fff;
    width: 64px;
    height: 64px;
}

.about-us-content {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
    flex-direction: column;
    gap: 20px;
    max-width: 288px;
}

.about-us-descrp {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
    flex-direction: column;
    width: 280px;
}

.about-section-title {
    font-family: 'Epilogue', sans-serif;
    font-weight: 700;
    font-size: 44px;
    line-height: 1.2;
    letter-spacing: -0.01em;
    color: #fff;
    margin: 0;
}

.about-section-description {
    font-size: 18px;
    line-height: 1.5;
    color: #fff;
    margin: 0;
}

/* Tablet */
@media screen and (min-width: 768px) {



    .img-container-about-section {
        width: 704px;
    }

    .about-us-content {

        max-width: none;
        width: 704px;
    }


    .logo-svg {
        width: 80px;
        height: 80px;
    }

    .about-us-descrp {
        width: 704px;
    }

    .about-section-description {
        font-size: 20px;
    }
}

/* Desktop */
@media screen and (min-width: 1440px) {
    .about-section {
        padding: 112px 0;
    }

  
    .div-about-section {
        flex-direction: row;
        gap: 32px;
    }

    .img-container-about-section {
        width: 640px;
    }

    .about-us-content {
        max-width: none;
        width: 640px;
        gap: 24px;
    }

    .about-us-descrp {
        width: 640px;
    }

    .about-section-title {
        font-size: 60px;
    }
}
```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artist.zoom.css

**size:** 1457 bytes &nbsp;&nbsp; **sha1:** `e839755351b785bd9e42e4cd6909f6ce41d7dfd0`

```css
/* === Zoom overlay === */
.am-zoom {
  position: fixed;
  inset: 0;
  z-index: 6000; /* выше плеера */
}

.am-zoom__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
}

.am-zoom__dialog {
  position: absolute;
  inset: 0;
  display: grid;
  grid-template-rows: 1fr auto;
  gap: 12px;
  padding: 16px;
}

@media (min-width: 768px) {
  .am-zoom__dialog {
    padding: 24px;
  }
}

.am-zoom__stage {
  position: relative;
  background: #000;
  border-radius: 12px;
  overflow: hidden;

  display: flex;
  align-items: center;
  justify-content: center;

  min-height: 240px;
  height: calc(100vh - 140px);
  touch-action: none; /* жесты pinch/drag — нашими руками */
}

.am-zoom__img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto !important; /* ключ к отсутствию растягивания */
  object-fit: contain;
  transform-origin: center center;
  will-change: transform;
  user-select: none;
  -webkit-user-drag: none;
  pointer-events: auto;
}

.am-zoom__bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
}

.am-zoom__open {
  color: #fff;
  text-decoration: none;
}

.am-zoom__close {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  border: none;
  background: var(--color-affair, #764191);
  color: #fff;
  cursor: pointer;
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.anim.css

**size:** 493 bytes &nbsp;&nbsp; **sha1:** `4ae5859eecaf0b8aa78e4a5e3149b465f6120fdc`

```css
/* спиннер */
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* тосты — на будущее, если понадобятся 
@keyframes toast-in  { to { opacity:1; transform: translateY(0);} }
@keyframes toast-out { to { opacity:0; transform: translateY(8px);} }
*/

/* скелетон (мерцающая полоса) */
@keyframes skel-shine {
  0% {
    background-position: -150% 0;
  }
  100% {
    background-position: 150% 0;
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.base.css

**size:** 3319 bytes &nbsp;&nbsp; **sha1:** `a8c5d0d940fc643c7283dff94c3bd5befdd774b9`

```css
/* ===== Artists Section — Base ===== */

/* Скрытие по [hidden] */
[hidden] {
  display: none !important;
}

/* Секция: управляем ТОЛЬКО вертикальными отступами; горизонтальные паддинги и ширины — из глобального .container */
#artists-section {
  /* обычно у секции: <section id="artists-section" class="artists1 container"> */
  padding-block: 64px; /* мобилка: верх/низ 64px — как было */
}
@media (min-width: 1440px) {
  #artists-section {
    padding-block: 112px; /* десктоп: верх/низ 112px — как было */
  }
}
/* На планшете (768–1439.98) дополнительных паддингов не задаём — как у тебя изначально. */

/* Заголовок секции */
.artists1__head {
  margin: 0 0 24px;
}
.artists1__head .eyebrow {
  color: var(--color-neutral-300, #9aa0a6);
  font: 600 16px/1.5 'IBM Plex Sans', system-ui;
  margin-bottom: 16px;
}
@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1__head {
    max-width: 704px;
    margin: 0 auto 32px;
  }
}
@media (min-width: 1440px) {
  .artists1__head {
    max-width: 863px;
    margin: 0 0 80px;
  }
}
.artists1__head .title {
  color: var(--color-white);
  font-family: 'Epilogue', system-ui;
  font-weight: 700;
  letter-spacing: -0.01em;
  margin: 0;
  font-size: 44px;
  line-height: 1.2;
}
@media (min-width: 1440px) {
  .artists1__head .title {
    font-size: 84px;
    line-height: 1.1;
  }
}

/* ===== Layout секции =====
   На мобилке/планшете — одна колонка: сверху блок фильтров/кнопок, ниже грид.
   НУЖНЫЕ 16px между кнопками и карточками обеспечиваем gap:16px.
*/
#artists-section .artists1__layout {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px; /* << ключевой отступ между .filters и #artists-grid для моб/планшета */
}
@media (min-width: 1440px) {
  #artists-section .artists1__layout {
    grid-template-columns: 304px 1fr;
    gap: 32px; /* десктоп как было */
  }
}

/* Иконки: оставляем твой жёсткий белый (чтобы ничего не «поплыло») */
.artists1 .ico,
.artists1 .ico use,
.artists1 .ico path {
  --color1: var(--color-white);
  fill: var(--color-white) !important;
  color: var(--color-white) !important;
}

/* Лоадер */
.artists1 .loader {
  width: 64px;
  aspect-ratio: 1;
  border-radius: 50%;
  margin: 24px auto;
  border: 6px solid rgba(255, 255, 255, 0.12);
  border-right-color: var(--color-affair, #764191);
  animation: artists_spin 0.8s linear infinite;
}
@keyframes artists_spin {
  to {
    transform: rotate(1turn);
  }
}

/* Доп. тексты */
.artists1 .muted {
  color: var(--color-neutral-300, #b8b9c0);
}

/* Запрет прокрутки (если где-то используешь) */
.no-scroll {
  position: fixed;
  width: 100%;
  overflow: hidden;
}

/* Опечатка исправлена */
.empty-reset {
  font-size: 50px !important;
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.card.css

**size:** 8813 bytes &nbsp;&nbsp; **sha1:** `9fb80d7aac83375892cc9b54162a3192bfdc0c97`

```css
/* =========================
   DEFAULT VIEW (база + фикс мобильной фотки)
   ========================= */

.artists1 .card {
  color: #e8e8ec;
  max-width: 100%;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  will-change: transform;
}

.artists1 .card__media img {
  width: 100%;
  height: 177px;
  display: block;
  border-radius: 16px;
  object-fit: cover;
  object-position: center top;
}

.artists1 .card__tags {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
}

.artists1 .tag {
  display: inline-flex;
  align-items: center;
  height: 32px;
  padding: 4px 10px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  font: 600 16px/1 'IBM Plex Sans';
}

.artists1 .card__title {
  color: var(--color-white);
  font: 700 32px/1.3 'Epilogue', system-ui;
  letter-spacing: -0.01em;
}

.artists1 .card__text {
  color: var(--color-white);
  font: 400 18px/1.5 'IBM Plex Sans';
  display: -webkit-box;
  -webkit-box-orient: vertical;
  overflow: hidden;
  margin-bottom: 0; /* не суммируемся с верхним отступом у кнопки */
}

/* Кнопка Learn More — базовый вариант (Default View) */
.artists1 .card__link {
  -webkit-appearance: none;
  appearance: none;
  border: 1px solid rgba(255, 255, 255, 0.15);
  background: transparent;
  border-radius: 12px;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;

  width: 125px;
  height: 27px;
  padding: 0;
  white-space: nowrap;

  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 500;
  font-size: 18px;
  line-height: 1.5;
  color: #fff;

  cursor: pointer;
}

.artists1 .card__link .ico {
  width: 24px;
  height: 24px;
  flex-shrink: 0;
  fill: currentColor;
  transition: transform 0.2s ease, fill 0.2s ease;
}

/* hover */
@media (hover: hover) {
  .artists1 .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }
  .artists1 .card__link:hover .ico,
  .artists1 .card__link:focus .ico {
    transform: translateX(2px);
    fill: var(--color-affair);
  }
}
@media (prefers-reduced-motion: reduce) {
  .artists1 .card,
  .artists1 .card__link .ico {
    transition: none;
  }
}

/* Высоты медиа по брейкпоинтам */
@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1 .grid .card__media img {
    height: 432px;
  }
}
@media (min-width: 1440px) {
  .artists1 .grid .card__media img {
    height: 393px;
  }
}

/* Ритм Default */
.artists1 .card__media + .card__tags {
  margin-top: 24px;
}
.artists1 .card__tags + .card__title {
  margin-top: 16px;
}
.artists1 .card__title + .card__text {
  margin-top: 8px;
}

/* Вернули 24px над кнопкой */
.artists1:not(.view-list) #artists-grid .card__text + .card__link,
.artists1:not(.view-list) #artists-grid .card__title + .card__link {
  margin-top: 24px !important;
}

/* Грид/центровка карточек */
.artists1 .grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 64px;
  justify-content: center;
}
@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1 .grid {
    grid-template-columns: 1fr;
    gap: 32px;
  }
  .artists1 .grid .card {
    max-width: 704px;
    margin: 0 auto;
  }
}
@media (min-width: 1440px) {
  .artists1 .grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 32px;
  }
}

/* MOBILE Default View: ширина карточки = 288px, фото 288×177 */
@media (max-width: 767.98px) {
  .artists1:not(.view-list) .grid .card {
    max-width: 288px;
    margin: 0 auto;
  }
  .artists1:not(.view-list) .card__media img {
    height: 177px;
    border-radius: 16px;
  }
}

#artists-section .card {
  margin: 0;
}
#artists-section .card + .card {
  margin-top: 0;
}

/* =========================
   LIST VIEW
   ========================= */

/* Контейнер сетки */
.artists1.view-list .grid {
  grid-template-columns: 1fr;
  gap: 24px;
}

/* Карточка: базовая (планшет/десктоп) */
.artists1.view-list .grid .card {
  display: grid;
  grid-template-columns: 208px minmax(0, 1fr) auto; /* << текст сжимается */
  grid-template-areas:
    'media title  action'
    'media tags   action';
  align-items: center;
  column-gap: 16px;
  row-gap: 6px;
  padding: 10px 12px;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.04);
  max-width: 976px;
  margin: 0 auto;
}

/* Превью */
.artists1.view-list .card__media {
  grid-area: media;
}
.artists1.view-list .card__media img {
  display: block;
  width: 208px;
  height: 117px;
  object-fit: cover;
  border-radius: 12px;
}

/* Заголовок/теги — разрешаем сжиматься */
.artists1.view-list .card__title,
.artists1.view-list .card__tags {
  min-width: 0;
}

.artists1.view-list .card__title {
  grid-area: title;
  margin: 0 0 2px;
  color: var(--color-white);
  font-weight: 700;
  font-size: 18px;
  line-height: 1.25;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Жанры — в одну линию, мягкая обрезка справа */
.artists1.view-list .card__tags {
  grid-area: tags;
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  flex-wrap: nowrap;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: clip;
  min-height: 22px;
  max-height: 22px;
  mask-image: linear-gradient(to right, black 92%, transparent);
  -webkit-mask-image: linear-gradient(to right, black 92%, transparent);
}
.artists1.view-list .card__tags .tag {
  display: inline-flex !important;
  align-items: center;
  height: 22px;
  padding: 2px 6px;
  font-size: 10px;
  line-height: 1;
  border-radius: 6px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  opacity: 0.9;
}

/* Текст в ListView — скрыт */
.artists1.view-list .card__text {
  display: none !important;
}

/* Кнопка Learn More */
.artists1.view-list .card__link {
  grid-area: action;
  justify-self: end;
  align-self: center;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 8px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 8px;
  background: transparent;
  font-size: 12px;
  line-height: 1;
  color: var(--color-white);
  white-space: nowrap;
  cursor: pointer;
}
.artists1.view-list .card__link .ico {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
  fill: currentColor;
  transition: transform 0.2s ease, fill 0.2s ease;
}

/* Мобильный ListView */
@media (max-width: 767.98px) {
  .artists1.view-list .grid {
    gap: 24px;
  }

  .artists1.view-list .grid .card {
    grid-template-columns: 64px minmax(0, 1fr) auto; /* << фикс для узких */
    grid-template-areas:
      'media title  action'
      'media tags   action';
    column-gap: 12px;
    row-gap: 2px;
    padding: 8px 10px;
    min-height: 72px;
  }

  .artists1.view-list .card__media {
    width: 64px;
    height: 64px;
    border-radius: 10px;
    overflow: hidden;
  }
  .artists1.view-list .card__media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
  }

  .artists1.view-list .card__title {
    font-size: 16px;
    line-height: 1.25;
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* кнопка — иконка 24×24, строго справа */
  .artists1.view-list .grid .card__link,
  .artists1.view-list #artists-grid .card__link {
    justify-self: end !important;
    align-self: center !important;
    width: 24px !important;
    height: 24px !important;
    padding: 0 !important;
    border: 0 !important;
    border-radius: 6px !important;
    font-size: 0 !important;
    line-height: 0 !important;
    gap: 0 !important;
    overflow: hidden !important;
    display: grid !important;
    place-items: center !important;
    background: transparent !important;
    color: var(--color-white, #fff) !important;
    cursor: pointer !important;
  }
  .artists1.view-list .grid .card__link .ico,
  .artists1.view-list #artists-grid .card__link .ico {
    width: 24px !important;
    height: 24px !important;
    margin-left: 0 !important;
    flex-shrink: 0 !important;
  }
}

/* Широкие (≥1440px) */
@media (min-width: 1440px) {
  .artists1.view-list .grid .card {
    min-height: 84px;
    padding: 10px 12px;
  }
  .artists1.view-list .card__title {
    font-size: 18px;
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.controls.css

**size:** 6352 bytes &nbsp;&nbsp; **sha1:** `bc139747484f0b6909028952f4a11e2f3b38cbfc`

```css
/* ----- Artists: interactive controls (Sort/Genre/Reset/Learn More & ListView) ----- */

#artists-section #dd-sort-btn,
#artists-section [data-dd='sort'] .dd__btn,
#artists-section #dd-genre-btn,
#artists-section [data-dd='genre'] .dd__btn,
#artists-section #filters-reset,
#artists-section #filters-reset-sm,
#artists-section .card__link,
#artists-section #view-toggle,             /* << добавили */
#artists-section .filters__view {
  /* << добавили */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transform-origin: center;
  will-change: transform;
  transition: transform 140ms ease, box-shadow 140ms ease,
    background-color 140ms ease, color 140ms ease;
}

/* Hover */
@media (hover: hover) and (pointer: fine) {
  #artists-section #dd-sort-btn:hover,
  #artists-section [data-dd='sort'] .dd__btn:hover,
  #artists-section #dd-genre-btn:hover,
  #artists-section [data-dd='genre'] .dd__btn:hover,
  #artists-section #filters-reset:hover,
  #artists-section #filters-reset-sm:hover,
  #artists-section .card__link:hover,
  #artists-section #view-toggle:hover,
  #artists-section .filters__view:hover {
    transform: scale(1.06);
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
  }
}

/* Focus */
#artists-section #dd-sort-btn:focus-visible,
#artists-section [data-dd='sort'] .dd__btn:focus-visible,
#artists-section #dd-genre-btn:focus-visible,
#artists-section [data-dd='genre'] .dd__btn:focus-visible,
#artists-section #filters-reset:focus-visible,
#artists-section #filters-reset-sm:focus-visible,
#artists-section .card__link:focus-visible,
#artists-section #view-toggle:focus-visible,
#artists-section .filters__view:focus-visible {
  outline: none;
  transform: scale(1.06);
box-shadow: 0 10px 24px rgba(0, 0, 0, .18),
    0 0 0 3px #9770ad;
  /* было: color-mix(..., white 25%) */
}

/* Active */
#artists-section #dd-sort-btn:active,
#artists-section [data-dd='sort'] .dd__btn:active,
#artists-section #dd-genre-btn:active,
#artists-section [data-dd='genre'] .dd__btn:active,
#artists-section #filters-reset:active,
#artists-section #filters-reset-sm:active,
#artists-section .card__link:active,
#artists-section #view-toggle:active,
#artists-section .filters__view:active {
  transform: scale(0.98);
}

/* Disabled */
#artists-section #dd-sort-btn:disabled,
#artists-section [data-dd='sort'] .dd__btn:disabled,
#artists-section #dd-genre-btn:disabled,
#artists-section [data-dd='genre'] .dd__btn:disabled,
#artists-section #filters-reset:disabled,
#artists-section #filters-reset-sm:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* НЕ красим Learn More: всё берём из базовых */
#artists-section .card__link {
  background: inherit;
  color: inherit;
  border: none;
}

@media (prefers-reduced-motion: reduce) {
  #artists-section #dd-sort-btn,
  #artists-section [data-dd='sort'] .dd__btn,
  #artists-section #dd-genre-btn,
  #artists-section [data-dd='genre'] .dd__btn,
  #artists-section #filters-reset,
  #artists-section #filters-reset-sm,
  #artists-section .card__link,
  #artists-section #view-toggle,
  #artists-section .filters__view {
    transition: none;
  }
}

/* База для всех кнопок секции Artists */
.artists1 .btn {
  -webkit-appearance: none;
  appearance: none;
  border: none;
  cursor: pointer;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 12px;

  height: 47px;
  padding: 10px 24px;
  border-radius: 12px;

  font-family: var(
    --font-sans,
    'IBM Plex Sans',
    system-ui,
    -apple-system,
    Segoe UI,
    Roboto,
    Arial,
    sans-serif
  );
  font-weight: 500;
  font-size: 18px;
  line-height: 1.5;

  color: var(--color-white, #fff);
  background: var(--color-grey-900, #111);

  box-shadow: 0 1px 2px rgba(6, 3, 7, 0.05), inset 0 -2px 1px rgba(0, 0, 0, 0.2),
    inset 0 0 0 1px rgba(6, 3, 7, 0.15),
    inset 0 32px 24px rgba(255, 255, 255, 0.05);
  transition: background-color 0.2s ease, transform 0.12s ease;
}

.artists1 .btn:hover,
.artists1 .btn:focus-visible {
  transform: translateY(-1px);
}

/* Кнопка List view как текст-линк (единый стиль с Reset) */
.artists1 .filters__view {
  appearance: none;
  background: none;
  border: 0;
  padding: 0;
  margin: 0;
  cursor: pointer;
  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 500;
  font-size: 18px;
  line-height: 1.5;
  text-decoration: underline;
  text-decoration-skip-ink: none;
  text-underline-offset: 3px;
  color: var(--color-white, #fff);
  white-space: nowrap;
}

/* НЕ скрывать на мобилке! (переопределяем старое правило) */
@media (max-width: 767.98px) {
  .artists1 .filters__view {
    display: inline-block !important;
  }
}

/* Desktop раскладка */
@media (min-width: 1440px) {
  .artists1 .filters__bar {
    display: grid;
    grid-template-columns: 1fr auto 1fr; /* Filters | Reset | List view */
    align-items: baseline;
    column-gap: 16px;
  }
  .artists1 .filters__label {
    grid-column: 1;
    justify-self: start;
  }
  .artists1 .filters__reset {
    grid-column: 2;
    justify-self: center;
  }
  .artists1 .filters__view {
    grid-column: 3;
    justify-self: end;
  }
}

/* выпадашки не обрезать */
.artists1 .filters {
  overflow: visible;
}

/* База dropdown */
.artists1 .dd {
  position: relative;
}
.artists1 .dd__list {
  display: none;
  margin-top: 8px;
  background: #141014;
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 12px;
  padding: 8px 0;
  list-style: none;
}
@media (min-width: 1440px) {
  .artists1 .dd__list {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    z-index: 30;
    max-height: 50vh;
    overflow: auto;
  }
  .artists1 .dd.open .dd__list {
    display: block;
  }
}
@media (max-width: 1439.98px) {
  .artists1 .dd {
    position: static;
  }
  .artists1 .dd__list {
    position: static;
    margin-top: 12px;
  }
  .artists1 .dd.open .dd__list {
    display: block;
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.filters.css

**size:** 9835 bytes &nbsp;&nbsp; **sha1:** `ff00ece8f0f02dc6818cff0b7293ab322674e41c`

```css
/* ========= Artists • Filters/Toolbar (clean) ========= */

/* по умолчанию скрываем кнопку поиска-иконки; на десктопе вернём */
#flt-q-btn {
  display: none !important;
}

/* базовый контейнер панели */
.artists1 .filters {
  position: relative;
  z-index: 5;
}

/* верхняя панель-контролы */
.artists1 .filters__bar {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* подпись (если используется) */
.artists1 .filters__label {
  color: #b8b9c0;
  font-weight: 600;
}

/* Reset — всегда толкаем вправо (и на моб/таб, и на десктопе) */
.artists1 .filters__reset {
  margin-left: auto;
  background: none;
  border: 0;
  color: #b8b9c0;
  cursor: pointer;
}

/* кнопка раскрытия панели (моб/таб) */
#filters-toggle {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: #2d2b33;
  border: 0;
  border-radius: 12px;
  color: var(--color-white);
  padding: 10px 14px;
  padding-right: 30px; /* запас под стрелку */
  position: relative;
  cursor: pointer;
}
#filters-toggle .ico {
  display: none !important;
}
#filters-toggle::after {
  content: '';
  position: absolute;
  right: 12px;
  top: 50%;
  width: 8px;
  height: 8px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: translateY(-50%) rotate(45deg);
  transition: transform 0.2s ease;
}
#filters-toggle[aria-expanded='true']::after {
  transform: translateY(-50%) rotate(-135deg);
}

/* сама панель */
#filters-panel {
  background: #1e1d24;
  border: 1px solid #262626;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
  margin-top: 12px;
  overflow: visible;
}

/* ---------- mobile & tablet (<=1439.98px) ---------- */
@media (max-width: 1439.98px) {
  /* показ/скрытие по aria */
  #filters-panel[aria-hidden='true'] {
    display: none;
  }
  #filters-panel[aria-hidden='false'] {
    display: block;
  }

  /* панель — overlay под баром */
  #filters-panel {
    position: absolute;
    top: calc(100% + 12px);
    left: 0;
    right: 0;
    z-index: 20;
    max-height: min(80vh, 720px);
    overflow: auto;
  }

  /* стекло-стили */
  .artists1 #filters-toggle,
  .artists1 #filters-panel .fld,
  .artists1 #filters-panel #flt-q-btn,
  .artists1 #filters-panel .dd {
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
      inset 0 -2px 1px 0 rgba(6, 3, 7, 0.05),
      inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    border: 0;
    color: var(--color-white);
  }
  .artists1 #filters-panel .dd__btn {
    background: transparent;
    color: var(--color-white);
  }
  .artists1 #filters-panel .dd__btn::after {
    border-right-color: var(--color-white);
    border-bottom-color: var(--color-white);
  }

  .artists1 #filters-panel #flt-q {
    background: transparent;
    color: var(--color-white);
  }
  .artists1 #filters-panel #flt-q::placeholder {
    color: rgba(255, 255, 255, 0.8);
  }
}

/* ---------- desktop (>=1440px) ---------- */
@media (min-width: 1440px) {
  /* показываем кнопку-иконку поиска; скрываем toggle */
  .fld-search__btn {
    background: none;
    border: 0;
    padding: 0;
    display: grid;
    place-items: center;
    cursor: pointer;
  }
  #flt-q-btn {
    display: block !important;
  }
  #filters-toggle {
    display: none !important;
  }

  /* панель статична, справа фикс ширина */
  #filters-panel {
    display: block !important;
    background: var(--color-neutral-darkest);
    border: 1px solid rgba(255, 255, 255, 0.12);
    width: 304px;
    overflow: visible;
  }
  #filters-panel .fld,
  #filters-panel .dd {
    width: 100%;
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    margin-bottom: 12px;
  }
  #filters-panel .dd {
    position: static !important;
  }
  #filters-panel .dd__list {
    position: static !important;
    display: none;
    max-height: 320px;
    overflow: auto;
    background: var(--color-neutral-darkest);
    border: 0;
    border-top: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 0 0 12px 12px;
    box-shadow: none;
    padding: 8px 0;
  }
  #filters-panel .dd.open .dd__list {
    display: block;
  }
  #filters-panel .dd.open .dd__btn {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
  }
  #filters-panel .dd__btn {
    height: 43px;
    padding: 8px 12px;
    font: 600 16px/1 'IBM Plex Sans';
    border-radius: 12px;
  }

  /* страховка: на десктопе бар — flex, Reset у правого края */
  .artists1 .filters__bar {
    display: flex !important;
    align-items: center;
    gap: 12px;
  }
  #filters-reset {
    margin-left: auto !important;
  }
}

/* ---------- поля поиска ---------- */
.fld {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #272630;
  border-radius: 12px;
  padding: 12px 14px;
  margin-bottom: 12px;
  min-height: 48px;
}
.fld .ico {
  width: 24px;
  height: 24px;
  fill: var(--color-white);
}
#flt-q {
  flex: 1 1 auto;
  background: transparent;
  border: 0;
  color: var(--color-white);
  outline: 0;
  font-size: 16px;
}
#flt-q::-webkit-search-cancel-button {
  -webkit-appearance: none;
  appearance: none;
  display: none;
}

/* ---------- дропдауны ---------- */
.dd {
  position: relative;
  background: #272630;
  border-radius: 12px;
  margin-bottom: 12px;
}
.dd__btn {
  position: relative;
}
.dd__btn .ico {
  display: none !important;
}
.dd__btn::after {
  content: '';
  position: absolute;
  right: 12px;
  top: 50%;
  width: 8px;
  height: 8px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: translateY(-50%) rotate(45deg);
  transition: transform 0.2s ease;
}
.dd.open .dd__btn::after {
  transform: translateY(-50%) rotate(-135deg);
}

.dd__list {
  position: absolute;
  left: 0;
  right: 0;
  top: calc(100% - 1px);
  z-index: 30;
  display: none;
  max-height: 320px;
  overflow: auto;
  padding: 8px 0;
  background: #0d0d0d;
  border: 1px solid #262626;
  border-top: 0;
  border-radius: 0 0 12px 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
}
.dd.open .dd__list {
  display: block;
}
.dd__list li {
  list-style: none;
  padding: 10px 14px;
  cursor: pointer;
  color: #e8e8ec;
  font-size: 16px;
}
.dd__list li:hover {
  background: #383744;
  border-radius: 10px;
}

/* ---------- mobile layout (<=767.98px) ---------- */
@media (max-width: 767.98px) {
  .artists1 .filters__bar {
    flex-wrap: wrap;
    row-gap: 12px;
  }

  /* toggle — на всю ширину второй строкой */
  #filters-toggle {
    order: 3;
    width: 100%;
    height: 56px;
    padding: 0 16px;
    justify-content: space-between;
    color: var(--color-white);
    text-align: center;
  }
}

/* ---------- tablet layout (768–1439.98px) ---------- */
@media (min-width: 768px) and (max-width: 1439.98px) {
  #filters-panel {
    width: 304px;
    margin: 12px 0 0 auto;
    padding: 12px;
    border-radius: 12px;
    background: #0d0d0d;
    border: 1px solid #262626;
    box-shadow: none;
    overflow: visible;
  }

  .artists1 #filters-panel .fld {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 0;
    background: #272630;
    border: 0;
    border-radius: 12px;
  }
  .artists1 #filters-panel .fld .ico {
    position: absolute;
    left: 12px;
    top: 12px;
    width: 24px;
    height: 24px;
    pointer-events: none;
  }
  #flt-q {
    width: 100%;
    height: 47px;
    padding: 10px 12px 10px 44px;
    border-radius: 12px;
    border: 0;
    background: transparent;
    font-size: 16px;
    color: var(--color-white);
    outline: 0;
  }

  #flt-q-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 233px;
    height: 47px;
    padding: 10px 24px;
    border-radius: 12px;
    border: none;
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
      inset 0 -2px 1px 0 rgba(6, 3, 7, 0.05),
      inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    color: var(--color-white);
    gap: 8px;
    margin-left: auto;
    cursor: pointer;
  }
  #flt-q-btn .ico {
    width: 24px;
    height: 24px;
    fill: currentColor;
  }

  #filters-toggle {
    width: 233px;
    height: 47px;
    padding: 10px 24px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
      inset 0 -2px 1px 0 rgba(6, 3, 7, 0.05),
      inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    border: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-white);
    position: relative;
  }
}

/* мини-лоадер в списке жанров */
.dd__loading {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  color: #e8e8ec;
  font-size: 16px;
}
.dd__spinner {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-top-color: rgba(255, 255, 255, 0.6);
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(1turn);
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.grid.css

**size:** 5097 bytes &nbsp;&nbsp; **sha1:** `fecc054a0a57b13c5b6e1550a000f5e892006466`

```css
/* ===== Grid (общая) ===== */
.artists1 #artists-grid,
.artists1 .grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 64px;
  justify-content: center; /* ширина дорожки */
}

/* Default View: центрируем карточки на мобиле/планшете */
.artists1:not(.view-list) #artists-grid,
.artists1:not(.view-list) .grid {
  justify-items: center; /* ключевой фикс */
}

/* Tablet */
@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1 #artists-grid,
  .artists1 .grid {
    gap: 32px;
  }
}

/* Desktop: две колонки в Default View */
@media (min-width: 1440px) {
  .artists1:not(.view-list) #artists-grid,
  .artists1:not(.view-list) .grid {
    grid-template-columns: repeat(2, 1fr);
    justify-items: stretch;
    gap: 32px;
  }
}

/* List View всегда в одну колонку */
.artists1.view-list #artists-grid,
.artists1.view-list .grid {
  grid-template-columns: 1fr;
  gap: 24px;
}

/* ===== Empty state ===== */
#artists-empty.empty {
  display: block;
  margin: 0;
}
.empty__card {
  width: 288px;
  min-height: 417px;
  box-sizing: border-box;
  background: var(--color-affair-950, #25152f);
  border: 1px solid rgba(255, 255, 255, 0.08);
  color: var(--color-white, #fff);
  border-radius: 16px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 24px;
}
.empty__icon {
  --icon-size: 40px;
  width: var(--icon-size);
  height: var(--icon-size);
  border-radius: 999px;
  display: grid;
  place-items: center;
  background: transparent;
  border: 4px solid var(--color-white, #fff);
  color: var(--color-white, #fff);
  font: 700 22px/1 'IBM Plex Sans', system-ui;
  transform: translateY(-1px);
}
.empty__title {
  margin: 0;
  font-family: 'Epilogue', system-ui;
  font-weight: 700;
  font-size: 32px;
  line-height: 1.2;
  letter-spacing: -0.01em;
}
.empty__text {
  margin: 0;
  font: 400 20px/1.5 'IBM Plex Sans', system-ui;
  opacity: 0.95;
}
.empty__btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 47px;
  padding: 10px 24px;
  width: 100%;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font: 500 18px/1.5 'IBM Plex Sans', system-ui;
  color: var(--color-white, #fff);
  background: var(--color-affair, #764191);
  box-shadow: 0 1px 2px rgba(6, 3, 7, 0.05), inset 0 -2px 1px rgba(0, 0, 0, 0.2),
    inset 0 0 0 1px rgba(6, 3, 7, 0.15),
    inset 0 32px 24px rgba(255, 255, 255, 0.05);
}
.empty__btn:hover,
.empty__btn:focus-visible {
  background: #5f3376;
}

/* ≥768 */
@media (min-width: 768px) {
  .empty__card {
    width: 704px;
    min-height: 341px;
    padding: 32px;
    gap: 24px;
  }
  .empty__title {
    font-size: 48px;
  }
  .empty__btn {
    width: 152px;
  }
}
/* ≥1440 */
@media (min-width: 1440px) {
  .empty__card {
    width: 976px;
    min-height: 341px;
    padding: 32px;
  }
  .empty__title {
    font-size: 48px;
  }
}

/* ==== HARD FIX: ListView не должен «вылезать» за край ==== */

/* 1) Трек сетки не центрируем — это источник «ползаний» при 1 колонке */
#artists-section .grid {
  justify-content: start !important;
  overflow-x: hidden; /* страховка от горизонтального скролла */
}

/* 2) Карточка занимает ширину трека + правильные колонки */
#artists-section.artists1.view-list .grid .card {
  box-sizing: border-box !important;
  width: 100% !important;
  max-width: 976px !important;
  margin: 0 auto !important;

  /* Мобайл: превью 64, середина сжимается, кнопка — авто */
  grid-template-columns: 64px minmax(0, 1fr) auto !important;
}

/* Планшет/десктоп: превью 208 */
@media (min-width: 768px) {
  #artists-section.artists1.view-list .grid .card {
    grid-template-columns: 208px minmax(0, 1fr) auto !important;
  }
}

/* 3) Средняя колонка реально может сжиматься */
#artists-section.artists1.view-list .card__title,
#artists-section.artists1.view-list .card__tags {
  min-width: 0 !important;
  overflow: hidden !important;
}

/* Заголовок — эллипсис; теги — мягкая маска справа */
#artists-section.artists1.view-list .card__title {
  white-space: nowrap !important;
  text-overflow: ellipsis !important;
}
#artists-section.artists1.view-list .card__tags {
  white-space: nowrap !important;
  text-overflow: clip !important;
  mask-image: linear-gradient(to right, black 92%, transparent) !important;
  -webkit-mask-image: linear-gradient(
    to right,
    black 92%,
    transparent
  ) !important;
}

/* 4) Кнопка — строго по правому краю своей колонки */
#artists-section.artists1.view-list .card__link {
  justify-self: end !important;
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.modal.css

**size:** 7035 bytes &nbsp;&nbsp; **sha1:** `c63082796d5fe6c7e7bb73726c43416c79168952`

```css
/* ============ Artists: Modal (очищено) ============ */

.amodal[hidden] {
  display: none !important;
}

.amodal {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  z-index: 1000;
}
.amodal__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
}

/* Диалог */
.amodal__dialog {
  position: relative;
  z-index: 1;
  background: var(--color-neutral-darkest, #0d0d0d);
  color: var(--color-white, #fff);
  border-radius: 16px;
  inline-size: min(360px, calc(100vw - 48px));
  max-block-size: 90vh;
  overflow: auto;
  padding: 52px 8px;
  padding-right: clamp(20px, 2.2vw, 32px);
  overscroll-behavior: contain;
}
@supports (height: 1svh) {
  .amodal__dialog {
    max-block-size: 90svh;
  }
}
@media (min-width: 768px) {
  .amodal__dialog {
    inline-size: min(702px, calc(100vw - 48px));
    padding: 64px 24px;
    padding-right: clamp(24px, 2.2vw, 36px);
  }
}
@media (min-width: 1440px) {
  .amodal__dialog {
    inline-size: min(1312px, calc(100vw - 96px));
    padding: 64px;
    padding-right: clamp(28px, 2.4vw, 40px);
  }
}

/* Крестик */
.amodal__close {
  position: absolute;
  top: 20px;
  right: 34px;
  inline-size: 36px;
  block-size: 36px;
  display: grid;
  place-items: center;
  border: 0;
  background: transparent;
  color: var(--color-white, #fff);
  font-size: 28px;
  line-height: 1;
  cursor: pointer;
  z-index: 10;
}
.amodal__close::after {
  content: '';
  position: absolute;
  inset: -10px;
}
@media (max-width: 767.98px) {
  .amodal__close {
    top: 16px;
    right: 20px;
  }
}

/* Контент */
.amodal__body {
  color: #e8e8ec;
}
.amodal__title {
  margin: 0 0 16px;
  font: 700 20px/1.3 'Epilogue', system-ui;
  color: var(--color-white, #fff);
  text-align: center;
}
@media (min-width: 768px) {
  .amodal__title {
    font-size: 32px;
  }
}

.amodal__content {
  display: flex;
  flex-direction: column;
  gap: 16px;
}
@media (min-width: 1440px) {
  .amodal__content {
    flex-direction: row;
    align-items: flex-start;
    gap: 32px;
  }
}

.amodal__img {
  width: 100%;
  border-radius: 16px;
  object-fit: cover;
  display: block;
}
.amodal__info {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* метаданные */
.am-meta {
  display: flex;
  gap: 16px;
}
.am-meta__col {
  display: flex;
  flex-direction: column;
  gap: 16px;
  min-width: 150px;
}
.am-meta__item {
  display: flex;
  flex-direction: column;
}
.lbl {
  font-weight: 600;
  color: var(--color-white, #fff);
  line-height: 1.5;
}
.val {
  color: #e8e8ec;
}

/* био */
.am-bio .lbl {
  margin-bottom: 8px;
}
.am-bio p {
  margin: 0;
  color: #e8e8ec;
  line-height: 1.5;
  max-height: calc(1.5em * 10);
  overflow: hidden;
}
@media (min-width: 768px) {
  .am-bio p {
    max-height: calc(1.5em * 12);
  }
}
@supports (-webkit-line-clamp: 1) {
  .am-bio p {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 10;
  }
}

/* теги */
.am-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
}
.am-tags .tag {
  display: inline-flex;
  align-items: center;
  height: 32px;
  padding: 4px 10px;
  border-radius: 6px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  font-weight: 600;
  font-size: 16px;
}

/* альбомы */
.amodal__albums-title {
  margin: 16px 0;
  font: 700 24px/1.3 'Epilogue', system-ui;
  color: var(--color-white, #fff);
}
.amodal__albums {
  display: flex;
  flex-direction: column;
  gap: 32px;
}
@media (min-width: 768px) {
  .amodal__albums {
    flex-direction: row;
    flex-wrap: wrap;
  }
  .amodal__albums .am-album {
    width: calc((100% - 32px) / 2);
  }
}
@media (min-width: 1440px) {
  .amodal__albums .am-album {
    width: calc((100% - 96px) / 4);
  }
}

.am-album {
  min-width: 250px;
  background: #1e1c1f;
  border-radius: 16px;
  padding: 14px 11px;
  display: flex;
  flex-direction: column;
}
.am-album__title {
  margin: 0 0 12px;
  color: var(--color-white, #fff);
  font-weight: 600;
  font-size: 16px;
}

/* таблица треков */
.tbl {
  display: flex;
  flex-direction: column;
}
.tbl .th {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 12px;
  color: var(--color-white, #fff);
  font-weight: 600;
  font-size: 12px;
  line-height: 1.5;
}
.tr {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 8px 12px;
  color: #e8e8ec;
  font-size: 12px;
}
.tr:nth-child(2n) {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 8px;
}

/* колонки */
.th span:nth-child(1),
.tr span:nth-child(1) {
  flex-basis: 60%;
}
.th span:nth-child(2),
.tr span:nth-child(2) {
  flex-basis: 20%;
  text-align: left;
}
.th span:nth-child(3),
.tr span:nth-child(3) {
  flex-basis: 10%;
  text-align: right;
}

/* ютуб-иконка */
.am-yt {
  width: 24px;
  height: 24px;
  fill: var(--color-white, #fff);
  display: inline-block;
  transition: fill 0.2s ease;
}
a:hover .am-yt,
a:focus .am-yt {
  fill: var(--color-affair, #764191);
}
.yt-ph {
  display: inline-block;
  width: 24px;
  height: 24px;
}

/* КНОПКА «ВВЕРХ» */
.amodal__scrolltop {
  position: fixed;
  display: none;
  align-items: center;
  justify-content: center;
  width: 56px;
  height: 56px;
  right: 28px;
  bottom: 58px;
  background: rgba(10, 10, 10, 0.55);
  border: 2px solid rgba(255, 255, 255, 0.95);
  border-radius: 999px;
  color: #fff;
  font-weight: 900;
  font-size: 28px;
  line-height: 1;
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35),
    inset 0 0 0 1px rgba(255, 255, 255, 0.08);
  z-index: 1500;
}
.amodal__scrolltop:focus-visible {
  outline: 2px solid rgba(255, 255, 255, 0.65);
  outline-offset: 2px;
}
@media (max-width: 767.98px) {
  .amodal__scrolltop {
    right: 22px;
    bottom: 58px;
  }
}

/* Slim scrollbars */
.amodal__dialog,
.artists1 .dd__list {
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.28) transparent;
}
.amodal__dialog::-webkit-scrollbar,
.artists1 .dd__list::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}
.amodal__dialog::-webkit-scrollbar-track,
.artists1 .dd__list::-webkit-scrollbar-track {
  background: transparent;
}
.amodal__dialog::-webkit-scrollbar-thumb,
.artists1 .dd__list::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.28);
  border-radius: 8px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
.amodal__dialog::-webkit-scrollbar-thumb:hover,
.artists1 .dd__list::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.42);
}
@media (max-width: 480px) {
  .amodal__dialog::-webkit-scrollbar,
  .artists1 .dd__list::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.pager.css

**size:** 1267 bytes &nbsp;&nbsp; **sha1:** `758a227b80c126a8f79cfa6e1cf9ca28807b2e23`

```css
/* Artists — Pagination */
.artists1 .pager {
  display: flex;
  justify-content: center;
  gap: 6px;
  margin-top: 64px;
}

.artists1 .pager button {
  min-width: 36px;
  height: 36px;
  border-radius: var(--radius-md, 10px);
  border: 1px solid var(--border-muted, rgba(255, 255, 255, 0.15));
  background: transparent;
  color: var(--color-text, var(--color-white, #fff));
  cursor: pointer;
  transition: background-color 150ms ease, border-color 150ms ease,
    transform 100ms ease;
}

.artists1 .pager button:hover:not([disabled]) {
  background: var(--surface-hover, rgba(255, 255, 255, 0.06));
}

.artists1 .pager button:focus-visible {
outline: 2px solid rgba(151, 112, 173, .9);
  outline-offset: 2px;
}

.artists1 .pager button.active {
  background: var(--color-affair-800, #3c2a58);
  border-color: var(--color-affair-800, #3c2a58);
  color: var(--color-white, #fff);
}

.artists1 .pager button[disabled] {
  opacity: 0.5;
  cursor: not-allowed;
}

.artists1 .pager .dots {
  border: 0;
  background: transparent;
  color: var(--color-text-muted, rgba(255, 255, 255, 0.7));
  pointer-events: none;
}

@media (prefers-reduced-motion: reduce) {
  .artists1 .pager button {
    transition: none;
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.player.css

**size:** 9951 bytes &nbsp;&nbsp; **sha1:** `a361fbb3d01a9fa5c2a34ca663003d89b047a5aa`

```css
/* ====== PLAYER (карточка) ====== */
.am-player {
  position: fixed;
  left: 50%;
  right: auto;
  bottom: 128px;
  width: min(720px, 92vw);
  z-index: 9999;
  transform: translate(-50%, 12px);
  opacity: 0;
  pointer-events: none;
  transition: transform 160ms ease, opacity 160ms ease;
}
.am-player--active {
  transform: translateY(0) translateX(-50%);
  opacity: 1;
  pointer-events: auto;
}

/* Свободное позиционирование после drag (управляется JS) */
.am-player--free {
}

/* Карточка */
.am-player__inner {
  background: #111;
  color: #fff;
  border-radius: 14px;
  overflow: hidden;
  box-shadow: 0 16px 42px rgba(0, 0, 0, 0.5);
  position: relative;
}

/* Верхняя «шапка» для перетаскивания */
.am-player__dragzone {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 44px;
  z-index: 6;
  cursor: grab;
  touch-action: none;
  background: transparent;
}
.am-player__dragzone.dragging {
  cursor: grabbing;
}

.am-player__close,
.am-player__hide {
  position: absolute;
  z-index: 8;
  height: 32px;
  border-radius: 8px;
  border: 0;
  color: #fff;
  cursor: pointer;
}
.am-player__close {
  top: 8px;
  right: 8px;
  width: 32px;
  line-height: 32px;
  text-align: center;
  background: #764191;
}
.am-player__hide {
  top: 8px;
  right: 48px;
  padding: 0 10px;
  background: #3a2a4f;
}
.am-player__hide:hover,
.am-player__hide:focus-visible {
  filter: brightness(1.06);
  outline: none;
}

/* Видео-кадр */
.am-player__frame {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 9;
  background: #000;
}
.am-player__host,
.am-player__frame > div,
.am-player__frame iframe {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border: 0;
  display: block;
}

.am-player__ytlink {
  position: absolute;
  top: 8px;
  left: 8px;
  z-index: 7;
  padding: 6px 10px;
  border-radius: 8px;
  background: rgba(0, 0, 0, 0.45);
  color: #fff;
  text-decoration: none;
  font: 600 12px/1 'IBM Plex Sans', system-ui, -apple-system, Segoe UI, Roboto,
    Arial, sans-serif;
}
.am-player__ytlink:hover {
  background: rgba(0, 0, 0, 0.6);
}

.am-player__bar {
  position: absolute;
  left: 8px;
  right: 8px;
  bottom: 8px;
  z-index: 5;
  display: grid;
  grid-template-columns: auto minmax(140px, 1fr) auto;
  gap: 10px;
  align-items: center;
  background: rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(4px);
  padding: 8px 10px;
  border-radius: 10px;
  box-sizing: border-box;
  cursor: default;
}

.am-player__left,
.am-player__right {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
}

/* Кнопки */
.am-player__skip,
.am-player__play,
.am-player__mute {
  cursor: pointer;
  border: none;
  background: #764191;
  color: #fff;
  width: 32px;
  height: 32px;
  border-radius: 8px;
  line-height: 32px;
  text-align: center;
}

/* Время */
.am-player__time {
  color: #fff;
  font: 500 13px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial,
    sans-serif;
}

/* Центр: прогресс */
.am-player__progresswrap {
  min-width: 0;
  width: 100%;
}
.am-player__progress {
  width: 100%;
  max-width: 440px;
  -webkit-appearance: none;
  appearance: none;
  height: 6px;
  background: rgba(255, 255, 255, 0.35);
  border-radius: 999px;
  outline: none;
  margin: 0;
  vertical-align: middle;
  overflow: hidden;
}
.am-player__progress::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #fff;
  border: 0;
  cursor: pointer;
  box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.2);
}
.am-player__progress::-moz-range-thumb {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #fff;
  border: 0;
  cursor: pointer;
}
.am-player__progress::-moz-range-track {
  height: 6px;
  background: rgba(255, 255, 255, 0.35);
  border: none;
  border-radius: 999px;
}

/* Правый блок: громкость фиксированной ширины */
.am-player__right .am-player__slider {
  flex: 0 0 120px;
  width: 120px;
  -webkit-appearance: none;
  appearance: none;
  height: 6px;
  background: rgba(255, 255, 255, 0.35);
  border-radius: 999px;
  outline: none;
  margin: 0;
  vertical-align: middle;
}
.am-player__right .am-player__slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #fff;
  border: 0;
  cursor: pointer;
  box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.2);
}
.am-player__right .am-player__slider::-moz-range-thumb {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #fff;
  border: 0;
  cursor: pointer;
}
.am-player__right .am-player__slider::-moz-range-track {
  height: 6px;
  background: rgba(255, 255, 255, 0.35);
  border: none;
  border-radius: 999px;
}

/* Мобилка: ниже и уже громкость */
@media (max-width: 480px) {
  .am-player {
    bottom: 110px;
  }
  .am-player__right .am-player__slider {
    flex-basis: 96px;
    width: 96px;
  }
}

/* ====== Свёрнутый режим ====== */
.am-player--min .am-player__inner {
  opacity: 0;
  pointer-events: none;
  transform: translate(-50%, 8px) scale(0.985);
  transition: transform 160ms ease, opacity 160ms ease;
}

/* ====== Пузырь ====== */
.am-player__bubble {
  position: fixed;
  z-index: 10000;
  left: auto;
  top: auto;
  right: auto;
  bottom: auto;

  width: 64px;
  height: 64px;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  display: grid;
  place-items: center;

  color: var(--color-white, #fff);
  background: var(--color-affair, #764191);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35),
    inset 0 0 0 1px rgba(255, 255, 255, 0.1);

  --amp: 1.06;
  --bpmDur: 520ms;
  animation: am-bubble-breathe var(--bpmDur) ease-in-out infinite;
}
.am-player__bubble .note {
  font: 700 18px/1 'IBM Plex Sans', system-ui;
  transform: translateY(-1px);
}
.am-player__bubble::before,
.am-player__bubble::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 999px;
  box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.14);
  pointer-events: none;
  transform: scale(1);
  opacity: 0.9;
  animation: am-bubble-ring var(--bpmDur) linear infinite;
}
.am-player__bubble::after {
  animation-delay: calc(var(--bpmDur) / 2);
  opacity: 0.7;
}
.am-player__bubble.is-paused {
  animation-play-state: paused;
}
.am-player__bubble.is-paused::before,
.am-player__bubble.is-paused::after {
  animation-play-state: paused;
  opacity: 0.35;
}
@keyframes am-bubble-breathe {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(var(--amp));
  }
}
@keyframes am-bubble-ring {
  0% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.16);
  }
  60% {
    transform: scale(1.25);
    box-shadow: 0 0 0 10px rgba(255, 255, 255, 0.08);
  }
  100% {
    transform: scale(1.42);
    box-shadow: 0 0 0 18px rgba(255, 255, 255, 0);
  }
}
@media (max-width: 420px) {
  .am-player__bubble {
    width: 56px;
    height: 56px;
  }
}

/* --- iPhone/узкие: прогресс на вторую строку, кнопки отдельно --- */
@media (max-width: 480px) {
  .am-player__bar {
    grid-template-columns: 1fr auto;
    grid-template-areas:
      'left right'
      'prog prog';
    row-gap: 8px;
  }
  .am-player__left {
    grid-area: left;
  }
  .am-player__right {
    grid-area: right;
    justify-self: end;
  }
  .am-player__progresswrap {
    grid-area: prog;
  }

  /* гарантируем, что слайдер не вылезает за бар */
  .am-player__progresswrap {
    overflow: hidden;
  }
}

/* было: z-index: 10000; */
.am-player__bubble {
  z-index: 2147483647; /* абсолютный верх */
}

/* ===== Патч кликов/слоёв при сворачивании ===== */

/* База (как у тебя): док не ловит клики, пока не активирован */
.am-player {
  pointer-events: none;
}

/* Когда активен — ловит клики */
.am-player--active {
  pointer-events: auto;
}

/* КОГДА СВЁРНУТ (пузырь) — снова не ловим клики,
   иначе невидимый док блокирует интерфейс под собой на мобилке */
.am-player--active.am-player--min {
  pointer-events: none;
}

/* Визуально прячем внутренность дока при сворачивании */
.am-player--min .am-player__inner {
  opacity: 0;
  transform: translate(-50%, 8px) scale(0.985);
  pointer-events: none; /* подстраховка */
}

/* Пузырь: управляем видимостью классом (чтобы не мешал кликам, когда скрыт) */
.am-player__bubble {
  display: none;
}
.am-player__bubble.is-visible {
  display: grid;
}

/* На всякий случай: пузырь ВСЕГДА кликабелен поверх всего */
.am-player__bubble {
  z-index: 2147483647;
  pointer-events: auto;
}

/* разрешаем кастомные жесты без нативного скролла */
.am-player__bubble,
.am-player__dragzone {
  touch-action: none;
}

/* когда плеер свёрнут — клики проходят сквозь док, но не сквозь пузырь */
.am-player--min.am-player--patch-applied {
  pointer-events: none;
}
.am-player--min.am-player--patch-applied .am-player__bubble {
  pointer-events: auto;
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.skeleton.css

**size:** 1022 bytes &nbsp;&nbsp; **sha1:** `2a430670c7f3ab2bc8a83120c9ee1c14312f8253`

```css
/* Fade-in изображений карточек */
.artists1 .img-fade {
  opacity: 0;
  transition: opacity 0.35s ease;
}
.artists1 .img-fade.is-loaded {
  opacity: 1;
}

/* Скелетоны карты */
.artists1 .card--skel .skel {
  display: block;
  border-radius: 12px;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0.06) 25%,
    rgba(255, 255, 255, 0.12) 37%,
    rgba(255, 255, 255, 0.06) 63%
  );
  background-size: 400% 100%;
  animation: skel-shine 1.4s ease infinite;
}
.artists1 .skel--media {
  height: 177px;
  border-radius: 16px;
}
.artists1 .skel--tag {
  width: 72px;
  height: 32px;
  border-radius: 6px;
}
.artists1 .skel--title {
  height: 28px;
  margin: 12px 0 8px;
}
.artists1 .skel--text {
  height: 40px;
  border-radius: 8px;
}

@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1 .skel--media {
    height: 432px;
  }
}
@media (min-width: 1440px) {
  .artists1 .skel--media {
    height: 393px;
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/artists.toolbar.css

**size:** 12219 bytes &nbsp;&nbsp; **sha1:** `08b8da54ea4473fcd1707cbb6b7b5dcb3ad960a0`

```css
/* =========================
   ARTISTS • TOOLBAR (final, no conflicts)
   ========================= */

/* Базовый вид кнопок внутри панели (drop-down + mix radio) */
#artists-section #filters-panel .dd__btn,
#artists-section #filters-panel #random-radio,
#artists-section #filters-panel #mixRadioBtn,
#artists-section #filters-panel #artist1Button,
#artists-section #filters-panel #Artist1Button {
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: space-between; /* текст слева, стрелка справа */
  gap: 12px;

  min-height: 47px;
  height: auto;
  padding: 10px 14px;
  padding-right: 30px; /* запас под стрелку */
  border-radius: 12px;

  width: 100%; /* <— ключевой фикс, без 265/280/304 */
  background: rgba(255, 255, 255, 0);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #e8e8ec;
  font: 600 16px/1 'IBM Plex Sans', system-ui, -apple-system, Segoe UI, Roboto,
    Arial, sans-serif;
}

/* Стрелка на кнопках дропдаунов */
#artists-section #filters-panel .dd__btn {
  position: relative;
}
#artists-section #filters-panel .dd__btn::after {
  content: '';
  position: absolute;
  right: 12px;
  top: 50%;
  width: 8px;
  height: 8px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: translateY(-50%) rotate(45deg);
  transition: transform 0.2s ease;
}
#artists-section #filters-panel .dd.open .dd__btn::after {
  transform: translateY(-50%) rotate(-135deg);
}

/* Иконки в mix-radio/кнопках (если есть) */
#artists-section #filters-panel #random-radio .ico,
#artists-section #filters-panel #mixRadioBtn .ico,
#artists-section #filters-panel #artist1Button .ico,
#artists-section #filters-panel #Artist1Button .ico {
  width: 24px;
  height: 24px;
  display: block;
  flex: 0 0 auto;
  fill: currentColor;
}

/* Hover / Focus */
@media (hover: hover) and (pointer: fine) {
  #artists-section #filters-panel .dd__btn:hover,
  #artists-section #filters-panel #random-radio:hover,
  #artists-section #filters-panel #mixRadioBtn:hover,
  #artists-section #filters-panel #artist1Button:hover,
  #artists-section #filters-panel #Artist1Button:hover {
    transform: scale(1.02);
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
  }
}
#artists-section #filters-panel .dd__btn:focus-visible,
#artists-section #filters-panel #random-radio:focus-visible,
#artists-section #filters-panel #mixRadioBtn:focus-visible,
#artists-section #filters-panel #artist1Button:focus-visible,
#artists-section #filters-panel #Artist1Button:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(151, 112, 173, 0.25);
}

/* Overlay-панель на мобилке — небольшой нижний отступ,
   НО без боковых margin у самих кнопок (чтобы ничего не наползало) */
@media (max-width: 767.98px) {
  #artists-section #filters-panel {
    padding-bottom: 16px;
  }
  #artists-section #filters-panel .dd__btn,
  #artists-section #filters-panel #random-radio,
  #artists-section #filters-panel #mixRadioBtn,
  #artists-section #filters-panel #artist1Button,
  #artists-section #filters-panel #Artist1Button {
    margin: 0; /* <— убираем старые margin-left/right */
  }
}

/* ——— Единый «линк-подчерк» для List view и Reset ——— */
#artists-section #view-toggle,
#artists-section #filters-reset {
  appearance: none;
  background: none;
  border: 0;
  padding: 0;
  margin: 0;
  font: 500 18px/1.5 'IBM Plex Sans', sans-serif;
  color: #fff;
  text-decoration: underline;
  text-decoration-skip-ink: none;
  text-underline-offset: 4px;
  text-decoration-thickness: 1.75px;
  white-space: nowrap;
  cursor: pointer;
}

/* Геометрия Reset из ТЗ — оставляем компактной, но подпись/подчерк остаются */
#artists-section #filters-reset {
  inline-size: 48px; /* ширина кликабельной зоны под текст Reset */
  block-size: 27px;
  display: inline-grid;
  place-items: center;
}

/* Ховер/фокус для текст-кнопок */
#artists-section #filters-reset:hover,
#artists-section #filters-reset:focus-visible,
#artists-section #view-toggle:hover,
#artists-section #view-toggle:focus-visible {
  filter: brightness(1.06);
  outline: none;
}
/* Tablet layout (768–1439.98): Default left, Reset + Search on the right */
@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1 .filters__bar {
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative; /* на всякий случай */
  }

  /* Default view — СЛЕВА, без абсолютов/центра */
  #view-toggle,
  .artists1 .filters__view {
    order: 1;
    position: static !important;
    left: auto !important;
    transform: none !important;
    margin: 0 !important;
    min-inline-size: 0; /* чтобы ширина текста не влияла */
    white-space: nowrap;
  }

  /* Reset — толкает правую группу вправо */
  #filters-reset {
    order: 2;
    margin-left: auto !important; /* ключ: именно Reset тянет всё вправо */
    margin-right: 0 !important;
    white-space: nowrap;
  }

  /* Search and Filters — крайний справа */
  #filters-toggle {
    order: 3;
    margin-left: 12px !important;
  }
}

/* Mobile fix: ListView слева, Reset крайний справа; Search&Filters — на второй строке, во всю ширину */
@media (max-width: 767.98px) {
  .artists1 .filters__bar {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap; /* 1-я строка: ListView + Reset, 2-я: Search */
  }

  /* ListView — слева, без абсолютных центровок */
  #view-toggle,
  .artists1 .filters__view {
    order: 1;
    position: static !important;
    left: auto !important;
    transform: none !important;
    margin: 0 !important;
    white-space: nowrap;
  }

  /* Reset — крайний справа на первой строке */
  #filters-reset {
    order: 2;
    margin-left: auto !important; /* толкаем к правому краю */
    white-space: nowrap;
  }

  /* Кнопка Search and Filters — целиком второй строкой */
  #filters-toggle {
    order: 3;
    width: 100% !important;
    margin-left: 0 !important;
  }
}

/* === LIST VIEW: железобетонный трек === */
#artists-section.artists1.view-list .grid {
  /* трек не центрируем, чтоб не ловить «ползание» при одной колонке */
  justify-content: start !important;
  overflow-x: clip; /* защита от горизонтальной прокрутки (визуального «вылета») */
}

#artists-section.artists1.view-list .grid .card {
  box-sizing: border-box !important;
  inline-size: 100% !important; /* width */
  max-inline-size: 976px !important; /* max-width */
  margin-inline: auto !important;

  /* мобайл: 64 | гибкая | кнопка */
  grid-template-columns: 64px minmax(0, 1fr) auto !important;
}

/* планшет/десктоп: превью 208 */
@media (min-width: 768px) {
  #artists-section.artists1.view-list .grid .card {
    grid-template-columns: 208px minmax(0, 1fr) auto !important;
  }
}

/* средняя колонка действительно может сжиматься */
#artists-section.artists1.view-list .card__title,
#artists-section.artists1.view-list .card__tags {
  min-width: 0 !important;
  overflow: hidden !important;
}
#artists-section.artists1.view-list .card__title {
  white-space: nowrap !important;
  text-overflow: ellipsis !important;
}
#artists-section.artists1.view-list .card__tags {
  white-space: nowrap !important;
  text-overflow: clip !important;
  mask-image: linear-gradient(to right, black 92%, transparent) !important;
  -webkit-mask-image: linear-gradient(
    to right,
    black 92%,
    transparent
  ) !important;
}

/* кнопка строго справа */
#artists-section.artists1.view-list .card__link {
  justify-self: end !important;
}

/* === ВАЖНО: убираем скейл на hover у .card__link (он визуально «вылезает» за край) === */
@media (hover: hover) and (pointer: fine) {
  /* если где-то выше её включили общим правилом — гасим */
  #artists-section .card__link:hover,
  #artists-section .card__link:focus-visible {
    transform: none !important;
    box-shadow: none !important;
  }
}

/* На мобиле .card__link у нас и так иконка 24×24; подстрахуем */
@media (max-width: 767.98px) {
  #artists-section.artists1.view-list .grid .card__link,
  #artists-section.artists1.view-list #artists-grid .card__link {
    inline-size: 24px !important;
    block-size: 24px !important;
    padding: 0 !important;
    border: 0 !important;
    display: grid !important;
    place-items: center !important;
    font-size: 0 !important;
    line-height: 0 !important;
    gap: 0 !important;
    background: transparent !important;
  }
  #artists-section.artists1.view-list .grid .card__link .ico,
  #artists-section.artists1.view-list #artists-grid .card__link .ico {
    inline-size: 24px !important;
    block-size: 24px !important;
    margin-left: 0 !important;
    flex-shrink: 0 !important;
  }
}

/* Общая страховка секции от X-скролла (лучше clip, чем hidden) */
#artists-section {
  overflow-x: clip;
}

#artists-section #filters-panel .dd__btn,
#artists-section #filters-panel #random-radio,
#artists-section #filters-panel #mixRadioBtn,
#artists-section #filters-panel #artist1Button,
#artists-section #filters-panel #Artist1Button,
#artists-section #filters-panel #mixradio-menu-btn {
  /* <— ДОБАВЛЕНО */
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;

  min-height: 47px;
  padding: 10px 14px;
  padding-right: 30px;
  border-radius: 12px;

  width: 100%;
  background: rgba(255, 255, 255, 0);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #e8e8ec;
  font: 600 16px/1 'IBM Plex Sans', system-ui, -apple-system, Segoe UI, Roboto,
    Arial, sans-serif;
}

@media (hover: hover) and (pointer: fine) {
  #artists-section #filters-panel .dd__btn:hover,
  #artists-section #filters-panel #random-radio:hover,
  #artists-section #filters-panel #mixRadioBtn:hover,
  #artists-section #filters-panel #artist1Button:hover,
  #artists-section #filters-panel #Artist1Button:hover,
  #artists-section #filters-panel #mixradio-menu-btn:hover {
    /* <— ДОБАВЛЕНО */
    transform: scale(1.02);
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
  }
}
#artists-section #filters-panel .dd__btn:focus-visible,
#artists-section #filters-panel #random-radio:focus-visible,
#artists-section #filters-panel #mixRadioBtn:focus-visible,
#artists-section #filters-panel #artist1Button:focus-visible,
#artists-section #filters-panel #Artist1Button:focus-visible,
#artists-section #filters-panel #mixradio-menu-btn:focus-visible {
  /* <— ДОБАВЛЕНО */
  outline: none;
  box-shadow: 0 0 0 3px rgba(151, 112, 173, 0.25);
}

.artists1 #filters-panel .fld,
.artists1 #filters-panel #flt-q-btn,
.artists1 #filters-panel .dd,
.artists1 #filters-toggle,
.artists1 #filters-panel #mixradio-menu-btn {
  /* <— ДОБАВЛЕНО */
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
    inset 0 -2px 1px 0 rgba(6, 3, 7, 0.05),
    inset 0 0 0 1px rgba(255, 255, 255, 0.1);
  border: 0;
  color: var(--color-white);
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/artists/index.css

**size:** 6517 bytes &nbsp;&nbsp; **sha1:** `a25af122fba29d9be3909efd1a2eb6ccc21c27a4`

```css
/* базовые вещи секции (если используешь) */
@import url('./artists.base.css');

/* сетка + карточки */
@import url('./artists.grid.css');
@import url('./artists.card.css');

/* интерактив: ховеры/фокусы/клики */
@import url('./artists.controls.css');

/* модалка, плеер, скелетоны, анимации, фильтры, пагер */
@import url('./artists.modal.css');
@import url('./artists.player.css');
@import url('./artist.zoom.css');
@import url('./artists.skeleton.css');
@import url('./artists.anim.css');
@import url('./artists.filters.css');
@import url('./artists.pager.css');
@import url('./artists.toolbar.css');

/* =========================
   ARTISTS • ZERO-OVERFLOW + SAFE HOVER (v2)
   ========================= */

/* секция не даёт горизонтальный скролл, но не «запаивает» покраску */
#artists-section {
  overflow-x: clip !important;
  /* contain: paint;  ← убираем: мешает теням/hover */
}

/* элементы сетки обязаны сжиматься, ширина не превышает контейнер */
#artists-section .artists1__layout > *,
#artists-section .artists1__content,
#artists-section .grid,
#artists-section #artists-grid {
  min-width: 0 !important;
  max-width: 100% !important;
}

/* ListView трек слева, без x-скролла */
#artists-section.artists1.view-list .grid {
  justify-content: start !important;
  overflow-x: clip !important;
  overflow-y: visible; /* тени видны */
}

/* Карточка в ListView не шире контейнера, горизонтально клипуем, вертикально показываем */
#artists-section.artists1.view-list .grid .card {
  box-sizing: border-box !important;
  inline-size: 100% !important;
  max-inline-size: 976px !important;
  margin-inline: auto !important;

  overflow-x: clip !important; /* защита по X */
  overflow-y: visible !important; /* тень/подъём видны по Y */
  contain: inline-size; /* только по ширине, без paint */

  /* мобайл: превью 64 | гибкая | кнопка */
  grid-template-columns: 64px minmax(0, 1fr) auto !important;
}
@media (min-width: 768px) {
  #artists-section.artists1.view-list .grid .card {
    grid-template-columns: 208px minmax(0, 1fr) auto !important;
  }
}

/* средняя колонка реально сжимается */
#artists-section.artists1.view-list .card__title,
#artists-section.artists1.view-list .card__tags {
  min-width: 0 !important;
  overflow: hidden !important;
  white-space: nowrap !important;
}
#artists-section.artists1.view-list .card__title {
  text-overflow: ellipsis !important;
}
#artists-section.artists1.view-list .card__tags {
  text-overflow: clip !important;
  mask-image: linear-gradient(to right, black 92%, transparent) !important;
  -webkit-mask-image: linear-gradient(
    to right,
    black 92%,
    transparent
  ) !important;
}

/* MOBILE: Learn More = иконка 24×24 строго справа */
@media (max-width: 767.98px) {
  #artists-section.artists1.view-list .grid .card__link,
  #artists-section.artists1.view-list #artists-grid .card__link {
    inline-size: 24px !important;
    block-size: 24px !important;
    padding: 0 !important;
    border: 0 !important;
    display: grid !important;
    place-items: center !important;
    font-size: 0 !important;
    line-height: 0 !important;
    gap: 0 !important;
    background: transparent !important;
  }
  #artists-section.artists1.view-list .grid .card__link .ico,
  #artists-section.artists1.view-list #artists-grid .card__link .ico {
    inline-size: 24px !important;
    block-size: 24px !important;
    margin-left: 0 !important;
    flex-shrink: 0 !important;
  }
}

/* ===== SAFE HOVER (возвращаем «живость», без вылезаний) ===== */
@media (hover: hover) and (pointer: fine) {
  /* карточка: лёгкий подъём + тень */
  #artists-section .grid .card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    will-change: transform;
  }
  #artists-section .grid .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.28);
  }

  /* кнопка Learn More: подсветка + толкание иконки, без scale */
  #artists-section .grid .card__link {
    transition: background-color 0.2s ease, border-color 0.2s ease,
      box-shadow 0.2s ease;
  }
  #artists-section .grid .card__link:hover,
  #artists-section .grid .card__link:focus-visible {
    background: rgba(255, 255, 255, 0.06) !important;
    border-color: rgba(255, 255, 255, 0.28) !important;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.24) !important;
  }
  #artists-section .grid .card__link .ico {
    transition: transform 0.2s ease, fill 0.2s ease;
  }
  #artists-section .grid .card__link:hover .ico,
  #artists-section .grid .card__link:focus-visible .ico {
    transform: translateX(2px);
    fill: var(--color-affair);
  }
}

/* Общая страховка: контейнер клипует только по X, по Y — видим hover-тени */
#artists-section .grid {
  overflow-x: clip;
  overflow-y: visible;
}

/* Модалка: оставь, только если нет собственного modal.css.
   Если модалка уже фиксируется в другом файле — убери дубли. */
#artist-modal.amodal {
  position: fixed;
  inset: 0;
  z-index: 10000;
}
#artist-modal[hidden] {
  display: none !important;
}

/* a) секция больше НЕ запирает слои */
#artists-section {
  contain: none !important;
} /* или initial */

/* b) бекдроп не перехватывает клики — кликается и плеер, и «пузырь» */
.amodal__backdrop {
  pointer-events: none !important;
}
.amodal__dialog {
  pointer-events: auto !important;
}

/* c) явные уровни поверх бекдропа */
.amodal {
  z-index: 10000 !important;
} /* модалка */
.am-player {
  z-index: 11000 !important;
} /* сам плеер */
.am-player__bubble {
  z-index: 2147483647 !important;
} /* у тебя уже так */

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/assistant/chat.css

**size:** 9619 bytes &nbsp;&nbsp; **sha1:** `4a3dc7a2f7c24d976615344c88adf43fdbb5ad06`

```css
/* =============================
   Chat Assistant (full CSS)
   ============================= */

/* Палитра и размеры */
:root {
  --as-bg: #0f1115; /* фон страницы (на случай растягивания) */
  --as-panel: #171a21; /* фон панели */
  --as-panel-2: #1c2129; /* фон шапки/подложек */
  --as-border: #2a3040; /* линии/границы */
  --as-shadow: 0 12px 40px rgba(0, 0, 0, 0.45);

  --as-text: #e8eef5; /* основной текст */
  --as-muted: #a9b3bf; /* приглушённый текст */
  --as-accent: #66e1ff; /* акцент (кнопки/фокус) */

  --as-bot: #1f2a33; /* пузырь бота */
  --as-user: #23303c; /* пузырь пользователя */

  --as-radius-lg: 16px;
  --as-radius-md: 12px;
  --as-radius-sm: 10px;

  --as-gap: 12px;
  --as-z: 9999;
}

/* Базовые сбросы внутри виджета */
.assistant,
.assistant * {
  box-sizing: border-box;
  font: inherit;
}
.assistant {
  color-scheme: dark;
}

/* ──────────────────────────────────────────────────────────────
   Плавающая toggle-кнопка
   ────────────────────────────────────────────────────────────── */
.assistant__toggle {
  position: fixed;
  right: max(12px, env(safe-area-inset-right));
  bottom: max(12px, env(safe-area-inset-bottom));
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: 1px solid var(--as-border);
  background: radial-gradient(120% 120% at 30% 30%, #202736 0%, #11141a 70%);
  color: var(--as-text);
  display: grid;
  place-items: center;
  cursor: pointer;
  z-index: var(--as-z);
  box-shadow: var(--as-shadow);
  transition:
    transform 0.15s ease,
    opacity 0.15s ease;
}
.assistant__toggle:hover {
  transform: translateY(-1px);
}
.assistant__toggle:active {
  transform: translateY(0);
}

/* ──────────────────────────────────────────────────────────────
   Панель
   ────────────────────────────────────────────────────────────── */
.assistant__panel {
  position: fixed;
  right: max(12px, env(safe-area-inset-right));
  bottom: max(88px, env(safe-area-inset-bottom)); /* над пузырём */
  width: min(420px, 96vw);
  max-height: calc(100vh - 120px);
  background: var(--as-panel);
  color: var(--as-text);
  border: 1px solid var(--as-border);
  border-radius: var(--as-radius-lg);
  box-shadow: var(--as-shadow);
  display: flex;
  flex-direction: column;
  overflow: hidden; /* защита от вылезания */
  z-index: var(--as-z);
}
.assistant__panel[hidden] {
  display: none !important;
}

/* Шапка */
.assistant__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 12px 14px;
  background: var(--as-panel-2);
  border-bottom: 1px solid var(--as-border);
}
.assistant__header strong {
  font-weight: 700;
  letter-spacing: 0.2px;
}
.assistant__close {
  appearance: none;
  border: 1px solid var(--as-border);
  background: #0e1116;
  color: var(--as-muted);
  width: 32px;
  height: 32px;
  border-radius: 8px;
  display: grid;
  place-items: center;
  cursor: pointer;
}
.assistant__close:hover {
  color: var(--as-text);
}

/* Лента сообщений */
.assistant__log {
  flex: 1 1 auto;
  overflow: auto;
  overscroll-behavior: contain;
  padding: 14px;
  display: grid;
  gap: 10px;
  background: linear-gradient(#0000 0, #0000 12px, #12151b 12px);
}

/* Сообщения */
.assistant__msg {
  max-width: 85%;
  padding: 10px 12px;
  line-height: 1.35;
  border-radius: 14px;
  white-space: pre-wrap;
  word-wrap: anywhere;
  border: 1px solid var(--as-border);
  color: var(--as-text);
}
.assistant__msg--bot {
  background: var(--as-bot);
  justify-self: start;
}
.assistant__msg--user {
  background: var(--as-user);
  justify-self: end;
}

/* Подсказки / уведомления */
.assistant__tip {
  font-size: 0.9em;
  color: var(--as-muted);
  text-align: center;
}

/* Блок управления (поле ввода, кнопки) */
.assistant__controls {
  position: sticky;
  bottom: 0;
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 8px;
  padding: 12px;
  background: linear-gradient(180deg, #161a20 0%, #12151b 100%);
  border-top: 1px solid var(--as-border);
}

/* Микрофон */
.assistant__mic {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  border: 1px solid var(--as-border);
  background: #0e1116;
  color: var(--as-text);
  display: grid;
  place-items: center;
  cursor: pointer;
}
.assistant__mic.is-on {
  outline: 2px solid var(--as-accent);
  background: #0c1a21;
}

/* Поле ввода */
.assistant__input {
  height: 40px;
  padding: 0 12px;
  border-radius: 10px;
  border: 1px solid var(--as-border);
  background: #0f1216;
  color: var(--as-text);
  width: 100%;
}
.assistant__input::placeholder {
  color: var(--as-muted);
}

/* Отправка */
.assistant__send {
  min-width: 110px;
  height: 40px;
  padding: 0 14px;
  border-radius: 10px;
  border: 1px solid #0d2a33;
  background: linear-gradient(180deg, #0f3641 0%, #0c252d 100%);
  color: #dff7ff;
  cursor: pointer;
}
.assistant__send:hover {
  filter: brightness(1.05);
}

/* ──────────────────────────────────────────────────────────────
   Настройки (голос, горячая фраза)
   ────────────────────────────────────────────────────────────── */
.assistant__settings {
  padding: 12px;
  border-top: 1px solid var(--as-border);
  background: var(--as-panel);
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  align-items: center;
}
.assistant__settings label {
  display: grid;
  gap: 6px;
  color: var(--as-muted);
  font-size: 0.95em;
}
.assistant__settings select {
  width: 100%;
  height: 38px;
  padding: 0 10px;
  border-radius: 10px;
  border: 1px solid var(--as-border);
  background: #0f1216;
  color: var(--as-text);
  min-width: 0;
}
.assistant__settings .as-row {
  display: flex;
  align-items: center;
  gap: 10px;
}
.assistant__settings .as-switch {
  appearance: none;
  width: 44px;
  height: 24px;
  border-radius: 999px;
  background: #202636;
  position: relative;
  border: 1px solid var(--as-border);
  cursor: pointer;
}
.assistant__settings .as-switch::after {
  content: '';
  position: absolute;
  top: 3px;
  left: 3px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #cfd9e6;
  transition: transform 0.2s ease;
}
.assistant__settings .as-switch:checked {
  background: #0f3a47;
  border-color: #16576b;
}
.assistant__settings .as-switch:checked::after {
  transform: translateX(20px);
}
.assistant__settings .as-btn {
  height: 38px;
  padding: 0 12px;
  border-radius: 10px;
  border: 1px solid var(--as-border);
  background: #0e1116;
  color: var(--as-text);
  cursor: pointer;
}
.assistant__settings .as-btn:hover {
  color: #fff;
}

/* ──────────────────────────────────────────────────────────────
   Доступность и фокусы
   ────────────────────────────────────────────────────────────── */
.assistant__panel :focus {
  outline: 2px solid color-mix(in oklab, var(--as-accent) 70%, #fff 0%);
  outline-offset: 2px;
}

/* ──────────────────────────────────────────────────────────────
   Мобилки/узкие экраны
   ────────────────────────────────────────────────────────────── */
@media (max-width: 480px) {
  .assistant__panel {
    right: 3vw;
    bottom: 84px;
    width: 94vw;
    max-height: calc(100vh - 100px);
  }
  .assistant__settings {
    grid-template-columns: 1fr; /* в столбик */
  }
  .assistant__send {
    min-width: 92px;
  }
}

/* Страховка от горизонтального скролла всей страницы,
   если сайт-лейаут «тесный» */
html,
body {
  overflow-x: hidden;
}

/* Доп. мелочи */
.assistant__msg code {
  background: #101620;
  border: 1px solid var(--as-border);
  padding: 0.1em 0.35em;
  border-radius: 6px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  font-size: 0.92em;
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/base.css

**size:** 1864 bytes &nbsp;&nbsp; **sha1:** `d9de513ed83f2080dd76474cb15e5a1e53e009b8`

```css
:root {

  /* основной текст */
  font-family: "IBM Plex Sans", system-ui, -apple-system, BlinkMacSystemFont,
    "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
    sans-serif;
  font-size: 16px;
  line-height: 1.5;
  font-weight: 400;

  color: var(--color-white,#fff);


  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-text-size-adjust: 100%;


  --color-scheme-1-background: var(--color-neutral-darkest);
  --color-neutral-darkest: #060307;

  --color-scheme-1-text: var(--color-white);
  --color-white: #fff;

  --color-affair: #764191;
  --opacity-white-5: rgba(255, 255, 255, 0.05);
  --color-error-red: #af0404;

  --color-affair-dark-14: #5f3376;
  --color-affair-light-25: #9770ad;
  --color-affair-light-25-rgba25: rgba(151, 112, 173, .25);
}

html,
body {
  overflow-x: clip;
  scroll-behavior: smooth;
  width: 100%;
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
  
}

body {
  display: flex;
  flex-direction: column;
  min-width: 100vw;
  min-height: 100vh;
  margin: 0;
  background-color: var(--color-neutral-darkest,#060307);
  padding-top: 20px;
}


main {
  flex-grow: 1;
}

img {
  height: 100%;
}

@media only screen and (min-width: 768px) {
  body {
    padding-top: 0;
  }
}
/* Минимальный reset без вендорных расширений */
:where(*, *::before, *::after) {
  box-sizing: border-box;
}

:where(html, body) {
  height: 100%;
}

:where(img, picture, video, canvas, svg) {
  display: block;
  max-width: 100%;
}

:where(input, button, textarea, select) {
  font: inherit;
}

:where(p, h1, h2, h3, h4, h5, h6) {
  margin: 0;
}
```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/comments.css

**size:** 9298 bytes &nbsp;&nbsp; **sha1:** `e91e1e87c6aa4704f545fd0de4940fa6238d575a`

```css
/* ====== FEEDBACK SECTION ====== */
.feedback-section {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  flex-direction: column;
  gap: 80px;
  padding: 64px 0;
  width: 100%;
  max-width: 1440px;
  margin: 0 auto;
}

@media (min-width: 1440px) {
  .feedback-section {
    padding: 112px 0;
  }
}

/* ====== SWIPER AREA WIDTHS (288 / 704 / 1312) ====== */
.swiper {
  position: relative;
  width: 100%;
  max-width: 288px;
  /* mobile */
  margin: 0 auto;
  overflow: hidden;
}

@media (min-width: 768px) {
  .swiper {
    max-width: 704px;
  }

}

@media (min-width: 1440px) {
  .swiper {
    max-width: 1312px;
  }

  /* desktop */
}

/* страховка от зазоров между слайдами */
.swiper .swiper-wrapper {
  gap: 0 !important;
}

.swiper .swiper-slide {
  flex: 0 0 100% !important;
  width: 100% !important;
  margin: 0 !important;
  box-sizing: border-box;
}

/* ====== ARROWS ====== */
.swiper-button-prev::after,
.swiper-button-next::after {
  display: none;
  content: none;
}

.swiper-button-prev,
.swiper-button-next {
  width: 48px !important;
  height: 48px !important;
  border: 1px solid rgba(255, 255, 255, 0.5);
  border-radius: 8px;
  background: transparent;
  display: none !important;
  /* показываем только >=768px */
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  /* идеальный центр */
  z-index: 100;
  transition: border-color 0.25s ease;
}

@media (min-width: 768px) {

  .swiper-button-prev,
  .swiper-button-next {
    display: flex !important;
  }
}

.swiper-button-prev {
  left: 0;
}

.swiper-button-next {
  right: 0;
}

.left-arrow {
  transform: rotate(180deg);
}

.swiper-button-prev svg,
.swiper-button-next svg {
  width: 24px;
  height: 24px;
  fill: var(--color-white);
  /* видно всегда */
  transition: fill 0.25s ease;
}

.swiper-button-prev:is(:hover, :focus),
.swiper-button-next:is(:hover, :focus) {
  border-color: var(--color-affair);
}

.swiper-button-prev:is(:hover, :focus) svg,
.swiper-button-next:is(:hover, :focus) svg {
  fill: var(--color-affair);
}

.swiper-button-prev svg use,
.swiper-button-next svg use {
  pointer-events: none;
}

/* ====== PAGINATION (3 точки) ====== */
.swiper-pagination {
  display: flex;
  justify-content: center;
  gap: 9px;
  margin: 0 auto 12px;
  padding: 10px 0;
  position: static !important;
}

.swiper-dots {
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.2);
  cursor: pointer;
}

.swiper-dots.active {
  background: #fff;
}

/* ====== STARS (в строку и по центру) ====== */
.feedback-section .rating,
.modal .rating {
  display: flex !important;
  align-items: center;
  justify-content: center;
  /* по макету — центр; поменяй на flex-start если нужно слева */
  gap: 6px;
  margin-bottom: 24px;
  /* переносим отступ на контейнер */
}
/* Firefox */
.modal {
  scrollbar-width: none;
}

/* Chrome / Edge / Safari */
.modal::-webkit-scrollbar {
  width: 0;
  height: 0;
}
.rating .star {
  cursor: pointer;
  display: inline-block !important;
  /* переопределяем старое display:flex */
  width: 30px;
  height: 28px;
  margin: 0 !important;
  /* убираем «ступеньки» */
  background-color: var(--color-white);
  clip-path: polygon(50% 0%,
      61% 35%,
      98% 35%,
      68% 57%,
      79% 91%,
      50% 70%,
      21% 91%,
      32% 57%,
      2% 35%,
      39% 35%);
}

.rating .star.filled {
  background-color: var(--color-affair);
}

/* ====== TEXTS ====== */
.feedback {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  flex-direction: column;
}

.customer-feedback {
  font-weight: 700;
  font-size: 18px;
  line-height: 1.4;
  letter-spacing: -0.01em;
  text-align: center;
  margin-bottom: 32px;
  color: var(--color-white);
  max-width: 288px;
  /* мобильный текст не шире контейнера */
}

@media (min-width: 768px) {
  .customer-feedback {
    font-size: 26px;
    max-width: 518px;
  }
}

@media (min-width: 1440px) {
  .customer-feedback {
    font-size: 32px;
    line-height: 1.3;
    max-width: 768px;
  }
}

.customer-name {
  font-weight: 600;
  font-size: 18px;
  line-height: 1.5;
  color: var(--color-white);
  margin-bottom: 16px;
}

/* ====== BUTTON ====== */
.review-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 64px;
  border-radius: 12px;
  padding: 10px 14px;
  width: 288px;
  height: 47px;
  box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
    inset 0 -2px 1px 0 rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(6, 3, 7, 0.15),
    inset 0 2px 1px 0 rgba(255, 255, 255, 0.25),
    inset 0 32px 24px 0 rgba(6, 3, 7, 0.05);
  background: var(--color-affair);
  font-weight: 500;
  font-size: 18px;
  color: var(--color-white);
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
}

@media (min-width: 768px) {
  .review-btn {
    width: 158px;
  }
}

@media (min-width: 1440px) {
  .review-btn {
    width: 177px;
  }
}

.review-btn:hover {
  box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
    inset 0 -2px 1px 0 rgba(6, 3, 7, 0.05),
    inset 0 0 0 1px rgba(255, 255, 255, 0.1);
  background: rgba(255, 255, 255, 0.1);
  border: none;
  transform: translateY(-2px);
}

.review-btn:active {
  border: none;
  background: transparent;
}

/* ====== MODAL ====== */
.overlay {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  background: rgba(0, 0, 0, 0.7);
  /* серый полупрозрачный */
  backdrop-filter: blur(2px);
  /* лёгкое размытие фона */
  opacity: 0;
  visibility: hidden;
  transition: opacity .3s ease, visibility .3s ease;
}

.overlay:not(.hidden) {
  opacity: 1;
  visibility: visible;
}

.modal {
  background: #000;
  /* чисто чёрный */
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 24px;
  border-radius: 16px;
  padding: 24px 16px;
  width: 100%;
  max-width: 320px;
  max-height: min(90vh, 740px);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
  overflow: auto;
}

@media (min-width: 768px) {
  .modal {
    padding: 40px 48px;
    max-width: 640px;
  }
}

@media (min-width: 1440px) {
  .modal {
    padding: 48px 64px;
    max-width: 864px;
  }
}

.close-icon {
  position: absolute;
  top: 16px;
  right: 16px;
  cursor: pointer;
  fill: var(--color-white);
  transition: transform .2s ease, fill .2s ease;
}

.close-icon:hover {
  transform: rotate(90deg) scale(1.05);
  fill: var(--color-affair);
}

.title-modal {
  margin-top: 64px;
  font-weight: 700;
  font-size: 24px;
  line-height: 1.3;
  letter-spacing: -0.01em;
  text-align: center;
  color: var(--color-white);
}

@media (min-width: 768px) {
  .title-modal {
    font-size: 44px;
    line-height: 1.2;
    margin: 64px 0;
  }
}

@media (min-width: 1440px) {
  .title-modal {
    font-size: 60px;
  }
}

label {
  display: block;
  margin-bottom: 8px;
  font-weight: 400;
  font-size: 18px;
  line-height: 1.5;
  color: #fff;
}

.form-input-name {
  display: flex;
  align-items: center;
  gap: 8px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 8px 12px;
  width: 100%;
  max-width: 288px;
  height: 43px;
  font-weight: 400;
  font-size: 18px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.6);
  background: transparent;
  margin-bottom: 32px;
}

@media (min-width: 768px) {
  .form-input-name {
    max-width: 640px;
    margin-bottom: 24px;
  }
}

@media (min-width: 1440px) {
  .form-input-name {
    max-width: 736px;
  }
}

textarea {
  display: block;
  margin-bottom: 32px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 8px 12px;
  width: 100%;
  max-width: 288px;
  /* mobile */
  height: 130px;
  font-weight: 400;
  font-size: 18px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.6);
  background: transparent;
  overflow-wrap: anywhere;
  word-break: break-word;
}

@media (min-width: 768px) {
  textarea {
    padding: 12px;
    max-width: 640px;
    height: 180px;
  }
}

@media (min-width: 1440px) {
  textarea {
    max-width: 736px;
    margin-bottom: 24px;
  }
}

/* ====== MISC ====== */
.send-btn-cont {
  display: flex;
  justify-content: center;
  align-items: center;
}

@media (min-width: 768px) {
  .send-feedback-btn {
    width: 340px;
  }
}

@media (min-width: 1440px) {
  .send-feedback-btn {
    width: 108px;
  }
}

.hidden {
  opacity: 0;
  visibility: hidden;
  cursor: none;
}

.hidden-container {
  display: none;
}

.no-scroll {
  overflow: hidden;
}

.required-text {
  border: 1px solid #e74c3c !important;
}
```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/container.css

**size:** 428 bytes &nbsp;&nbsp; **sha1:** `58f7008c5631ff5e6af879c0a0ebfaee222afbc6`

```css
/* Styles for Mobile devices */
.container {
  min-width: 320px;
  max-width: 375px;
  margin: 0 auto;
  padding: 0 16px;
}
/* Styles for Tablet devices */
@media only screen and (min-width: 768px) {
  .container {
    max-width: 768px;
    padding: 0 32px;
  }
}
/* Styles for Desktop devices */
@media only screen and (min-width: 1440px) {
  .container {
    max-width: 1440px;
    padding: 0 64px;
  }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/footer.css

**size:** 3244 bytes &nbsp;&nbsp; **sha1:** `fcc2f534f8889fc9d1294d85d99e6f8a6b14e69d`

```css
@media only screen and (min-width: 320px) {

    .footer-section {
        padding: 48px 0;
    }

    .footer-logo-wrapper {
        display: flex;
        flex-direction: row;
        gap: 32px;
        justify-content: center;
        align-items: center;
        margin-bottom: 32px;
    }

    .footer-logo {
        width: 84px;
        height: 36px;
    }

    .footer-logo-svg {
        fill: var(--color-affair);
        ;
        width: 84px;
        height: 36px;
    }

    .footer-nav-list {
        display: flex;
        flex-direction: column;
        gap: 32px;
        justify-content: center;
        align-items: center;
        margin-bottom: 48px;
    }

    .footer-nav-item {
        color: #fff;
        font-family: 'IBM Plex Sans';
        font-size: 16px;
        font-style: normal;
        font-weight: 600;
        line-height: 1.5;
    }

    .footer-nav-link:hover,
    .footer-nav-link:focus {
        color: var(--color-affair);
        ;
    }

    .footer-nav-link:active {
        color: var(--color-white);

    }

    .footer-nav-item:hover,
    .footer-nav-item:focus {
        color: var(--color-affair);
        ;
        transition: color 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .divider {
        background: rgba(255, 255, 255, 0.2);
        width: 100%;
        height: 1px;
        margin-bottom: 24px;
    }

    .footer-social-wrapper {
        display: flex;
        flex-direction: column;
        gap: 32px;
        align-items: center;
        margin-bottom: 16px;
    }

    .footer-social-list {
        display: flex;
        gap: 32px;
        justify-content: center;
        align-items: center;
    }

    .social-icon {
        fill: var(--color-white);
        transition: none;
    }

    .social-icon:hover,
    .social-icon:focus {
        fill: var(--color-affair);
        ;
        transition: none;
    }

    .footer-text {
        color: var(--color-white);
        font-family: 'IBM Plex Sans';
        font-size: 16px;
        font-style: normal;
        font-weight: 400;
        line-height: 1.5;
        text-align: center
    }
}

@media only screen and (min-width: 768px) {

    .footer-section {
        padding: 80px 0;
    }

    .footer-logo-svg {
        width: 116px;
        height: 45px;
    }

    .footer-logo-wrapper {
        padding-right: 40px;
    }

    .footer-nav-list {
        flex-direction: row;
        margin-bottom: 80px;
    }

    .divider {
        margin-bottom: 32px;
    }

    .footer-social-wrapper {
        flex-direction: row-reverse;
        gap: 0;
        align-items: center;
        margin-bottom: 0;
    }

    .footer-social-list {
        display: flex;
        gap: 24px;
        justify-content: center;
        align-items: center;
        margin-bottom: 0;
    }

    .footer-text-wrapper {
        margin-bottom: 0;
        margin-right: auto;
    }

    .social-icon {
        width: 32px;
        height: 32px;
    }
}

@media only screen and (min-width: 1440px) {
    .social-icon {
        width: 24px;
        height: 24px;
    }
}
```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/header.css

**size:** 5538 bytes &nbsp;&nbsp; **sha1:** `6b57ad3b306de01cfd269f93b7c60a5694db4a7d`

```css
/* ===========================
   Header
   =========================== */
.header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  min-width: 320px;
  height: 64px;
  background: var(--color-neutral-darkest);
  z-index: 1000;
}

section[id] {
  scroll-margin-top: 64px;
}

.header-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 12px 0 20px;
  height: 100%;
}

/* ---------- LOGO ---------- */
.header-logo,
.mobile-menu-top .header-logo {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  width: 119px;
  height: 51px;
  margin: 0;
  flex: 0 0 auto;
}

.header-logo-icon,
.mobile-menu-top .header-logo-icon {
  width: 106px;
  height: 30px;
  fill: var(--color-white);
  display: block;
}

/* ---------- NAVIGATION ---------- */
.header-nav {
  display: none;
}
.header-nav-list {
  display: flex;
  gap: 32px;
}
.header-nav-link {
  color: var(--color-white);
  font-weight: 400;
  font-size: 18px;
  text-decoration: none;
  transition: color 0.2s ease;
}
.header-nav-link:hover,
.header-nav-link.active {
  color: var(--color-affair);
}

.header-nav-link:focus,
.header-nav-link:active {
  color: inherit;
}

/* ---------- BURGER MENU ---------- */
.burger-menu-btn {
  background: transparent;
  border: 0;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
}
.burger-menu-icon {
  width: 24px;
  height: 24px;
  fill: var(--color-white);
}
.burger-menu-btn:hover .burger-menu-icon,
.burger-menu-btn:focus .burger-menu-icon,
.burger-menu-btn:active .burger-menu-icon {
  fill: var(--color-affair);
}

/* ---------- MOBILE MENU ---------- */
.mobile-menu {
  position: fixed;
  inset: 0;
  background: var(--color-neutral-darkest);
  backdrop-filter: blur(6px);
  z-index: 2000;

  display: flex;
  flex-direction: column;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}
.mobile-menu.show {
  opacity: 1;
  pointer-events: auto;
}

.mobile-menu-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  position: relative;
  transform: translateY(-20px);
  opacity: 0;
  transition: transform 0.4s ease, opacity 0.4s ease;
}
.mobile-menu.show .mobile-menu-container {
  transform: translateY(0);
  opacity: 1;
}

.mobile-menu-top {
  width: 100%;
  height: 64px;
  padding: 0px 12px 0px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--color-neutral-darkest);
}

.mobile-menu-close-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  background: transparent;
  border: 0;
  cursor: pointer;
}
.mobile-menu-close-icon {
  width: 24px;
  height: 24px;
  fill: var(--color-white);
  transition: transform 0.3s ease, fill 0.2s ease;
}
.mobile-menu-close-btn:hover .mobile-menu-close-icon,
.mobile-menu-close-btn:focus .mobile-menu-close-icon,
.mobile-menu-close-btn:active .mobile-menu-close-icon {
  transform: rotate(90deg);
  fill: var(--color-affair);
}

.mobile-menu-nav {
  margin-top: 39px;
  display: flex;
  justify-content: center;
  width: 100%;
}
.mobile-menu-nav-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 32px;
  align-items: center;
}
.mobile-menu-nav-link {
  color: var(--color-white);
  text-decoration: none;
  font-weight: 500;
  font-size: 26px;
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.4s ease, transform 0.4s ease, color 0.2s ease;
}
.mobile-menu.show .mobile-menu-nav-link {
  opacity: 1;
  transform: translateY(0);
}
.mobile-menu.show .mobile-menu-nav-link:nth-child(1) {
  transition-delay: 0.1s;
}
.mobile-menu.show .mobile-menu-nav-link:nth-child(2) {
  transition-delay: 0.2s;
}
.mobile-menu.show .mobile-menu-nav-link:nth-child(3) {
  transition-delay: 0.3s;
}
.mobile-menu-nav-link:hover,
.mobile-menu-nav-link:focus,
.mobile-menu-nav-link:active,
.mobile-menu-nav-link.active {
  color: var(--color-affair);
}

/* ---------- RESPONSIVE ---------- */
@media screen and (min-width: 768px) {
  .header {
    height: 72px;
  }

  section[id] {
    scroll-margin-top: 72px;
  }

  .header-container {
    padding: 0 64px;
  }
  .header-nav {
    display: block;
    margin-left: auto;
  }
  .burger-menu-btn,
  .mobile-menu {
    display: none !important;
  }
}

/* ---------- ACCESSIBILITY ---------- */
a,
button {
  outline: none;
  -webkit-tap-highlight-color: transparent;
}

a:focus-visible,
button:focus-visible {
  outline: 2px solid var(--color-affair);
  outline-offset: 2px;
}

.sr-only {
  position: absolute !important;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0 0 0 0);
  white-space: nowrap;
  border: 0;
}
/* ДЕСKTOP: подсветка только у .active */
@media (min-width: 768px) {

  .header-nav-link.active,
  .header-nav-link.active:hover,
  .header-nav-link.active:focus {
    color: var(--color-affair);
  }

  /* не красим неактивные по hover/focus/active */
  .header-nav-link:not(.active):hover,
  .header-nav-link:not(.active):focus,
  .header-nav-link:not(.active):active {
    color: inherit;
  }
}
```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/hero.css

**size:** 5064 bytes &nbsp;&nbsp; **sha1:** `93c0e5fc9d2d174716aae96fde61ce666fec1666`

```css
.hero-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 64px;
}

.hero-section {
    padding-top: 64px;
    min-width: 320px;
    margin: 0 auto;
    background: linear-gradient(180deg,
            #060307,
            #06030700 20%,
            #06030700 80%,
            #060307),
             #22132b;
    position: relative;
}

.hero-section::before,
.hero-section::after {
    content: '';
    position: absolute;
    left: 0;
    width: 100%;
    height: 100px;
    z-index: 2;
    pointer-events: none;
}

.hero-section::before {
    top: -2px;
    background: linear-gradient(180deg, #060307, rgba(35, 19, 43, 0) 30px);
}

.hero-section::after {
    bottom: -2px;
    background: linear-gradient(180deg, rgba(35, 19, 43, 0), #060307);
}

.hero-title {
    font-family: 'Epilogue', sans-serif;
    font-weight: 700;
    font-size: 48px;
    line-height: 1.1;
    letter-spacing: -0.01em;
    margin-bottom: 20px;
    color: var(--color-white);
}

.hero-subtitle {
    font-weight: 400;
    font-size: 18px;
    line-height: 1.5;
    margin-bottom: 24px;
    max-width: 624px;
    color: var(--color-white);
}

.hero-content {
    width: 280px;
}

.hero-btn {
    box-sizing: border-box;
    margin: 0 auto;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 12px;
    padding: 10px 24px;
    max-width: 280px;
    height: 47px;
    font-size: 18px;
    border: none;
    font-weight: 500;
    line-height: 1.5;
    letter-spacing: 0.04em;
    fill: #fff;
    gap: 12px;
    cursor: pointer;
    text-decoration: none;
    box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
        inset 0 -2px 1px 0 rgba(0, 0, 0, 0.2),
        inset 0 0 0 1px rgba(6, 3, 7, 0.15),
        inset 0 2px 1px 0 rgba(255, 255, 255, 0.25),
        inset 0 32px 24px 0 rgba(255, 255, 255, 0.05);
    background: #764191;
    transition: background-color .2s ease, box-shadow .2s ease, transform .05s ease;
}

.hero-btn:hover,
.hero-btn:focus {
    background: #603177;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15),
        inset 0 -2px 1px rgba(0, 0, 0, 0.3),
        inset 0 2px 1px rgba(255, 255, 255, 0.2);
    outline: none;
    transform: translateY(-1px);
}

.hero-btn:active {
    transform: translateY(0);
}

.hero-img {
    box-sizing: border-box;
    background-image: url(../img/hero/hero-mob.png);
    background-repeat: no-repeat;
    background-position: center bottom;
    background-size: contain;
    height: 385px;
    position: relative;
    width: 280px;
}

main {
    margin-top: 40px;
}

@media (min-resolution: 192dpi) and (max-width: 767px) {
    .hero-img {
        background-image: url(../img/hero/hero-mob-2x.png);
    }
}

@media screen and (min-width: 768px) {   
    .hero-container {
        gap: 32px;
    }

   .hero-section {
        padding-top: 32px;
        padding-bottom: 0;
    }

    main {
        margin-top: 70px;
    }

    .hero-title {
        margin-bottom: 24px;
        max-width: 624px;
    }

    .hero-subtitle {
        font-size: 20px;
        margin-bottom: 32px;
    }

    .hero-content {
        width: 704px;
    }

    .hero-btn {
        max-width: 246px;
        margin: 0;
    }

    .hero-img {
        background-image: url(../img/hero/hero-tabl.png);
        background-size: cover;
        background-position: center;
        height: 632px;
        width: 704px;
    }

    .hero-img::after {
        content: '';
        position: absolute;
        pointer-events: none;
        left: 0;
        right: 0;
        bottom: 0;
        height: 120px;
        z-index: 2;
        background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, #060307 100%);
    }
}

@media (min-resolution: 192dpi) and (min-width: 768px) {
    .hero-img {
        background-image: url(../img/hero/hero-tabl-2x.png);
    }
}

@media screen and (min-width: 1440px) {
    .hero-container {
        flex-direction: row;
    }

    .hero-section {
        padding: 0;
    }

    .hero-title {
        font-size: 84px;
    }

    .hero-content {
        width: 640px;
        flex-shrink: 0;
    }

    .hero-btn {
        max-width: 206px;
        padding: 10px 0;
    }

    .hero-img {
        background-image: url(../img/hero/hero-desk.png);
        background-position: center;
        background-size: cover;
        width: 641px;
        height: 900px;
        flex-shrink: 0;
    }

    .hero-img::before {
        content: '';
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        height: 120px;
        background: linear-gradient(to top, rgba(0, 0, 0, 0) 0%, #060307 100%);
        pointer-events: none;
        z-index: 2;
    }
}

@media (min-resolution: 192dpi) and (min-width: 1440px) {
    .hero-img {
        background-image: url(../img/hero/hero-desk-2x.png);
    }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/reset.css

**size:** 318 bytes &nbsp;&nbsp; **sha1:** `5d43d070dc815f84dd324c88544c4e104f2dbb5f`

```css
h1,
h2,
h3,
h4,
h5,
h6,
p {
  margin: 0;
}

p:last-child {
  margin-bottom: 0;
}

ul {
  margin: 0;
  padding: 0;
  list-style: none;
}

a {
  color: currentColor;
  text-decoration: none;
}

button {
  cursor: pointer;
}

img {
  display: block;
  max-width: 100%;
  height: auto;
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/css/styles.css

**size:** 1273 bytes &nbsp;&nbsp; **sha1:** `1a88be1185c0312b902a9dc900758c79bbc534d4`

```css
/**
  |============================
  | include css partials with
  | default @import url()
  |============================
*/
/* Common styles */
@import url('./reset.css');
@import url('./base.css');
@import url('./container.css');

/* Sections style */
@import url('./hero.css');
@import url('./artists/index.css');
@import url('./header.css');
@import url('./about.css');
@import url('./comments.css');
@import url('./footer.css');

/* Тёмные скроллы повсюду */
* {
  scrollbar-width: thin;
  scrollbar-color: #2a3040 #0f1115; /* FF */
}
*::-webkit-scrollbar {
  width: 10px;
  height: 10px;
} /* Chrome/Edge */
*::-webkit-scrollbar-track {
  background: #0f1115;
}
*::-webkit-scrollbar-thumb {
  background: #2a3040;
  border-radius: 8px;
}
*::-webkit-scrollbar-thumb:hover {
  background: #3a4358;
}

/* На всякий случай — без горизонтального перелива */
html,
body {
  overflow-x: hidden;
}

/* Если внезапно появится вертикальный «микропротечка» от 1px:
   убрать возможные 100vw-переливы от вложенных блоков */
img,
video {
  max-width: 100%;
  height: auto;
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/img/sprite.svg

**size:** 22883 bytes &nbsp;&nbsp; **sha1:** `e8b04210c4ceb37a06772d7c0cb844a866a88884`

```text
<svg
  aria-hidden="true"
  style="position: absolute; width: 0; height: 0; overflow: hidden;"
  version="1.1"
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink"
>
  <defs>

    <symbol id="icon-search" viewBox="0 0 31 32">
      <path fill="#fff"
            d="M12.8 23.68c2.272 0 4.478-.761 6.268-2.161l5.627 5.627 1.81-1.81-5.627-5.627a10.184 10.184 0 0 0 2.162-6.269c0-5.646-4.594-10.24-10.24-10.24S2.56 7.794 2.56 13.44 7.154 23.68 12.8 23.68zm0-17.92c4.236 0 7.68 3.444 7.68 7.68s-3.444 7.68-7.68 7.68-7.68-3.444-7.68-7.68 3.444-7.68 7.68-7.68z"
            style="fill:var(--color1, #fff)"/>
    </symbol>

    <symbol id="icon-arrow-up" viewBox="0 0 32 32">
      <path fill="#fff" d="m8.391 19.057 1.885 1.885L16 15.218l5.724 5.724 1.885-1.885L16 11.448l-7.609 7.609z" style="fill:var(--color1, #fff)"/>
    </symbol>

    <symbol id="icon-icon_close" viewBox="0 0 32 32">
      <path d="M29.671 28.728l-0.943 0.943c-0.521 0.521-1.365 0.521-1.886 0l-10.842-10.842-10.842 10.842c-0.521 0.521-1.365 0.521-1.886 0l-0.943-0.943c-0.521-0.521-0.521-1.365 0-1.886l10.842-10.842-10.842-10.842c-0.521-0.521-0.521-1.365 0-1.886l0.943-0.943c0.521-0.521 1.365-0.521 1.886 0l10.842 10.842 10.842-10.842c0.521-0.521 1.365-0.521 1.886 0l0.943 0.943c0.521 0.521 0.521 1.365 0 1.886l-10.842 10.842 10.842 10.842c0.521 0.521 0.521 1.365 0 1.886z"></path>
    </symbol>

    <symbol id="icon-icon_download_load_more_art_sec" viewBox="0 0 32 32">
      <path d="M31.33 15.949l-3.232-3.232-9.813 9.813v-21.911h-4.571v21.911l-9.813-9.813-3.232 3.232 15.33 15.33 15.33-15.33z"></path>
    </symbol>

    <symbol id="icon-icon_facebook_footer" viewBox="0 0 31 32">
      <path d="M28.16 16.51c0-7.112-5.731-12.878-12.8-12.878s-12.8 5.766-12.8 12.878c0 6.428 4.681 11.756 10.8 12.722v-8.999h-3.25v-3.723h3.25v-2.837c0-3.228 1.911-5.010 4.835-5.010 1.401 0 2.865 0.252 2.865 0.252v3.169h-1.614c-1.59 0-2.086 0.993-2.086 2.011v2.416h3.55l-0.567 3.723h-2.983v8.999c6.119-0.966 10.8-6.294 10.8-12.722z"></path>
    </symbol>

    <symbol id="icon-icon_inst_footer" viewBox="0 0 31 32">
      <path d="M15.358 6.676c3.078 0 3.442 0.014 4.652 0.068 1.125 0.050 1.732 0.238 2.137 0.396 0.536 0.207 0.922 0.459 1.323 0.86 0.405 0.405 0.652 0.788 0.864 1.323 0.158 0.405 0.346 1.017 0.396 2.137 0.054 1.215 0.068 1.579 0.068 4.653s-0.014 3.442-0.068 4.653c-0.050 1.125-0.238 1.732-0.396 2.137-0.207 0.536-0.459 0.922-0.86 1.323-0.405 0.405-0.788 0.652-1.323 0.864-0.405 0.158-1.017 0.346-2.137 0.396-1.215 0.054-1.58 0.068-4.653 0.068s-3.442-0.014-4.653-0.068c-1.125-0.050-1.732-0.238-2.137-0.396-0.536-0.207-0.922-0.459-1.323-0.86-0.405-0.405-0.652-0.788-0.864-1.322-0.158-0.405-0.346-1.017-0.396-2.137-0.054-1.215-0.068-1.579-0.068-4.653s0.014-3.442 0.068-4.653c0.050-1.125 0.238-1.732 0.396-2.137 0.207-0.536 0.459-0.922 0.86-1.323 0.405-0.405 0.788-0.652 1.323-0.864 0.405-0.158 1.017-0.346 2.137-0.396 1.21-0.054 1.575-0.068 4.653-0.068h0.001zM15.358 4.602c-3.127 0-3.518 0.014-4.747 0.068-1.224 0.054-2.065 0.252-2.794 0.536-0.76 0.297-1.404 0.688-2.042 1.332-0.644 0.639-1.035 1.282-1.332 2.038-0.284 0.734-0.482 1.57-0.536 2.794-0.054 1.233-0.068 1.624-0.068 4.751s0.014 3.518 0.068 4.747c0.054 1.224 0.252 2.065 0.536 2.794 0.297 0.76 0.688 1.404 1.332 2.042 0.639 0.639 1.282 1.035 2.038 1.328 0.734 0.284 1.57 0.482 2.794 0.536 1.228 0.054 1.62 0.068 4.747 0.068s3.519-0.014 4.747-0.068c1.224-0.054 2.065-0.252 2.794-0.536 0.756-0.292 1.4-0.688 2.038-1.328s1.035-1.282 1.328-2.038c0.284-0.734 0.482-1.57 0.536-2.794 0.054-1.228 0.068-1.62 0.068-4.747s-0.014-3.518-0.068-4.747c-0.054-1.224-0.252-2.065-0.536-2.794-0.284-0.765-0.675-1.408-1.318-2.047-0.639-0.639-1.282-1.035-2.038-1.327-0.734-0.284-1.57-0.482-2.794-0.536-1.233-0.058-1.624-0.072-4.751-0.072l-0.001 0.001z"></path>
      <path d="M15.358 10.204c-3.266 0-5.917 2.65-5.917 5.917s2.65 5.917 5.917 5.917c3.267 0 5.917-2.65 5.917-5.917s-2.65-5.917-5.917-5.917zM15.358 19.958c-2.119 0-3.838-1.718-3.838-3.838s1.718-3.838 3.838-3.838c2.119 0 3.838 1.718 3.838 3.838s-1.718 3.838-3.838 3.838z"></path>
      <path d="M22.889 9.97c0 0.763-0.618 1.381-1.381 1.381s-1.381-0.618-1.381-1.381 0.619-1.381 1.381-1.381c0.763 0 1.381 0.618 1.381 1.381z"></path>
    </symbol>

    <symbol id="icon-icon_left_button_feedback_sec" viewBox="0 0 30 32">
      <path d="M18.575 27.020l-9.158-9.158h20.45v-4.267h-20.45l9.158-9.158-3.017-3.017-14.308 14.308 14.308 14.308 3.017-3.017z"></path>
    </symbol>

    <symbol id="icon-icon_menu_mobile_navbar" viewBox="0 0 32 32">
      <path d="M5.333 8h21.333v2.667h-21.333v-2.667zM10.667 14.667h16v2.667h-16v-2.667zM17.333 21.333h9.333v2.667h-9.333v-2.667z"></path>
    </symbol>

    <symbol id="icon-icon_play_artists_sections" viewBox="0 0 17 32">
      <path d="M0 31.878l17.067-14.933-17.067-14.933v29.867z"></path>
    </symbol>

    <symbol id="icon-icon_play_hero_section" viewBox="0 0 24 32">
      <path d="M0.858 31.818c0.259 0.135 0.549 0.196 0.841 0.178s0.572-0.115 0.812-0.281l20.8-14.4c0.212-0.147 0.386-0.344 0.506-0.573s0.183-0.484 0.183-0.742c0-0.259-0.063-0.513-0.183-0.742s-0.294-0.426-0.506-0.573l-20.8-14.4c-0.24-0.167-0.521-0.266-0.813-0.284s-0.583 0.043-0.842 0.179c-0.259 0.136-0.476 0.34-0.627 0.59s-0.23 0.537-0.229 0.83v28.8c-0 0.292 0.080 0.579 0.231 0.828s0.368 0.454 0.627 0.589zM3.2 4.654l16.389 11.346-16.389 11.346v-22.691z"></path>
    </symbol>

    <symbol id="icon-icon_right_button_feedback_sec" viewBox="0 0 31 32">
      <path d="M14.455 22.612l1.81 1.81 8.585-8.585-8.585-8.585-1.81 1.81 5.495 5.495h-12.27v2.56h12.27l-5.495 5.495z"></path>
    </symbol>

    <symbol id="icon-icon_youtube_footer" viewBox="0 0 31 32">
      <path d="M27.639 9.981c-0.146-0.541-0.431-1.034-0.826-1.431s-0.888-0.683-1.429-0.83c-2.004-0.55-10.024-0.559-10.024-0.559s-8.018-0.009-10.024 0.517c-0.54 0.154-1.032 0.444-1.428 0.842s-0.683 0.892-0.833 1.433c-0.529 2.004-0.534 6.162-0.534 6.162s-0.005 4.178 0.52 6.162c0.294 1.097 1.158 1.964 2.257 2.259 2.025 0.55 10.022 0.559 10.022 0.559s8.019 0.009 10.024-0.516c0.541-0.147 1.034-0.432 1.431-0.828s0.683-0.888 0.831-1.429c0.53-2.003 0.534-6.159 0.534-6.159s0.026-4.179-0.521-6.184zM12.795 19.968l0.006-7.68 6.665 3.846-6.671 3.834z"></path>
    </symbol>

    <symbol id="icon-logo" viewBox="0 0 110 32">
      <path d="M16.403 0.142c0.434-0.050 0.936 0.047 1.354 0.174 0.945 0.288 1.714 0.905 2.169 1.785 0.474 0.902 0.564 1.957 0.252 2.927-0.397 1.196-1.247 1.797-2.309 2.35l0.012 3.489c0.759 0.231 1.498 0.495 2.187 0.894 1.584 0.919 2.669 2.467 3.123 4.23 0.48 1.848 0.207 3.812-0.76 5.459-0.887 1.493-2.3 2.597-3.993 3.019-2.211 0.552-4.086-0.047-5.986-1.176-0.84 0.898-1.67 1.807-2.489 2.725 0.366 0.864 0.487 1.77 0.244 2.687-0.237 0.897-0.866 1.666-1.67 2.121-0.901 0.51-1.928 0.603-2.916 0.321-0.981-0.281-1.805-0.889-2.284-1.801-0.472-0.897-0.511-1.949-0.206-2.907 0.348-1.089 1.057-1.759 2.053-2.257 1.072-0.419 1.958-0.281 3.005 0.096 0.872-0.917 1.693-1.88 2.574-2.789-0.968-1.898-1.281-3.515-0.778-5.606-1.096-0.511-2.153-1.108-3.249-1.62-0.586 0.61-1.301 1.028-2.142 1.169-1.003 0.169-2.061-0.105-2.885-0.694-0.817-0.592-1.354-1.493-1.486-2.493-0.135-0.97 0.12-2.038 0.741-2.803 0.64-0.789 1.634-1.265 2.637-1.37 0.986-0.096 1.97 0.205 2.734 0.836 0.976 0.818 1.258 1.834 1.376 3.045 1.039 0.637 2.229 1.129 3.312 1.698 1.409-1.665 2.439-2.191 4.492-2.824l0.002-3.463c-0.368-0.147-0.735-0.326-1.055-0.561-0.81-0.599-1.341-1.502-1.473-2.501-0.121-0.994 0.159-1.996 0.779-2.782 0.678-0.851 1.585-1.238 2.636-1.377zM20.931 17.367c-0.209-2.382-2.302-4.148-4.686-3.955-2.404 0.196-4.189 2.311-3.979 4.714 0.211 2.404 2.337 4.176 4.739 3.951 2.381-0.224 4.134-2.328 3.925-4.71z"></path>
      <path d="M102.107 11.958c0.708 0.001 1.415 0.011 2.124 0.029l-0.004 3.742c0.546-0.424 1.14-0.739 1.831-0.843 0.933-0.141 1.884 0.1 2.637 0.669 0.908 0.687 1.384 1.844 1.523 2.949 0.175 1.401-0.154 2.749-1.019 3.866-0.574 0.554-1.263 0.941-2.057 1.072-1.165 0.191-2.088-0.216-2.998-0.894l-0.004 0.817-2.032-0.003-0.001-11.404zM105.747 16.862c-0.632 0.21-1.070 0.51-1.378 1.118-0.342 0.675-0.365 1.508-0.099 2.211 0.204 0.538 0.585 1.004 1.118 1.244 0.385 0.175 0.749 0.18 1.164 0.155 0.66-0.249 1.103-0.569 1.402-1.229 0.311-0.689 0.307-1.52 0.011-2.214-0.228-0.533-0.632-0.963-1.177-1.174-0.341-0.131-0.682-0.149-1.042-0.111z"></path>
      <path d="M41.272 11.936c1.246 3.84 2.84 7.575 4.055 11.425l-2.296 0.003c-0.269-0.822-0.529-1.752-0.939-2.512-0.268-0.115-0.586-0.076-0.873-0.073-1.108 0.011-2.215 0.007-3.323-0.012-0.348 0.849-0.628 1.722-0.903 2.596l-2.339-0.002c1.221-3.833 2.677-7.617 3.996-11.42 0.872 0.019 1.749-0.001 2.622-0.005zM39.964 14.775c-0.483 1.374-0.934 2.768-1.464 4.125l1.681-0.001 1.306-0.015c-0.184-0.518-1.25-3.88-1.524-4.109z"></path>
      <path d="M89.685 11.961l2.196 0.013c-0.030 2.647-0.007 5.298-0.007 7.945-0.001 1.093 0.11 2.287-0.013 3.365l-0.121 0.083h-2.058l-0.004-4.889c-1.645-0.046-3.303-0.005-4.949-0.003l0.001 4.894-2.209-0.004 0.009-11.401 2.2 0.005 0.002 4.662h4.957l-0.003-4.67z"></path>
      <path d="M93.202 15.121c0.729 0.021 1.46 0.013 2.188 0.017-0.009 1.165-0.193 4.384 0.089 5.347 0.111 0.38 0.333 0.728 0.693 0.913 0.541 0.278 1.090 0.117 1.628-0.072 0.238-0.266 0.443-0.515 0.561-0.859 0.386-1.123 0.18-4.006 0.174-5.343 0.694 0.019 1.391 0.004 2.085 0-0.016 0.8-0.003 1.603-0.004 2.404l0.011 5.834c-0.683 0.010-1.365 0.005-2.047-0.015l-0.063-0.074c0.010-0.173 0.013-0.314-0.018-0.487-0.639 0.277-1.209 0.697-1.936 0.712-0.843 0.017-1.758-0.245-2.363-0.852-0.459-0.459-0.739-1.076-0.883-1.703-0.31-1.348-0.127-4.332-0.113-5.824z"></path>
      <path d="M63.686 14.891c1.089-0.085 2.224-0.008 3.104 0.725 0.617 0.514 0.816 1.13 0.883 1.897l-1.968-0.002c-0.113-0.21-0.226-0.454-0.404-0.619-0.284-0.262-0.694-0.398-1.078-0.377-0.298 0.016-0.679 0.135-0.865 0.387-0.113 0.154-0.175 0.311-0.132 0.503 0.224 1.009 2.79 0.884 3.607 1.419 0.52 0.341 0.919 0.951 1.034 1.56 0.115 0.623-0.033 1.266-0.409 1.775-0.627 0.865-1.593 1.175-2.599 1.329-0.931 0.056-2.011-0.194-2.756-0.761-0.699-0.532-0.95-1.185-1.045-2.025 0.663 0.001 1.326-0.005 1.989-0.018 0.039 0.125 0.082 0.245 0.145 0.361 0.289 0.533 0.865 0.651 1.4 0.808 0.353-0.081 0.831-0.172 1.082-0.457 0.151-0.172 0.204-0.471 0.14-0.691-0.245-0.843-2.703-0.943-3.556-1.468-0.505-0.311-0.876-0.764-1.011-1.349-0.121-0.53-0.075-1.125 0.223-1.59 0.538-0.84 1.28-1.185 2.216-1.408z"></path>
      <path d="M76.93 14.889c0.62-0.050 1.227-0.047 1.831 0.117 0.697 0.189 1.438 0.578 1.79 1.239 0.169 0.317 0.3 0.886 0.186 1.237-0.565 0.122-1.255 0.040-1.835 0.033-0.085-0.287-0.158-0.509-0.391-0.707-0.295-0.247-0.679-0.364-1.062-0.322-0.3 0.031-0.685 0.178-0.852 0.447-0.1 0.16-0.141 0.325-0.078 0.509 0.362 1.068 2.535 0.814 3.38 1.297 0.538 0.308 0.988 0.848 1.141 1.454 0.164 0.65 0.056 1.372-0.319 1.931-0.56 0.835-1.449 1.149-2.388 1.331-0.922 0.114-1.989-0.082-2.759-0.613-0.791-0.545-1.028-1.229-1.206-2.123l1.973-0.015c0.12 0.302 0.229 0.537 0.485 0.746 0.341 0.279 0.745 0.406 1.184 0.347 0.341-0.045 0.676-0.202 0.88-0.487 0.133-0.187 0.2-0.414 0.136-0.642-0.247-0.878-2.426-0.823-3.29-1.288-0.584-0.315-1.046-0.838-1.231-1.481-0.157-0.544-0.091-1.11 0.196-1.599 0.477-0.81 1.353-1.206 2.231-1.409z"></path>
      <path d="M52.641 12.857c0.655 0.023 1.315 0.009 1.97 0.011-0.007 0.74 0.004 1.48 0.032 2.219l1.944 0.001-0.004 1.694-1.851-0.001c0.001 1.066-0.243 3.817 0.246 4.641 0.382 0.301 1.145 0.189 1.609 0.183l-0.007 1.404c0.004 0.145 0.004 0.218-0.070 0.344-0.259 0.124-0.524 0.152-0.81 0.154-0.752 0.007-1.791-0.129-2.331-0.693-1.086-1.131-0.739-4.457-0.734-6.035l-1.254 0.002 0.004-1.698 1.249 0.008 0.007-2.236z"></path>
      <path d="M69.54 12.848l1.934 0.011c-0.015 0.741 0.016 1.485 0.030 2.226l1.976-0.004-0.003 1.702-1.859-0.001c0.023 1.015-0.226 3.85 0.234 4.617 0.494 0.295 1.113 0.216 1.669 0.215-0.007 0.489 0.003 0.979 0.005 1.469l-0.023 0.186c-0.191 0.202-0.486 0.194-0.747 0.2-0.794 0.019-1.891-0.107-2.467-0.71-1.075-1.126-0.74-4.405-0.731-5.978l-1.323 0.001c-0.017-0.564-0.010-1.129-0.015-1.692l1.318 0.007 0.004-2.249z"></path>
      <path d="M27.821 11.582c0.102-0.005 0.2-0.007 0.302 0.008 0.316 0.046 0.628 0.198 0.802 0.476 0.185 0.294 0.21 0.687 0.235 1.028 0.125 1.688 0.032 3.444 0.032 5.138-0 1.384 0.153 3.26-0.104 4.592-0.081 0.419-0.359 0.619-0.691 0.846-0.127 0.015-0.259 0.033-0.387 0.026-0.285-0.016-0.556-0.143-0.74-0.361-0.183-0.216-0.177-0.648-0.193-0.919-0.116-1.942-0.018-3.946-0.016-5.893 0.001-1.107-0.151-3.225 0.082-4.213 0.083-0.353 0.402-0.539 0.68-0.727z"></path>
      <path d="M50.243 15.058l0.278-0.003c0.329 0.368 0.166 1.535 0.155 2.018-0.696-0.007-1.354-0.035-1.899 0.471-1.023 0.949-0.678 4.425-0.688 5.82-0.548-0.005-1.617 0.195-2.035-0.154l-0.022-0.346c0.010-2.586-0.055-5.169-0.038-7.754 0.664 0.021 1.33 0.007 1.994 0.003l-0.023 1.142c0.123-0.177 0.246-0.366 0.389-0.527 0.503-0.568 1.186-0.619 1.891-0.669z"></path>
      <path d="M57.795 15.092l2.086 0.001 0.005 8.275-2.11-0.003 0.019-8.273z"></path>
      <path d="M24.906 14.293c0.343 0.063 0.645 0.192 0.845 0.489 0.308 0.459 0.316 4.955 0.162 5.596-0.084 0.351-0.388 0.522-0.675 0.691-0.33-0.020-0.763-0.049-0.983-0.335-0.327-0.425-0.3-5.203-0.114-5.802 0.108-0.348 0.466-0.495 0.765-0.639z"></path>
      <path d="M58.701 11.683c0.62-0.073 1.185 0.36 1.276 0.978s-0.325 1.195-0.939 1.304c-0.414 0.073-0.835-0.084-1.099-0.411s-0.33-0.771-0.171-1.161c0.159-0.389 0.516-0.661 0.933-0.71z"></path>
    </symbol>

    <symbol id="icon-logo_footer" viewBox="0 0 110 32">
      <path d="M16.403 0.241c0.434-0.050 0.936 0.047 1.354 0.174 0.945 0.288 1.714 0.904 2.169 1.784 0.474 0.902 0.564 1.958 0.252 2.927-0.397 1.196-1.248 1.798-2.311 2.351l0.012 3.489c0.759 0.231 1.498 0.494 2.187 0.893 1.585 0.918 2.668 2.467 3.123 4.23 0.48 1.848 0.208 3.812-0.759 5.46-0.887 1.493-2.3 2.596-3.993 3.018-2.211 0.553-4.087-0.046-5.987-1.175-0.84 0.898-1.67 1.806-2.489 2.724 0.366 0.864 0.488 1.771 0.245 2.689-0.237 0.897-0.866 1.666-1.67 2.121-0.901 0.51-1.928 0.602-2.916 0.32-0.981-0.281-1.805-0.888-2.284-1.8-0.472-0.897-0.511-1.949-0.206-2.907 0.348-1.089 1.056-1.759 2.052-2.257 1.072-0.419 1.959-0.281 3.006 0.096 0.872-0.917 1.692-1.881 2.573-2.79-0.968-1.898-1.281-3.515-0.778-5.606-1.095-0.511-2.152-1.107-3.248-1.619-0.586 0.61-1.302 1.028-2.143 1.169-1.003 0.169-2.060-0.105-2.884-0.694-0.817-0.592-1.354-1.494-1.486-2.494-0.135-0.969 0.12-2.037 0.741-2.802 0.64-0.789 1.634-1.266 2.637-1.371 0.986-0.096 1.969 0.205 2.733 0.836 0.976 0.818 1.259 1.835 1.377 3.046 1.039 0.637 2.229 1.128 3.312 1.697 1.409-1.665 2.439-2.191 4.492-2.824l0.001-3.463c-0.367-0.147-0.734-0.326-1.054-0.561-0.81-0.599-1.343-1.502-1.474-2.501-0.121-0.994 0.16-1.995 0.78-2.781 0.678-0.851 1.585-1.238 2.636-1.377zM20.931 17.465c-0.209-2.382-2.302-4.149-4.685-3.955-2.404 0.196-4.19 2.311-3.979 4.714s2.337 4.176 4.739 3.951c2.38-0.224 4.134-2.328 3.925-4.71z"></path>
      <path d="M102.108 12.055c0.708 0.001 1.416 0.010 2.124 0.028l-0.004 3.743c0.545-0.424 1.14-0.74 1.83-0.844 0.933-0.141 1.885 0.101 2.637 0.67 0.908 0.687 1.385 1.843 1.523 2.947 0.175 1.402-0.154 2.75-1.019 3.867-0.574 0.554-1.262 0.941-2.056 1.072-1.165 0.191-2.089-0.216-2.998-0.894l-0.004 0.818-2.033-0.004-0.001-11.403zM105.748 16.96c-0.631 0.21-1.070 0.509-1.378 1.117-0.342 0.675-0.365 1.509-0.098 2.212 0.203 0.538 0.585 1.004 1.117 1.244 0.386 0.175 0.749 0.18 1.165 0.155 0.659-0.249 1.102-0.569 1.401-1.229 0.312-0.689 0.307-1.52 0.011-2.214-0.227-0.533-0.632-0.963-1.177-1.174-0.341-0.131-0.682-0.149-1.042-0.111z"></path>
      <path d="M41.271 12.034c1.246 3.84 2.84 7.576 4.056 11.426l-2.296 0.002c-0.269-0.822-0.529-1.752-0.939-2.512-0.268-0.115-0.586-0.076-0.873-0.073-1.108 0.011-2.215 0.008-3.323-0.011-0.348 0.848-0.628 1.721-0.903 2.595l-2.339-0.002c1.221-3.833 2.677-7.617 3.996-11.42 0.872 0.019 1.749-0.002 2.622-0.005zM39.962 14.872c-0.483 1.374-0.934 2.768-1.464 4.125l1.681-0.001 1.307-0.014c-0.184-0.517-1.25-3.881-1.524-4.11z"></path>
      <path d="M89.685 12.058l2.196 0.013c-0.030 2.647-0.007 5.298-0.007 7.945-0.001 1.093 0.11 2.287-0.012 3.365l-0.121 0.083h-2.058l-0.004-4.889c-1.645-0.046-3.303-0.005-4.949-0.003l0.001 4.894-2.209-0.004 0.009-11.401 2.201 0.005 0.001 4.661h4.957l-0.003-4.67z"></path>
      <path d="M93.202 15.219c0.729 0.021 1.459 0.013 2.188 0.017-0.009 1.165-0.193 4.384 0.089 5.347 0.111 0.38 0.333 0.728 0.693 0.913 0.541 0.278 1.090 0.117 1.628-0.072 0.238-0.266 0.443-0.515 0.561-0.859 0.386-1.123 0.18-4.006 0.174-5.343 0.694 0.019 1.391 0.004 2.085 0.001-0.016 0.8-0.003 1.603-0.004 2.404l0.011 5.834c-0.683 0.010-1.365 0.005-2.047-0.015l-0.063-0.074c0.010-0.173 0.012-0.314-0.018-0.487-0.639 0.277-1.209 0.697-1.936 0.712-0.843 0.017-1.758-0.245-2.364-0.851-0.459-0.459-0.739-1.077-0.883-1.703-0.31-1.348-0.127-4.332-0.113-5.824z"></path>
      <path d="M63.686 14.989c1.089-0.085 2.224-0.008 3.104 0.725 0.617 0.514 0.816 1.13 0.883 1.897l-1.968-0.002c-0.113-0.21-0.227-0.455-0.404-0.619-0.284-0.262-0.694-0.398-1.078-0.377-0.298 0.016-0.679 0.135-0.865 0.387-0.113 0.154-0.175 0.311-0.132 0.503 0.224 1.009 2.79 0.884 3.607 1.419 0.52 0.341 0.919 0.951 1.034 1.56 0.115 0.623-0.033 1.266-0.408 1.775-0.627 0.865-1.593 1.175-2.599 1.329-0.931 0.056-2.010-0.194-2.756-0.761-0.699-0.532-0.95-1.185-1.045-2.025 0.663 0.001 1.326-0.005 1.989-0.018 0.039 0.125 0.082 0.246 0.145 0.361 0.289 0.533 0.865 0.651 1.4 0.808 0.353-0.081 0.831-0.172 1.082-0.457 0.151-0.172 0.204-0.471 0.14-0.691-0.245-0.843-2.703-0.943-3.556-1.467-0.505-0.311-0.876-0.764-1.011-1.349-0.121-0.53-0.075-1.125 0.223-1.59 0.538-0.84 1.28-1.185 2.216-1.408z"></path>
      <path d="M76.929 14.987c0.62-0.050 1.227-0.047 1.831 0.117 0.697 0.189 1.438 0.578 1.79 1.238 0.17 0.317 0.3 0.886 0.186 1.237-0.565 0.122-1.255 0.039-1.835 0.033-0.086-0.287-0.158-0.509-0.391-0.707-0.295-0.247-0.679-0.364-1.062-0.322-0.3 0.031-0.685 0.178-0.852 0.447-0.1 0.16-0.141 0.324-0.078 0.509 0.363 1.068 2.535 0.814 3.38 1.297 0.538 0.308 0.988 0.849 1.141 1.454 0.164 0.65 0.056 1.372-0.319 1.931-0.56 0.835-1.449 1.149-2.388 1.331-0.921 0.114-1.989-0.082-2.759-0.613-0.791-0.545-1.028-1.229-1.206-2.123l1.973-0.015c0.12 0.302 0.229 0.537 0.485 0.746 0.341 0.279 0.745 0.406 1.184 0.347 0.341-0.045 0.676-0.202 0.88-0.487 0.133-0.187 0.2-0.414 0.136-0.642-0.247-0.878-2.426-0.823-3.29-1.288-0.584-0.315-1.046-0.838-1.231-1.481-0.157-0.544-0.091-1.11 0.196-1.599 0.477-0.81 1.353-1.206 2.231-1.408z"></path>
      <path d="M52.64 12.955c0.655 0.023 1.315 0.009 1.97 0.011-0.007 0.74 0.004 1.48 0.032 2.219l1.944 0.001-0.004 1.694-1.851-0.001c0.001 1.066-0.243 3.817 0.246 4.641 0.382 0.301 1.145 0.189 1.609 0.183l-0.007 1.404c0.004 0.145 0.004 0.218-0.070 0.344-0.259 0.124-0.524 0.152-0.81 0.154-0.752 0.007-1.791-0.129-2.331-0.693-1.086-1.131-0.739-4.457-0.734-6.035l-1.254 0.002 0.004-1.698 1.249 0.008 0.007-2.236z"></path>
      <path d="M69.539 12.946l1.934 0.011c-0.015 0.741 0.016 1.485 0.030 2.226l1.975-0.004-0.003 1.702-1.859-0.001c0.023 1.015-0.226 3.85 0.234 4.617 0.494 0.295 1.113 0.216 1.668 0.215-0.007 0.489 0.003 0.979 0.005 1.469l-0.023 0.186c-0.191 0.202-0.486 0.194-0.747 0.2-0.794 0.019-1.891-0.107-2.467-0.71-1.075-1.125-0.74-4.405-0.731-5.978l-1.323 0.001c-0.017-0.563-0.010-1.129-0.015-1.692l1.318 0.007 0.004-2.249z"></path>
      <path d="M27.82 11.679c0.102-0.005 0.2-0.007 0.302 0.008 0.316 0.046 0.628 0.198 0.802 0.476 0.185 0.294 0.21 0.687 0.235 1.028 0.125 1.688 0.032 3.444 0.032 5.138-0 1.384 0.153 3.26-0.104 4.592-0.081 0.419-0.358 0.619-0.691 0.846-0.127 0.015-0.259 0.033-0.387 0.026-0.285-0.016-0.556-0.143-0.74-0.361-0.183-0.216-0.177-0.648-0.193-0.919-0.116-1.942-0.018-3.946-0.016-5.893 0.001-1.107-0.151-3.225 0.082-4.213 0.083-0.353 0.402-0.539 0.68-0.727z"></path>
      <path d="M50.244 15.156l0.278-0.003c0.329 0.368 0.166 1.535 0.155 2.018-0.696-0.007-1.354-0.035-1.899 0.471-1.023 0.949-0.678 4.425-0.688 5.82-0.548-0.005-1.617 0.195-2.035-0.154l-0.022-0.346c0.010-2.586-0.055-5.169-0.038-7.754 0.664 0.021 1.33 0.007 1.994 0.003l-0.023 1.142c0.123-0.177 0.245-0.366 0.388-0.527 0.503-0.568 1.186-0.619 1.891-0.669z"></path>
      <path d="M57.795 15.19l2.086 0.001 0.005 8.275-2.11-0.003 0.019-8.273z"></path>
      <path d="M24.906 14.391c0.343 0.063 0.645 0.192 0.845 0.489 0.308 0.459 0.316 4.955 0.162 5.596-0.084 0.351-0.388 0.522-0.675 0.691-0.33-0.020-0.763-0.049-0.983-0.335-0.327-0.425-0.3-5.203-0.114-5.802 0.108-0.348 0.466-0.495 0.765-0.64z"></path>
      <path d="M58.7 11.781c0.62-0.073 1.185 0.36 1.276 0.978s-0.325 1.195-0.939 1.304c-0.414 0.073-0.835-0.084-1.099-0.411s-0.33-0.771-0.171-1.161c0.159-0.389 0.516-0.661 0.933-0.71z"></path>
    </symbol>

    <symbol id="icon-logo_icon_about_us" viewBox="0 0 32 32">
      <path d="M17.285 3.195c0.38-0.041 0.82 0.039 1.185 0.142 0.827 0.235 1.499 0.738 1.898 1.456 0.415 0.736 0.494 1.596 0.221 2.387-0.347 0.976-1.092 1.466-2.022 1.917l0.010 2.845c0.665 0.189 1.311 0.403 1.915 0.729 1.387 0.749 2.336 2.012 2.733 3.449 0.42 1.507 0.181 3.109-0.665 4.452-0.776 1.218-2.014 2.117-3.495 2.461-1.935 0.451-3.576-0.037-5.24-0.959-0.735 0.732-1.462 1.473-2.179 2.222 0.32 0.704 0.427 1.444 0.214 2.192-0.208 0.732-0.758 1.359-1.462 1.73-0.789 0.416-1.688 0.492-2.553 0.261-0.858-0.229-1.58-0.724-1.999-1.469-0.413-0.732-0.448-1.589-0.18-2.371 0.305-0.888 0.925-1.435 1.797-1.841 0.939-0.342 1.715-0.23 2.631 0.078 0.763-0.748 1.481-1.534 2.252-2.275-0.847-1.548-1.121-2.866-0.681-4.572-0.959-0.417-1.884-0.903-2.843-1.321-0.513 0.497-1.139 0.838-1.875 0.954-0.878 0.138-1.803-0.085-2.525-0.566-0.715-0.483-1.185-1.218-1.301-2.033-0.119-0.791 0.105-1.662 0.648-2.286 0.56-0.644 1.43-1.032 2.309-1.117 0.863-0.078 1.724 0.167 2.392 0.681 0.855 0.667 1.101 1.496 1.205 2.484 0.91 0.52 1.951 0.92 2.899 1.384 1.233-1.358 2.134-1.787 3.931-2.303l0.002-2.824c-0.322-0.12-0.643-0.266-0.923-0.458-0.709-0.489-1.174-1.225-1.289-2.040-0.106-0.811 0.139-1.628 0.682-2.269 0.594-0.694 1.387-1.010 2.307-1.123zM21.246 17.242c-0.183-1.943-2.014-3.383-4.1-3.225-2.105 0.159-3.668 1.885-3.483 3.844s2.046 3.406 4.149 3.221c2.083-0.183 3.618-1.898 3.435-3.841z"></path>
      <path d="M27.276 12.524c0.089-0.004 0.175-0.005 0.264 0.007 0.277 0.037 0.549 0.162 0.702 0.388 0.162 0.24 0.184 0.56 0.206 0.838 0.11 1.377 0.028 2.809 0.028 4.19-0 1.128 0.134 2.658-0.091 3.745-0.071 0.341-0.314 0.505-0.605 0.69-0.111 0.013-0.227 0.027-0.339 0.021-0.25-0.013-0.486-0.117-0.648-0.294-0.16-0.176-0.155-0.529-0.169-0.749-0.102-1.584-0.016-3.218-0.014-4.806 0.001-0.903-0.132-2.63 0.071-3.436 0.073-0.288 0.352-0.439 0.595-0.593z"></path>
      <path d="M24.726 14.736c0.3 0.051 0.565 0.156 0.74 0.399 0.269 0.374 0.277 4.041 0.142 4.564-0.074 0.286-0.339 0.426-0.591 0.563-0.288-0.016-0.668-0.040-0.86-0.273-0.287-0.346-0.263-4.243-0.1-4.732 0.095-0.284 0.408-0.404 0.67-0.522z"></path>
    </symbol>
  </defs>
</svg>

```

---
## assistant_bundle_20250912_153759/_snapshot/src/index.html

**size:** 1675 bytes &nbsp;&nbsp; **sha1:** `07669e8091c1d8989728b4f86da91f4ed3dd8103`

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/logo-icon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ArtistsHub | Website</title>

    <!-- fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Epilogue:wght@700&display=swap"
      rel="stylesheet"
    />

    <!-- normalize -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    />
    <!-- def-styles -->
    <link rel="stylesheet" href="./css/styles.css" />
  </head>
  <body>
    <load src="./partials/header.html" icon-path="img/sprite.svg#logo" />

    <main>
      <load src="./partials/hero.html" />
      <load src="./partials/artists.html" />
      <load src="./partials/about.html" />
      <load src="./partials/comments.html" />
    </main>

    <load src="./partials/footer.html" />
    <load src="./partials/modal.html" />

    <!-- ассистенту нужен стиль до появления панели -->
    <link rel="stylesheet" href="./css/assistant/chat.css" />

    <!-- ВАЖНО: убрали bridge.js, чтобы не было двойных слушателей assistant:* -->
    <!-- <script type="module" src="./js/assistant/bridge.js"></script> -->

    <!-- твой основной код сайта -->
    <script type="module" src="./main.js"></script>
  </body>
</html>

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/api.js

**size:** 6686 bytes &nbsp;&nbsp; **sha1:** `0c01a3e55f4b606e8245de5a3882d962f82ddf0b`

```javascript
// CRC/JS/api.js
// Единая обёртка над REST API проекта.
// Возвращает стабильные структуры, не бросает исключений наружу.
// Совместимо с artists/features/api.js

import axios from "axios";

/* =========================
   ENV / ЛОГИРОВАНИЕ
   ========================= */
const IS_DEV =
  /localhost|127\.0\.0\.1/.test(location.hostname) ||
  (document.documentElement.getAttribute("data-env") || "").toLowerCase() === "dev";

const logWarn = (...args) => { if (IS_DEV) console.warn(...args); };

/* =========================
   BASE URL (с возможностью переопределить)
   ========================= */
// приоритет: <html data-api="..."> → VITE_API_BASE → дефолт
const API_BASE =
  document.documentElement.getAttribute("data-api") ||
  (typeof import.meta !== "undefined" && import.meta.env && import.meta.env.VITE_API_BASE) ||
  "https://sound-wave.b.goit.study/api";

/* =========================
   AXIOS ИНСТАНС
   ========================= */
const api = axios.create({
  baseURL: API_BASE,
  timeout: 15000,
  headers: { "Accept": "application/json" },
});

// перехватчик ответов — ничего «магического» не делаем, только единый warn в DEV
api.interceptors.response.use(
  (res) => res,
  (err) => {
    logWarn("[api] HTTP error:", err?.message || err);
    return Promise.reject(err);
  }
);

/* =========================
   ХЕЛПЕРЫ
   ========================= */
function toastError(msg) {
  try { window.__toast?.error(msg); } catch {}
}

// безопасная нормализация любого значения в число (с минимумом)
function clampNumber(v, min, fallback) {
  const n = Number(v);
  return Number.isFinite(n) ? Math.max(min, n) : fallback;
}

/* =========================
   API ФУНКЦИИ
   ========================= */

/**
 * Список артистов
 * @param {{page?:number,limit?:number,genre?:string,sort?:'asc'|'desc'|'',name?:string}} params
 * @returns {Promise<{artists:Array,totalArtists:number,page:number,limit:number}>}
 */
export async function fetchArtists(
  { page = 1, limit = 8, genre = "", sort = "", name = "" } = {}
) {
  try {
    const params = {
      page: clampNumber(page, 1, 1),
      limit: clampNumber(limit, 1, 8),
    };

    const s = String(sort || "").toLowerCase();
    if (s === "asc" || s === "desc") params.sortName = s;

    const g = String(genre || "").trim();
    if (g && g !== "All Genres") params.genre = g;

    const n = String(name || "").trim();
    if (n.length >= 1) params.name = n;

    const { data } = await api.get("/artists", { params });

    // Нормализация ответа (на случай неожиданных форм)
    const artists = Array.isArray(data?.artists) ? data.artists
                   : Array.isArray(data)          ? data
                   : [];
    const totalArtists = clampNumber(data?.totalArtists, 0, artists.length);
    const pageOut  = clampNumber(data?.page, 1, params.page);
    const limitOut = clampNumber(data?.limit, 1, params.limit);

    return { artists, totalArtists, page: pageOut, limit: limitOut };
  } catch (err) {
    logWarn("[api] fetchArtists failed:", err?.message || err);
    toastError("Не удалось загрузить артистов. Попробуйте позже.");
    return { artists: [], totalArtists: 0, page: 1, limit: clampNumber(limit, 1, 8) };
  }
}

/* ----- кэш жанров (in-memory) на короткое время ----- */
let _genresCache = { ts: 0, list: [] };
const GENRES_TTL = 5 * 60 * 1000; // 5 минут

/**
 * Список жанров
 * @returns {Promise<string[]>} — массив имён жанров (включая "All Genres" первым)
 */
export async function fetchGenres() {
  try {
    const now = Date.now();
    if (_genresCache.list.length && now - _genresCache.ts < GENRES_TTL) {
      return _genresCache.list.slice(); // отдаём копию
    }

    const { data } = await api.get("/genres");
    const raw = Array.isArray(data) ? data : (data?.genres || []);
    const names = raw
      .map((g) =>
        typeof g === "string"
          ? g
          : g?.name || g?.title || g?.genre || g?.label || ""
      )
      .filter(Boolean);
    const uniq = [...new Set(names)];
    const out = ["All Genres", ...uniq];

    _genresCache = { ts: now, list: out };
    return out;
  } catch (err) {
    logWarn("[api] fetchGenres failed:", err?.message || err);
    toastError("Не удалось загрузить жанры.");
    return ["All Genres"];
  }
}

/**
 * Один артист
 * @param {string|number} id
 * @returns {Promise<Object|null>}
 */
export async function fetchArtist(id) {
  if (!id && id !== 0) return null;
  try {
    const { data } = await api.get(`/artists/${id}`);
    // Возможные формы: объект, массив, { artists: [...] }
    if (data && !Array.isArray(data)) return data;
    if (Array.isArray(data) && data.length) return data[0];
    if (Array.isArray(data?.artists) && data.artists.length) return data.artists[0];
    return null;
  } catch (err) {
    logWarn("[api] fetchArtist failed:", err?.message || err);
    toastError("Не удалось загрузить артиста.");
    return null;
  }
}

/**
 * Альбомы артиста (каждый альбом может содержать массив треков)
 * @param {string|number} id
 * @returns {Promise<Array>}
 */
export async function fetchArtistAlbums(id) {
  if (!id && id !== 0) return [];
  try {
    const { data } = await api.get(`/artists/${id}/albums`);

    // Возможные формы от API:
    // - Array
    // - { albumsList: [...] } / { albums: [...] } / { album: [...] }
    if (Array.isArray(data)) return data;
    if (Array.isArray(data?.albumsList)) return data.albumsList;
    if (Array.isArray(data?.albums)) return data.albums;
    if (Array.isArray(data?.album)) return data.album;

    return [];
  } catch (err) {
    logWarn("[api] fetchArtistAlbums failed:", err?.message || err);
    toastError("Не удалось загрузить альбомы.");
    return [];
  }
}

/* =========================
   Доп. экспорт при необходимости
   ========================= */
export { api, API_BASE, IS_DEV };

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/api.js

**size:** 2911 bytes &nbsp;&nbsp; **sha1:** `8b8f794ef5e6f95b6942fea6b99b6f94767a1fb8`

```javascript

import {
  fetchArtists as _fetchArtists,
  fetchGenres  as _fetchGenres,
  fetchArtist  as _fetchArtist,
  fetchArtistAlbums as _fetchArtistAlbums,
} from "../../api.js";

// ---------- helpers ----------
const normId = (o) => o?.idArtist || o?.id || o?._id || o?.artistId || "";

const normGenres = (o) => {
  if (Array.isArray(o?.genres)) return o.genres;
  if (typeof o?.strGenre === "string" && o.strGenre.trim())
    return o.strGenre.split(/,\s*/).filter(Boolean);
  if (o?.genre) return [o.genre];
  return [];
};

const NOPHOTO = "https://via.placeholder.com/960x540?text=No+Image";

const normArtist = (o = {}) => ({
  id: normId(o),
  name: o.strArtist || o.name || "Unknown artist",
  image: o.strArtistThumb || o.thumb || o.photo || o.image || NOPHOTO,
  country: o.strCountry || o.country || "N/A",
  members: o.intMembers || o.members || "N/A",
  gender:  o.strGender || o.sex || "N/A",
  biography: o.strBiographyEN || o.biography || o.about || "",
  genres: normGenres(o),
  formedYear: o.intFormedYear || o.formedYear || o.yearStart || null,
  endedYear:  o.intDisbandedYear || o.intDiedYear || o.disbandedYear || o.yearEnd || null,
});

const normTrack = (t = {}) => ({
  title: t.strTrack || t.title || t.name || "—",
  duration: Number(t.intDuration ?? t.duration ?? t.time ?? 0),
  youtube: t.strMusicVid || t.youtube || t.youtube_url || t.url || t.movie || "",
});

const normAlbum = (a = {}) => {
  const rawTracks =
    Array.isArray(a.tracks) ? a.tracks :
    Array.isArray(a.songs)  ? a.songs  :
    Array.isArray(a.track)  ? a.track  : [];
  return {
    title: a.strAlbum || a.title || a.name || "Album",
    tracks: rawTracks.map(normTrack),
  };
};

// ---------- exported API (normalized) ----------
export async function fetchArtists(params) {
  const res = await _fetchArtists(params);
  const list = Array.isArray(res?.artists) ? res.artists
             : Array.isArray(res)          ? res
             : [];
  const artists = list.map(normArtist);
  const totalArtists = Number(res?.totalArtists ?? res?.total ?? artists.length);
  return { artists, totalArtists };
}

export async function fetchGenres() {
  const res = await _fetchGenres();
  if (Array.isArray(res)) return res;
  if (Array.isArray(res?.genres)) return res.genres;
  return [];
}

export async function fetchArtist(id) {
  const res = await _fetchArtist(id);
  const obj = Array.isArray(res) ? res[0]
            : Array.isArray(res?.artists) ? res.artists[0]
            : res;
  return obj ? normArtist(obj) : null;
}

export async function fetchArtistAlbums(id) {
  const res = await _fetchArtistAlbums(id);
  const list = Array.isArray(res) ? res
             : Array.isArray(res?.albums) ? res.albums
             : Array.isArray(res?.album)  ? res.album
             : [];
  return list.map(normAlbum);
}




```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/grid.js

**size:** 20625 bytes &nbsp;&nbsp; **sha1:** `e7ef9cfa1eff616e6819621efa552ffa51648d9f`

```javascript
// src/js/artists/features/grid.js
// Грид артистов: скелетоны, пагинация, поиск/сорт/жанры, модалка, zoom, List/Grid view.
// Плюс: "умная" биография (минимум 3–5 строк), единая высота блоков, data:-плейсхолдер.

import { UISound } from "../lib/sound.js";
import { fetchArtists, fetchGenres } from "./api.js";
import { ArtistState } from "./state.js";
import { createArtistModal } from "./modal.js";
import { openZoom } from "./zoom.js";

// === SVG SPRITE (лежит в CRC/img/sprite.svg) ===
import SPRITE_RAW from "../../../img/sprite.svg?raw";

const SPRITE_CONTAINER_ID = "GLOBAL_SVG_SPRITE";
function ensureSpriteMounted(doc = document) {
  if (doc.getElementById(SPRITE_CONTAINER_ID)) return;
  const wrap = doc.createElement("div");
  wrap.id = SPRITE_CONTAINER_ID;
  wrap.setAttribute("aria-hidden", "true");
  wrap.style.position = "absolute";
  wrap.style.width = "0";
  wrap.style.height = "0";
  wrap.style.overflow = "hidden";
  wrap.innerHTML = SPRITE_RAW;
  doc.body.prepend(wrap);
}
const icon = (id, cls = "ico") =>
  `<svg class="${cls}" aria-hidden="true"><use href="#${id}" xlink:href="#${id}"></use></svg>`;

// === Рантайм-CSS (ровная сетка: 5 строк биографии + фикс высота тегов) ===
const RUNTIME_STYLE_ID = "artists-grid-runtime";
function ensureRuntimeStyles() {
  if (document.getElementById(RUNTIME_STYLE_ID)) return;
  const css = `
  #artists-section .card__tags{min-height:28px;display:flex;flex-wrap:wrap;gap:8px}
  #artists-section .card__text{
    display:-webkit-box;
    -webkit-line-clamp:5;          /* 5 строк по ТЗ */
    -webkit-box-orient:vertical;
    overflow:hidden;
  }`;
  const style = document.createElement("style");
  style.id = RUNTIME_STYLE_ID;
  style.textContent = css;
  document.head.appendChild(style);
}

// ——— параметры рендеринга ———
const DEFAULT_LIMIT = 8;

// Без сетевых запросов → не будет ошибок в консоли
const FALLBACK_IMG =
  "data:image/svg+xml;utf8," +
  encodeURIComponent(
    `<svg xmlns="http://www.w3.org/2000/svg" width="960" height="540">
      <rect width="100%" height="100%" fill="#0b0b0b"/>
      <text x="50%" y="50%" fill="#888" font-family="IBM Plex Sans,Arial,sans-serif"
            font-size="28" text-anchor="middle" dominant-baseline="middle">No image</text>
    </svg>`
  );

// аккуратно отсекаем «странные» URL, чтобы не гонять лишние запросы
function looksLikeImageUrl(u) {
  if (!u || typeof u !== "string") return false;
  if (!/^https?:\/\//i.test(u)) return false;
  if (/null|undefined$/i.test(u)) return false;
  if (!/\.(jpg|jpeg|png|webp|gif|avif|svg)(\?|#|$)/i.test(u)) return false;
  return true;
}

// лимит для List View
function computeListLimit() {
  const w = window.innerWidth || document.documentElement.clientWidth || 0;
  if (w >= 1440) return 16;
  if (w >= 768) return 12;
  return 10;
}

// гарантируем наличие кнопки List view (особенно на мобилке)
function ensureViewToggle(root) {
  let btn = root.querySelector("#view-toggle");
  if (!btn) {
    btn = document.createElement("button");
    btn.id = "view-toggle";
    btn.type = "button";
    btn.className = "filters__view";
    btn.setAttribute("aria-pressed", "false");
    btn.textContent = "List view";
    const mount =
      root.querySelector(".filters__bar") ||
      root.querySelector(".filters") ||
      root;
    mount.appendChild(btn);
  }
  return btn;
}

/* ---------- «умная» биография: добивка фактами, чтобы получить 3–5 строк ---------- */
function cleanText(s = "") {
  return String(s)
    .replace(/\s+/g, " ")
    .replace(/\s*([,.!?;:])\s*/g, "$1 ")
    .trim();
}
function yearsLabel(a = {}) {
  const start = a.intFormedYear || a.formedYear || a.yearStart || "";
  const end   = a.intDisbandedYear || a.intDiedYear || a.disbandedYear || a.yearEnd || "";
  if (start && end) return `${start}–${end}`;
  if (start) return `since ${start}`;
  return "";
}
function topGenres(a) {
  const arr = Array.isArray(a?.genres) ? a.genres : (a?.genre ? [a.genre] : []);
  return arr.map(String).filter(Boolean).slice(0, 2);
}
function composeBio(a) {
  const raw = cleanText(a?.strBiographyEN || a?.biography || a?.about || "");
  const hasJazz = topGenres(a).some(g => /jazz/i.test(g));
  const fallback = hasJazz
    ? "A look at the influential figures who shaped jazz music history."
    : "A look at the influential figures who shaped music history.";

  const facts = [];
  const gs = topGenres(a); if (gs.length) facts.push(`Genres: ${gs.join(", ")}`);
  const country = a.strCountry || a.country; if (country) facts.push(`Country: ${country}`);
  const yrs = yearsLabel(a); if (yrs) facts.push(`Active: ${yrs}`);

  let bio = raw || fallback;
  if (facts.length) bio += " " + facts.join(". ") + ".";

  // корректно «растянем», чтобы чаще было 3–5 строк (при текущей ширине карточки и 16px)
  const MIN_CHARS = 230;
  if (bio.length < MIN_CHARS && raw) {
    bio += " Explore discography, style, and milestones.";
  }
  return bio;
}

/* ====================================================================== */

export function initGrid(root = document.querySelector("#artists-section")) {
  if (!root) return;

  ensureSpriteMounted(document);
  ensureRuntimeStyles();

  // ---------- refs ----------
  const panel      = root.querySelector("#filters-panel");
  const toggleBtn  = root.querySelector("#filters-toggle");
  const resetBtn   = root.querySelector("#filters-reset");
  const resetBtnSm = root.querySelector("#filters-reset-sm");
  const viewToggle = ensureViewToggle(root);

  const searchInput = root.querySelector("#flt-q");
  const searchBtn   = root.querySelector("#flt-q-btn");

  const ddSort      = root.querySelector('.dd[data-dd="sort"]');
  const ddSortBtn   = root.querySelector("#dd-sort-btn")  || ddSort?.querySelector(".dd__btn");
  const ddSortList  = root.querySelector("#dd-sort-list") || ddSort?.querySelector(".dd__list");

  const ddGenre     = root.querySelector('.dd[data-dd="genre"]');
  const ddGenreBtn  = root.querySelector("#dd-genre-btn") || ddGenre?.querySelector(".dd__btn");
  const ddGenreList = root.querySelector("#dd-genre-list")|| ddGenre?.querySelector(".dd__list");

  const grid  = root.querySelector("#artists-grid");
  const pager = root.querySelector("#artists-pager");
  const empty = root.querySelector("#artists-empty");

  if (!grid) {
    console.warn("[artists] #artists-grid not found; abort initGrid");
    return;
  }

  const sectionRoot = root.closest(".artists1") || root;

  // модалка (единый экземпляр)
  const modalApi = createArtistModal(document);

  // защита от гонок API
  let reqId = 0;

  // для слежения за авто-лимитом при ресайзе
  let lastAppliedLimit = null;

  // ---------- utils ----------
  const show = (el) => el && el.removeAttribute("hidden");
  const hide = (el) => el && el.setAttribute("hidden", "");
  const isDesktop = () => matchMedia("(min-width:1440px)").matches;
  const byName = (a) => (a?.strArtist || a?.name || "").toLowerCase();
  const isListMode = () => sectionRoot.classList.contains("view-list");

  function updateViewButtonUI(listOn) {
    viewToggle?.setAttribute("aria-pressed", String(listOn));
    if (viewToggle) viewToggle.textContent = listOn ? "Default view" : "List view";
  }

  function applyAutoLimitForCurrentMode({ resetPage = false } = {}) {
    const want = isListMode() ? computeListLimit() : DEFAULT_LIMIT;
    if (lastAppliedLimit === want) return;
    lastAppliedLimit = want;
    ArtistState.setLimit(want);
    if (resetPage) ArtistState.setPage(1);
    loadArtists();
  }

  function syncPanelMode() {
    const st = ArtistState.get();
    if (isDesktop()) {
      panel?.setAttribute("aria-hidden", "false");
      toggleBtn?.setAttribute("aria-expanded", "false");
      ArtistState.setMobilePanel(false);
    } else {
      panel?.setAttribute("aria-hidden", st.isMobilePanelOpen ? "false" : "true");
      toggleBtn?.setAttribute("aria-expanded", st.isMobilePanelOpen ? "true" : "false");
    }
  }

  function scrollToGridTop() {
    const top = root.getBoundingClientRect().top + window.scrollY - 16;
    window.scrollTo({ top, behavior: "smooth" });
  }

  function applyEmpty(on) {
    if (on) {
      show(empty); hide(grid); hide(pager); resetGridInlineStyles();
    } else {
      hide(empty); show(grid);
    }
  }
  function resetGridInlineStyles() {
    grid.style.height = "";
    grid.style.overflow = "";
    grid.style.transition = "";
    grid.style.willChange = "";
  }

  // ---------- skeleton + fade-in ----------
  function buildSkeletonCard() {
    return `
      <li class="card card--skel">
        <div class="card__media skel skel--media"></div>
        <div class="card__tags">
          <span class="tag skel skel--tag"></span>
          <span class="tag skel skel--tag"></span>
        </div>
        <div class="skel skel--title"></div>
        <div class="skel skel--text"></div>
      </li>`;
  }
  function renderSkeleton(count) {
    const n = Math.max(1, Number(count) || DEFAULT_LIMIT);
    grid.innerHTML = new Array(n).fill(0).map(buildSkeletonCard).join("");
    show(grid); hide(empty); hide(pager);
  }
  function afterImagesFadeIn() {
    const imgs = grid.querySelectorAll("img.img-fade");
    imgs.forEach((img) => {
      const done = () => img.classList.add("is-loaded");
      if (img.complete && img.naturalWidth > 0) done();
      else img.addEventListener("load", done, { once: true });
    });
  }
  function attachImgFallbacks() {
    grid.querySelectorAll("img").forEach(img => {
      img.onerror = () => { img.onerror = null; img.src = FALLBACK_IMG; };
    });
  }

  // удержание высоты на время перерендера
  let gridCleanupTimer = null;
  function lockGridHeight(h) {
    const hh = h ?? grid.getBoundingClientRect().height;
    grid.style.willChange = "height";
    grid.style.overflow = "hidden";
    grid.style.transition = "none";
    grid.style.height = `${Math.max(1, Math.round(hh || 0))}px`;
  }
  function unlockGridHeight() { resetGridInlineStyles(); }
  function swapGridContent(renderFn) {
    renderFn();
    void grid.offsetHeight;
    const newH = grid.scrollHeight;
    grid.style.transition = "height 200ms ease";
    grid.style.height = `${newH}px`;
    const onEnd = (e) => {
      if (e.target !== grid || e.propertyName !== "height") return;
      grid.removeEventListener("transitionend", onEnd);
      unlockGridHeight();
    };
    grid.addEventListener("transitionend", onEnd);
    clearTimeout(gridCleanupTimer);
    gridCleanupTimer = setTimeout(unlockGridHeight, 400);
  }

  // ---------- rendering ----------
  function buildCard(a) {
    const id    = a?.id || a?._id || a?.artistId || "";
    const name  = a?.strArtist || a?.name || "Unknown";
    const rawImg= a?.strArtistThumb || a?.photo || a?.image || "";
    const img   = looksLikeImageUrl(rawImg) ? rawImg : FALLBACK_IMG;

    const bio   = composeBio(a);
    const tags  = Array.isArray(a?.genres) ? a.genres : (a?.genre ? [a.genre] : []);

    return `
      <li class="card" data-id="${id}">
        <div class="card__media">
          <img
            class="img-fade"
            src="${img}"
            alt="${name}"
            loading="lazy"
            onerror="this.onerror=null;this.src='${FALLBACK_IMG}'"
          >
        </div>
        <div class="card__tags">${tags.map(t => `<span class="tag">${t}</span>`).join("")}</div>
        <h3 class="card__title">${name}</h3>
        <p class="card__text">${bio}</p>
        <button class="card__link" data-action="more">
          Learn More
          ${icon("icon-icon_play_artists_sections")}
        </button>
      </li>`;
  }
  function renderGrid(arr) {
    grid.innerHTML = arr.map(buildCard).join("");
    attachImgFallbacks();
    afterImagesFadeIn();
  }

  function renderPager(page, totalPages) {
    if (totalPages <= 0) { pager.innerHTML = ""; hide(pager); return; }
    if (totalPages === 1) {
      pager.innerHTML = `<button class="active" data-page="1" disabled>1</button>`;
      show(pager); return;
    }
    const btn = (label, p, dis = false, act = false) =>
      `<button ${dis ? "disabled" : ""} data-page="${p}" class="${act ? "active" : ""}">${label}</button>`;

    const win = 2;
    const from = Math.max(1, page - win);
    const to = Math.min(totalPages, page + win);
    const out = [];

    out.push(btn("‹", Math.max(1, page - 1), page === 1, false));
    if (from > 1) {
      out.push(btn("1", 1, false, page === 1));
      if (from > 2) out.push(`<button class="dots" disabled>…</button>`);
    }
    for (let p = from; p <= to; p++) out.push(btn(String(p), p, false, p === page));
    if (to < totalPages) {
      if (to < totalPages - 1) out.push(`<button class="dots" disabled>…</button>`);
      out.push(btn(String(totalPages), totalPages, false, page === totalPages));
    }
    out.push(btn("›", Math.min(totalPages, page + 1), page === totalPages, false));

    pager.innerHTML = out.join("");
    show(pager);
  }

  // ---------- data ----------
  async function loadGenres() {
    try {
      ddGenre?.classList.add("loading");
      ddGenreBtn?.setAttribute("aria-busy", "true");
      if (ddGenreBtn) ddGenreBtn.disabled = true;
      if (ddGenreList) {
        ddGenreList.innerHTML = `
          <li class="dd__loading">
            <span class="dd__spinner" aria-hidden="true"></span>
            <span>Loading…</span>
          </li>`;
      }
      const list = await fetchGenres();
      if (ddGenreList) ddGenreList.innerHTML = list.map((g) => `<li data-val="${g}">${g}</li>`).join("");
    } catch {
      if (ddGenreList) ddGenreList.innerHTML = `<li data-val="">All Genres</li>`;
    } finally {
      ddGenre?.classList.remove("loading");
      ddGenreBtn?.removeAttribute("aria-busy");
      if (ddGenreBtn) ddGenreBtn.disabled = false;
    }
  }

  async function loadArtists(allowRetry = true) {
    const myId = ++reqId;

    const { page, limit, genre, sort, q } = ArtistState.get();

    lockGridHeight(grid.getBoundingClientRect().height);
    renderSkeleton(limit);
    hide(pager);

    let list = [];
    let total = 0;

    try {
      const server = await fetchArtists({
        page, limit,
        genre: genre || "",
        sort:  sort  || "",
        name:  q?.trim?.() || "",
      });
      if (myId !== reqId) return;
      list  = Array.isArray(server.artists) ? server.artists : (Array.isArray(server) ? server : []);
      total = Number(server.totalArtists ?? server.total ?? list.length ?? 0);
    } catch {
      if (myId !== reqId) return;
      list = []; total = 0;
    }

    let totalPages = Math.max(1, Math.ceil(total / Math.max(1, Number(limit) || DEFAULT_LIMIT)));
    if (page > totalPages && allowRetry) { ArtistState.setPage(totalPages); return loadArtists(false); }
    if (page < 1 && allowRetry)          { ArtistState.setPage(1);         return loadArtists(false); }

    if (sort === "asc")  list = list.slice().sort((a, b) => byName(a).localeCompare(byName(b)));
    if (sort === "desc") list = list.slice().sort((a, b) => byName(b).localeCompare(byName(a)));

    if (myId !== reqId) return;

    if (!list.length) {
      grid.innerHTML = "";
      applyEmpty(true);
      unlockGridHeight();
      return;
    }

    applyEmpty(false);
    swapGridContent(() => renderGrid(list));
    renderPager(ArtistState.get().page, totalPages);
  }

  // ---------- dropdowns ----------
  function closeDropdowns(except) {
    [ddSort, ddGenre].forEach((dd) => {
      if (dd && dd !== except) {
        dd.classList.remove("open");
        const ul = dd.querySelector(".dd__list");
        if (ul) ul.style.display = "none";
      }
    });
  }
  function toggleDropdown(dd) {
    if (!dd) return;
    const open = !dd.classList.contains("open");
    closeDropdowns(dd);
    dd.classList.toggle("open", open);
    const ul = dd.querySelector(".dd__list");
    if (ul) ul.style.display = open ? "block" : "none";
  }

  // ---------- UI events ----------
  toggleBtn?.addEventListener("click", () => {
    try { UISound?.tap?.(); } catch {}
    const st = ArtistState.get();
    ArtistState.setMobilePanel(!st.isMobilePanelOpen);
    syncPanelMode();
  });
  addEventListener("resize", () => {
    syncPanelMode();
    if (isListMode()) applyAutoLimitForCurrentMode({ resetPage: true });
  });

  ddSortBtn?.addEventListener("click", () => { try { UISound?.tap?.(); } catch {} toggleDropdown(ddSort); });
  ddGenreBtn?.addEventListener("click", () => { try { UISound?.tap?.(); } catch {} toggleDropdown(ddGenre); });
  document.addEventListener("click", (e) => { if (!e.target.closest(".dd")) closeDropdowns(); });

  ddSortList?.addEventListener("click", (e) => {
    const li = e.target.closest("li"); if (!li) return;
    try { UISound?.tap?.(); } catch {}
    ArtistState.setSort(li.dataset.val || "");
    toggleDropdown(ddSort);
    loadArtists();
  });

  ddGenreList?.addEventListener("click", (e) => {
    const li = e.target.closest("li"); if (!li) return;
    try { UISound?.tap?.(); } catch {}
    const v = li.dataset.val || "";
    ArtistState.setGenre(v === "All Genres" ? "" : v);
    toggleDropdown(ddGenre);
    loadArtists();
    ddSortBtn?.focus();
  });

  function doSearch() {
    try { UISound?.tap?.(); } catch {}
    ArtistState.setQuery(searchInput?.value.trim() || "");
    ArtistState.setPage(1);
    loadArtists();
  }
  searchBtn?.addEventListener("click", doSearch);
  searchInput?.addEventListener("keydown", (e) => { if (e.key === "Enter") doSearch(); });

  function resetAll() {
    ArtistState.reset();
    if (searchInput) searchInput.value = "";
    closeDropdowns();
    lastAppliedLimit = null;
    applyAutoLimitForCurrentMode({ resetPage: true });
  }
  resetBtn?.addEventListener("click", () => { try { UISound?.tap?.(); } catch {} resetAll(); });
  resetBtnSm?.addEventListener("click", () => {
    try { UISound?.tap?.(); } catch {}
    resetAll();
    ArtistState.setMobilePanel(false);
    syncPanelMode();
  });
  root.querySelector("#empty-reset")?.addEventListener("click", () => { try { UISound?.tap?.(); } catch {} resetAll(); });

  pager?.addEventListener("click", (e) => {
    const b = e.target.closest("button[data-page]");
    if (!b || b.disabled) return;
    const p = Number(b.dataset.page) || 1;
    if (p === ArtistState.get().page) return;
    try { UISound?.page?.(); } catch {}
    scrollToGridTop();
    ArtistState.setPage(p);
    loadArtists();
  });

  // Learn More + Zoom
  grid?.addEventListener("click", (e) => {
    const btn = e.target.closest(".card__link, [data-action='more']");
    if (btn) {
      const id = btn.closest(".card")?.dataset?.id;
      if (!id) return;
      try { UISound?.tap?.(); } catch {}
      modalApi.openFor(id);
      return;
    }
    const img = e.target.closest(".card__media img");
    if (img) {
      try { UISound?.tap?.(); } catch {}
      const src = img.currentSrc || img.src || img.getAttribute("src") || "";
      openZoom(src, img.getAttribute("alt") || "");
    }
  });

  // List/Grid view
  viewToggle?.addEventListener("click", () => {
    try { UISound?.tap?.(); } catch {}
    const listOn = !isListMode();
    sectionRoot.classList.toggle("view-list", listOn);
    sectionRoot.classList.toggle("view-grid", !listOn);
    updateViewButtonUI(listOn);
    lastAppliedLimit = null;
    applyAutoLimitForCurrentMode({ resetPage: true });
  });

  // init
  updateViewButtonUI(isListMode());
  syncPanelMode();
  lastAppliedLimit = null;
  applyAutoLimitForCurrentMode({ resetPage: false });
  loadGenres();
  loadArtists();
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/init.js

**size:** 749 bytes &nbsp;&nbsp; **sha1:** `04f7c5fee8d19fa8fe3ebe0354b60262af0a6913`

```javascript
import { initGrid } from "./grid.js";
import { createArtistModal } from "./modal.js";
import { initRouter } from "./router.js";
import { initPrefetch } from "./prefetch.js";

export function initArtists(root = document.querySelector("#artists-section")) {
  if (!root) return;

  // URL-sync сначала (восстановит состояние до начальной загрузки)
  initRouter(root);

  // Модалка (возвращает open/close)
  const modal = createArtistModal(root);

  // Prefetch "Learn more" (ускоряет открытие модалки)
  initPrefetch(root);

  // Грид (передаём модалку для открытия)
  initGrid(root, { openModal: modal.open });
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/mixradio-menu.js

**size:** 5940 bytes &nbsp;&nbsp; **sha1:** `cbcb3f4274d3ccf21a96811b1beab2cc95813238`

```javascript
// Кнопка "Radio Menu": кликом открывает поповер под кнопкой, шириной = ширине кнопки.
// Экспорт: installMixRadioMenu(selector, player)

export function installMixRadioMenu(buttonSelector = "#mixradio-menu-btn", player) {
  const btn = document.querySelector(buttonSelector);
  if (!btn || btn.dataset.mrxInited) return;
  btn.dataset.mrxInited = "1";

  // ---- Inline CSS (один раз) ----
  const STYLE_ID = "mixradio-menu-style";
  if (!document.getElementById(STYLE_ID)) {
    const st = document.createElement("style");
    st.id = STYLE_ID;
    st.textContent = `
      .am-mrx-pop{
        position:fixed; z-index:3000; background:#0f0f10;
        border:1px solid rgba(255,255,255,.12); border-radius:12px;
        box-shadow:0 12px 32px rgba(0,0,0,.4); padding:8px; color:#e8e8ec;
        font:500 14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif
      }
      .am-mrx-pop__grp{padding:6px 6px 4px 6px}
      .am-mrx-pop__hdr{font-weight:700;color:#fff;margin:4px 6px 6px}
      .am-mrx-pop__btn{display:flex;align-items:center;gap:8px;width:100%;
        padding:8px 10px;border:0;background:transparent;color:#e8e8ec;border-radius:8px;cursor:pointer}
      .am-mrx-pop__btn:hover,.am-mrx-pop__btn:focus-visible{background:rgba(255,255,255,.08);outline:none}
      .am-mrx-pop__sep{height:1px;background:rgba(255,255,255,.12);margin:6px 0}
      .am-mrx-pop__row{display:flex;gap:6px;flex-wrap:wrap}
      .am-mrx-pop__chip{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.18);
        background:transparent;color:#fff;cursor:pointer}
      .am-mrx-pop__chip:hover,.am-mrx-pop__chip:focus-visible{background:rgba(255,255,255,.08);outline:none}
      .am-mrx-pop__muted{opacity:.8}
    `;
    document.head.appendChild(st);
  }

  let pop = null;
  let sleepTimer = null;

  function closePop() {
    if (pop && pop.parentNode) pop.parentNode.removeChild(pop);
    pop = null;
    document.removeEventListener("click", onDocClick, true);
    window.removeEventListener("scroll", placeUnderButton);
    window.removeEventListener("resize", placeUnderButton);
    document.removeEventListener("keydown", onEsc);
  }
  function onEsc(e){ if(e.key==="Escape") closePop(); }
  function onDocClick(e){
    if (!pop) return;
    if (e.target === btn) return;          // повторный клик по кнопке — пусть обрабатывается её хэндлером
    if (!pop.contains(e.target)) closePop();
  }

  function placeUnderButton() {
    if (!pop) return;
    const r = btn.getBoundingClientRect();
    const w = Math.max(160, Math.round(r.width));
    pop.style.width = w + "px";
    pop.style.minWidth = w + "px";

    const vw = window.innerWidth;
    const px8 = 8;
    const left = Math.min(Math.max(px8, r.left), vw - w - px8);
    const top  = r.bottom + 6;

    // ВАЖНО: позиционирование fixed — координаты по вьюпорту, БЕЗ скролл-офсетов
    pop.style.left = left + "px";
    pop.style.top  = top + "px";
  }

  function setSleep(minutes) {
    if (sleepTimer) { clearTimeout(sleepTimer); sleepTimer = null; }
    if (!minutes) { closePop(); return; }
    sleepTimer = setTimeout(() => {
      try {
        if (player?.pause) player.pause();
        else if (player?.stop) player.stop();
        else if (player?.close) player.close();
      } catch {}
      sleepTimer = null;
    }, minutes * 60 * 1000);
    closePop();
  }

  function clickGenre(name) {
    const li =
      document.querySelector(`#dd-genre-list li[data-val="${name}"]`) ||
      Array.from(document.querySelectorAll("#dd-genre-list li"))
        .find(x => (x.textContent||"").trim().toLowerCase() === String(name).toLowerCase());
    if (li) li.click();
    closePop();
  }

  function buildPop() {
    closePop();
    pop = document.createElement("div");
    pop.className = "am-mrx-pop";
    pop.innerHTML = `
      <div class="am-mrx-pop__grp">
        <div class="am-mrx-pop__hdr">Popular styles</div>
        <div class="am-mrx-pop__row">
          ${["Pop","Rock","Jazz","Hip-Hop","Electronic","Classical"].map(g =>
            `<button type="button" class="am-mrx-pop__chip" data-genre="${g}">${g}</button>`
          ).join("")}
        </div>
      </div>
      <div class="am-mrx-pop__sep"></div>
      <div class="am-mrx-pop__grp">
        <div class="am-mrx-pop__hdr">Sleep timer</div>
        <button type="button" class="am-mrx-pop__btn" data-sleep="20">Stop after 20 min</button>
        <button type="button" class="am-mrx-pop__btn" data-sleep="40">Stop after 40 min</button>
        <button type="button" class="am-mrx-pop__btn" data-sleep="60">Stop after 60 min</button>
        <button type="button" class="am-mrx-pop__btn am-mrx-pop__muted" data-sleep="0">Cancel timer</button>
      </div>
    `;
    document.body.appendChild(pop);

    pop.addEventListener("click", (e) => {
      const chip = e.target.closest(".am-mrx-pop__chip");
      if (chip) { clickGenre(chip.dataset.genre); return; }
      const b = e.target.closest("[data-sleep]");
      if (b) { setSleep(Number(b.dataset.sleep) || 0); return; }
    });

    // позиционируем и подписываемся на изменения
    requestAnimationFrame(placeUnderButton);
    window.addEventListener("scroll", placeUnderButton, { passive: true });
    window.addEventListener("resize", placeUnderButton);
    document.addEventListener("click", onDocClick, true);
    document.addEventListener("keydown", onEsc);
  }

  // Клик по кнопке — открыть/закрыть
  btn.addEventListener("click", (e) => {
    e.preventDefault();
    if (pop) { closePop(); return; }
    buildPop();
  });
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/modal.js

**size:** 11692 bytes &nbsp;&nbsp; **sha1:** `5e400c38554e7ef0bcacb117a202700162e24285`

```javascript
import { lockScroll, unlockScroll } from "../lib/scroll-lock.js";
import { UISound } from "../lib/sound.js";
import { fetchArtist, fetchArtistAlbums } from "./api.js";
import { createMiniPlayer } from "./player.js";
import { openZoom } from "./zoom.js";
import { getPrefetched } from "./prefetch.js";

import SPRITE_RAW from "../../../img/sprite.svg?raw";
const SPRITE_CONTAINER_ID = "GLOBAL_SVG_SPRITE";
function ensureSpriteMounted(doc = document) {
  if (doc.getElementById(SPRITE_CONTAINER_ID)) return;
  const wrap = doc.createElement("div");
  wrap.id = SPRITE_CONTAINER_ID;
  wrap.setAttribute("aria-hidden", "true");
  wrap.style.position = "absolute";
  wrap.style.width = "0";
  wrap.style.height = "0";
  wrap.style.overflow = "hidden";
  wrap.innerHTML = SPRITE_RAW;
  doc.body.prepend(wrap);
}
const icon = (id, cls = "ico") =>
  `<svg class="${cls}" aria-hidden="true"><use href="#${id}" xlink:href="#${id}"></use></svg>`;

const FALLBACK_IMG =
  "data:image/svg+xml;utf8," +
  encodeURIComponent(
    `<svg xmlns="http://www.w3.org/2000/svg" width="960" height="540">
      <rect width="100%" height="100%" fill="#0b0b0b"/>
      <text x="50%" y="50%" fill="#888" font-family="IBM Plex Sans,Arial,sans-serif"
            font-size="28" text-anchor="middle" dominant-baseline="middle">No image</text>
    </svg>`
  );

/* ---------- ensure modal shell ---------- */
function ensureModalShell(doc = document) {
  let modal = doc.querySelector("#artist-modal");
  if (modal) return modal;

  modal = doc.createElement("div");
  modal.id = "artist-modal";
  modal.className = "amodal";
  modal.setAttribute("hidden", "");
  modal.innerHTML = `
    <div class="amodal__backdrop"></div>
    <div class="amodal__dialog" role="dialog" aria-modal="true" aria-label="Artist details">
      <button id="am-close" class="amodal__close" type="button" aria-label="Close">×</button>
      <div id="am-body" class="amodal__body">
        <div class="amodal__loader loader"></div>
      </div>
    </div>`;
  doc.body.appendChild(modal);
  return modal;
}

/* ----------------- helpers ----------------- */
function fmtTime(msLike) {
  const ms = Number(msLike);
  if (!Number.isFinite(ms)) return "—";
  const total = Math.round(ms / 1000);
  const m = Math.floor(total / 60);
  const s = String(total % 60).padStart(2, "0");
  return `${m}:${s}`;
}
function years(d = {}) {
  const s = d.formedYear || d.intFormedYear || d.yearStart;
  const e = d.endedYear || d.intDisbandedYear || d.intDiedYear || d.yearEnd;
  if (s && e) return `${s}–${e}`;
  if (s) return `${s}–present`;
  return "information missing";
}
function trackRow(t = {}) {
  const title = t.title || t.strTrack || t.name || "—";
  const dur   = fmtTime(t.duration ?? t.intDuration ?? t.time);
  const link  = t.youtube || t.youtube_url || t.url || t.movie || t.strMusicVid || "";
  return `
    <li class="tr">
      <span>${title}</span>
      <span>${dur}</span>
      <span>${
        link
          ? `<a class="yt" href="${link}" target="_blank" rel="noopener noreferrer" aria-label="Play">
               ${icon("icon-icon_youtube_footer", "ico am-yt")}
             </a>`
          : `<span class="yt-ph"></span>`
      }</span>
    </li>`;
}
function dedupe(arr){const s=new Set(),r=[];for(const x of arr){if(x&&!s.has(x)){s.add(x);r.push(x)}}return r;}
function isMixRadioOn(){
  return !!document.querySelector('#random-radio[aria-pressed="true"], .toolbar__mixradio.is-active, body.mixradio-on');
}

/* ----------------- main ----------------- */
export function createArtistModal(rootEl = document) {
  ensureSpriteMounted(document);

  const modal =
    (rootEl && rootEl.querySelector ? rootEl.querySelector("#artist-modal") : null) ||
    document.querySelector("#artist-modal") ||
    ensureModalShell(document);

  const modalBody  = modal.querySelector("#am-body");
  const modalClose = modal.querySelector("#am-close");
  const dialog     = modal.querySelector(".amodal__dialog");

  // ЕДИНЫЙ мини-плеер для сайта:
  // 1) используем уже созданный глобально в index.js
  // 2) если его ещё нет (например, модалку открыли раньше) — создаём и регистрируем
  let player = (window.AM && window.AM.player) || null;
  if (!player) {
    player = createMiniPlayer();
    window.AM = window.AM || {};
    window.AM.player = player;
    document.dispatchEvent(new CustomEvent("am:player-ready", { detail: { player } }));
  }

  // Scroll-to-top в диалоге
  let scrollTopBtn = null;
  let onDialogScroll = null;
  let onWinResize    = null;

  function placeScrollTop() {
    try {
      const pad = 24;
      const r = dialog.getBoundingClientRect();
      const right = Math.max(pad, window.innerWidth - (r.left + r.width) + pad);
      scrollTopBtn.style.right  = `${right}px`;
      scrollTopBtn.style.bottom = `58px`;
    } catch {}
  }
  function ensureScrollTop() {
    if (!scrollTopBtn) {
      scrollTopBtn = document.createElement("button");
      scrollTopBtn.type = "button";
      scrollTopBtn.className = "amodal__scrolltop";
      scrollTopBtn.setAttribute("aria-label", "Scroll to top");
      scrollTopBtn.textContent = "↑";
      dialog.appendChild(scrollTopBtn);
      scrollTopBtn.addEventListener("click", () => {
        try { UISound?.tap?.(); } catch {}
        dialog.scrollTo({ top: 0, behavior: "smooth" });
      });
    }
    if (onDialogScroll) dialog.removeEventListener("scroll", onDialogScroll);
    if (onWinResize) {
      window.removeEventListener("resize", onWinResize);
      window.visualViewport?.removeEventListener("resize", onWinResize);
      window.removeEventListener("orientationchange", onWinResize);
    }
    onDialogScroll = () => {
      try {
        scrollTopBtn.style.display = (dialog.scrollTop || 0) > 220 ? "flex" : "none";
        placeScrollTop();
      } catch {}
    };
    dialog.addEventListener("scroll", onDialogScroll);

    onWinResize = () => { placeScrollTop(); };
    window.addEventListener("resize", onWinResize);
    window.visualViewport?.addEventListener("resize", onWinResize);
    window.addEventListener("orientationchange", onWinResize);

    placeScrollTop();
  }

  const onEsc = (e) => { if (e.key === "Escape") { try { UISound?.tap?.(); } catch {} close(); } };

  function open() {
    modal.removeAttribute("hidden");
    lockScroll();
    ensureScrollTop();
    if (scrollTopBtn) scrollTopBtn.style.display = "none";
    modalBody.innerHTML = `<div class="amodal__loader loader"></div>`;
    document.addEventListener("keydown", onEsc);
  }

  function close() {
    modal.setAttribute("hidden", "");
    unlockScroll();
    modalBody.innerHTML = "";
    document.removeEventListener("keydown", onEsc);

    if (onDialogScroll) { dialog.removeEventListener("scroll", onDialogScroll); onDialogScroll = null; }
    if (onWinResize) {
      window.removeEventListener("resize", onWinResize);
      window.visualViewport?.removeEventListener("resize", onWinResize);
      window.removeEventListener("orientationchange", onWinResize);
      onWinResize = null;
    }
    if (scrollTopBtn) scrollTopBtn.style.display = "none";
  }

  modalClose.addEventListener("click", () => { try { UISound?.tap?.(); } catch {} close(); });
  modal.addEventListener("click", (e) => {
    if (e.target.classList.contains("amodal__backdrop")) {
      try { UISound?.tap?.(); } catch {}
      close();
    }
  });

  // Делегирование: YouTube (очередь) и Zoom по картинке
  modal.addEventListener("click", (e) => {
    const a = e.target.closest("a.yt");
    if (a) {
      e.preventDefault();
      try { UISound?.tap?.(); } catch {}

      const links = Array.from(modal.querySelectorAll("a.yt"));
      const hrefs = dedupe(links.map((x) => x.href).filter(Boolean));
      let start = hrefs.indexOf(a.href);
      if (start < 0) start = 0;

      if (!hrefs.length) { player.open(a.href); return; }

      const mix = isMixRadioOn();
      player.openQueue(hrefs, { startIndex: start, shuffle: mix, loop: mix });
      return;
    }
    const zoomImg = e.target.closest(".amodal__img");
    if (zoomImg) {
      try { UISound?.tap?.(); } catch {}
      const src =
        zoomImg.currentSrc ||
        zoomImg.getAttribute("src") ||
        zoomImg.getAttribute("data-src") ||
        "";
      openZoom(src, zoomImg.getAttribute("alt") || "");
    }
  });

  async function render(artistId) {
    const cached = getPrefetched?.(String(artistId));

    const [artist, albums] = await Promise.all([
      cached?.artist ?? fetchArtist(artistId).catch(() => null),
      cached?.albums ?? fetchArtistAlbums(artistId).catch(() => []),
    ]);

    const d = artist || {};
    const name    = d.name || d.strArtist || "Unknown artist";
    const img     = d.image || d.strArtistThumb || FALLBACK_IMG;
    const country = d.country || d.strCountry || "N/A";
    const members = d.members || d.intMembers || "N/A";
    const sex     = d.gender  || d.strGender  || "N/A";
    const bio     = d.biography || d.strBiographyEN || "";
    const genres  = Array.isArray(d.genres) ? d.genres :
                    (d.genre ? [d.genre] : []);

    const albumsArr = Array.isArray(albums) ? albums : [];
    const albumsMarkup = albumsArr.map(alb => {
      const title  = alb?.title || alb?.strAlbum || alb?.name || "Album";
      const tracks = Array.isArray(alb?.tracks) ? alb.tracks :
                     (Array.isArray(alb?.songs) ? alb.songs : []);
      return `
        <div class="am-album">
          <div class="am-album__title">${title}</div>
          <ul class="tbl">
            <li class="th"><span>Track</span><span>Time</span><span>Link</span></li>
            ${tracks.map(trackRow).join("")}
          </ul>
        </div>`;
    }).join("");

    modalBody.innerHTML = `
      <h3 class="amodal__title">${name}</h3>

      <div class="amodal__content">
        <img class="amodal__img" src="${img}" alt="${name}" loading="lazy"
             onerror="this.onerror=null;this.src='${FALLBACK_IMG}'">
        <div class="amodal__info">
          <div class="am-meta">
            <div class="am-meta__col">
              <div class="am-meta__item"><span class="lbl">Years active</span><span class="val">${years(d)}</span></div>
              <div class="am-meta__item"><span class="lbl">Sex</span><span class="val">${sex}</span></div>
            </div>
            <div class="am-meta__col">
              <div class="am-meta__item"><span class="lbl">Members</span><span class="val">${members}</span></div>
              <div class="am-meta__item"><span class="lbl">Country</span><span class="val">${country}</span></div>
            </div>
          </div>

          <div class="am-bio">
            <div class="lbl">Biography</div>
            <p>${bio || "—"}</p>
          </div>

          ${genres.length ? `<div class="am-tags">${genres.map(g => `<span class="tag">${g}</span>`).join("")}</div>` : ""}
        </div>
      </div>

      <h4 class="amodal__albums-title">Albums</h4>
      <div class="amodal__albums">
        ${albumsMarkup || "<p class='muted'>No albums found for this artist.</p>"}
      </div>`;
  }

  async function openFor(id) {
    try { UISound?.tap?.(); } catch {}
    open();
    await render(id);
  }

  return { openFor, close };
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/player-patch.js

**size:** 7661 bytes &nbsp;&nbsp; **sha1:** `047646082143b5815c8006f9ae046de4106d082a`

```javascript
/*
  player-patch.js — patch-v1.4.0-2025-09-09
  Мост assistant:* ↔ публичное API плеера.
  Важно: не ломаем контракт событий и Player API.
*/

export default function mountPlayerPatch(player) {
  try { window.__AM_PLAYER_PATCH_INSTALLED__ = true; } catch {}

  if (!player || typeof player !== "object") {
    console.warn("[player-patch] No player instance provided");
    return;
  }

  const clamp01 = (x) => Math.max(0, Math.min(1, Number(x) || 0));

  // Разбор ID/URL
  function toVideoId(urlOrId) {
    const s = String(urlOrId || "").trim();
    if (!s) return "";
    if (/^[A-Za-z0-9_-]{11}$/.test(s)) return s;
    try {
      const u = new URL(s, location.href);
      if (/(^|\.)youtu\.be$/i.test(u.hostname)) {
        const cand = u.pathname.replace(/^\/+/, "");
        return /^[A-Za-z0-9_-]{11}$/.test(cand) ? cand : "";
      }
      const v = u.searchParams.get("v");
      if (v && /^[A-Za-z0-9_-]{11}$/.test(v)) return v;
      const m = u.pathname.match(/\/(?:embed|v|shorts)\/([^/?#]+)/i);
      if (m && m[1] && /^[A-Za-z0-9_-]{11}$/.test(m[1])) return m[1];
    } catch {}
    return "";
  }

  const MIX_SEEDS = [
    "random music mix",
    "popular hits playlist",
    "indie rock mix",
    "classic rock hits",
    "lofi chill beats to relax",
    "jazz essentials playlist",
    "hip hop classic mix",
    "ambient focus music long"
  ];

  const call = (name, ...args) => {
    const fn = player?.[name];
    if (typeof fn === "function") {
      try { return fn.apply(player, args); }
      catch (e) { console.warn(`[player-patch] ${name} failed`, e); }
    }
  };

  // Антидубль
  const recently = new Map();
  function dedup(key, ttl = 350) {
    const now = Date.now();
    const last = recently.get(key) || 0;
    if (now - last < ttl) return true;
    recently.set(key, now);
    return false;
  }

  // === PLAY ===
  window.addEventListener("assistant:play", (e) => {
    const rawId  = e?.detail?.id ?? "";
    const query  = e?.detail?.query ?? "";
    const key    = "play|" + JSON.stringify({ rawId, query });
    if (dedup(key)) return;

    const vid = toVideoId(rawId);
    if (vid) {
      call("open", vid);
    } else if (query && player.playSearch) {
      call("playSearch", String(query));
    } else if (rawId) {
      call("playSearch", String(rawId));
    }
  });

  // === MIXRADIO ===
  window.addEventListener("assistant:mixradio", () => {
    if (document.querySelector("#random-radio")) return;
    const seed = MIX_SEEDS[(Math.random() * MIX_SEEDS.length) | 0];
    if (player.playSearch) call("playSearch", seed);
  });

  // === TRANSPORT ===
  window.addEventListener("assistant:player-play",  () => call("play"));
  window.addEventListener("assistant:player-pause", () => call("pause"));
  window.addEventListener("assistant:player-stop",  () => call("stop"));
  window.addEventListener("assistant:player-next",  () => call("next"));
  window.addEventListener("assistant:player-prev",  () => call("prev"));

  // === UI ===
  window.addEventListener("assistant:minimize", () => call("minimize"));
  window.addEventListener("assistant:expand",   () => call("expand"));

  // === ГРОМКОСТЬ ===
  window.addEventListener("assistant:volume", (e) => {
    const d = Number(e?.detail?.delta || 0);
    if (!Number.isFinite(d)) return;
    if (typeof player.getVolume === "function" && typeof player.setVolume === "function") {
      const cur = Number(player.getVolume() || 0);
      call("setVolume", clamp01(cur + d));
    }
  });

  // === RECOMMEND (autoplay) ===
  window.addEventListener("assistant:recommend", (e) => {
    const a = e?.detail || {};
    if (!a || a.autoplay !== true) return;

    const looksLikeTrack = (s) => {
      const t = String(s || "").toLowerCase();
      return /["«»“”„‟]/.test(s) || t.includes(' - ') || /(official|audio|video|lyrics|remaster)/.test(t);
    };

    let q = "";
    if (a.like) {
      const like = String(a.like).trim();
      if (!like) return;
      // если похоже на конкретный трек → одиночный трек
      // иначе — хиты артиста (плейлист)
      q = looksLikeTrack(like)
        ? `${like} official audio`
        : `${like} greatest hits playlist`;
    } else if (a.genre) {
      const map = new Map([
        ["джаз", "best jazz music relaxing"],
        ["рок", "classic rock hits"],
        ["поп", "pop hits playlist"],
        ["электрон", "edm house techno mix"],
        ["lofi", "lofi hip hop radio"],
        ["классик", "classical symphony playlist"],
        ["рэп", "hip hop playlist"],
        ["инди", "indie rock playlist"],
        ["ambient", "ambient music long playlist"],
        ["блюз", "best blues songs playlist"],
        ["шансон", "russian chanson mix"],
        ["folk", "folk acoustic playlist"],
        ["rnb", "rnb soul classics playlist"],
        ["latin", "latin hits playlist"],
        ["reggae", "best reggae mix"],
        ["k-pop", "kpop hits playlist"],
        ["j-pop", "jpop hits playlist"],
        ["soundtrack", "movie soundtrack playlist"]
      ]);
      q = map.get(String(a.genre).toLowerCase()) || `${a.genre} music playlist`;
    } else if (a.mood) {
      const moods = new Map([
        ["happy", "upbeat feel good hits"],
        ["calm", "chillout ambient relaxing playlist"],
        ["sad", "sad indie playlist"],
        ["energetic", "energetic edm gym playlist"]
      ]);
      q = moods.get(String(a.mood).toLowerCase()) || "music playlist";
    }

    if (q && player.playSearch) call("playSearch", q);
  });

  // Совместимость doc→win, если нет внешнего bridge
  if (!(typeof window !== 'undefined' && window.__AH_BRIDGE_PRESENT === true)) {
    document.addEventListener("assistant:play",       (e) => window.dispatchEvent(new CustomEvent("assistant:play",       { detail: e.detail })));
    document.addEventListener("assistant:mixradio",   (e) => window.dispatchEvent(new CustomEvent("assistant:mixradio",   { detail: e.detail })));
    document.addEventListener("assistant:player-play",(e) => window.dispatchEvent(new CustomEvent("assistant:player-play",{ detail: e.detail })));
    document.addEventListener("assistant:player-pause",(e)=> window.dispatchEvent(new CustomEvent("assistant:player-pause",{ detail: e.detail })));
    document.addEventListener("assistant:player-stop",(e) => window.dispatchEvent(new CustomEvent("assistant:player-stop",{ detail: e.detail })));
    document.addEventListener("assistant:player-next",(e) => window.dispatchEvent(new CustomEvent("assistant:player-next",{ detail: e.detail })));
    document.addEventListener("assistant:player-prev",(e) => window.dispatchEvent(new CustomEvent("assistant:player-prev",{ detail: e.detail })));
    document.addEventListener("assistant:minimize",   (e) => window.dispatchEvent(new CustomEvent("assistant:minimize",   { detail: e.detail })));
    document.addEventListener("assistant:expand",     (e) => window.dispatchEvent(new CustomEvent("assistant:expand",     { detail: e.detail })));
    document.addEventListener("assistant:volume",     (e) => window.dispatchEvent(new CustomEvent("assistant:volume",     { detail: e.detail })));
    document.addEventListener("assistant:recommend",  (e) => window.dispatchEvent(new CustomEvent("assistant:recommend",  { detail: e.detail })));
  }
}


```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/player.js

**size:** 36050 bytes &nbsp;&nbsp; **sha1:** `76631a3becc3a7971606ebeeb94fe193b868b66f`

```javascript
/* eslint-env browser */
/* global YT */

/**
 * Mini YouTube player (superset, v2.3.6)
 *
 * Что нового vs 2.3.5:
 * - Больше не передаём videoId в конструктор, если его нет (фикс "Invalid video id").
 * - Не передаём playerVars.origin, если origin === "null"/file://.
 * - В searchMode используем host https://www.youtube.com (а не nocookie) — стабильнее для listType:"search".
 * - Таймер прогресса работает без проверки ready; duration подтягивается на PLAYING.
 * - При переключении loadVideoById() не сбивает ready, не пересоздаёт iframe лишний раз.
 * - Autoplay helper: на старте делаем soft-автозапуск через mute→play, с безопасными повторными попытками.
 * - Stuck-guard: если PLAYING, но прогресс «не едет» — форсируем next(); ротация запросов в searchMode.
 * - Smart next: для одиночного видео без очереди — ре-поиск по артисту.
 * - Глобалка window.Player для консоли.
 */

let _instance = null;

/* -------------------- Debug -------------------- */
function dbg(...a) {
  try {
    if (typeof window !== 'undefined' && window.__AM_DEBUG__ === true) {
      // eslint-disable-next-line no-console
      console.log('[player]', ...a);
    }
  } catch {}
}

/* -------------------- Events -------------------- */
function emit(name, detail = {}) {
  try { window.dispatchEvent(new CustomEvent(`AM.player.${name}`, { detail })); } catch {}
}

/* -------------------- YT API -------------------- */
function loadYTAPI() {
  if (window.YT && window.YT.Player) return Promise.resolve();
  if (loadYTAPI._p) return loadYTAPI._p;
  loadYTAPI._p = new Promise((res, rej) => {
    const s = document.createElement("script");
    s.src = "https://www.youtube.com/iframe_api";
    s.onerror = () => rej(new Error("YT API load failed"));
    document.head.appendChild(s);
    const t = setTimeout(() => rej(new Error("YT API timeout")), 15000);
    window.onYouTubeIframeAPIReady = () => { clearTimeout(t); res(); };
  });
  return loadYTAPI._p;
}

const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

function getYouTubeId(urlOrId) {
  if (!urlOrId) return "";
  const s = String(urlOrId).trim();
  if (/^[A-Za-z0-9_-]{11}$/.test(s)) return s;
  try {
    const u = new URL(s, location.href);
    if (/(^|\.)youtu\.be$/i.test(u.hostname)) {
      const cand = u.pathname.replace(/^\/+/, "");
      return /^[A-Za-z0-9_-]{11}$/.test(cand) ? cand : "";
    }
    const v = u.searchParams.get("v");
    if (v && /^[A-Za-z0-9_-]{11}$/.test(v)) return v;
    const m = u.pathname.match(/\/(?:embed|shorts|v)\/([^/?#]+)/i);
    if (m && m[1] && /^[A-Za-z0-9_-]{11}$/.test(m[1])) return m[1];
  } catch {}
  return "";
}
const clamp = (v, a, b) => Math.min(b, Math.max(a, v));
const shuffleArr = (arr) => {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = (Math.random() * (i + 1)) | 0;
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
};
function fmtTimeSec(sec) {
  sec = Math.max(0, Math.round(Number(sec) || 0));
  const m = Math.floor(sec / 60);
  const s = String(sec % 60).padStart(2, "0");
  return `${m}:${s}`;
}

/* -------------------- Server search -------------------- */
const API_BASE =
  (import.meta?.env?.VITE_API_URL && import.meta.env.VITE_API_URL.replace(/\/+$/, "")) ||
  (location.hostname === "localhost" ? "http://localhost:8787" : "");

async function fetchYTSearchIds(q, max = 25) {
  if (!API_BASE) return [];
  try {
    const r = await fetch(`${API_BASE}/api/yt/search`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ q, max })
    });
    if (!r.ok) return [];
    const j = await r.json();
    const ids = Array.isArray(j?.ids) ? j.ids.filter(x => /^[A-Za-z0-9_-]{11}$/.test(x)) : [];
    dbg('server-search ids:', ids.length);
    return ids;
  } catch (e) {
    dbg('server-search error', e);
    return [];
  }
}

/* -------------------- Exported factory -------------------- */
export function createMiniPlayer() {
  if (_instance) return _instance;

  /* ---------- DOM ---------- */
  const dock = document.createElement("div");
  dock.className = "am-player";
  dock.innerHTML = `
    <div class="am-player__inner">
      <div class="am-player__dragzone" aria-hidden="true" title="Drag the player"></div>
      <button class="am-player__hide" type="button" aria-label="Hide">Hide</button>
      <button class="am-player__close" type="button" aria-label="Close">×</button>

      <div class="am-player__frame">
        <div class="am-player__host" id="am-player-host"></div>
        <a class="am-player__ytlink" href="#" target="_blank" rel="noopener noreferrer" aria-label="Open on YouTube">YouTube ↗</a>
      </div>

      <div class="am-player__bar">
        <div class="am-player__left">
          <button class="am-player__skip am-player__prev" type="button" aria-label="Previous">⏮</button>
          <button class="am-player__play" type="button" aria-label="Play/Pause">▶</button>
          <button class="am-player__skip am-player__next" type="button" aria-label="Next">⏭</button>
          <span class="am-player__time"><span class="am-player__cur">0:00</span> / <span class="am-player__dur">0:00</span></span>
        </div>

        <div class="am-player__progresswrap">
          <input class="am-player__progress" type="range" min="0" max="1000" value="0" step="1" aria-label="Seek">
        </div>

        <div class="am-player__right">
          <button class="am-player__mute" type="button" aria-label="Mute/Unmute">🔈</button>
          <input class="am-player__slider" type="range" min="0" max="100" value="60" step="1" aria-label="Volume">
        </div>
      </div>
    </div>
  `;
  document.body.appendChild(dock);

  let bubble = null;

  // refs
  const host     = dock.querySelector("#am-player-host");
  const btnClose = dock.querySelector(".am-player__close");
  const btnHide  = dock.querySelector(".am-player__hide");
  const btnPlay  = dock.querySelector(".am-player__play");
  const btnPrev  = dock.querySelector(".am-player__prev");
  const btnNext  = dock.querySelector(".am-player__next");
  const btnMute  = dock.querySelector(".am-player__mute");
  const vol      = dock.querySelector(".am-player__slider");
  const prog     = dock.querySelector(".am-player__progress");
  const tCur     = dock.querySelector(".am-player__cur");
  const tDur     = dock.querySelector(".am-player__dur");
  const dragzone = dock.querySelector(".am-player__dragzone");
  const aYTlink  = dock.querySelector(".am-player__ytlink");

  /* ---------- state ---------- */
  let yt = null;
  let ready = false;            // логический ready экземпляра
  let duration = 0;
  let timer = null;
  let muted = false;
  let volVal = 60;
  let userSeeking = false;

  let queue = [];
  let qi = -1;
  let loop = false;

  // searchMode — при фоллбэке на YT search playlist
  let searchMode = false;

  // анти-зацикливание / stuck-control
  let lastVidId = null;
  let sameIdPlays = 0;
  let lastQuery = '';
  let variantIndex = 0;
  let stuckTimer = null;
  let lastProgressT = 0;
  let lastProgressV = 0;

  // autoplay helper
  let autoplayTimer = null;

  const DOCK_KEY = "amPlayerPos";
  let dockDrag = null;

  const BUBBLE_KEY = "amBubblePos2";
  let bubbleDragging = false;
  let bubbleStart = null;
  let _bubblePos = null;

  let recentBubbleDrag = false;
  let watchdogId = null;
  let searchWatchdogId = null;

  if (isIOS) {
    vol.disabled = true;
    vol.title = "On iOS the volume is hardware-only";
  }

  /* ---------- UI helpers ---------- */
  function showBubble(useSaved = true) {
    if (!bubble) {
      bubble = document.createElement("button");
      bubble.className = "am-player__bubble is-paused";
      bubble.type = "button";
      bubble.setAttribute("aria-label", "Open player");
      bubble.style.display = "none";
      bubble.innerHTML = `<span class="note">♪</span>`;
      document.body.appendChild(bubble);

      bubble.addEventListener("click", (e) => {
        if (recentBubbleDrag) {
          recentBubbleDrag = false;
          e.preventDefault();
          e.stopPropagation();
          return;
        }
        uiMin(false);
      });

      bubble.addEventListener("pointerdown", (e) => {
        bubbleDragging = false;
        recentBubbleDrag = false;
        try { bubble.setPointerCapture(e.pointerId); } catch {}
        const r = bubble.getBoundingClientRect();
        bubbleStart = { x: e.clientX, y: e.clientY, left: r.left, top: r.top };
      });
      bubble.addEventListener("pointermove", (e) => {
        if (!bubbleStart) return;
        const dx = e.clientX - bubbleStart.x;
        const dy = e.clientY - bubbleStart.y;
        if (Math.abs(dx) + Math.abs(dy) > 3) bubbleDragging = true;
        bubble.style.left = `${(bubbleStart.left + dx) | 0}px`;
        bubble.style.top  = `${(bubbleStart.top  + dy) | 0}px`;
      });
      bubble.addEventListener("pointerup", (e) => {
        try { bubble.releasePointerCapture(e.pointerId); } catch {}
        recentBubbleDrag = !!bubbleDragging;
        bubbleStart = null;
        bubbleDragging = false;
        clampBubbleToViewport(); persistBubblePos();
      });
      bubble.addEventListener("pointercancel", () => {
        recentBubbleDrag = !!bubbleDragging;
        bubbleStart = null;
        bubbleDragging = false;
      });
      window.addEventListener("resize", () => { clampBubbleToViewport(); persistBubblePos(); });
      window.visualViewport?.addEventListener("resize", () => { clampBubbleToViewport(); persistBubblePos(); });
      window.addEventListener("orientationchange", () => { clampBubbleToViewport(); persistBubblePos(); });
    }
    bubble.style.display = "grid";
    restoreBubblePos(useSaved);
  }
  function hideBubble() { if (bubble) bubble.style.display = "none"; }
  function setBubblePulse(isPlaying) {
    if (!bubble) return;
    bubble.classList.toggle("is-paused", !isPlaying);
  }
  function setBubbleAmp(v) {
    if (!bubble) return;
    const amp = 1.02 + (Math.max(0, Math.min(100, v)) / 100) * 0.08;
    bubble.style.setProperty("--amp", amp.toFixed(3));
  }
  function clampBubbleToViewport(margin = 8) {
    if (!bubble || bubble.style.display === "none") return;
    const w = window.innerWidth, h = window.innerHeight;
    const r = bubble.getBoundingClientRect();
    let left = clamp(r.left, margin, Math.max(margin, w - r.width - margin));
    let top  = clamp(r.top,  margin, Math.max(margin, h - r.height - margin));
    bubble.style.left = `${left}px`;
    bubble.style.top  = `${top}px`;
  }
  function persistBubblePos() {
    if (!bubble || bubble.style.display === "none") return;
    const r = bubble.getBoundingClientRect();
    const w = Math.max(1, window.innerWidth  - r.width);
    const h = Math.max(1, window.innerHeight - r.height);
    _bubblePos = { rx: clamp(r.left / w, 0, 1), ry: clamp(r.top / h, 0, 1) };
    try { localStorage.setItem(BUBBLE_KEY, JSON.stringify(_bubblePos)); } catch {}
  }
  function restoreBubblePos(useSaved = true) {
    if (!bubble) return;
    const r0 = bubble.getBoundingClientRect();
    let left, top;
    if (useSaved) {
      try {
        const pos = JSON.parse(localStorage.getItem(BUBBLE_KEY) || "null");
        if (pos && Number.isFinite(pos.rx) && Number.isFinite(pos.ry)) {
          const w = Math.max(1, window.innerWidth  - r0.width);
          const h = Math.max(1, window.innerHeight - r0.height);
          left = clamp(Math.round(pos.rx * w), 8, w);
          top  = clamp(Math.round(pos.ry * h), 8, h);
        }
      } catch {}
    }
    if (!Number.isFinite(left) || !Number.isFinite(top)) {
      const w = window.innerWidth, h = window.innerHeight;
      const size = r0.width || 64;
      left = Math.max(8, Math.round((w - size) / 2));
      top  = Math.max(8, Math.round(h - size - 24));
    }
    bubble.style.left = `${left}px`;
    bubble.style.top  = `${top}px`;
    clampBubbleToViewport();
  }

  function uiPlayIcon(isPlaying) { btnPlay.textContent = isPlaying ? "⏸" : "▶"; }
  function uiMuteIcon(isMuted)   { btnMute.textContent = isMuted ? "🔇" : "🔈"; }

  function uiShow(on) {
    dock.classList.toggle("am-player--active", !!on);
    const isMin = dock.classList.contains("am-player--min");
    if (on) {
      if (!isMin) hideBubble();
    } else {
      hideBubble();
    }
    emit("state", { active: !!on });
  }
  function uiMin(on) {
    dock.classList.toggle("am-player--min", !!on);
    if (on) showBubble(true);
    else hideBubble();
    emit(on ? "minimized" : "expanded", {});
  }

  function uiSetTime(cur, dur) {
    tCur.textContent = fmtTimeSec(cur);
    tDur.textContent = fmtTimeSec(dur);
    if (!userSeeking) {
      const v = dur > 0 ? Math.round((cur / dur) * 1000) : 0;
      prog.value = String(v);
    }
  }
  function clearTimer() { if (timer) { clearInterval(timer); timer = null; } }
  function startTimer() {
    clearTimer();
    timer = setInterval(() => {
      if (!yt || typeof yt.getCurrentTime !== "function") return;
      const cur = yt.getCurrentTime() || 0;
      const d = (typeof yt.getDuration === "function" ? yt.getDuration() : 0) || duration || 0;
      if (d > 0) duration = d;
      uiSetTime(cur, duration);
      lastProgressT = Date.now();
      lastProgressV = cur;
    }, 250);
  }
  function clearWatchdog() { if (watchdogId) { clearTimeout(watchdogId); watchdogId = null; } }
  function clearSearchWatch() { if (searchWatchdogId) { clearTimeout(searchWatchdogId); searchWatchdogId = null; } }
  function clearStuckGuard() { if (stuckTimer) { clearTimeout(stuckTimer); stuckTimer = null; } }
  function clearAutoplayTimer() { if (autoplayTimer) { clearTimeout(autoplayTimer); autoplayTimer = null; } }

  /* ---------- playlist hydrate ---------- */
  function hydrateFromYTPlaylist() {
    if (searchMode) return;
    if (!yt || typeof yt.getPlaylist !== "function") return;
    try {
      const pl = yt.getPlaylist() || [];
      if (Array.isArray(pl) && pl.length) {
        queue = pl.slice();
        qi = typeof yt.getPlaylistIndex === "function" ? (yt.getPlaylistIndex() | 0) : 0;
      }
    } catch {}
  }

  /* ---------- stuck helpers ---------- */
  const VARIANTS = (base) => [
    `${base} official audio`,
    `${base} greatest hits playlist`,
    `${base} mix`,
    `${base}`
  ];

  function armStuckGuard() {
    clearStuckGuard();
    stuckTimer = setTimeout(() => {
      try {
        const s = yt?.getPlayerState?.();
        const cur = yt?.getCurrentTime?.() || 0;
        const idle = Date.now() - (lastProgressT || 0);
        if (s === YT.PlayerState.PLAYING && idle > 6000 && Math.abs(cur - (lastProgressV || 0)) < 1) {
          dbg('stuck-guard: forcing next');
          if (searchMode) yt?.nextVideo?.(); else smartNextFromCurrent();
        }
      } catch {}
    }, 7000);
  }

  function markIdAndMaybeRotate(id) {
    if (!id) return;
    if (id === lastVidId) sameIdPlays++;
    else { lastVidId = id; sameIdPlays = 1; }
    dbg('PLAYING id:', id, 'same plays:', sameIdPlays, 'searchMode:', searchMode);

    if (searchMode && sameIdPlays >= 3) {
      sameIdPlays = 0;
      dbg('dup id → next/rotate');
      yt?.nextVideo?.();
      setTimeout(() => {
        try {
          const curId = yt?.getVideoData?.()?.video_id || '';
          if (curId === id && lastQuery) {
            variantIndex = (variantIndex + 1) % VARIANTS(lastQuery).length;
            const alt = VARIANTS(lastQuery)[variantIndex];
            dbg('rotate variant →', alt);
            playSearch(alt);
          }
        } catch {}
      }, 1200);
    }
  }

  /* ---------- autoplay helper ---------- */
  function tryAutoplaySoft() {
    clearAutoplayTimer();
    autoplayTimer = setTimeout(() => {
      try {
        const st = yt?.getPlayerState?.();
        if (st !== YT.PlayerState.PLAYING) {
          // soft-автостарт: mute → play
          const wasMuted = yt?.isMuted?.() || false;
          yt?.mute?.();
          yt?.playVideo?.();
          setTimeout(() => { if (!wasMuted) yt?.unMute?.(); }, 600);
        }
      } catch {}
    }, 450);
  }

  /* ---------- YT ---------- */
  function skipWithDelay(ms = 2000) { setTimeout(autoNext, ms); }

  function currentHostForMode() {
    // searchMode требует обычный youtube-хост
    return searchMode ? "https://www.youtube.com" : "https://www.youtube-nocookie.com";
  }

  function safePlayerVars(hasInitialId) {
    const pv = {
      rel: 0,
      modestbranding: 1,
      controls: 1,
      enablejsapi: 1
    };
    // autoplay в конструкторе — только если есть валидный id
    if (hasInitialId) pv.autoplay = 1;

    // origin не указываем на file:// и "null"
    try {
      const isFile = location.protocol === 'file:' || location.origin === 'null';
      if (!isFile) pv.origin = location.origin;
    } catch {}
    return pv;
  }

  async function ensureYT(initialVideoId) {
    await loadYTAPI();

    // Если уже есть плеер, но хост не совпадает с нужным для режима — пересоздадим
    const needHost = currentHostForMode();
    const mustRecreate = !yt || !yt?.getIframe || (() => {
      try {
        const iframe = yt.getIframe();
        const url = new URL(iframe?.src || '', location.href);
        return !url.origin || !url.origin.startsWith(needHost);
      } catch { return true; }
    })();

    if (mustRecreate) {
      if (yt) { try { yt.destroy(); } catch {} yt = null; }
      host.innerHTML = `<div id="am-player-yt"></div>`;
      const cfg = {
        host: needHost,
        playerVars: safePlayerVars(!!initialVideoId),
        events: {
          onReady: () => {
            ready = true;
            duration = yt.getDuration?.() || 0;
            uiSetTime(0, duration);
            if (!isIOS && typeof yt.setVolume === "function") yt.setVolume(volVal);
            if (muted && yt.mute) yt.mute();
            uiPlayIcon(!!initialVideoId);
            setBubblePulse(!!initialVideoId);
            setBubbleAmp(volVal);
            startTimer();
            emit("ready", {});
            armStuckGuard();
            tryAutoplaySoft();

            clearWatchdog();
            if (initialVideoId) {
              watchdogId = setTimeout(() => {
                try {
                  if (yt && yt.getPlayerState && yt.getPlayerState() !== YT.PlayerState.PLAYING) {
                    setBubblePulse(false);
                    skipWithDelay(0);
                  }
                } catch {}
              }, 6000);
            }
          },
          onStateChange: (e) => {
            emit("state", { state: e.data });

            if (e.data === YT.PlayerState.PLAYING) {
              clearWatchdog();
              clearSearchWatch();
              clearStuckGuard();
              clearAutoplayTimer();
              uiPlayIcon(true);
              setBubblePulse(true);
              // duration часто инициализируется только тут
              const d = yt.getDuration?.() || 0;
              if (d > 0) duration = d;
              startTimer();
              try {
                const url = yt.getVideoUrl?.();
                if (url) aYTlink.href = url;
                const vd = yt.getVideoData?.();
                if (vd && vd.video_id) {
                  emit("track", { id: vd.video_id, title: vd.title || "" });
                  markIdAndMaybeRotate(vd.video_id);
                }
                hydrateFromYTPlaylist();
              } catch {}
            } else if (e.data === YT.PlayerState.PAUSED) {
              uiPlayIcon(false);
              setBubblePulse(false);
              clearTimer();
              emit("pause", {});
            } else if (e.data === YT.PlayerState.ENDED) {
              uiPlayIcon(false);
              setBubblePulse(false);
              clearTimer();
              clearWatchdog();
              clearStuckGuard();
              clearAutoplayTimer();
              emit("ended", {});
              if (window.__AM_SLEEP_AFTER__) {
                try { window.__AM_SLEEP_AFTER__ = false; } catch {}
                stop();
                return;
              }
              autoNext();
            }
          },
          // ⬇⬇⬇ ИЗМЕНЕНО: обработка ошибок с мгновенным skip для embed-кодов 2/5/100/101/150
          onError: (e) => {
            const code = (e && (e.data ?? e.code)) ?? 0;
            emit("error", { code });
            dbg('YT error', code, e);
            uiPlayIcon(false);
            setBubblePulse(false);
            clearTimer();
            clearWatchdog();
            clearSearchWatch();
            clearStuckGuard();
            clearAutoplayTimer();

            // Эти коды почти всегда означают "невстраиваемо/заблокировано"
            if ([2, 5, 100, 101, 150].includes(code)) {
              try {
                if (searchMode) { yt?.nextVideo?.(); } else { next(); }
              } catch {
                skipWithDelay(0);
              }
              return;
            }

            // Прочие ошибки — мягкий skip с небольшой задержкой
            skipWithDelay(1200);
          }
          // ▲▲▲ КОНЕЦ ИЗМЕНЕНИЙ
        }
      };
      // Добавляем videoId ТОЛЬКО если он валидный
      if (initialVideoId && /^[\w-]{11}$/.test(initialVideoId)) {
        cfg.videoId = initialVideoId;
        cfg.playerVars.autoplay = 1;
      }
      yt = new YT.Player("am-player-yt", cfg);
    } else {
      // Плеер уже подходящий — просто убедимся что ready и таймер крутится
      ready = true;
      startTimer();
      tryAutoplaySoft();
    }
  }

  /* ---------- Queue ---------- */
  async function playByIndex(idx, opts = {}) {
    if (!queue.length) return;

    // Явный переход по индексам — это локальная очередь → выключаем searchMode
    searchMode = false;

    qi = clamp(idx, 0, queue.length - 1);
    const id = queue[qi];
    if (!id || !/^[\w-]{11}$/.test(id)) {
      return skipWithDelay(0);
    }
    aYTlink.href = `https://www.youtube.com/watch?v=${id}`;

    const reveal = opts.reveal ?? true;
    if (reveal) {
      uiMin(false);
      uiShow(true);
      restoreDockPos();
    } else {
      if (!dock.classList.contains("am-player--active")) uiShow(true);
    }

    duration = 0; clearTimer(); clearWatchdog(); clearStuckGuard(); clearAutoplayTimer();
    try {
      await ensureYT(null); // НЕ передаём videoId здесь, будем грузить loadVideoById
      ready = true;
      yt.loadVideoById({ videoId: id });
      tryAutoplaySoft();
    } catch { skipWithDelay(1200); }
  }

  function autoNext() {
    if (queue.length && !searchMode) {
      if (qi < queue.length - 1) playByIndex(qi + 1, { reveal: false });
      else if (loop) playByIndex(0, { reveal: false });
      else if (yt && yt.nextVideo) yt.nextVideo();
    } else if (yt && yt.nextVideo) {
      yt.nextVideo();
      armStuckGuard();
    }
  }

  /* ---------- Drag Dock ---------- */
  function getVP() {
    const w = window.visualViewport?.width || document.documentElement.clientWidth || window.innerWidth;
    const h = window.visualViewport?.height || document.documentElement.clientHeight || window.innerHeight;
    return { w, h };
  }
  function clampDock() {
    if (!dock.classList.contains("am-player--free")) return;
    const rect = dock.getBoundingClientRect();
    const { w, h } = getVP();
    let left = clamp(rect.left, 8, Math.max(8, w - rect.width - 8));
    let top  = clamp(rect.top,  8, Math.max(8, h - rect.height - 8));
    dock.style.left = `${left}px`;
    dock.style.top  = `${top}px`;
    try { localStorage.setItem(DOCK_KEY, JSON.stringify({ left, top })); } catch {}
  }
  function restoreDockPos() {
    let pos = null;
    try { pos = JSON.parse(localStorage.getItem(DOCK_KEY) || "null"); } catch {}
    if (pos && Number.isFinite(pos.left) && Number.isFinite(pos.top)) {
      dock.classList.add("am-player--free");
      dock.style.transform = "none";
      dock.style.left = `${pos.left}px`;
      dock.style.top  = `${pos.top}px`;
      dock.style.right = "auto";
      dock.style.bottom = "auto";
      clampDock();
    } else {
      dock.classList.remove("am-player--free");
      dock.style.left = dock.style.top = dock.style.right = dock.style.bottom = "";
      dock.style.transform = "";
    }
  }
  function beginDockDrag(e) {
    if (!dock.classList.contains("am-player--free")) {
      const r = dock.getBoundingClientRect();
      dock.classList.add("am-player--free");
      dock.style.transform = "none";
      dock.style.left = `${r.left}px`;
      dock.style.top  = `${r.top}px`;
      dock.style.right = "auto";
      dock.style.bottom = "auto";
    }
    dockDrag = {
      startX: e.clientX,
      startY: e.clientY,
      baseLeft: parseFloat(dock.style.left || "0"),
      baseTop:  parseFloat(dock.style.top || "0"),
    };
    dragzone.classList.add("dragging");
    try { dragzone.setPointerCapture?.(e.pointerId); } catch {}
  }
  function moveDockDrag(e) {
    if (!dockDrag) return;
    let left = dockDrag.baseLeft + (e.clientX - dockDrag.startX);
    let top  = dockDrag.baseTop  + (e.clientY - dockDrag.startY);
    const r = dock.getBoundingClientRect();
    const { w, h } = getVP();
    left = clamp(left, 8, Math.max(8, w - r.width - 8));
    top  = clamp(top,  8, Math.max(8, h - r.height - 8));
    dock.style.left = `${left}px`;
    dock.style.top  = `${top}px`;
  }
  function endDockDrag(e) {
    if (!dockDrag) return;
    try { dragzone.releasePointerCapture?.(e.pointerId); } catch {}
    dragzone.classList.remove("dragging");
    dockDrag = null;
    clampDock();
  }
  dragzone.addEventListener("pointerdown", beginDockDrag);
  window.addEventListener("pointermove", moveDockDrag);
  window.addEventListener("pointerup", endDockDrag);
  window.addEventListener("resize", clampDock);
  window.visualViewport?.addEventListener("resize", clampDock);
  window.addEventListener("orientationchange", clampDock);

  /* ---------- Buttons ---------- */
  btnClose.addEventListener("click", () => {
    try { yt?.stopVideo?.(); yt?.destroy?.(); } catch {}
    yt = null; ready = false; duration = 0; clearTimer(); clearWatchdog(); clearSearchWatch(); clearStuckGuard(); clearAutoplayTimer();
    uiShow(false); uiMin(false);
    queue = []; qi = -1;
    searchMode = false;
    lastVidId = null; sameIdPlays = 0; lastQuery = ''; variantIndex = 0;
    setBubblePulse(false);
  });
  btnHide.addEventListener("click", () => { uiMin(true); });

  aYTlink.addEventListener("click", () => {
    try { yt?.stopVideo?.(); yt?.destroy?.(); } catch {}
    yt = null; ready = false; duration = 0; clearTimer(); clearWatchdog(); clearSearchWatch(); clearStuckGuard(); clearAutoplayTimer();
    uiShow(false); uiMin(false);
    queue = []; qi = -1;
    searchMode = false;
    lastVidId = null; sameIdPlays = 0; lastQuery = ''; variantIndex = 0;
    setBubblePulse(false);
  });

  btnPlay.addEventListener("click", () => {
    if (!yt) return;
    const s = yt.getPlayerState ? yt.getPlayerState() : -1;
    if (s === YT.PlayerState.PLAYING) { yt.pauseVideo?.(); uiPlayIcon(false); setBubblePulse(false); }
    else { yt.playVideo?.(); uiPlayIcon(true); setBubblePulse(true); armStuckGuard(); }
  });
  btnPrev.addEventListener("click", () => {
    if (queue.length && !searchMode) { playByIndex(qi > 0 ? qi - 1 : (loop ? queue.length - 1 : 0), { reveal: true }); }
    else { yt?.previousVideo?.(); armStuckGuard(); }
  });
  btnNext.addEventListener("click", () => { next(); });

  btnMute.addEventListener("click", () => {
    if (!yt) return;
    muted = !muted;
    if (muted) yt.mute?.(); else yt.unMute?.();
    uiMuteIcon(muted);
  });
  vol.addEventListener("input", () => {
    const v = Number(vol.value) || 0;
    volVal = v;
    if (!isIOS) yt?.setVolume?.(v);
    if (v === 0 && !muted) { muted = true; yt?.mute?.(); uiMuteIcon(true); }
    else if (v > 0 && muted) { muted = false; yt?.unMute?.(); uiMuteIcon(false); }
    setBubbleAmp(v);
  });
  prog.addEventListener("input", () => {
    userSeeking = true;
    const v = Number(prog.value) || 0;
    const sec = duration > 0 ? (v / 1000) * duration : 0;
    tCur.textContent = fmtTimeSec(sec);
  });
  prog.addEventListener("change", () => {
    userSeeking = false;
    if (!yt || !duration) return;
    const v = Number(prog.value) || 0;
    const sec = (v / 1000) * duration;
    yt.seekTo?.(sec, true);
  });

  /* ---------- Public API ---------- */
  async function open(urlOrId) {
    const id = getYouTubeId(urlOrId);
    if (!id) {
      const q = String(urlOrId || "").trim();
      if (q) return playSearch(q);
      return;
    }
    searchMode = false;
    lastQuery = ''; variantIndex = 0;
    queue = [id]; qi = 0;
    uiMin(false); uiShow(true); restoreDockPos();
    await playByIndex(0, { reveal: true });
  }

  async function openQueue(list, opts = {}) {
    const ids = (list || []).map(getYouTubeId).filter(Boolean);
    if (!ids.length) return;
    searchMode = false;
    lastQuery = ''; variantIndex = 0;
    loop = !!opts.loop;
    const arr = opts.shuffle ? shuffleArr(ids) : ids.slice();
    queue = arr;
    const start = clamp(Number(opts.startIndex ?? 0) || 0, 0, queue.length - 1);
    uiMin(false); uiShow(true); restoreDockPos();
    await playByIndex(start, { reveal: true });
  }

  async function smartNextFromCurrent() {
    try {
      const vd = yt?.getVideoData?.();
      const title = (vd?.title || "").trim();
      const author = (vd?.author || "").trim();
      const artist = title.includes('-') ? title.split('-')[0].trim() : author;
      if (artist) {
        dbg('smartNextFromCurrent(): re-search by', artist);
        await playSearch(artist);
      } else if (author) {
        await playSearch(author);
      }
    } catch (e) {
      dbg('smartNextFromCurrent() failed', e);
    }
  }

  function next() {
    if (queue.length && !searchMode) {
      const reveal = !dock.classList.contains("am-player--min");
      playByIndex(qi < queue.length - 1 ? qi + 1 : (loop ? 0 : qi), { reveal });
    } else {
      if (searchMode) {
        yt?.nextVideo?.();
        armStuckGuard();
      } else {
        smartNextFromCurrent();
      }
    }
  }
  function prev() {
    if (queue.length && !searchMode) {
      const reveal = !dock.classList.contains("am-player--min");
      playByIndex(qi > 0 ? qi - 1 : (loop ? queue.length - 1 : 0), { reveal });
    } else {
      yt?.previousVideo?.();
      armStuckGuard();
    }
  }

  function play() {
    if (yt && ready) { yt.playVideo?.(); uiPlayIcon(true); setBubblePulse(true); armStuckGuard(); return; }
    if (queue.length && !searchMode) { playByIndex(qi < 0 ? 0 : qi, { reveal: false }); return; }
  }
  function pause() {
    try { yt?.pauseVideo?.(); } catch {}
    uiPlayIcon(false); setBubblePulse(false);
  }
  function stop() {
    try { yt?.stopVideo?.(); } catch {}
    uiPlayIcon(false); setBubblePulse(false);
  }
  function setVolume01(x) {
    const v = clamp(Math.round((Number(x)||0)*100), 0, 100);
    volVal = v; vol.value = String(v);
    if (!isIOS) yt?.setVolume?.(v);
    if (v === 0 && !muted) { muted = true; yt?.mute?.(); uiMuteIcon(true); }
    else if (v > 0 && muted) { muted = false; yt?.unMute?.(); uiMuteIcon(false); }
    setBubbleAmp(v);
  }
  function getVolume01() { return (volVal||0)/100; }
  function minimize()     { if (dock.classList.contains("am-player--active")) uiMin(true); }
  function expand()       { uiMin(false); uiShow(true); restoreDockPos(); }

  function isActive()     { return dock.classList.contains("am-player--active"); }
  function isMinimized()  { return isActive() && dock.classList.contains("am-player--min"); }
  function hasQueue()     { return Array.isArray(queue) && queue.length > 0; }
  function close()        { btnClose.click(); }

  async function playSearch(query) {
    const q = String(query || "").trim();
    if (!q) return;
    uiMin(false); uiShow(true); restoreDockPos();

    lastQuery = q; variantIndex = 0; sameIdPlays = 0; lastVidId = null;

    // 1) Серверный поиск с кэшем и фильтрами
    const ids = await fetchYTSearchIds(q, 25);
    if (ids.length > 1) {
      await openQueue(ids, { shuffle: false, startIndex: 0 });
      return;
    } else if (ids.length === 1) {
      await open(ids[0]);
      return;
    }

    // 2) Фоллбэк — встроенный поисковый плейлист YouTube
    searchMode = true;
    queue = []; qi = -1;
    await ensureYT(null);
    try {
      yt.loadPlaylist({ listType: "search", list: q, index: 0 });
      yt.playVideo?.();
      clearSearchWatch();
      searchWatchdogId = setTimeout(() => {
        try {
          const st = yt.getPlayerState?.();
          if (st !== YT.PlayerState.PLAYING) yt.playVideo?.();
        } catch {}
      }, 1000);
      aYTlink.href = "#";
      uiPlayIcon(true);
      setBubblePulse(true);
      startTimer();
      tryAutoplaySoft();
      armStuckGuard();
    } catch (e) {
      dbg("[player.playSearch] loadPlaylist failed, try cuePlaylist()", e);
      try { yt.cuePlaylist?.({ listType: "search", list: q, index: 0 }); yt.playVideo?.(); armStuckGuard(); } catch {}
    }
  }

  _instance = {
    open, openQueue, next, prev,
    play, pause, stop, setVolume: setVolume01, getVolume: getVolume01, expand,
    minimize, isActive, isMinimized, hasQueue, close,
    playSearch
  };
  return _instance;
}

/* ---------- Default export & global ---------- */
function get() { return _instance || createMiniPlayer(); }

const Player = {
  open:       (x) => get().open(x),
  openQueue:  (l,o) => get().openQueue(l,o),
  next:       () => get().next(),
  prev:       () => get().prev(),
  play:       () => get().play(),
  pause:      () => get().pause(),
  stop:       () => get().stop(),
  setVolume:  (x) => get().setVolume(x),
  getVolume:  () => get().getVolume(),
  minimize:   () => get().minimize(),
  expand:     () => get().expand(),
  isActive:   () => get().isActive(),
  isMinimized:() => get().isMinimized(),
  hasQueue:   () => get().hasQueue(),
  close:      () => get().close(),
  playSearch: (q) => get().playSearch(q),
};

export default Player;

// Глобалка для консоли и внешних скриптов
if (typeof window !== 'undefined') { window.Player = Player; }



```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/prefetch.js

**size:** 1367 bytes &nbsp;&nbsp; **sha1:** `886f15a116070d118e77fbe29e03f1187fa8a045`

```javascript
// Предзагрузка данных артиста при hover на “Learn more” >150мс.

import { fetchArtist, fetchArtistAlbums } from "./api.js";

const cache = new Map(); // id -> { artist, albums, ts }

export function getPrefetched(id) {
  return cache.get(String(id));
}

export function initPrefetch(root) {
  const grid = root.querySelector("#artists-grid");
  if (!grid) return;

  let hoverTimer = null;
  let hoverId = null;

  function schedulePrefetch(id) {
    clearTimeout(hoverTimer);
    hoverTimer = setTimeout(async () => {
      try {
        if (cache.has(id)) return;
        const [artist, albums] = await Promise.all([
          fetchArtist(id),
          fetchArtistAlbums(id),
        ]);
        cache.set(id, { artist, albums, ts: Date.now() });
      } catch { /* тихо игнорим */ }
    }, 150);
  }

  grid.addEventListener("mouseenter", (e) => {
    const btn = e.target.closest('[data-action="more"]');
    if (!btn) return;
    const id = btn.closest(".card")?.dataset?.id;
    if (!id) return;
    hoverId = String(id);
    schedulePrefetch(hoverId);
  }, true);

  grid.addEventListener("mouseleave", (e) => {
    if (e.target.closest('[data-action="more"]')) {
      clearTimeout(hoverTimer);
      hoverTimer = null;
      hoverId = null;
    }
  }, true);
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/router.js

**size:** 1419 bytes &nbsp;&nbsp; **sha1:** `a2572fe65e8b6bc170a4e4f76cc086a0344cc717`

```javascript
// URL-sync для секции Artists: читает состояние из query при старте,
// и поддерживает актуальный query при изменении state (replaceState).

import { getState, setState, subscribe } from "./state.js";

function parseQuery() {
  const p = new URLSearchParams(location.search);
  const q = (p.get("q") || "").trim();
  const genre = p.get("genre") || "";
  const sort = p.get("sort") || "";
  const page = Math.max(1, Number(p.get("page") || 1));
  return { q, genre, sort, page };
}

function buildQuery(s) {
  const p = new URLSearchParams();
  if (s.q) p.set("q", s.q);
  if (s.genre) p.set("genre", s.genre);
  if (s.sort) p.set("sort", s.sort);
  if (s.page && s.page !== 1) p.set("page", String(s.page));
  return p.toString();
}

export function initRouter() {
  
  const urlState = parseQuery();
  const cur = getState();
  const patch = {};
  let changed = false;
  for (const k of ["q","genre","sort","page"]) {
    if (urlState[k] !== undefined && urlState[k] !== cur[k]) {
      patch[k] = urlState[k];
      changed = true;
    }
  }
  if (changed) setState(patch);

  
  let lastQS = null;
  subscribe((s) => {
    const qs = buildQuery(s);
    if (qs === lastQS) return;
    lastQS = qs;
    const url = qs ? `?${qs}` : location.pathname;
    history.replaceState(null, "", url);
  });
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/state.js

**size:** 4969 bytes &nbsp;&nbsp; **sha1:** `39bf1a97bd78559d76218eb4fd4002d91fa5809e`

```javascript
// src/js/artists/features/state.js

const STORAGE_KEY = "artistsStateV2";

const initial = {
  page: 1,
  limit: 8,            // базовый лимит для Default
  genre: "",
  sort: "",
  q: "",
  isMobilePanelOpen: false,
};

// Текущее состояние
let state = { ...initial };

// Флаг и слушатели
let storageLoaded = false;
const listeners = new Set();

/* ---------------- storage helpers ---------------- */
function canUseStorage() {
  try {
    const k = "__probe__";
    localStorage.setItem(k, "1");
    localStorage.removeItem(k);
    return true;
  } catch {
    return false;
  }
}

function loadFromStorage() {
  if (storageLoaded) return;
  storageLoaded = true;
  if (!canUseStorage()) return;

  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    const obj = JSON.parse(raw);
    state = {
      page: Math.max(1, Number(obj?.page) || initial.page),
      limit: Math.max(1, Number(obj?.limit) || initial.limit),
      genre: String(obj?.genre ?? initial.genre),
      sort: String(obj?.sort ?? initial.sort),
      q: String(obj?.q ?? initial.q),
      isMobilePanelOpen: !!obj?.isMobilePanelOpen,
    };
  } catch {
    // игнор
  }
}

function saveToStorage() {
  if (!storageLoaded || !canUseStorage()) return;
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  } catch {
    // квота/приватный режим — молча
  }
}

/* ---------------- pub/sub ---------------- */
function notify() {
  const snap = { ...state };
  for (const fn of listeners) {
    try { fn(snap); } catch {}
  }
}

/** Подписка на изменения состояния. Возвращает функцию отписки. */
export function subscribe(fn) {
  if (typeof fn !== "function") return () => {};
  listeners.add(fn);
  return () => listeners.delete(fn);
}

/** Явная отписка (альтернатива функции, возвращаемой subscribe) */
export function unsubscribe(fn) {
  listeners.delete(fn);
}

// на всякий случай алиас, если где-то импортируется другое имя
export const onChange = subscribe;

/* ---------------- современный API ---------------- */
const ArtistState = {
  get() {
    loadFromStorage();
    return { ...state };
  },
  setPage(p) {
    loadFromStorage();
    state.page = Math.max(1, Number(p) || 1);
    saveToStorage(); notify();
  },
  setLimit(n) {
    loadFromStorage();
    state.limit = Math.max(1, Number(n) || initial.limit);
    saveToStorage(); notify();
  },
  setGenre(v) {
    loadFromStorage();
    state.genre = v || "";
    saveToStorage(); notify();
  },
  setSort(v) {
    loadFromStorage();
    state.sort = v || "";
    saveToStorage(); notify();
  },
  setQuery(v) {
    loadFromStorage();
    state.q = v || "";
    saveToStorage(); notify();
  },
  setMobilePanel(on) {
    loadFromStorage();
    state.isMobilePanelOpen = !!on;
    saveToStorage(); notify();
  },
  reset() {
    loadFromStorage();
    state = { ...initial };
    saveToStorage(); notify();
  },
};

export { ArtistState };
export default ArtistState;

/* ---------------- back-compat экспорт ---------------- */
// Старые импорты могли использовать эти функции.
export const getState = () => ArtistState.get();

export const setState = (patch = {}) => {
  loadFromStorage();
  const next = { ...state };

  if ("page" in patch)  next.page  = Math.max(1, Number(patch.page)  || 1);
  if ("limit" in patch) next.limit = Math.max(1, Number(patch.limit) || initial.limit);
  if ("genre" in patch) next.genre = String(patch.genre || "");
  if ("sort" in patch)  next.sort  = String(patch.sort  || "");
  if ("q" in patch)     next.q     = String(patch.q     || "");
  if ("isMobilePanelOpen" in patch) next.isMobilePanelOpen = !!patch.isMobilePanelOpen;

  state = next;
  saveToStorage(); notify();
  return ArtistState.get();
};

export const resetState = () => { ArtistState.reset(); return ArtistState.get(); };

// Пробрасываем поименованные сеттеры, если где-то импортируются напрямую
export const setPage        = (p)  => ArtistState.setPage(p);
export const setLimit       = (n)  => ArtistState.setLimit(n);
export const setGenre       = (v)  => ArtistState.setGenre(v);
export const setSort        = (v)  => ArtistState.setSort(v);
export const setQuery       = (v)  => ArtistState.setQuery(v);
export const setMobilePanel = (on) => ArtistState.setMobilePanel(on);

/* ---------------- первичная загрузка ---------------- */
loadFromStorage(); // чтобы состояние было готово до первых подписок



```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/yt-catalog-provider.js

**size:** 6833 bytes &nbsp;&nbsp; **sha1:** `9d0c85b5f48a6e3c62db42044e08f2f91e9a598f`

```javascript
/* eslint-env browser */

/**
 * Каталожный провайдер YouTube-ID без API-ключа.
 *
 * Идея: использовать локальную БД артиста/альбомов/треков (то, что уже есть у тебя в проекте),
 * находить в ней youtube-ссылки и извлекать 11-символьные videoId.
 *
 * Безопасность:
 * - Никаких сетевых запросов к YouTube.
 * - Работает даже при исчерпанной квоте Data API.
 *
 * Гибкость:
 * - Пытается динамически импортировать один из модулей каталога:
 *   ./api.js, ../api.js, ./modal.js — и аккуратно ищет знакомые функции/структуры.
 * - Если ничего не нашлось, пытается воспользоваться глобалками window.__ARTISTS_DB__ / window.Artists.
 *
 * Кэш:
 * - localStorage ("amCatCacheV1") с TTL по умолчанию 7 дней.
 */

const YT_ID_RE = /(?:v=|\/(?:embed|shorts|v)\/|youtu\.be\/)([A-Za-z0-9_-]{11})/i;
const RAW_ID_RE = /\b([A-Za-z0-9_-]{11})\b/;

function getYouTubeIdFromString(s) {
  if (!s) return '';
  const str = String(s);
  const m1 = str.match(YT_ID_RE);
  if (m1 && m1[1]) return m1[1];
  const m2 = str.match(RAW_ID_RE);
  if (m2 && m2[1]) return m2[1];
  return '';
}

function normalize(q) {
  return String(q || '').trim().toLowerCase();
}

function readCache() {
  try {
    return JSON.parse(localStorage.getItem('amCatCacheV1') || '{}');
  } catch { return {}; }
}

function writeCache(obj) {
  try { localStorage.setItem('amCatCacheV1', JSON.stringify(obj)); } catch {}
}

function collectIdsFromArtist(artistObj) {
  const out = new Set();
  if (!artistObj || typeof artistObj !== 'object') return out;

  // 1) прямые поля
  for (const k of ['yt', 'youtube', 'url', 'video', 'link']) {
    const id = getYouTubeIdFromString(artistObj[k]);
    if (id) out.add(id);
  }

  // 2) альбомы → треки
  const albums = artistObj.albums || artistObj.discography || [];
  if (Array.isArray(albums)) {
    for (const al of albums) {
      for (const k of ['yt', 'youtube', 'url', 'video', 'link']) {
        const id = getYouTubeIdFromString(al?.[k]);
        if (id) out.add(id);
      }
      const tracks = al?.tracks || al?.songs || [];
      if (Array.isArray(tracks)) {
        for (const tr of tracks) {
          for (const k of ['yt', 'youtube', 'url', 'video', 'link']) {
            const id = getYouTubeIdFromString(tr?.[k]);
            if (id) out.add(id);
          }
        }
      }
    }
  }

  // 3) иногда встречаются «extras»/«links»
  const links = artistObj.links || artistObj.extra || [];
  if (Array.isArray(links)) {
    for (const x of links) {
      const id = getYouTubeIdFromString(x);
      if (id) out.add(id);
    }
  }

  return out;
}

async function tryImport(path) {
  try { return await import(/* @vite-ignore */ path); }
  catch { return null; }
}

async function findArtistCandidates(query) {
  const q = normalize(query);
  const out = [];

  // Пытаемся разные модули (на твой проект часто подходит ./api.js)
  const mod1 = await tryImport('./api.js');
  const mod2 = await tryImport('../api.js');
  const mod3 = await tryImport('./modal.js'); // вдруг там экспортятся данные
  const mods = [mod1, mod2, mod3].filter(Boolean);

  for (const m of mods) {
    // Наиболее частые варианты API:
    const fns = [
      m.searchArtists, m.findArtists, m.lookupArtist, m.findArtistByName,
      m.getArtistBySlug, m.getArtist, m.getArtists, m.getAllArtists
    ].filter(Boolean);

    // 1) функции поиска
    for (const fn of fns) {
      try {
        const res = await fn(q);
        if (Array.isArray(res)) {
          for (const a of res) out.push(a);
        } else if (res && typeof res === 'object') {
          out.push(res);
        }
      } catch { /* no-op */ }
    }

    // 2) экспортированные индексы
    for (const key of Object.keys(m)) {
      const val = m[key];
      if (Array.isArray(val) && val.length && typeof val[0] === 'object') {
        // массив артистов
        for (const a of val) {
          const name = (a.name || a.title || a.artist || '').toLowerCase();
          const slug = (a.slug || '').toLowerCase();
          if (name.includes(q) || slug === q) out.push(a);
        }
      }
    }
  }

  // 3) глобалки как fallback
  const globals = [window.__ARTISTS_DB__, window.Artists, window.APP_CATALOG].filter(Boolean);
  for (const g of globals) {
    if (Array.isArray(g)) {
      for (const a of g) {
        const name = (a?.name || a?.title || a?.artist || '').toLowerCase();
        const slug = (a?.slug || '').toLowerCase();
        if (name.includes(q) || slug === q) out.push(a);
      }
    } else if (g && typeof g === 'object') {
      // объект вида { slug: artist }
      for (const k of Object.keys(g)) {
        const a = g[k];
        const name = (a?.name || a?.title || a?.artist || '').toLowerCase();
        const slug = String(k || '').toLowerCase();
        if (name.includes(q) || slug.includes(q)) out.push(a);
      }
    }
  }

  // легкая нормализация
  const unique = [];
  const seen = new Set();
  for (const a of out) {
    if (!a) continue;
    const key = (a.slug || a.name || a.title || JSON.stringify(a)).toLowerCase();
    if (seen.has(key)) continue;
    seen.add(key);
    unique.push(a);
  }
  return unique;
}

/**
 * Возвращает массив YouTube videoId (строки по 11 символов) из локального каталога
 * по текстовому запросу. Кэширует результат в localStorage.
 */
export async function idsFromCatalog(query, { ttlMs = 7 * 24 * 3600 * 1000 } = {}) {
  const q = normalize(query);
  if (!q) return [];

  // cache
  const cache = readCache();
  const now = Date.now();
  const cval = cache[q];
  if (cval && Array.isArray(cval.ids) && (now - (cval.ts || 0) < ttlMs)) {
    return cval.ids.slice();
  }

  const artists = await findArtistCandidates(q);
  const bag = new Set();
  for (const a of artists) {
    const ids = collectIdsFromArtist(a);
    ids.forEach(id => bag.add(id));
  }

  const res = Array.from(bag);
  cache[q] = { ids: res, ts: now };
  writeCache(cache);
  return res;
}

export default { idsFromCatalog };

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/features/zoom.js

**size:** 8612 bytes &nbsp;&nbsp; **sha1:** `cc6d1e09b877394f9c34c4c08787c59e1549256c`

```javascript

// Оверлей зума: без искажений на моб/таб + pinch/zoom/pan + колесо/двойной клик

let overlay, dialogEl, stageEl, imgEl, linkEl, closeBtn, backdropEl;
let isPanning = false, startX = 0, startY = 0, curX = 0, curY = 0, scale = 1;
let baseW = 0, baseH = 0, stageW = 0, stageH = 0;
const activePointers = new Map();
let pinchActive = false, pinchBaseDist = 0, pinchBaseScale = 1;

const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
const dist = (a, b) => Math.hypot(a.x - b.x, a.y - b.y);
const midpoint = (a, b) => ({ x: (a.x + b.x) / 2, y: (a.y + b.y) / 2 });

/* ---------- ensure ---------- */
function ensureZoom() {
  if (overlay) return;

  overlay = document.createElement("div");
  overlay.className = "am-zoom";
  overlay.innerHTML = `
    <div class="am-zoom__backdrop"></div>
    <div class="am-zoom__dialog" role="dialog" aria-modal="true" aria-label="Image preview">
      <div class="am-zoom__stage">
        <img class="am-zoom__img" alt="">
      </div>
      <div class="am-zoom__bar">
        <a class="am-zoom__open" href="#" target="_blank" rel="noopener noreferrer">Open original ↗</a>
        <button class="am-zoom__close" type="button" aria-label="Close">×</button>
      </div>
    </div>`;
  document.body.appendChild(overlay);

  // базовые стилевые фолбэки (если вдруг профильный CSS не подключен)
  Object.assign(overlay.style, { position: "fixed", inset: "0", zIndex: "6000", display: "none" });
  dialogEl = overlay.querySelector(".am-zoom__dialog");
  Object.assign(dialogEl.style, {
    position: "absolute", inset: "0", display: "grid",
    gridTemplateRows: "1fr auto", gap: "12px", padding: "16px"
  });

  backdropEl = overlay.querySelector(".am-zoom__backdrop");
  Object.assign(backdropEl.style, { position: "absolute", inset: "0", background: "rgba(0,0,0,.7)" });

  stageEl = overlay.querySelector(".am-zoom__stage");
  Object.assign(stageEl.style, {
    position: "relative",
    background: "#000",
    borderRadius: "12px",
    overflow: "hidden",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    minHeight: "240px",
    height: "calc(100vh - 140px)",
    touchAction: "none" // жесты — нашими руками
  });

  imgEl = overlay.querySelector(".am-zoom__img");
  // важные анти-искажения + перехват global img{height:100%}
  imgEl.style.maxWidth = "100%";
  imgEl.style.maxHeight = "100%";
  imgEl.style.width = "auto";
  imgEl.style.setProperty("height", "auto", "important");
  imgEl.style.objectFit = "contain";
  imgEl.style.transformOrigin = "center center";
  imgEl.style.willChange = "transform";
  imgEl.style.userSelect = "none";
  imgEl.style.webkitUserDrag = "none";
  imgEl.style.pointerEvents = "auto";

  const bar = overlay.querySelector(".am-zoom__bar");
  Object.assign(bar.style, {
    display: "flex", justifyContent: "space-between",
    alignItems: "center", gap: "12px"
  });

  linkEl = overlay.querySelector(".am-zoom__open");
  linkEl.style.color = "#fff";
  closeBtn = overlay.querySelector(".am-zoom__close");
  Object.assign(closeBtn.style, {
    width: "40px", height: "40px", borderRadius: "10px",
    border: "none", background: "var(--color-affair, #764191)", color: "#fff", cursor: "pointer"
  });

  // события
  backdropEl.addEventListener("click", closeZoom);
  closeBtn.addEventListener("click", closeZoom);

  overlay.addEventListener("wheel", onWheel, { passive: false });
  imgEl.addEventListener("dblclick", toggleZoom);

  imgEl.addEventListener("pointerdown", onPointerDown);
  imgEl.addEventListener("pointermove", onPointerMove);
  imgEl.addEventListener("pointerup", onPointerUpCancel);
  imgEl.addEventListener("pointercancel", onPointerUpCancel);

  document.addEventListener("keydown", (e) => { if (e.key === "Escape" && isZoomOpen()) closeZoom(); });
  window.addEventListener("resize", () => { if (isZoomOpen()) { measureStage(); applyTransform(); } });
}

/* ---------- measurements ---------- */
function measureBase() {
  const prev = imgEl.style.transform;
  imgEl.style.transform = "translate3d(0,0,0) scale(1)";
  const r = imgEl.getBoundingClientRect();
  imgEl.style.transform = prev;
  baseW = r.width; baseH = r.height;
}
function measureStage() {
  const s = stageEl.getBoundingClientRect();
  stageW = s.width; stageH = s.height;
}
function clampPan() {
  if (!baseW || !baseH || !stageW || !stageH) return;
  const contentW = baseW * scale, contentH = baseH * scale;
  if (contentW <= stageW) curX = 0;
  else { const maxX = (contentW - stageW) / 2; curX = clamp(curX, -maxX, maxX); }
  if (contentH <= stageH) curY = 0;
  else { const maxY = (contentH - stageH) / 2; curY = clamp(curY, -maxY, maxY); }
}
function applyTransform() {
  clampPan();
  imgEl.style.transform = `translate3d(${curX}px, ${curY}px, 0) scale(${scale})`;
  imgEl.style.cursor = scale > 1 ? (isPanning ? "grabbing" : "grab") : "zoom-in";
}

/* ---------- API ---------- */
export function openZoom(src, alt = "") {
  if (!src) return;
  ensureZoom();

  // сброс состояния
  activePointers.clear();
  pinchActive = false; pinchBaseDist = 0; pinchBaseScale = 1;
  isPanning = false; startX = startY = 0; curX = curY = 0; scale = 1;

  imgEl.src = src;
  imgEl.alt = alt || "";
  linkEl.href = src;

  overlay.style.display = "block";

  const doMeasure = () => { measureStage(); measureBase(); clampPan(); applyTransform(); };
  if (imgEl.complete && imgEl.naturalWidth > 0) requestAnimationFrame(doMeasure);
  else imgEl.onload = () => requestAnimationFrame(doMeasure);
}

export function closeZoom() {
  if (!overlay) return;
  overlay.style.display = "none";
  imgEl.src = "";
  activePointers.clear();
  pinchActive = false;
}

export function isZoomOpen() {
  return !!(overlay && overlay.style.display !== "none");
}

/* ---------- gestures ---------- */
function toggleZoom() {
  const prev = scale;
  scale = prev > 1 ? 1 : 2;
  if (scale === 1) { curX = 0; curY = 0; }
  applyTransform();
}
function onWheel(e) {
  if (!isZoomOpen()) return;
  e.preventDefault();
  const newScale = clamp(scale + (e.deltaY > 0 ? -0.15 : 0.15), 1, 3);

  const rect = imgEl.getBoundingClientRect();
  const pivot = { x: e.clientX, y: e.clientY };
  const center = { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
  const factor = newScale / scale;
  curX += (center.x - pivot.x) * (1 - factor);
  curY += (center.y - pivot.y) * (1 - factor);

  scale = newScale;
  if (scale === 1) { curX = 0; curY = 0; }
  applyTransform();
}
function onPointerDown(e) {
  activePointers.set(e.pointerId, { x: e.clientX, y: e.clientY });
  imgEl.setPointerCapture(e.pointerId);

  if (activePointers.size === 2) {
    const [p1, p2] = Array.from(activePointers.values());
    pinchActive = true;
    pinchBaseDist = dist(p1, p2) || 1;
    pinchBaseScale = scale;
    isPanning = false;
    return;
  }
  if (activePointers.size === 1 && scale > 1) {
    isPanning = true;
    startX = e.clientX - curX;
    startY = e.clientY - curY;
    applyTransform();
  }
}
function onPointerMove(e) {
  if (!activePointers.has(e.pointerId)) return;
  activePointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

  if (pinchActive && activePointers.size >= 2) {
    const [p1, p2] = Array.from(activePointers.values());
    const d = dist(p1, p2) || 1;
    let newScale = clamp(pinchBaseScale * (d / pinchBaseDist), 1, 3);

    const mid = midpoint(p1, p2);
    const rect = imgEl.getBoundingClientRect();
    const center = { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
    const factor = newScale / scale;
    curX += (center.x - mid.x) * (1 - factor);
    curY += (center.y - mid.y) * (1 - factor);

    scale = newScale;
    if (scale === 1) { curX = 0; curY = 0; }
    applyTransform();
    return;
  }

  if (isPanning && activePointers.size === 1 && scale > 1) {
    curX = e.clientX - startX;
    curY = e.clientY - startY;
    applyTransform();
  }
}
function onPointerUpCancel(e) {
  if (activePointers.has(e.pointerId)) activePointers.delete(e.pointerId);
  try { imgEl.releasePointerCapture(e.pointerId); } catch {}
  if (activePointers.size < 2) { pinchActive = false; pinchBaseDist = 0; }
  if (activePointers.size === 0) { isPanning = false; applyTransform(); }
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/index.js

**size:** 10071 bytes &nbsp;&nbsp; **sha1:** `ca5a1ea384009c5cdada763b7003b092d9027e7d`

```javascript
// --------------------------------------------------
// Artists: точка входа
// - initArtists(): инициализация сетки/фильтров/модалок
// - createMiniPlayer(): создаёт мини-плеер
// - mountPlayerPatch(player): навешивает события управления с ассистента
// - installMixRadioMenu(btnSelector, player): поповер меню под Mix Radio
// --------------------------------------------------

import { initArtists } from "./features/init.js";
import { createMiniPlayer } from "./features/player.js";
import mountPlayerPatch from "./features/player-patch.js";
import { installMixRadioMenu } from "./features/mixradio-menu.js";

/* =========================
   Утилиты
   ========================= */

/** Достаёт YouTube ID из ID или URL (youtu.be, /embed, /shorts, ?v=) */
function getYouTubeId(urlOrId) {
  if (!urlOrId) return "";
  if (/^[\w-]{11}$/.test(urlOrId)) return urlOrId; // уже ID

  try {
    const u = new URL(urlOrId, location.href);
    if (/youtu\.be$/i.test(u.hostname)) return u.pathname.slice(1);
    const v = u.searchParams.get("v");
    if (v && /^[\w-]{11}$/.test(v)) return v;
    const m = u.pathname.match(/\/(?:embed|v|shorts)\/([^/?#]+)/i);
    if (m && m[1] && /^[\w-]{11}$/.test(m[1])) return m[1];
  } catch { /* ignore */ }
  return "";
}

const uniq = (arr) => Array.from(new Set((arr || []).filter(Boolean)));
function shuffle(a) {
  const arr = a.slice();
  for (let i = arr.length - 1; i > 0; i--) {
    const j = (Math.random() * (i + 1)) | 0;
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* =========================
   Seed-пул видео (можно дополнять)
   ========================= */

const SEED_IDS = uniq([
  // базовый набор
  "Zi_XLOBDo_Y","3JZ_D3ELwOQ","fRh_vgS2dFE","OPf0YbXqDm0","60ItHLz5WEA",
  "2Vv-BfVoq4g","kXYiU_JCYtU","UceaB4D0jpo","RubBzkZzpUA","kJQP7kiw5Fk",
  "CevxZvSJLk8","pRpeEdMmmQ0","IcrbM1l_BoI","YVkUvmDQ3HY","hT_nvWreIhg",
  "09R8_2nJtjg","uelHwf8o7_U","JGwWNGJdvx8","YQHsXMglC9A","NmugSMBh_iI",
  "LrUvu1mlWco","hLQl3WQQoQ0","RgKAFK5djSk","SlPhMPnQ58k","oRdxUFDoQe0",
  "Pkh8UtuejGw","tt2k8PGm-TI","lY2yjAdbvdQ","pXRviuL6vMY","nfs8NYg7yQM",
  "nCkpzqqog4k","M7lc1UVf-VE",
  // расширение
  "fLexgOxsZu0","2vjPBrBU-TM","9bZkp7q19f0","e-ORhEE9VVg","gCYcHz2k5x0",
  "ktvTqknDobU","ub82Xb1C8os","fKopy74weus","Qv5fqunQ_4I","vNoKguSdy4Y",
  "0KSOMA3QBU0","lp-EO5I60KA","DK_0jXPuIr0","tVj0ZTS4WF4","6fVE8kSM43I",
  "6Ejga4kJUts","gGdGFtwCNBE","rYEDA3JcQqw","AtKZKl7Bgu0","eVTXPUF4Oz4",
  "kffacxfA7G4"
]);

/* =========================
   localStorage: кэш пула
   ========================= */

const LS_KEY_POOL = "am.radio.pool";
const LS_KEY_LAST = "am.radio.last";

function readPoolLS() {
  try {
    const raw = localStorage.getItem(LS_KEY_POOL);
    const arr = raw ? JSON.parse(raw) : [];
    return Array.isArray(arr) ? uniq(arr) : [];
  } catch { return []; }
}
function savePoolLS(arr) {
  try {
    localStorage.setItem(LS_KEY_POOL, JSON.stringify(uniq(arr).slice(0, 800)));
  } catch { /* ignore */ }
}
function addToPoolLS(ids) {
  if (!ids?.length) return;
  const cur = new Set(readPoolLS());
  ids.forEach((id) => cur.add(id));
  savePoolLS([...cur]);
}

/* =========================
   Сбор ID из DOM
   ========================= */

function collectFromDOM(root = document) {
  const out = new Set();

  // Ссылки на YouTube
  root.querySelectorAll('a[href*="youtu"], a.yt').forEach((a) => {
    const href = a.getAttribute("href") || "";
    const id = getYouTubeId(href);
    if (id) out.add(id);
  });

  // Возможные data-атрибуты
  root.querySelectorAll("[data-yt],[data-youtube],[data-ytid]").forEach((el) => {
    const raw =
      el.getAttribute("data-yt") ||
      el.getAttribute("data-youtube") ||
      el.getAttribute("data-ytid") ||
      "";
    const id = getYouTubeId(raw);
    if (id) out.add(id);
  });

  return [...out];
}

function installCollector() {
  // стартовая выборка
  addToPoolLS(collectFromDOM());

  // наблюдаем за добавлениями (модалки, подгрузки и т.п.)
  const mo = new MutationObserver((mutations) => {
    let added = [];
    for (const m of mutations) {
      if (!m.addedNodes) continue;
      m.addedNodes.forEach((n) => {
        if (n.nodeType !== 1) return; // ELEMENT_NODE
        added = added.concat(collectFromDOM(n));
      });
    }
    if (added.length) addToPoolLS(added);
  });
  mo.observe(document.documentElement, { childList: true, subtree: true });
}

/* =========================
   Построение итогового пула
   ========================= */

function buildPool() {
  const mem = readPoolLS();
  const dom = collectFromDOM();
  return uniq([...SEED_IDS, ...mem, ...dom]);
}

/* =========================
   Mix Radio
   ========================= */

function startMixRadio(player) {
  const pool = buildPool();
  if (!pool.length || !player) return;

  // большая перемешанная очередь
  let order = shuffle(pool);

  // анти-повтор стартового
  const last = localStorage.getItem(LS_KEY_LAST);
  if (last && order.length > 1 && order[0] === last) {
    order.push(order.shift());
  }
  localStorage.setItem(LS_KEY_LAST, order[0]);

  // отдаём очередь плееру (API нашего мини-плеера)
  if (typeof player.openQueue === "function") {
    player.openQueue(order, { shuffle: false, loop: true, startIndex: 0 });
  } else {
    // фолбэк: просто сыграть первый ID, если есть метод playYouTube/id
    if (typeof player.playYouTube === "function") player.playYouTube(order[0]);
    else if (typeof player.play === "function") player.play(order[0]);
  }
}

/* =========================
   Привязка ассистента к каталогу
   ========================= */

function bindAssistantToCatalog(player) {
  // Рекомендации (жанр/настроение/поиск по слову)
  document.addEventListener("assistant:recommend", (e) => {
    const { mood, genre, decade, like } = e.detail || {};

    // ЖАНР — кликаем существующий пункт дропа
    if (genre) {
      const item = document.querySelector(
        '#dd-genre-list li[data-val="' + genre + '"]'
      );
      if (item) item.click();
    }

    // ПОИСК — вписываем в поле и триггерим input
    if (like) {
      const q = document.getElementById("flt-q");
      if (q) {
        q.value = like;
        q.dispatchEvent(new Event("input", { bubbles: true }));
      }
    }

    // mood/decade — под твой реальный маппинг тегов/чекбоксов
    // После выставления фильтров можно дёрнуть свою refresh():
    // try { refresh(); } catch {}
  });

  // Фолбэки на случай, если player-patch не подхватился:
  const safe = (fn) => { try { fn && fn(); } catch {} };

  document.addEventListener("assistant:player-play", () => {
    safe(() => {
      if (player?.isActive?.()) player.play?.();
      else if (player?.hasQueue?.()) player.play?.();
      else startMixRadio(player);
    });
  });
  document.addEventListener("assistant:player-pause", () => safe(() => player?.pause?.()));
  document.addEventListener("assistant:player-next",  () => safe(() => {
    if (player?.hasQueue?.()) player.next?.(); else startMixRadio(player);
  }));
  document.addEventListener("assistant:player-prev",  () => safe(() => player?.prev?.()));
  document.addEventListener("assistant:volume", (e) => safe(() => {
    const d = e.detail?.delta ?? 0;
    if (typeof player?.setVolume === "function") {
      const v = Math.max(0, Math.min(1, (player.getVolume?.() ?? 0.7) + d));
      player.setVolume(v);
    }
  }));
}

/* =========================
   Bootstrap
   ========================= */

document.addEventListener("DOMContentLoaded", () => {
  // Инициализация секции/грида/модалок (как было)
  try { initArtists(); } catch { /* ignore */ }

  // Создаём мини-плеер
  const player = (typeof createMiniPlayer === "function") ? createMiniPlayer() : null;

  // Патч — строго после создания плеера
  try { if (player) mountPlayerPatch(player); } catch { /* ignore */ }

  // Сбор ID на лету (модалки, динамика)
  installCollector();

  // Кнопка «Mix Radio / Next»
  const btn = document.querySelector("#random-radio");
  if (btn) {
    btn.addEventListener("click", (e) => {
      e.preventDefault();
      if (!player) return;

      // Если свернут (пузырь) — просто next, не раскрывая плеер
      if (player.isMinimized?.()) { player.next?.(); return; }

      // Если ещё не активен — стартуем радио или next по готовой очереди
      if (!player.isActive?.()) {
        if (player.hasQueue?.()) player.next?.();
        else startMixRadio(player);
        return;
      }

      // Если активен — просто next
      player.next?.();
    });
  }

  // Радио-меню (доп. кнопка под MixRadio)
  const ensureMenu = () => installMixRadioMenu("#mixradio-menu-btn", player);
  ensureMenu();
  window.addEventListener("load", ensureMenu);
  document.getElementById("filters-toggle")?.addEventListener("click", () => {
    setTimeout(ensureMenu, 0);
  });

  // Привязка ассистента
  bindAssistantToCatalog(player);
});

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/lib/scroll-lock.js

**size:** 1292 bytes &nbsp;&nbsp; **sha1:** `18ed610d66bd9f9b9602d1d40a1e018aef33c26b`

```javascript
// Реф-счётчик + «аварийная» разблокировка
let depth = 0;
let savedY = 0;

export function lockScroll() {
  if (depth++ === 0) {
    savedY = window.scrollY || document.documentElement.scrollTop || 0;
    const s = document.body.style;
    s.position = "fixed";
    s.top = `-${savedY}px`;
    s.left = "0";
    s.right = "0";
    s.width = "100%";
    document.body.classList.add("scroll-locked");
  }
}

export function unlockScroll(force = false) {
  if (force) depth = 1;                // принудительно «свести» к нулю
  if (depth > 0 && --depth === 0) {
    const s = document.body.style;
    s.position = s.top = s.left = s.right = s.width = "";
    window.scrollTo(0, savedY);
    document.body.classList.remove("scroll-locked");
  }
}

// на всякий случай — доступно из консоли: window.__unlockScroll()
export function emergencyUnlock() { unlockScroll(true); }
if (typeof window !== "undefined") {
  window.__unlockScroll = emergencyUnlock;
  // если страница перегружается в зафиксированном состоянии — снимем блокировку
  window.addEventListener("pageshow", () => emergencyUnlock());
}

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/lib/sound.js

**size:** 3822 bytes &nbsp;&nbsp; **sha1:** `08ad23667a1f493c41e3f2d95ec59d55c1ef502d`

```javascript

// Мягкий «клац» (tap) и чуть иной звук для пагинации (page)
let ctx, master, comp, postLP;
let inited = false;

function init() {
  if (inited) return;
  const AC = window.AudioContext || window.webkitAudioContext;
  if (!AC) return;
  ctx = new AC();

  comp = ctx.createDynamicsCompressor();
  comp.threshold.value = -26;
  comp.knee.value = 22;
  comp.ratio.value = 6;
  comp.attack.value = 0.004;
  comp.release.value = 0.08;

  postLP = ctx.createBiquadFilter();
  postLP.type = "lowpass";
  postLP.frequency.value = 2300;
  postLP.Q.value = 0.6;

  master = ctx.createGain();
  master.gain.value = 0.11;

  master.connect(postLP);
  postLP.connect(comp);
  comp.connect(ctx.destination);

  // Разблокировка на первом жесте
  const unlock = () => {
    try { ctx.resume(); } catch {}
    window.removeEventListener("pointerdown", unlock);
    window.removeEventListener("keydown", unlock);
    window.removeEventListener("touchstart", unlock);
  };
  window.addEventListener("pointerdown", unlock, { once: true, passive: true });
  window.addEventListener("keydown", unlock, { once: true });
  window.addEventListener("touchstart", unlock, { once: true, passive: true });

  inited = true;
}

function resume() { if (ctx && ctx.state === "suspended") ctx.resume(); }

function tap() {
  if (!inited) init();
  if (!ctx) return;
  resume();
  const now = ctx.currentTime + 0.004;

  // шумовой щелчок
  const durNoise = 0.055;
  const nsrc = ctx.createBufferSource();
  const nbuf = ctx.createBuffer(1, Math.max(32, (ctx.sampleRate * durNoise) | 0), ctx.sampleRate);
  const ch = nbuf.getChannelData(0);
  for (let i = 0; i < ch.length; i++) {
    const t = i / ch.length;
    ch[i] = (Math.random() * 2 - 1) * Math.pow(1 - t, 2);
  }
  nsrc.buffer = nbuf;

  const bp = ctx.createBiquadFilter();
  bp.type = "bandpass"; bp.frequency.value = 2050; bp.Q.value = 0.9;
  const hp = ctx.createBiquadFilter();
  hp.type = "highpass"; hp.frequency.value = 360; hp.Q.value = 0.7;

  const ng = ctx.createGain();
  ng.gain.setValueAtTime(0.0001, now);
  ng.gain.linearRampToValueAtTime(0.45, now + 0.004);
  ng.gain.exponentialRampToValueAtTime(0.0001, now + 0.055);

  nsrc.connect(bp); bp.connect(hp); hp.connect(ng); ng.connect(master);
  nsrc.start(now); nsrc.stop(now + 0.06);

  // лёгкий верхний обертон
  const osc = ctx.createOscillator();
  osc.type = "triangle"; osc.frequency.setValueAtTime(2100, now);
  const og = ctx.createGain();
  og.gain.setValueAtTime(0.0001, now);
  og.gain.linearRampToValueAtTime(0.20, now + 0.003);
  og.gain.exponentialRampToValueAtTime(0.0001, now + 0.05);
  osc.connect(og); og.connect(master);
  osc.start(now); osc.stop(now + 0.055);

  // чуть «тела»
  const low = ctx.createOscillator();
  low.type = "sine"; low.frequency.setValueAtTime(165, now);
  const lg = ctx.createGain();
  lg.gain.setValueAtTime(0.0001, now);
  lg.gain.linearRampToValueAtTime(0.05, now + 0.003);
  lg.gain.exponentialRampToValueAtTime(0.0001, now + 0.042);
  low.connect(lg); lg.connect(master);
  low.start(now); low.stop(now + 0.045);
}

function page() {
  if (!inited) init();
  if (!ctx) return;
  resume();
  const now = ctx.currentTime + 0.003;
  const osc = ctx.createOscillator();
  osc.type = "triangle"; osc.frequency.setValueAtTime(1750, now);
  const g = ctx.createGain();
  g.gain.setValueAtTime(0.0001, now);
  g.gain.linearRampToValueAtTime(0.17, now + 0.003);
  g.gain.exponentialRampToValueAtTime(0.0001, now + 0.06);
  osc.connect(g); g.connect(master);
  osc.start(now); osc.stop(now + 0.065);
}

export const UISound = { tap, page };
export default UISound;

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/artists/lib/toast.js

**size:** 1105 bytes &nbsp;&nbsp; **sha1:** `74b455fddcd2e40a485d4f95087f4a12afc24f45`

```javascript

let box = null;

function ensureBox() {
  if (box) return box;
  box = document.createElement("div");
  box.className = "toast-container";
  document.body.appendChild(box);
  return box;
}

function show(message, kind = "info", timeout = 3000) {
  ensureBox();
  const item = document.createElement("div");
  item.className = `toast toast--${kind}`;
  item.setAttribute("role", "status");
  item.textContent = String(message || "");
  box.appendChild(item);

  const t = setTimeout(() => hide(item), timeout);
  item.addEventListener("click", () => { clearTimeout(t); hide(item); });
}

function hide(item) {
  item.classList.add("toast--hide");
  item.addEventListener("animationend", () => item.remove(), { once: true });
}

export const toast = {
  show,
  info: (m, t) => show(m, "info", t),
  success: (m, t) => show(m, "success", t),
  error: (m, t) => show(m, "error", t),
};

// Для обратной совместимости, если что-то ещё дергает window.__toast
if (!window.__toast) window.__toast = toast;

export default toast;

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/assistant/assistant-hooks.js

**size:** 2251 bytes &nbsp;&nbsp; **sha1:** `3da9584bb2d1beda81451e495b4523eebaf5cfa4`

```javascript
// lightweight hooks for Assistant UI
// normalize timing phrases & small utilities
(() => {
  const W = (window.Assistant = window.Assistant || {});

  function normalizeDashes(s) {
    return String(s || "").replace(/[–—]/g, "-");
  }

  function normalizeTimingPhrases(s0) {
    let s = normalizeDashes(String(s0 || "")).toLowerCase();

    // "через полминуты" -> "через 30 секунд"; "через пол часа" -> "через 30 минут"
    s = s.replace(/через\s+пол ?минут[ыи]/g, "через 30 секунд");
    s = s.replace(/через\s+пол ?часа/g, "через 30 минут");

    // "через минуту/секунду/час" -> явная единица (поможет простым парсерам)
    s = s.replace(/через\s+минут[уы]/g, "через 1 минуту");
    s = s.replace(/через\s+секунд[уы]/g, "через 1 секунду");
    s = s.replace(/через\s+час[ау]?/g, "через 1 час");

    // "через 15–20 секунд" -> берём правую границу
    s = s.replace(/через\s+(\d{1,3})\s*-\s*(\d{1,3})\s*(секунд\w*|минут\w*|час\w*|s|m|h|min|sec|hour|minutes?)/g,
      (_m, a, b, u) => `через ${b} ${u}`);

    // "через 10, 15, 20 секунд" -> последняя величина
    s = s.replace(
      /через\s+(\d{1,3}(?:\s*,\s*\d{1,3})+)\s*(секунд\w*|минут\w*|час\w*|s|m|h|min|sec|hour|minutes?)/g,
      (_m, list, u) => {
        const parts = list.split(/\s*,\s*/).map(Number).filter((n) => Number.isFinite(n));
        const last = parts[parts.length - 1] || 0;
        return `через ${last} ${u}`;
      }
    );

    // разговорные уменьшительные → нормальная форма
    s = s.replace(/секундочк[ауи]/g, "секунду").replace(/минутк[ауи]/g, "минуту");

    return s0 && s !== s0 ? s : s0;
  }

  // Можно расширять обработчик дальше по необходимости
  W.preprocessText = function (text) {
    const t1 = normalizeTimingPhrases(text);
    return t1;
  };
})();

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/assistant/bridge.js

**size:** 5019 bytes &nbsp;&nbsp; **sha1:** `75dfcf1fef9e3fd09aea3ed96b39cd9d1e75d108`

```javascript
/* Bridge: превращаем события assistant:* в реальные действия плеера/интерфейса */
(() => {
  // Signal presence of assistant bridge to avoid duplicate wiring
  try { window.__AH_BRIDGE_PRESENT = true; } catch {}
  // If the dedicated player patch is installed, skip this bridge to avoid double-handling.
  if (typeof window !== 'undefined' && window.__AM_PLAYER_PATCH_INSTALLED__) {
    return;
  }

  const q = (sel) => document.querySelector(sel);

  function safeCall(method, ...args) {
    try { return method?.(...args); } catch { /* no-op */ }
  }
  function clickFirst(...selectors) {
    for (const s of selectors) {
      const el = q(s);
      if (el) { el.click(); return true; }
    }
    return false;
  }

  function player() { return (window.AM && window.AM.player) || null; }

  // Вид (list/grid)
  document.addEventListener("assistant:view", (e) => {
    const mode = e?.detail?.mode;
    const isList = mode === "list";
    document.documentElement.classList.toggle("list-view", !!isList);
  });

  // Прямой запуск по ID/URL (если ассистент прислал конкретную песню)
  document.addEventListener("assistant:play", (e) => {
    const id = e?.detail?.id;
    const query = e?.detail?.query;
    const p = player();
    const ytid = (s) => {
      if (!s) return "";
      if (/^[\w-]{11}$/.test(s)) return s;
      try {
        const u = new URL(s, location.href);
        if (/youtu\.be$/i.test(u.hostname)) return u.pathname.slice(1);
        const m = u.pathname.match(/\/(?:embed|v|shorts)\/([^/?#]+)/i);
        if (m && m[1] && /^[\w-]{11}$/.test(m[1])) return m[1];
        const v = u.searchParams.get("v");
        if (v && /^[\w-]{11}$/.test(v)) return v;
      } catch {}
      return "";
    };

    const tid = id || ytid(query);
    if (p && tid && typeof p.openQueue === "function") {
      p.openQueue([tid], { startIndex: 0, shuffle: false, loop: true });
    } else if (tid) {
      // как фоллбэк — попробуем просто кликнуть на ссылку в DOM, если она есть
      const link = document.querySelector(`a[href*="${tid}"]`);
      if (link) link.click();
    }
  });

  // Транспорт
  document.addEventListener("assistant:player-play", () => {
    const p = player();
    if (!p || !safeCall(p.play)) {
      clickFirst(".am-player [data-action='play']",
                 ".am-player__btn--play",
                 "button[aria-label='Play']");
    }
  });

  document.addEventListener("assistant:player-pause", () => {
    const p = player();
    if (!p || !safeCall(p.pause)) {
      clickFirst(".am-player [data-action='pause']",
                 ".am-player__btn--pause",
                 "button[aria-label='Pause']");
    }
  });

  document.addEventListener("assistant:player-stop", () => {
    const p = player();
     if (p && safeCall(p.stop)) return;
    // 2) пробуем кнопки стопа
    if (clickFirst(".am-player [data-action='stop']", "button[aria-label='Stop']")) return;
    // 3) деградация в паузу
    if (p && safeCall(p.pause)) return;
    clickFirst(".am-player [data-action='pause']", "button[aria-label='Pause']");
  });

  document.addEventListener("assistant:player-next", () => {
    const p = player();
    if (!p || !safeCall(p.next)) {
      clickFirst(".am-player [data-action='next']",
                 ".am-player__btn--next",
                 "button[aria-label='Next']");
    }
  });

  document.addEventListener("assistant:player-prev", () => {
    const p = player();
    if (!p || !safeCall(p.prev)) {
      clickFirst(".am-player [data-action='prev']",
                 ".am-player__btn--prev",
                 "button[aria-label='Previous']", "button[aria-label='Prev']");
    }
  });

  // Громкость
  document.addEventListener("assistant:volume", (e) => {
    const delta = Number(e?.detail?.delta ?? 0);
    const p = player();
    if (p && typeof p.setVolume === "function") {
      const cur = p.getVolume?.() ?? 0.7;
      const next = Math.max(0, Math.min(1, cur + delta));
      p.setVolume(next);
      return;
    }

    // Фоллбэк по слайдеру громкости в DOM
    const slider = document.querySelector(".am-player input[type='range'][name='volume'], .am-player .volume input[type='range']");
    if (slider) {
      const cur = Number(slider.value || 70) / 100;
      const next = Math.max(0, Math.min(1, cur + delta));
      slider.value = String(Math.round(next * 100));
      slider.dispatchEvent(new Event("input", { bubbles: true }));
    }
  });

  // MixRadio — отдаём в index.js, там есть buildPool/startMixRadio
  document.addEventListener("assistant:mixradio", () => {
    const btn = q("#random-radio");
    if (btn) btn.click();
  });
})();

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/assistant/chat.js

**size:** 60807 bytes &nbsp;&nbsp; **sha1:** `178382235193088c9c9dc22c15f34e30c3ca2292`

```javascript
// Chat Friend + AI bridge with memory + Provider + Server/Browser TTS
// VERSION: chat.js v2.8.8
// (stronger delay parser + ms validation + action sanitization + logs)
// — 2025-09-11
(() => {
  if (window.__ASSISTANT_UI_INIT__) return;
  window.__ASSISTANT_UI_INIT__ = true;

  const API_BASE =
    (import.meta?.env?.VITE_API_URL && import.meta.env.VITE_API_URL.replace(/\/+$/, "")) ||
    (location.hostname === "localhost" ? "http://localhost:8787" : "");

  // ─── helpers ─────────────────────────────────────────────────────────
  function getYouTubeId(urlOrId) {
    if (!urlOrId) return "";
    if (/^[\w-]{11}$/.test(urlOrId)) return urlOrId;
    try {
      const u = new URL(urlOrId, location.href);
      if (/youtu\.be$/i.test(u.hostname)) return u.pathname.slice(1);
      const v = u.searchParams.get("v");
      if (v && /^[\w-]{11}$/.test(v)) return v;
      const m = u.pathname.match(/\/(?:embed|v|shorts)\/([^/?#]+)/i);
      if (m && m[1] && /^[A-Za-z0-9_-]{11}$/.test(m[1])) return m[1];
    } catch {}
    return "";
  }
  const isStr = (v) => typeof v === "string" && v.length > 0;
  const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

  // всё, что похоже на «следующая/другая/another/next/skip»
  const NEXT_RE = /\b(следующ(ую|ий|ая)|друг(ую|ой)|ин(ую|ой)|нов(ую|ый)|another|next|skip|скип)\b/i;

  // ─── language lock (только из настроек) ──────────────────────────────
  const state = {
    langPref:
      (localStorage.getItem("assistant.lang") || "").toLowerCase() ||
      ((navigator.language || "").toLowerCase().startsWith("uk")
        ? "uk"
        : (navigator.language || "").toLowerCase().startsWith("en")
        ? "en"
        : "ru"),
  };
  function pinLang(lang) {
    const v = (lang || "").toLowerCase();
    if (v === "ru" || v === "uk" || v === "en") {
      state.langPref = v;
      try {
        localStorage.setItem("assistant.lang", v);
      } catch {}
      addMsg("note", `Язык речи закреплён: ${v.toUpperCase()}`);
    }
  }
  function codeToBCP47(v) {
    return v === "uk" ? "uk-UA" : v === "ru" ? "ru-RU" : "en-US";
  }

  // ─── UI ──────────────────────────────────────────────────────────────
  const root = document.createElement("div");
  root.id = "assistant-root";
  root.className = "assistant";
  root.innerHTML = `
    <button class="assistant__toggle" aria-label="Чат-ассистент">🤖</button>
    <div class="assistant__panel" hidden>
      <div class="assistant__header">
        <strong>Чат-друг</strong>
        <div class="assistant__hdr-actions">
          <span class="assistant__ai-badge">${API_BASE ? "AI" : ""}</span>
          <label class="assistant__prov-wrap" title="Режим ИИ">
            <span class="assistant__prov-label">Режим</span>
            <select id="as-provider">
              <option value="auto">Auto</option>
              <option value="free">Free</option>
              <option value="pro">Pro</option>
            </select>
          </label>
          <button class="assistant__gear" aria-label="Настройки">⚙️</button>
          <button class="assistant__close" aria-label="Закрыть">✕</button>
        </div>
      </div>
      <div class="assistant__log" id="assistantLog"></div>
      <div class="assistant__controls">
        <button class="assistant__mic" aria-label="Голос">🎤</button>
        <input class="assistant__input" type="text" placeholder="Скажи або напиши…"/>
        <button class="assistant__send">Отправить</button>
      </div>
      <div class="assistant__settings" hidden>
        <label class="assistant__row">
          <span>Язык (RU/UK/EN)</span>
          <select id="as-lang">
            <option value="ru">Русский</option>
            <option value="uk">Українська</option>
            <option value="en">English</option>
          </select>
        </label>
        <label class="assistant__row">
          <span>Голос озвучки</span>
          <select id="as-voice"></select>
        </label>
        <label class="assistant__row">
          <span>Серверный TTS (Piper)</span>
          <input id="as-tts-server" type="checkbox" />
          <small class="assistant__hint">Нужно настроить /api/tts на сервере. Иначе будет браузерный голос.</small>
        </label>
        <label class="assistant__row">
          <span>Пост. прослушивание (wake word)</span>
          <input id="as-wake-on" type="checkbox" />
        </label>
        <label class="assistant__row">
          <span>Фраза активации</span>
          <input id="as-wake-phrase" type="text" value="диджей,dj" />
        </label>
        <div class="assistant__row">
          <button id="as-test-voice" type="button">Проба голоса</button>
          <button id="as-clear-log" type="button">Очистить чат</button>
          <button id="as-hide-settings" type="button">Свернуть настройки</button>
        </div>
        <div class="assistant__row">
          <small class="assistant__hint">
            Фоновое прослушивание работает только при активной вкладке и выданном доступе к микрофону.
          </small>
        </div>
      </div>
    </div>`;
  document.body.appendChild(root);

  const style = document.createElement("style");
  style.textContent = `
    .assistant{position:fixed;right:18px;bottom:18px;z-index:9999}
    .assistant__toggle{width:48px;height:48px;border-radius:50%;border:none;background:#0ea5e9;color:#fff;font-size:22px;box-shadow:0 8px 20px rgba(0,0,0,.35);cursor:pointer}
    .assistant__panel{position:fixed;right:18px;bottom:84px;width:min(92vw,520px);max-height:min(80vh,720px);display:flex;flex-direction:column;background:#111418;border:1px solid rgba(255,255,255,.06);border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.6);overflow:hidden}
    .assistant__header{display:flex;align-items:center;gap:.75rem;padding:.8rem 1rem;background:linear-gradient(180deg,#121821,#0e1318);border-bottom:1px solid rgba(255,255,255,.06)}
    .assistant__hdr-actions{margin-left:auto;display:flex;gap:.5rem;align-items:center}
    .assistant__ai-badge{font:600 12px;color:#9ae6b4;background:#203021;border:1px solid #2b4a2d;padding:.25rem .4rem;border-radius:6px}
    .assistant__prov-wrap{display:flex;align-items:center;gap:.35rem;color:#cbd5e1}
    .assistant__prov-wrap select{background:#0b0f14;border:1px solid #263142;color:#e8f1ff;border-radius:8px;padding:.2rem .35rem}
    .assistant__close,.assistant__gear{background:none;border:1px solid rgba(255,255,255,.14);color:#cbd5e1;width:32px;height:32px;border-radius:8px;cursor:pointer}
    .assistant__log{padding:10px 12px;overflow:auto;display:flex;flex-direction:column;gap:8px;flex:1;min-height:160px}
    .assistant__msg{padding:.6rem .9rem;border-radius:12px;max-width:85%;white-space:pre-wrap}
    .assistant__msg--user{margin-left:auto;background:#243244;color:#e7f0ff}
    .assistant__msg--bot{background:#171b21;color:#dfe6ef}
    .assistant__msg--note{align-self:center;opacity:.7;font-size:.9em}
    .assistant__controls{display:flex;gap:8px;padding:10px;border-top:1px solid rgba(255,255,255,.08);background:#0f1216}
    .assistant__controls input{flex:1;min-width:0;padding:.65rem .8rem;border-radius:10px;background:#0b0f14;border:1px solid #263142;color:#e8f1ff}
    .assistant__controls button{border-radius:10px;background:#0ea5e9;color:#fff;border:none;padding:.65rem .9rem;cursor:pointer}
    .assistant__mic{background:#1f2836 !important;border:1px solid #2a3a52 !important;color:#cbd5e1 !important}
    .assistant__mic.is-on{outline:2px solid #0ea5e9}
    .assistant__settings{padding:.75rem;border-top:1px solid rgba(255,255,255,.08);background:#0f1216}
    .assistant__row{display:flex;align-items:center;gap:.5rem;margin:.45rem 0}
    .assistant__row > span{min-width:150px;opacity:.85}
    .assistant__hint{opacity:.7}
    #as-voice,#as-lang{flex:1;min-width:0;padding:.45rem .55rem;border-radius:8px;background:#0b0f14;border:1px solid #263142;color:#e8f1ff}
  `;
  document.head.appendChild(style);

  // refs
  const panel = root.querySelector(".assistant__panel");
  const btnClose = root.querySelector(".assistant__close");
  const btnGear = root.querySelector(".assistant__gear");
  const logEl = root.querySelector("#assistantLog");
  const inputEl = root.querySelector(".assistant__input");
  const btnSend = root.querySelector(".assistant__send");
  const btnMic = root.querySelector(".assistant__mic");
  const selLang = root.querySelector("#as-lang");
  const selVoice = root.querySelector("#as-voice");
  const selProv = root.querySelector("#as-provider");
  const chkTTS = root.querySelector("#as-tts-server");
  const btnTest = root.querySelector("#as-test-voice");
  const btnClr = root.querySelector("#as-clear-log");
  const btnHideSettings = root.querySelector("#as-hide-settings");
  const chkWake = root.querySelector("#as-wake-on");
  const inpWake = root.querySelector("#as-wake-phrase");

  // ─── memory ───────────────────────────────────────────────────────────
  const chat = {
    history: [],
    lastIds: [],
    lastGenre: null,
    lastMood: null,
    nowPlaying: null,
    lastQuery: "",
  };

  // кольцо последних ID (до 25) для exclude
  const recent = {
    ids: [],
    add(id) {
      if (!id) return;
      this.ids = this.ids.filter((x) => x !== id);
      this.ids.push(id);
      if (this.ids.length > 25) this.ids.shift();
    },
    has(id) {
      return this.ids.includes(id);
    },
    list() {
      return [...this.ids];
    },
  };

  // клиентская очередь (управляем сами)
  const cQueue = {
    ids: [],
    seed: "",
    busy: false,
    clear() {
      this.ids = [];
      this.seed = "";
    },
    async refill(q) {
      if (!API_BASE || this.busy) return;
      this.busy = true;
      try {
        const r = await fetch(`${API_BASE}/api/yt/search`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ q, max: 30, exclude: recent.list(), shuffle: true }),
        });
        const j = await r.json().catch(() => ({ ids: [] }));
        const got = Array.isArray(j.ids) ? j.ids : [];
        this.seed = q;
        // жёсткий дедуп: выкидываем недавние
        this.ids = got.filter((id) => /^[A-Za-z0-9_-]{11}$/.test(id) && !recent.has(id));
      } catch (e) {
        console.warn("[queue] refill failed", e);
      } finally {
        this.busy = false;
      }
    },
    take() {
      while (this.ids.length) {
        const id = this.ids.shift();
        if (!recent.has(id)) return id;
      }
      return "";
    },
    dropCurrent(id) {
      if (!id) return;
      this.ids = this.ids.filter((x) => x !== id);
    },
  };

  // ─── Anti AB-loop detector ───────────────────────────────────────────
  const loop = {
    last: [],
    lastBreak: 0,
    push(id) {
      if (!id) return;
      this.last.push(id);
      if (this.last.length > 8) this.last.shift();
    },
    isABPattern() {
      if (this.last.length < 6) return false;
      const a = this.last.slice(-6);
      const uniq = Array.from(new Set(a));
      if (uniq.length !== 2) return false;
      if (a[0] === a[1]) return false;
      for (let i = 2; i < a.length; i++) {
        if (a[i] !== a[i - 2]) return false;
      }
      return true; // A,B,A,B,A,B
    },
  };

  window.addEventListener("AM.player.track", (e) => {
    const id = e?.detail?.id || "";
    const title = String(e?.detail?.title || "");
    let artist = "",
      song = "";
    const m = title.split(" - ");
    if (m.length >= 2) {
      artist = m[0].trim();
      song = m.slice(1).join(" - ").trim();
    }
    chat.nowPlaying = { id, title, artist, song };
    if (id) {
      recent.add(id);
      chat.lastIds = [id];
      cQueue.dropCurrent(id);
      loop.push(id);

      // разрыв «A-B-A-B» зацикливания
      if (loop.isABPattern() && Date.now() - loop.lastBreak > 5000) {
        loop.lastBreak = Date.now();
        const seed = chat.lastQuery || randomMixSeed();
        (async () => {
          await cQueue.refill(seed);
          const nid = cQueue.take();
          if (nid) dispatch("play", { id: nid });
          else dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
          addMsg("note", "[anti-loop] Пересобрал поток, чтобы не заедало.");
        })();
      }
    }
  });

  // ─── Provider pref ───────────────────────────────────────────────────
  const provPref = localStorage.getItem("assistant.provider") || "auto";
  selProv.value = provPref;
  selProv.addEventListener("change", () => {
    localStorage.setItem("assistant.provider", selProv.value);
    addMsg(
      "note",
      `Режим: ${selProv.value === "pro" ? "Pro (OpenAI)" : selProv.value === "free" ? "Free (локально)" : "Auto"}`
    );
  });
  function providerToSend() {
    const p = localStorage.getItem("assistant.provider") || "auto";
    if (p === "pro") return "openai";
    if (p === "free") return "lmstudio";
    return undefined; // auto
  }

  // ─── Language select ─────────────────────────────────────────────────
  if (selLang) {
    selLang.value = state.langPref;
    selLang.addEventListener("change", () => {
      pinLang(selLang.value);
      speak(sampleByLang(state.langPref));
      // перезапуск wake-word с новым языком
      if (SR && isWakeOn()) startWakeLoop(true);
    });
  }

  // ─── Server TTS pref ─────────────────────────────────────────────────
  chkTTS.checked = localStorage.getItem("assistant.ttsServer") === "1";
  chkTTS.addEventListener("change", () => {
    localStorage.setItem("assistant.ttsServer", chkTTS.checked ? "1" : "0");
    addMsg("note", chkTTS.checked ? "Серверный TTS включён" : "Серверный TTS выключен");
  });

  // ─── Voices list (browser) ───────────────────────────────────────────
  const tts = { voiceName: localStorage.getItem("assistant.voice") || "" };
  function populateVoices() {
    try {
      const V = window.speechSynthesis?.getVoices?.() || [];
      selVoice.innerHTML =
        `<option value="">Системный / лучший доступный</option>` +
        V.map((v) => `<option value="${v.name}">${v.name} — ${v.lang}</option>`).join("");
      if (tts.voiceName) selVoice.value = tts.voiceName;
    } catch {}
  }
  if ("speechSynthesis" in window) {
    try {
      window.speechSynthesis.onvoiceschanged = populateVoices;
    } catch {}
    setTimeout(populateVoices, 300);
  }
  selVoice?.addEventListener("change", () => {
    tts.voiceName = selVoice.value || "";
    localStorage.setItem("assistant.voice", tts.voiceName);
    speak(sampleByLang(state.langPref));
  });

  // ─── server TTS (buffered, explicit lang) ────────────────────────────
  async function speakServer(text, lang) {
    if (!API_BASE) throw new Error("no API");
    const url = `${API_BASE}/api/tts?lang=${encodeURIComponent(lang || "")}`;
    const r = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json; charset=utf-8" },
      body: JSON.stringify({ text, lang }),
    });
    if (!r.ok) {
      let msg = `tts ${r.status}`;
      try {
        const j = await r.json();
        if (j?.error) msg += ` ${j.error}`;
      } catch {}
      throw new Error(msg);
    }
    const buf = await r.arrayBuffer();
    const urlObj = URL.createObjectURL(new Blob([buf], { type: "audio/wav" }));
    const audio = new Audio(urlObj);
    audio.preload = "auto";
    try {
      await audio.play();
    } catch (e) {
      console.warn("[tts] play() blocked:", e);
    }
    audio.onended = () => URL.revokeObjectURL(urlObj);
    audio.onerror = () => console.error("[tts] audio error:", audio.error);
  }
  async function ttsServerSpeak(text, lang) {
    return speakServer(text, lang);
  }

  // ─── browser TTS (strict voice match) ────────────────────────────────
  function speakBrowser(text, lang) {
    try {
      if (!("speechSynthesis" in window)) return;
      try {
        window.speechSynthesis.cancel();
      } catch {}
      const u = new SpeechSynthesisUtterance(text);
      const want = codeToBCP47(lang);
      const wantPrefix = want.slice(0, 2);
      const voices = (window.speechSynthesis.getVoices?.() || []).filter((v) =>
        String(v.lang || "").toLowerCase().startsWith(wantPrefix)
      );
      let v = voices.find((v) => v.name === tts.voiceName);
      if (!v) v = voices[0];
      if (v) u.voice = v;
      u.lang = want;
      u.rate = 1;
      u.pitch = 1;
      window.speechSynthesis.speak(u);
    } catch {}
  }

  // ─── public speak() ──────────────────────────────────────────────────
  function speak(text) {
    const lang = state.langPref;
    const useServer = chkTTS.checked && !!API_BASE;
    if (useServer) {
      speakServer(text, lang).catch((err) => {
        console.warn("[tts] server failed → browser fallback:", err?.message || err);
        addMsg("note", `[TTS fallback → ${lang}]`);
        speakBrowser(text, lang);
      });
    } else {
      speakBrowser(text, lang);
    }
  }
  function sampleByLang(lang) {
    return lang === "uk"
      ? "Привіт! Перевірка голосу."
      : lang === "en"
      ? "Hello! This is a voice test."
      : "Привет! Проверка голоса.";
  }

  btnTest?.addEventListener("click", () => speak(sampleByLang(state.langPref)));
  btnClr?.addEventListener("click", () => {
    logEl.innerHTML = "";
    chat.history = [];
  });
  btnHideSettings?.addEventListener("click", () => {
    const s = root.querySelector(".assistant__settings");
    if (s) s.hidden = true;
  });

  // === Sleep timer (helpers) ===========================================
  let sleepTimerId = null,
    sleepAfterTrack = false,
    sleepAfterAction = "stop";

  // защита от авто-next после намеренной паузы
  let manualPauseGuardUntil = 0; // пока > now — не авто-Next на paused
  function markManualPauseGuard(ms = 60 * 60 * 1000) {
    manualPauseGuardUntil = Date.now() + ms;
  }

  function clearSleepTimer() {
    if (sleepTimerId) {
      clearTimeout(sleepTimerId);
      sleepTimerId = null;
    }
  }
  function scheduleActionLater(ms, op) {
    clearSleepTimer();
    // валидация и минимальный разумный порог
    if (!Number.isFinite(ms) || ms <= 0) {
      console.warn("[timer] invalid ms:", ms);
      addMsg("note", "⏱ Не понял время для таймера. Скажи, например, «через 20 секунд» или «через 1:30».");
      return;
    }
    const msSafe = Math.max(500, Math.round(ms));
    addMsg("note", `⏱ Таймер установлен: ${Math.round(msSafe / 1000)} сек → ${op === "pause" ? "пауза" : "стоп"}.`);
    sleepTimerId = setTimeout(() => {
      if (op === "pause") {
        dispatch("player-pause");
        markManualPauseGuard(12 * 60 * 60 * 1000); // 12 ч защиты от авто-next
        addMsg("note", "⏰ Таймер: пауза.");
      } else {
        dispatch("player-stop");
        addMsg("note", "⏰ Таймер: стоп.");
      }
    }, msSafe);
  }
  function parseSleepDuration(s) {
    const r =
      /(\d{1,3})\s*(час(?:ов|а)?|h|hour|hours|минут(?:ы|у)?|мин|m|min|minutes|секунд(?:ы|у)?|сек|s|sec|seconds)/i;
    const m = String(s || "").toLowerCase().match(r);
    if (!m) return null;
    const n = Number(m[1] || 0);
    const unit = (m[2] || "").toLowerCase();
    if (/^час|h|hour/.test(unit)) return n * 3600 * 1000;
    if (/^мин|minutes?/.test(unit) || /^минут/.test(unit) || unit === "m" || unit === "min") return n * 60 * 1000;
    return n * 1000;
  }
  const DASH = /[–—-]/; // en dash / em dash / hyphen

  // авто-продолжение по окончанию трека + «после текущего»
  let lastEndedNextAt = 0;
  window.addEventListener("AM.player.ended", () => {
    if (sleepAfterTrack) {
      sleepAfterTrack = false;
      clearSleepTimer();
      if (sleepAfterAction === "pause") {
        dispatch("player-pause");
        markManualPauseGuard(12 * 60 * 60 * 1000);
      } else {
        dispatch("player-stop");
      }
      addMsg(
        "note",
        sleepAfterAction === "pause" ? "⏰ Пауза после текущего трека." : "⏰ Остановлено после текущего трека."
      );
      return;
    }
    // авто-next, если пользователь не просил «после текущего»
    if (Date.now() - lastEndedNextAt > 1000) {
      lastEndedNextAt = Date.now();
      nextWithGuard();
    }
  });

  // страховка тишины
  let silenceTimer = null;
  window.addEventListener("AM.player.state", (e) => {
    const st = String(e?.detail?.state || "").toLowerCase(); // "paused"/"stopped"/"ended"
    clearTimeout(silenceTimer);
    if (!sleepAfterTrack && (st === "stopped" || st === "ended" || st === "paused")) {
      if (st === "paused" && Date.now() < manualPauseGuardUntil) return;
      silenceTimer = setTimeout(() => {
        if (!sleepAfterTrack && !(st === "paused" && Date.now() < manualPauseGuardUntil)) {
          nextWithGuard();
        }
      }, 3000);
    }
  });

  // ─── log/history ─────────────────────────────────────────────────────
  function addMsg(role, content) {
    const cls =
      role === "user"
        ? "assistant__msg--user"
        : role === "bot"
        ? "assistant__msg--bot"
        : "assistant__msg--note";
    const d = document.createElement("div");
    d.className = `assistant__msg ${cls}`;
    d.textContent = String(content || "");
    logEl.appendChild(d);
    logEl.scrollTop = logEl.scrollHeight;
    if (role !== "note") {
      chat.history.push({ role: role === "user" ? "user" : "assistant", content: String(content || "") });
      chat.history = chat.history.slice(-10);
    }
  }

  function dispatch(name, detail = {}) {
    const ev = new CustomEvent(`assistant:${name}`, { detail, bubbles: true, composed: true });
    window.dispatchEvent(ev);
    document.dispatchEvent(new CustomEvent(`assistant:${name}`, { detail, bubbles: true, composed: true }));
  }

  // ─── mix seeds ───────────────────────────────────────────────────────
  const MIX_SEEDS = [
    "lofi hip hop radio",
    "classic rock hits",
    "best jazz music relaxing",
    "indie rock playlist",
    "hip hop playlist",
    "edm house techno mix",
    "ambient music long playlist",
    "pop hits playlist",
    "latin hits playlist",
    "rnb soul classics playlist",
    "best reggae mix",
  ];
  let lastMixSeed = "";
  function randomMixSeed() {
    if (!MIX_SEEDS.length) return "music radio mix";
    let tries = 0,
      seed = MIX_SEEDS[(Math.random() * MIX_SEEDS.length) | 0];
    while (MIX_SEEDS.length > 1 && seed === lastMixSeed && tries < 6) {
      seed = MIX_SEEDS[(Math.random() * MIX_SEEDS.length) | 0];
      tries++;
    }
    lastMixSeed = seed;
    return seed;
  }
  function ensureMoodQuery(mood) {
    const m = String(mood || "").toLowerCase();
    if (m === "happy") return "upbeat feel good hits";
    if (m === "calm") return "lofi chill beats to relax";
    if (m === "sad") return "sad emotional songs playlist";
    if (m === "energetic") return "high energy workout rock mix";
    return "music radio mix";
  }
  function ensureGenreQuery(genre) {
    const g = String(genre || "").toLowerCase();
    const map = {
      джаз: "best jazz music relaxing",
      рок: "classic rock hits",
      поп: "pop hits playlist",
      электрон: "edm house techno mix",
      lofi: "lofi hip hop radio",
      классик: "classical symphony playlist",
      рэп: "hip hop playlist",
      инди: "indie rock playlist",
      ambient: "ambient music long playlist",
      блюз: "best blues songs playlist",
      шансон: "russian chanson mix",
      folk: "folk acoustic playlist",
      rnb: "rnb soul classics playlist",
      latin: "latin hits playlist",
      reggae: "best reggae mix",
      "k-pop": "kpop hits playlist",
      "j-pop": "jpop hits playlist",
      soundtrack: "movie soundtrack playlist",
    };
    return map[g] || `${g} music playlist`;
  }

  // ─── mood suggestions ────────────────────────────────────────────────
  const MOOD_SUGGEST = {
    ru: {
      calm: {
        genres: ["lofi", "ambient", "джаз", "чилаут", "неоклассика"],
        artists: ["Nujabes", "Bonobo", "Brian Eno", "Massive Attack", "Ludovico Einaudi"],
      },
      happy: {
        genres: ["поп", "инди-поп", "фанк", "диско"],
        artists: ["Dua Lipa", "Pharrell Williams", "Daft Punk", "Maroon 5", "Foster The People"],
      },
      sad: {
        genres: ["инди", "альт-рок", "акустика", "singer-songwriter"],
        artists: ["Radiohead", "Billie Eilish", "Coldplay", "Damien Rice", "Adele"],
      },
      energetic: {
        genres: ["рок", "панк", "EDM", "drum & bass"],
        artists: ["The Prodigy", "Skrillex", "Rage Against The Machine", "Linkin Park", "Pendulum"],
      },
    },
    uk: {
      calm: {
        genres: ["lofi", "ambient", "джаз", "чилаут", "неокласика"],
        artists: ["Nujabes", "Bonobo", "Brian Eno", "Massive Attack", "Ludovico Einaudi"],
      },
      happy: {
        genres: ["поп", "інді-поп", "фанк", "диско"],
        artists: ["Dua Lipa", "Pharrell Williams", "Daft Punk", "Maroon 5", "Foster The People"],
      },
      sad: {
        genres: ["інді", "альт-рок", "акустика", "singer-songwriter"],
        artists: ["Radiohead", "Billie Eilish", "Coldplay", "Damien Rice", "Adele"],
      },
      energetic: {
        genres: ["рок", "панк", "EDM", "drum & bass"],
        artists: ["The Prodigy", "Skrillex", "Rage Against The Machine", "Linkin Park", "Pendulum"],
      },
    },
    en: {
      calm: {
        genres: ["lofi", "ambient", "jazz", "chillout", "neoclassical"],
        artists: ["Nujabes", "Bonobo", "Brian Eno", "Massive Attack", "Ludovico Einaudi"],
      },
      happy: {
        genres: ["pop", "indie pop", "funk", "disco"],
        artists: ["Dua Lipa", "Pharrell Williams", "Daft Punk", "Maroon 5", "Foster The People"],
      },
      sad: {
        genres: ["indie", "alt rock", "acoustic", "singer-songwriter"],
        artists: ["Radiohead", "Billie Eilish", "Coldplay", "Damien Rice", "Adele"],
      },
      energetic: {
        genres: ["rock", "punk", "EDM", "drum & bass"],
        artists: ["The Prodigy", "Skrillex", "Rage Against The Machine", "Linkin Park", "Pendulum"],
      },
    },
  };

  // ─── NEXT with guard ─────────────────────────────────────────────────
  async function nextWithGuard() {
    let id = cQueue.take();
    if (!id && chat.lastQuery) {
      await cQueue.refill(chat.lastQuery);
      id = cQueue.take();
    }
    if (id) {
      dispatch("play", { id });
      return;
    }

    const prevId = chat.nowPlaying?.id || "";
    dispatch("player-next");
    await sleep(700);
    const cur1 = chat.nowPlaying?.id || "";
    if (cur1 && cur1 !== prevId) return;

    dispatch("player-next");
    await sleep(1200);
    const cur2 = chat.nowPlaying?.id || "";
    if (cur2 && cur2 !== prevId) return;

    const seed = chat.lastQuery || randomMixSeed();
    dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
    await sleep(750);
    dispatch("player-next");
  }

  // ─── actions runner ──────────────────────────────────────────────────
  async function runActions(actions = []) {
    for (const a of actions) {
      if (a?.type === "player" && a.action) {
        if (a.action === "next") await nextWithGuard();
        else dispatch("player-" + a.action);
      } else if (a?.type === "view" && a.mode) {
        dispatch("view", { mode: a.mode });
      } else if (a?.type === "recommend") {
        dispatch("recommend", a);
        if (a.genre) chat.lastGenre = a.genre;
        if (a.mood) chat.lastMood = a.mood;
        if (a.autoplay && (a.genre || a.mood || a.like)) {
          const q = a.like ? a.like : a.genre ? ensureGenreQuery(a.genre) : ensureMoodQuery(a.mood);
          chat.lastQuery = q;
          await cQueue.refill(q);
          const id = cQueue.take();
          if (id) dispatch("play", { id });
          else dispatch("play", { query: q, exclude: recent.list(), shuffle: true });
        }
      } else if (a?.type === "volume") {
        dispatch("volume", a);
      } else if (a?.type === "mixradio") {
        const seed = randomMixSeed();
        chat.lastQuery = seed;
        await cQueue.refill(seed);
        const id = cQueue.take();
        if (id) dispatch("play", { id });
        else dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
      } else if (a?.type === "ui" && a.action) {
        if (a.action === "minimize") dispatch("minimize");
        else if (a.action === "expand") dispatch("expand");
      } else if (a?.type === "play" && (a.id || a.query)) {
        if (a.query) {
          chat.lastQuery = a.query;
          await cQueue.refill(a.query);
          const id = cQueue.take();
          if (id) {
            dispatch("play", { id });
            continue;
          }
        }
        dispatch("play", { id: a.id, query: a.query, exclude: recent.list(), shuffle: true });
        const idd = getYouTubeId(a.id || a.query);
        if (idd) {
          chat.lastIds = [idd];
          recent.add(idd);
          cQueue.dropCurrent(idd);
        }
      }
    }
  }

  function harvestIdsFromReply(txt = "") {
    const ids = new Set();
    const urlRe =
      /\bhttps?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/shorts\/)([A-Za-z0-9_-]{11})\b/g;
    let m;
    while ((m = urlRe.exec(txt))) ids.add(m[1]);
    const idRe = /\b([A-Za-z0-9_-]{11})\b/g;
    while ((m = idRe.exec(txt))) ids.add(m[1]);
    return Array.from(ids);
  }

  // ─── numbers-by-words → number ───────────────────────────────────────
  function parseNumberWords(str) {
    const s = String(str || "").toLowerCase().trim();
    if (!s) return null;
    const map = new Map(
      Object.entries({
        // RU
        "ноль": 0,
        "один": 1,
        "одна": 1,
        "одной": 1,
        "одну": 1,
        "два": 2,
        "две": 2,
        "три": 3,
        "четыре": 4,
        "пять": 5,
        "шесть": 6,
        "семь": 7,
        "восемь": 8,
        "девять": 9,
        "десять": 10,
        "одиннадцать": 11,
        "двенадцать": 12,
        "тринадцать": 13,
        "четырнадцать": 14,
        "пятнадцать": 15,
        "шестнадцать": 16,
        "семнадцать": 17,
        "восемнадцать": 18,
        "девятнадцать": 19,
        "двадцать": 20,
        "тридцать": 30,
        "сорок": 40,
        "пятьдесят": 50,
        "шестьдесят": 60,
        "полминуты": 30,
        "полчаса": 1800,
        "полторы": 1.5,
        "полтора": 1.5,
        "несколько": 5,
        "пару": 2,
        "пара": 2,
        // UK (минимальный набор)
        "нуль": 0,
        "дві": 2,
        "чотири": 4,
        "п’ять": 5,
        "вісім": 8,
        "дев’ять": 9,
        "кілька": 5,
        "півхвилини": 30,
        "півгодини": 1800,
        // EN
        "zero": 0,
        "one": 1,
        "two": 2,
        "three": 3,
        "four": 4,
        "five": 5,
        "six": 6,
        "seven": 7,
        "eight": 8,
        "nine": 9,
        "ten": 10,
        "eleven": 11,
        "twelve": 12,
        "thirteen": 13,
        "fourteen": 14,
        "fifteen": 15,
        "sixteen": 16,
        "seventeen": 17,
        "eighteen": 18,
        "nineteen": 19,
        "twenty": 20,
        "thirty": 30,
        "forty": 40,
        "fifty": 50,
        "sixty": 60,
        "half-minute": 30,
        "half an hour": 1800,
        "couple": 2,
        "few": 5,
      })
    );
    if (map.has(s)) return map.get(s);
    const tokens = s.split(/[\s-]+/g).filter(Boolean);
    let total = 0,
      had = false;
    for (const t of tokens) {
      if (map.has(t)) {
        total += map.get(t);
        had = true;
        continue;
      }
      const n = Number(t.replace(",", "."));
      if (!Number.isNaN(n)) {
        total += n;
        had = true;
      }
    }
    return had ? total : null;
  }

  // ─── Delay/After-current parsing (расширенный) ───────────────────────
  function toMs(n, unit) {
    const u = String(unit || "").toLowerCase().replace(/[.,;:!?)+\]\s]+$/g, "");
    if (/^час|h|hour/.test(u)) return n * 3600 * 1000;
    if (/^мин|m|min|minutes?/.test(u) || /^минут/.test(u)) return n * 60 * 1000;
    if (/^сек|s|sec|seconds?/.test(u) || /^секунд/.test(u)) return n * 1000;
    return n * 1000;
  }

  function parseDelaySpec(input = "") {
    const t = String(input || "").toLowerCase().replace(/[–—]/g, "-");

    const wantsPause = /(постав(ь|ить).+пауз|на пауз|пауз(а|у)\b|пауза\b|pause)/.test(t);
    const wantsStop = /(выключ|останов|стоп\b|stop)/.test(t);
    const op = wantsPause ? "pause" : wantsStop ? "stop" : null;

    const afterCurrent =
      /(после\s+(этой|текущей)\s+(песни|композиции|трека)|after\s+(this|current)\s+(song|track))/.test(t);

    // mm:ss
    let m = t.match(/(?:через|за)\s+(\d{1,2}):(\d{2})/);
    if (m) {
      const mm = Number(m[1] || 0),
        ss = Number(m[2] || 0);
      const ms = (mm * 60 + ss) * 1000;
      return { ms, afterCurrent: false, op: op || "pause" };
    }

    // перечисления/диапазоны: "через 10, 15, 20 секунд" / "через 15-20 секунд"
    m = t.match(
      /(?:через|за|на)\s+([0-9 ,.-]{1,20})\s*(сек(?:унд\w*)?|s|sec|seconds|мин(?:ут\w*)?|m|min|minutes|час(?:\w*)?|h|hour|hours)\b/i
    );
    if (m) {
      const seq = String(m[1]).split(/[^\d]+/).filter(Boolean).map(Number);
      const n = seq.length ? seq[seq.length - 1] : NaN;
      if (Number.isFinite(n)) return { ms: toMs(n, m[2]), afterCurrent: false, op: op || "pause" };
    }

    // цифрами: «через 10 секунд»
    m = t.match(/(?:через|за|на)\s+(\d{1,3})\s*([a-zа-яёіїє.]+)/i);
    if (m) {
      const n = Number(m[1]);
      const u = String(m[2] || "");
      if (!Number.isNaN(n)) return { ms: toMs(n, u), afterCurrent: false, op: op || "pause" };
    }

    // словами: «через десять секунд», «через одну минуту»
    m = t.match(/(?:через|за|на)\s+([a-zа-яёіїє \-]+)\s*([a-zа-яёіїє.]+)/i);
    if (m) {
      const num = parseNumberWords(m[1]);
      if (num !== null) return { ms: toMs(num, m[2]), afterCurrent: false, op: op || "pause" };
    }

    // неявная 1: «через минуту/секунду/час»
    m = t.match(/(?:через|за|на)\s*(минут[ауы]?|секунд[ауы]?|час[ауы]?)/i);
    if (m) return { ms: toMs(1, m[1]), afterCurrent: false, op: op || "pause" };

    if (afterCurrent) return { ms: null, afterCurrent: true, op: op || "stop" };
    return null;
  }

  // ─── Local intents (таймер/«после текущего»/хиты N часов) ────────────
  function tryAdvancedLocalIntents(traw) {
    const text = String(traw || "");
    const ds = parseDelaySpec(text);
    if (ds?.ms) {
      const secs = Math.round(ds.ms / 1000);
      const verb = ds.op === "pause" ? "поставлю на паузу" : "выключу";
      addMsg("bot", `Ок, ${verb} через ${secs} сек.`);
      speak(`${verb} через ${secs} секунд`);
      scheduleActionLater(ds.ms, ds.op);
      return true;
    }
    if (ds?.afterCurrent) {
      sleepAfterTrack = true;
      sleepAfterAction = ds.op || "stop";
      clearSleepTimer();
      addMsg(
        "bot",
        ds.op === "pause" ? "Ок, поставлю на паузу после текущего трека." : "Ок, выключу после текущего трека."
      );
      speak(ds.op === "pause" ? "Поставлю на паузу после текущего трека" : "Выключу после текущего трека");
      try {
        window.__AM_SLEEP_AFTER__ = true;
      } catch {}
      return true;
    }

    // «хиты <артист> на 2 часа»
    const reThisArtist = /(хит(?:ов|ы)|лучшие|best of|hits).*(этого артиста).*(\d{1,2}.*(час|мин))/i;
    const reNamed =
      /(хит(?:ов|ы)|лучшие|best of|hits)\s+([a-zа-яёіїє .'\-]+?)\s+(?:на|в течение|напротяжении)?\s*(\d{1,2}\s*(?:час|часа|часов|мин|минут|minutes?|hours?))/i;
    let artist = "",
      durStr = "";
    let m = text.toLowerCase().match(reThisArtist);
    if (m && chat.nowPlaying?.artist) {
      artist = chat.nowPlaying.artist;
      durStr = m[3] || "";
    } else {
      m = text.toLowerCase().match(reNamed);
      if (m) {
        artist = (m[2] || "").trim();
        durStr = m[3] || "";
      }
    }
    if (artist && durStr) {
      const ms = parseSleepDuration(durStr);
      if (ms) {
        const q = `${artist} greatest hits playlist`;
        chat.lastQuery = q;
        addMsg("bot", `Ок, хиты ${artist} — поехали. Выключу через ${Math.round(ms / 60000)} мин.`);
        speak(`Включаю хиты ${artist}. Выключу через ${Math.round(ms / 60000)} минут`);
        (async () => {
          await cQueue.refill(q);
          const id = cQueue.take();
          if (id) dispatch("play", { id });
          else dispatch("play", { query: q, exclude: recent.list(), shuffle: true });
        })();
        scheduleActionLater(ms, "stop");
        return true;
      }
    }
    return false;
  }

  // ─── API ─────────────────────────────────────────────────────────────
  async function callAI(message) {
    if (!API_BASE) return null;
    const r = await fetch(`${API_BASE}/api/chat`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message,
        history: chat.history,
        provider: providerToSend(),
        langHint: state.langPref,
      }),
    });
    if (!r.ok) throw new Error(`API ${r.status}`);
    return r.json();
  }

  async function handleUserText(text) {
    let v = String(text || "").trim();
    if (!v) return;

    // внешний препроцессор (без редактирования chat.js)
    try {
      if (window.Assistant?.preprocessText) {
        const res = window.Assistant.preprocessText(v);
        if (res && typeof res === "object" && res.handled) return;
        if (typeof res === "string") v = res;
      }
    } catch {}

    addMsg("user", v);

    // Локальный "что сейчас играет?"
    if (/(что\s+(сейчас\s+)?играет|что за трек|какой трек|what'?s\s+playing)/i.test(v)) {
      const np = chat.nowPlaying;
      const msg = np?.id
        ? np.title
          ? `Сейчас играет: ${np.title}`
          : (np.artist || np.song)
          ? `Сейчас играет: ${[np.artist, np.song].filter(Boolean).join(" - ")}`
          : "Сейчас что-то играет."
        : "Сейчас ничего не играет.";
      addMsg("bot", msg);
      speak(msg);
      return;
    }

    if (tryAdvancedLocalIntents(v)) return;

    // таймер авто-стоп/паузы в тексте
    const delaySpec = parseDelaySpec(v);
    const hasDelayWords = /(через|после\s+(этой|текущей))/i.test(v);
    const suppressImmediatePauseStop = !!(delaySpec && (delaySpec.ms || delaySpec.afterCurrent)) || hasDelayWords;
    const forcedNext = NEXT_RE.test(v);

    try {
      const data = await callAI(v);
      if (data && isStr(data.reply)) {
        const harvested = harvestIdsFromReply(data.reply);
        if (harvested.length) {
          chat.lastIds = harvested;
          harvested.forEach((id) => recent.add(id));
        }

        addMsg("bot", data.reply);
        speak(data.reply);

        let actions = Array.isArray(data.actions) ? data.actions : [];

        // SANITIZE: если пользователь сказал «пауза», заменяем любые stop-акшены модели на pause
        const askedPause = /\b(пауза|pause)\b/i.test(v);
        const askedStop = /\b(стоп|выключ|останов|stop)\b/i.test(v);
        if (askedPause && !askedStop && actions.length) {
          actions = actions.map((a) =>
            a?.type === "player" && a.action === "stop" ? { ...a, action: "pause" } : a
          );
        }

        if (forcedNext) {
          await nextWithGuard();
        } else if (actions.length) {
          // не делать немедленный pause/stop, если просили задержку
          if (suppressImmediatePauseStop) {
            actions = actions.filter(
              (a) => !(a?.type === "player" && (a.action === "stop" || a.action === "pause"))
            );
          }
          const aPlay = actions.find((a) => a.type === "play" && (a.id || a.query));
          if (aPlay) {
            const id = getYouTubeId(aPlay.id || aPlay.query);
            if (id) {
              chat.lastIds = [id];
              recent.add(id);
              cQueue.dropCurrent(id);
            }
            if (aPlay.query) chat.lastQuery = aPlay.query;
          }
          await runActions(actions);

          if (delaySpec?.ms) {
            const secs = Math.round(delaySpec.ms / 1000);
            addMsg(
              "note",
              delaySpec.op === "pause"
                ? `⏰ Поставлю на паузу через ~${secs} сек.`
                : `⏰ Выключусь через ~${secs} сек.`
            );
            scheduleActionLater(delaySpec.ms, delaySpec.op);
          } else if (delaySpec?.afterCurrent) {
            sleepAfterTrack = true;
            sleepAfterAction = delaySpec.op || "stop";
            clearSleepTimer();
            addMsg(
              "note",
              sleepAfterAction === "pause" ? "⏰ Пауза после текущего трека." : "⏰ Выключусь после текущего трека."
            );
            try {
              window.__AM_SLEEP_AFTER__ = true;
            } catch {}
          }
        } else {
          const localReply = await handleCommandLocal(v, /*suppressInstant*/ suppressImmediatePauseStop);
          addMsg("note", "[" + localReply + "]");
          if (delaySpec?.ms) scheduleActionLater(delaySpec.ms, delaySpec.op);
          else if (delaySpec?.afterCurrent) {
            sleepAfterTrack = true;
            sleepAfterAction = delaySpec.op || "stop";
            clearSleepTimer();
            addMsg(
              "note",
              sleepAfterAction === "pause" ? "⏰ Пауза после текущего трека." : "⏰ Выключусь после текущего трека."
            );
            try {
              window.__AM_SLEEP_AFTER__ = true;
            } catch {}
          }
        }

        if (isStr(data.explain)) addMsg("note", "[" + data.explain + "]");
        return;
      }
    } catch (e) {
      console.warn("AI API error", e);
    }

    const reply = await handleCommandLocal(v, /*suppressInstant*/ suppressImmediatePauseStop);
    addMsg("bot", reply);
    speak(reply);
  }

  // ─── local fallback for simple commands ──────────────────────────────
  async function handleCommandLocal(t, suppressInstantPauseStop = false) {
    const text = (t || "").toLowerCase();
    const wantsPlay = /включ|поставь|play|запусти|вруби|сыграй/.test(text);
    const hasDelayWords = /(через|после\s+(этой|текущей))/i.test(text);

    if (/list|список|лист ?вью/.test(text)) {
      dispatch("view", { mode: "list" });
      return "Включаю список";
    }
    if (/grid|сетка|карточк/.test(text)) {
      dispatch("view", { mode: "grid" });
      return "Включаю сетку";
    }

    if (NEXT_RE.test(text)) {
      await nextWithGuard();
      return "Следующий трек";
    }

    if (/prev|пред/.test(text)) {
      dispatch("player-prev");
      return "Предыдущий трек";
    }

    // Мгновенные pause/stop — только если НЕ просили задержку
    if (!suppressInstantPauseStop && !hasDelayWords) {
      if (/\b(пауза|pause)\b/.test(text)) {
        dispatch("player-pause");
        markManualPauseGuard(); // 1 час по умолчанию
        return "Пауза";
      }
      if (/\b(стоп|выключи|останови|stop)\b/.test(text)) {
        dispatch("player-stop");
        return "Стоп";
      }
    }

    if (/(отмени|сбрось|cancel).*(таймер|timer)/.test(text)) {
      clearSleepTimer();
      sleepAfterTrack = false;
      manualPauseGuardUntil = 0;
      return "Таймер отменён";
    }

    if (/play|плей|включи|вруби|сыграй/.test(text)) {
      if (chat.lastIds.length) {
        dispatch("play", { id: chat.lastIds[0] });
      } else {
        const seed = randomMixSeed();
        chat.lastQuery = seed;
        await cQueue.refill(seed);
        const id = cQueue.take();
        if (id) dispatch("play", { id });
        else dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
      }
      manualPauseGuardUntil = 0;
      return "Играю";
    }

    if (/тише|quieter|volume down|поменьше/.test(text)) {
      dispatch("volume", { delta: -0.1 });
      return "Тише";
    }
    if (/громче|louder|volume up|погромче/.test(text)) {
      dispatch("volume", { delta: +0.1 });
      return "Громче";
    }
    if (/(mix ?radio|микс|радио|random)/.test(text)) {
      const seed = randomMixSeed();
      chat.lastQuery = seed;
      await cQueue.refill(seed);
      const id = cQueue.take();
      if (id) dispatch("play", { id });
      else dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
      manualPauseGuardUntil = 0;
      return "Mix Radio";
    }

    if (/^(?:включи|поставь|запусти|найди|знайди)\s+.+/i.test(text)) {
      const like = text.replace(/^(?:включи|поставь|запусти|найди|знайди)\s+/i, "").trim();
      if (like) {
        chat.lastQuery = like;
        await cQueue.refill(like);
        const id = cQueue.take();
        if (id) dispatch("play", { id });
        else dispatch("play", { query: like, exclude: recent.list(), shuffle: true });
        manualPauseGuardUntil = 0;
        return "Шукаю та вмикаю…";
      }
    }

    const moods = [
      { re: /(весел|радіс|радост|happy|joy)/, mood: "happy" },
      { re: /(спок|calm|chill|relax)/, mood: "calm" },
      { re: /(сум|sad|minor)/, mood: "sad" },
      { re: /(енерг|drive|бадьор|рок|rock|energy|energetic)/, mood: "energetic" },
    ];
    const m = moods.find((m) => m.re.test(text));
    if (m) {
      const q = ensureMoodQuery(m.mood);
      chat.lastQuery = q;

      if (wantsPlay) {
        await cQueue.refill(q);
        const id = cQueue.take();
        if (id) dispatch("play", { id });
        else dispatch("play", { query: q, exclude: recent.list(), shuffle: true });
        return "Підбираю та вмикаю…";
      } else {
        const dict = MOOD_SUGGEST[state.langPref] || MOOD_SUGGEST.ru;
        const sug = dict[m.mood];
        if (sug) {
          addMsg(
            "bot",
            state.langPref === "en"
              ? `For a ${m.mood} mood I can play genres: ${sug.genres.join(", ")}. Sample artists: ${sug.artists.join(
                  ", "
                )}. Say “play [genre/artist]” or “mix radio”.`
              : state.langPref === "uk"
              ? `Під ${m.mood} настрій можу запропонувати жанри: ${sug.genres.join(
                  ", "
                )}. Виконавці: ${sug.artists.join(
                  ", "
                )}. Скажи «включи [жанр/артиста]» або «мікс радіо».`
              : `Под ${m.mood} настроение могу предложить жанры: ${sug.genres.join(
                  ", "
                )}. Исполнители: ${sug.artists.join(
                  ", "
                )}. Скажи «включи [жанр/исполнителя]» или «микс радио».`
          );
          return "Підбираю під настрій";
        }
        return "Підбираю під настрій";
      }
    }

    const g = text.match(/жанр\s*([a-zа-яёіїє-]+)/i);
    if (g && g[1]) {
      const q = ensureGenreQuery(g[1]);
      chat.lastQuery = q;
      await cQueue.refill(q);
      const id = cQueue.take();
      if (id) dispatch("play", { id });
      else dispatch("play", { query: q, exclude: recent.list(), shuffle: true });
      return wantsPlay ? `Жанр ${g[1]}, запускаю…` : `Жанр: ${g[1]}`;
    }

    if (/из (этого|того) списка|из предложенного|любой из списка/.test(text)) {
      if (chat.lastIds.length) {
        dispatch("play", { id: chat.lastIds[0] });
        return "Запускаю из последнего списка";
      }
      const seed = randomMixSeed();
      chat.lastQuery = seed;
      await cQueue.refill(seed);
      const id = cQueue.take();
      if (id) dispatch("play", { id });
      else dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
      return "Включаю из своих рекомендаций";
    }

    return "Я тут. Могу переключать вид, управлять треком и подбирать музыку по настроению.";
  }

  // ─── Mic + Wake word (с дебаунсом результатов SR) ────────────────────
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  function isWakeOn() {
    return !!chkWake?.checked;
  }
  function wakePhrases() {
    return String(inpWake?.value || "")
      .toLowerCase()
      .split(/[,\|]/)
      .map((s) => s.trim())
      .filter(Boolean);
  }

  const micAgg = { buf: "", timer: null };
  const wakeAgg = { buf: "", timer: null };
  function debouncedPush(agg, phrase, delay = 800) {
    const s = String(phrase || "").trim();
    if (!s) return;
    agg.buf = agg.buf ? agg.buf + " " + s : s;
    clearTimeout(agg.timer);
    agg.timer = setTimeout(() => {
      const payload = agg.buf.trim();
      agg.buf = "";
      handleUserText(payload);
    }, delay);
  }

  let wakeRec = null,
    wakeStopReq = false,
    wakeRestartTimer = null;
  let wakePausedForMic = false,
    wakeActive = false,
    wakeLogShown = false;

  async function startWakeLoop(force = false) {
    if (!SR) {
      addMsg("note", "[Wake] Браузер не поддерживает распознавание речи.");
      return;
    }
    if (!isWakeOn() && !force) return;
    if (wakeActive && !force) return;

    stopWakeLoop(true);
    try {
      const rec = new SR();
      rec.lang = codeToBCP47(state.langPref);
      rec.continuous = true;
      rec.interimResults = false;
      rec.maxAlternatives = 1;
      wakeRec = rec;

      rec.onstart = () => {
        wakeActive = true;
        if (!wakeLogShown) {
          addMsg("note", "[Wake] Фоновое прослушивание включено.");
          wakeLogShown = true;
        }
      };

      rec.onresult = (ev) => {
        const t = (ev.results?.[ev.results.length - 1]?.[0]?.transcript || "").toLowerCase().trim();
        const hot = wakePhrases().find((ph) => t.startsWith(ph) || t.includes(" " + ph + " "));
        if (hot) {
          let cmd = t;
          for (const ph of wakePhrases()) cmd = cmd.replace(new RegExp("^\\s*" + ph + "\\s*"), "").trim();
          if (!cmd) {
            addMsg("note", "[Wake] Слушаю.");
            return;
          }
          if (!wakeAgg.buf) clearTimeout(wakeAgg.timer);
          debouncedPush(wakeAgg, cmd, 800);
          return;
        }
      };

      rec.onerror = () => {};
      rec.onend = () => {
        wakeActive = false;
        if (wakeStopReq) return;
        if (!isWakeOn() || wakePausedForMic) return;
        clearTimeout(wakeRestartTimer);
        wakeRestartTimer = setTimeout(() => startWakeLoop(true), 600);
      };

      rec.start();
    } catch (e) {
      addMsg("note", "[Wake] Не удалось запустить прослушивание.");
    }
  }

  function stopWakeLoop(silent = false) {
    wakeStopReq = true;
    clearTimeout(wakeRestartTimer);
    if (wakeRec) {
      try {
        wakeRec.onend = null;
        wakeRec.stop();
      } catch {}
      wakeRec = null;
    }
    wakeStopReq = false;
    wakeActive = false;
    if (!silent) {
      addMsg("note", "[Wake] Выключено.");
      wakeLogShown = false;
    }
  }

  if (chkWake) {
    chkWake.addEventListener("change", () => {
      if (isWakeOn()) startWakeLoop(true);
      else stopWakeLoop(false);
    });
  }
  if (inpWake) {
    inpWake.addEventListener("change", () => {
      if (SR && isWakeOn()) startWakeLoop(true);
    });
  }

  // Кнопка микрофона — разовый слушатель (коэкзистенция с wake)
  if (btnMic && SR) {
    btnMic.addEventListener("click", () => {
      try {
        if (isWakeOn() && wakeActive) {
          wakePausedForMic = true;
          stopWakeLoop(true);
        }

        const rec = new SR();
        rec.lang = codeToBCP47(state.langPref);
        rec.interimResults = false;
        rec.maxAlternatives = 1;
        btnMic.classList.add("is-on");

        rec.onresult = (ev) => {
          // Берём последний финальный результат текущей сессии
          const t = (ev.results?.[ev.results.length - 1]?.[0]?.transcript || "");
          if (!micAgg.buf) clearTimeout(micAgg.timer);
          debouncedPush(micAgg, t, 800);
        };

        rec.onerror = () => {
          addMsg("bot", "Не вышло распознать голос");
        };
        rec.onend = () => {
          btnMic.classList.remove("is-on");
          if (isWakeOn()) {
            wakePausedForMic = false;
            startWakeLoop(true);
          }
        };
        rec.start();
      } catch {
        addMsg("bot", "Розпізнавач недоступний");
      }
    });
  }

  // ─── wiring ──────────────────────────────────────────────────────────
  root.querySelector(".assistant__toggle").addEventListener("click", () => {
    panel.hidden = !panel.hidden;
  });
  btnClose.addEventListener("click", () => {
    panel.hidden = true;
  });
  btnGear.addEventListener("click", () => {
    const s = root.querySelector(".assistant__settings");
    if (s) s.hidden = !s.hidden;
  });
  btnSend.addEventListener("click", () => {
    const t = inputEl.value;
    inputEl.value = "";
    handleUserText(t);
  });
  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      const t = inputEl.value;
      inputEl.value = "";
      handleUserText(t);
    }
  });

  // автозапуск wake-loop, если включён
  if (SR && isWakeOn()) startWakeLoop();

  // ─── лёгкие внешние хуки ─────────────────────────────────────────────
  window.Assistant = window.Assistant || {};
  window.Assistant.enqueueText = (txt) => handleUserText(String(txt || ""));
  window.Assistant.nowPlaying = () => ({ ...(chat.nowPlaying || {}) });
  // window.Assistant.preprocessText = (text) => text;
})();

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/assistant/hooks.js

**size:** 1551 bytes &nbsp;&nbsp; **sha1:** `858b1de20e159de45ba5431b6fb3b7ac687c6225`

```javascript
// alias of assistant-hooks.js
(() => {
  const W = (window.Assistant = window.Assistant || {});

  function normalizeDashes(s) {
    return String(s || "").replace(/[–—]/g, "-");
  }
  function normalizeTimingPhrases(s0) {
    let s = normalizeDashes(String(s0 || "")).toLowerCase();
    s = s.replace(/через\s+пол ?минут[ыи]/g, "через 30 секунд");
    s = s.replace(/через\s+пол ?часа/g, "через 30 минут");
    s = s.replace(/через\s+минут[уы]/g, "через 1 минуту");
    s = s.replace(/через\s+секунд[уы]/g, "через 1 секунду");
    s = s.replace(/через\s+час[ау]?/g, "через 1 час");
    s = s.replace(/через\s+(\d{1,3})\s*-\s*(\d{1,3})\s*(секунд\w*|минут\w*|час\w*|s|m|h|min|sec|hour|minutes?)/g,
      (_m, a, b, u) => `через ${b} ${u}`);
    s = s.replace(
      /через\s+(\d{1,3}(?:\s*,\s*\d{1,3})+)\s*(секунд\w*|минут\w*|час\w*|s|m|h|min|sec|hour|minutes?)/g,
      (_m, list, u) => {
        const parts = list.split(/\s*,\s*/).map(Number).filter((n) => Number.isFinite(n));
        const last = parts[parts.length - 1] || 0;
        return `через ${last} ${u}`;
      }
    );
    s = s.replace(/секундочк[ауи]/g, "секунду").replace(/минутк[ауи]/g, "минуту");
    return s0 && s !== s0 ? s : s0;
  }

  W.preprocessText = function (text) {
    const t1 = normalizeTimingPhrases(text);
    return t1;
  };
})();

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/comments.js

**size:** 10562 bytes &nbsp;&nbsp; **sha1:** `2cb2bce8223c513ad35109201787a2f160c55b64`

```javascript
// ===== Imports =====
import Swiper from 'swiper/bundle';
import 'swiper/swiper-bundle.css';
import iziToast from 'izitoast';
import 'izitoast/dist/css/iziToast.min.css';

// ===== Constants / State =====
const STORAGE_KEY = 'myFeedback';
let scrollY = 0;
let swiper = null;

// ===== DOM refs (назначим после DOMContentLoaded) =====
let overlay, openBtn, closeBtn, form, container, inputName, inputMessage, formRating;

// ===== Utils =====
function debounce(fn, delay = 400) {
  let t;
  return (...args) => {
    clearTimeout(t);
    t = setTimeout(() => fn(...args), delay);
  };
}

// ===== Stars =====
function createStars(container, rating) {
  if (!container) return;
  container.innerHTML = '';

  for (let i = 1; i <= 5; i++) {
    const star = document.createElement('span');
    star.classList.add('star');
    if (i <= rating) star.classList.add('filled');
    container.appendChild(star);

    // Интерактив — только у рейтинга формы
    if (container.id === 'customer-rating') {
      star.addEventListener('click', () => {
        container.dataset.rating = String(i);
        createStars(container, i);
        saveToLocalStorage(); // сразу запишем рейтинг
      });
      star.addEventListener('mouseenter', () => hoveredStar(container, i));
      star.addEventListener('mouseleave', () => {
        const savedRating = parseInt(formRating.dataset.rating) || 0;
        createStars(container, savedRating);
      });
    }
  }
}

function hoveredStar(container, upTo) {
  const stars = container.querySelectorAll('.star');
  stars.forEach((star, index) => {
    if (index < upTo) star.classList.add('filled');
    else star.classList.remove('filled');
  });
}

// ===== LocalStorage (draft) =====
function saveToLocalStorage() {
  const name = inputName?.value?.trim() || '';
  const message = inputMessage?.value?.trim() || '';
  const rating = Number(formRating?.dataset?.rating || 0);

  // Всё пусто? Удаляем ключ.
  if (!name && !message && rating === 0) {
    localStorage.removeItem(STORAGE_KEY);
    return;
  }

  const draft = { name, message, rating };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(draft));
}

const saveDraftDebounced = debounce(saveToLocalStorage, 400);

function dataFromLocalStorage() {
  let saved = null;
  try {
    saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
  } catch {
    saved = null;
  }

  if (!saved) {
    // На всякий случай визуально сбросим рейтинг
    if (formRating) {
      formRating.dataset.rating = '0';
      createStars(formRating, 0);
    }
    return;
  }

  if (inputName) inputName.value = saved.name || '';
  if (inputMessage) inputMessage.value = saved.message || '';
  if (formRating) {
    formRating.dataset.rating = String(saved.rating ?? 0);
    createStars(formRating, saved.rating ?? 0);
  }
}

function resetLocalStorage() {
  localStorage.removeItem(STORAGE_KEY);
  form?.reset();
  if (formRating) {
    formRating.dataset.rating = '0';
    createStars(formRating, 0);
  }
}

// ===== Modal =====
function openModal(e) {
  e?.preventDefault?.();
  scrollY = window.scrollY;
  document.body.style.position = 'fixed';
  document.body.style.top = `-${scrollY}px`;
  document.body.style.left = '0';
  document.body.style.right = '0';

  overlay.classList.remove('hidden');
  container.classList.add('hidden');

  dataFromLocalStorage(); // подхватим драфт при каждом открытии
}

function closeModal() {
  overlay.classList.add('hidden');
  container.classList.remove('hidden');

  document.body.style.position = '';
  window.scrollTo(0, scrollY);

  // Синхронно сбросим рейтинг визуально
  if (formRating) {
    formRating.dataset.rating = '0';
    createStars(formRating, 0);
  }

  // Сохраним/удалим актуальный драфт после закрытия
  saveToLocalStorage();
}

// ===== Swiper =====
function initSwiper() {
  // если уже был — уничтожим
  if (swiper) {
    swiper.destroy(true, true);
    swiper = null;
  }

  swiper = new Swiper('.swiper', {
    slidesPerView: 1,
    spaceBetween: 0,
    loop: false,
    grabCursor: true,
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    centeredSlides: false,

    // 3 точки: первый / середина / последний
    pagination: {
      el: '.swiper-pagination',
      type: 'custom',
      clickable: true,
      renderCustom: (sw, _current, total) => {
        const first = 0;
        const last = total - 1;
        const middle = Math.floor(total / 2);
        const curr = sw.realIndex;

        const isActive = (i) =>
          (i === first && curr === first) ||
          (i === last && curr === last) ||
          (i === middle && curr !== first && curr !== last);

        const dot = (i) =>
          `<span class="swiper-dots ${isActive(i) ? 'active' : ''}" data-i="${i}"></span>`;

        return dot(first) + dot(middle) + dot(last);
      },
    },
  });

  // клики по кастомным точкам
  const pag = document.querySelector('.swiper-pagination');
  if (pag) {
    pag.onclick = (e) => {
      const dot = e.target.closest('.swiper-dots');
      if (!dot) return;
      swiper.slideTo(Number(dot.dataset.i));
    };
  }

  // при смене слайда — перерисовать кастомные точки
  swiper.on('slideChange', () => swiper.pagination.render());
}

// ===== Fetch & render feedbacks =====
async function loadReviews() {
  const wrapper = document.querySelector('.swiper-wrapper');
  if (!wrapper) return;
  wrapper.innerHTML = '';

  try {
    const res = await fetch('https://sound-wave.b.goit.study/api/feedbacks');
    const ct = res.headers.get('content-type') || '';
    if (!res.ok || !ct.includes('audio')) {
    // попробуем показать причину
     let msg = 'TTS server error';
     try { msg = (await res.clone().json()).error || msg; } catch {}
     console.warn('[tts] non-audio response', msg);
     throw new Error(msg);
    }

    const json = await res.json();
    const feedbacks = (json?.data || []).slice(0, 10); // РОВНО 10

    feedbacks.forEach((fb, index) => {
      const stars = Math.round(fb.rating || 0);

      const slide = document.createElement('div');
      slide.className = 'swiper-slide';
      slide.innerHTML = `
        <div class="rating my-rating" id="rating-${index}" data-rating="${stars}"></div>
        <div class="feedback">
          <p class="customer-feedback">${fb.descr}</p>
          <h3 class="customer-name">${fb.name}</h3>
        </div>
      `;

      wrapper.appendChild(slide);
      createStars(slide.querySelector('.rating'), stars); // звёзды в слайдах статичны
    });

    // инициализируем Swiper только после вставки слайдов
    initSwiper();
  } catch (err) {
    iziToast.error({
      title: 'Error',
      message: 'Bad request (invalid request params)',
    });
  }
}

// ===== Submit =====
function attachSubmitHandler() {
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = inputName.value.trim();
    const message = inputMessage.value.trim();
    const rating = Math.round(formRating.dataset.rating) || 0;

    if (!name || name.length < 2 || name.length > 16) {
      iziToast.error({ message: 'Shortest name - 2 letters; Largest name - 16 letters' });
      return;
    }
    if (!message || message.length < 10 || message.length > 512) {
      iziToast.error({ message: 'Min message - 10 symbols; Max message - 512 symbols' });
      return;
    }
    if (rating < 1 || rating > 5) {
      iziToast.error({ message: "Rating must be between '1' and '5'" });
      return;
    }

    try {
      const response = await fetch('https://sound-wave.b.goit.study/api/feedbacks', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Accept: 'application/json',
        },
        body: JSON.stringify({ name, descr: message, rating }),
      });

      if (!response.ok) {
        iziToast.error({ title: 'Error:', message: `${response.status}` });
        return;
      }

      iziToast.success({ message: "Success! You're comment posted" });
      resetLocalStorage();
      closeModal();
      document.body.classList.remove('no-scroll');

      loadReviews();
    } catch (err) {
      iziToast.error({ message: 'Bad request (invalid request body)' });
    }
  });
}

// ===== Init =====
function initApp() {
  // Присваиваем DOM-элементы
  overlay = document.querySelector('.overlay');
  openBtn = document.querySelector('.feedback-btn');
  closeBtn = document.querySelector('.close-icon');
  form = document.querySelector('#feedback-form');
  container = document.querySelector('.feedback-section');
  inputName = document.querySelector('.form-input-name');
  inputMessage = document.querySelector('.form-input-message');
  formRating = document.getElementById('customer-rating');

  // Безопасные проверки
  if (!overlay || !container) {
    console.warn('Overlay or container not found');
  }

  // Звёзды в форме (интерактив)
  createStars(formRating, parseInt(formRating?.dataset?.rating) || 0);

  // Навешиваем обработчики модалки
  openBtn?.addEventListener('click', openModal);
  closeBtn?.addEventListener('click', closeModal);

  overlay?.addEventListener('click', (e) => {
    if (e.target === overlay) closeModal();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !overlay.classList.contains('hidden')) closeModal();
  });

  // Автосохранение драфта при наборе
  inputName?.addEventListener('input', saveDraftDebounced);
  inputMessage?.addEventListener('input', saveDraftDebounced);

  // Сабмит
  attachSubmitHandler();

  // Первичная загрузка отзывов
  loadReviews();
}

document.addEventListener('DOMContentLoaded', initApp);

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/global-sfx.js

**size:** 3160 bytes &nbsp;&nbsp; **sha1:** `53f2e663eed1e45124a8fcb78216f2dd2a2a3499`

```javascript
// ГЛОБАЛЬНЫЕ SFX ДЛЯ ВСЕГО САЙТА
// Подключите один раз в main.js:  import "./js/global-sfx.js";
import { UISound } from "./artists/lib/sound.js"; // путь под ваш проект

// ===== Конфиг =====
const CLICKABLE_SELECTOR = [
  'a[href]',
  'button',
  '[role="button"]',
  'input[type="button"]',
  'input[type="submit"]',
  'input[type="reset"]',
  'summary',
  '.sfx-click'          // опциональный «маркер-класс»
].join(',');

// Где НЕ играть (ползунки, драг-зоны и т.п.)
const IGNORE_SELECTOR = [
  '.no-sfx',
  '[data-sfx="off"]',
  '[disabled],[aria-disabled="true"]',
  'input[type="range"]',
  '.am-player__dragzone', // ваша верхняя зона перетаскивания плеера
].join(',');

// ===== Сервис =====
const SFX = {
  enabled: localStorage.getItem('sfx') !== 'off',
  lastAt: 0,
  playOnce() {
    if (!this.enabled) return;
    const now = performance.now();
    if (now - this.lastAt < 80) return; // анти-дубль
    this.lastAt = now;
    try {
      UISound?.tap?.(); // ваш текущий звук
    } catch {
      // Фолбэк мини-бипом (если вдруг UISound не инициализирован)
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'triangle'; o.frequency.value = 660;
        g.gain.setValueAtTime(0.06, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.06);
        o.connect(g).connect(ctx.destination); o.start(); o.stop(ctx.currentTime + 0.07);
      } catch {}
    }
  },
};

// Глобальный обработчик кликов
document.addEventListener('click', (e) => {
  // только «настоящие» левые клики
  if (!e.isTrusted || e.button !== 0 || e.metaKey || e.ctrlKey || e.altKey) return;

  const el = e.target.closest(CLICKABLE_SELECTOR);
  if (!el) return;
  if (el.matches(IGNORE_SELECTOR)) return;

  // Если элемент тащили (drag), браузер обычно не кидает click — но на всякий случай:
  if (Math.abs((e.movementX || 0)) > 2 || Math.abs((e.movementY || 0)) > 2) return;

  SFX.playOnce();
}, { capture: true });

// Клавиатурная активация (Enter/Space) — для a11y
document.addEventListener('keydown', (e) => {
  if (!SFX.enabled) return;
  if (!(e.key === 'Enter' || e.key === ' ')) return;

  const el = e.target.closest(CLICKABLE_SELECTOR);
  if (!el || el.matches(IGNORE_SELECTOR)) return;

  SFX.playOnce();
}, { capture: true });

// Публичный тумблер (можно привязать к настройкам)
window.SFX = {
  enable()  { SFX.enabled = true;  localStorage.setItem('sfx', 'on');  },
  disable() { SFX.enabled = false; localStorage.setItem('sfx', 'off'); },
  toggle()  { SFX.enabled ? this.disable() : this.enable(); },
};

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/header.js

**size:** 7165 bytes &nbsp;&nbsp; **sha1:** `cf6a27edff25b05b90c5dcf1345564ff4725794e`

```javascript
const refs = {
  openBtn: document.querySelector('[data-menu-open]'),
  closeBtn: document.querySelector('[data-menu-close]'),
  menu: document.querySelector('[data-menu]'),
  links: document.querySelectorAll('[data-menu-link]'),
  logos: document.querySelectorAll('.header-logo'),
  header: document.querySelector('.header'),
};

function openMenu() {
  if (!refs.menu) return;
  refs.menu.hidden = false;
  refs.menu.classList.add('show');
  document.body.style.overflow = 'hidden';
  refs.openBtn?.setAttribute('aria-expanded', 'true');
}

function closeMenu() {
  return new Promise(resolve => {
    if (!refs.menu) return resolve();
    refs.menu.classList.remove('show');
    setTimeout(() => {
      refs.menu.hidden = true;
      document.body.style.overflow = '';
      refs.openBtn?.setAttribute('aria-expanded', 'false');
      resolve();
    }, 400);
  });
}

/* ---------- header offset helpers ---------- */
function getHeaderOffset() {
  return (refs.header?.offsetHeight || 80) + 8;
}
function applyScrollPadding() {
  document.documentElement.style.scrollPaddingTop = `${getHeaderOffset()}px`;
}
applyScrollPadding();
window.addEventListener('resize', () => requestAnimationFrame(applyScrollPadding));

/* ---------- custom smooth scroll (no teleports) ---------- */
function smoothScroll(targetHref, duration = 500) {
  const raw = (targetHref || '').replace('#', '');
  const el = document.getElementById(raw) || document.getElementById(`${raw}-section`);
  if (!el) return;

  const headerOffset = getHeaderOffset();
  const targetY = el.getBoundingClientRect().top + window.pageYOffset - headerOffset;

  const startY = window.pageYOffset;
  const diff = targetY - startY;
  let t0 = null;

  const ease = t => (t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2);

  function step(ts) {
    if (t0 === null) t0 = ts;
    const p = Math.min(1, (ts - t0) / duration);
    window.scrollTo(0, startY + diff * ease(p));
    if (p < 1) {
      requestAnimationFrame(step);
    } else {
      // NEW: переносим фокус на секцию, чтобы ссылка потеряла :focus
      el.setAttribute('tabindex', '-1');
      el.focus({ preventScroll: true });
      setTimeout(() => el.removeAttribute('tabindex'), 0);
    }
  }
  requestAnimationFrame(step);
}

/* ---------- menu events ---------- */
refs.openBtn?.addEventListener('click', openMenu);
refs.closeBtn?.addEventListener('click', closeMenu);

refs.logos.forEach(logo => {
  logo.addEventListener('click', e => {
    if (logo.closest('.mobile-menu')) {
      e.preventDefault();
      closeMenu();
      setTimeout(() => {
        window.location.href = logo.getAttribute('href');
      }, 400);
    }
  });
});

refs.menu?.addEventListener('click', e => {
  if (e.target === refs.menu) {
    closeMenu();
  }
});

document.addEventListener('keydown', e => {
  if (e.key === 'Escape' && refs.menu?.classList.contains('show')) {
    closeMenu();
  }
});

/* ---------- scroll-spy with IO ---------- */
const navLinks = document.querySelectorAll('.header-nav-link, .mobile-menu-nav-link');

const linkTargets = new Map();
navLinks.forEach(a => {
  const href = (a.getAttribute('href') || '').trim();
  if (!href.startsWith('#')) return;
  const rawId = href.slice(1);
  const el = document.getElementById(rawId) || document.getElementById(`${rawId}-section`);
  if (!el) return;
  if (!linkTargets.has(el)) linkTargets.set(el, []);
  linkTargets.get(el).push(a);
});

let currentEl = null;
function setActiveByEl(el) {
  if (!el || currentEl === el) return;
  navLinks.forEach(a => a.classList.remove('active'));
  (linkTargets.get(el) || []).forEach(a => a.classList.add('active'));
  currentEl = el;
}

let lockUntil = 0;
const LOCK_MS = 700;
const isLocked = () => Date.now() < lockUntil;

let io;
function initScrollSpy() {
  if (io) io.disconnect();

  const rootMargin = `-${getHeaderOffset()}px 0px -55% 0px`;
  const visibleRatio = new Map();

  io = new IntersectionObserver(
    entries => {
      entries.forEach(en => {
        visibleRatio.set(en.target, en.isIntersecting ? en.intersectionRatio : 0);
      });
      if (isLocked()) return;
      const best = [...visibleRatio.entries()].sort((a, b) => b[1] - a[1])[0];
      if (best && best[1] > 0) setActiveByEl(best[0]);
    },
    { root: null, rootMargin, threshold: [0, 0.25, 0.5, 0.75, 1] }
  );

  linkTargets.forEach((_, el) => io.observe(el));
}
initScrollSpy();
window.addEventListener('resize', () => requestAnimationFrame(initScrollSpy));

// ---------- HERO "Explore Artists" button smooth scroll ----------
const exploreBtn = document.getElementById('exploreBtn');

if (exploreBtn) {
  exploreBtn.addEventListener('click', async (e) => {
    e.preventDefault();
    exploreBtn.blur();

    const href = exploreBtn.getAttribute('href') || '#artists-section';
    const raw  = href.replace('#', '');
    const el   = document.getElementById(raw) || document.getElementById(`${raw}-section`);
    if (!el) return;

    // если вдруг открыт мобильный бургер — прикрываем перед скроллом
    if (refs.menu?.classList.contains('show')) {
      await closeMenu();
    }

    // подсветим активный пункт в хедере (если такой есть)
    setActiveByEl(el);

    // слегка «заблокируем» scroll-spy, чтобы он не перебил активный пункт во время анимации
    lockUntil = Date.now() + LOCK_MS;

    // плавный скролл с учётом высоты хедера
    smoothScroll(href, 600); // можешь подправить длительность
  });
}

/* ---------- nav handlers ---------- */
// Desktop: не трогаем мобильные (у них есть data-menu-link)
navLinks.forEach(a => {
  a.addEventListener('click', (e) => {
    if (a.matches('[data-menu-link]')) return;
    const href = (a.getAttribute('href') || '').trim();
    if (!href.startsWith('#')) return;

    e.preventDefault();
    a.blur();                      // NEW: снимаем :focus с кликнутой ссылки

    const raw = href.slice(1);
    const el = document.getElementById(raw) || document.getElementById(`${raw}-section`);
    if (!el) return;

    setActiveByEl(el);
    lockUntil = Date.now() + LOCK_MS;
    smoothScroll(href);
  });
});

// Mobile: ждём закрытие меню, снимаем фокус, потом скроллим
refs.links.forEach(link =>
  link.addEventListener('click', async e => {
    e.preventDefault();
    link.blur();                   // NEW: снимаем :focus с мобильной ссылки
    const targetId = link.getAttribute('href');
    await closeMenu();
    smoothScroll(targetId);
  })
);

window.addEventListener('load', () => {
  applyScrollPadding();
  if (location.hash) {
    setTimeout(() => smoothScroll(location.hash), 0);
  }
});

```

---
## assistant_bundle_20250912_153759/_snapshot/src/js/shared/sprite.js

**size:** 219 bytes &nbsp;&nbsp; **sha1:** `9a1fd48bf33ab7f30d5cd29568449bb5624e18b4`

```javascript

import spriteUrl from '../../img/sprite.svg?url';

export const SPRITE = spriteUrl;

export const icon = (id, cls = 'ico') =>
  `<svg class="${cls}" aria-hidden="true"><use href="${SPRITE}#${id}"></use></svg>`;

```

---
## assistant_bundle_20250912_153759/_snapshot/src/main.js

**size:** 517 bytes &nbsp;&nbsp; **sha1:** `69f42ec2151deeeb106b69c33541fe193d3ddf04`

```javascript
import './js/api.js';                 
import './js/artists/index.js';  

import './js/assistant/chat.js';
import './js/assistant/assistant-hooks.js'; 


import './js/header.js';
import './js/hero.js';
import './js/comments.js';
import "./js/global-sfx.js";
// Важно: чат подключается через <script type="module" src="./js/assistant/chat.js"> в index.html
// Здесь его не импортируем, чтобы не было двойной инициализации.



```

---
## assistant_bundle_20250912_153759/_snapshot/src/partials/about.html

**size:** 1403 bytes &nbsp;&nbsp; **sha1:** `d13913ebc3f51f7b64c71bd8ec46ca34e3e8af0c`

```html
<section id="about" class="about-section">
  <div class="container div-about-section">
    <div class="img-container-about-section">
      <picture>
        <source
          media="(min-width: 1440px)"
          srcset="/img/about/about-desk.png 1x, /img/about/about-desk-2x.png 2x"
        />
        <source
          media="(min-width: 768px)"
          srcset="/img/about/about-tabl.png 1x, /img/about/about-tabl-2x.png 2x"
        />
        <source
          media="(max-width: 767px)"
          srcset="/img/about/about-mob.png 1x, /img/about/about-mob-2x.png 2x"
        />
        <img
          src="/img/about/about-mob.png"
          srcset="/img/about/about-mob.png 1x, /img/about/about-mob-2x.png 2x"
          alt="Team"
        />
      </picture>
    </div>

    <div class="about-us-content">
      <svg class="logo-svg" width="64" height="64">
        <use href="/img/sprite.svg#icon-logo_icon_about_us"></use>
      </svg>

      <div class="about-us-descrp">
        <h2 class="about-section-title">About ArtistsHub</h2>
        <p class="about-section-description">
          At ArtistsHub, our mission is to connect music lovers with the artists
          they adore. We strive to create a vibrant community where discovering
          new music is as enjoyable as listening to it.
        </p>
      </div>
    </div>
  </div>
</section>

```

---
## assistant_bundle_20250912_153759/_snapshot/src/partials/artists.html

**size:** 5277 bytes &nbsp;&nbsp; **sha1:** `d090c1a50f4408fd5a2126bc3c3ef84903a4c4ae`

```html
<section id="artists-section" class="artists1 container">
  <div class="artists1__head">
    <p class="eyebrow">Artists</p>
    <h2 class="title">Explore Your New Favorite Artists</h2>
  </div>

  <div class="artists1__layout">
    <!-- TOOLBAR / FILTERS -->
    <aside class="filters" id="filters">
      <div class="filters__bar">
        <!-- <span class="filters__label">Filters</span> -->

        <button
          id="view-toggle"
          class="filters__view"
          type="button"
          aria-pressed="false"
          data-action="view-list"
          data-view="list"
        >
          List view
        </button>

        <button
          id="filters-reset"
          type="button"
          class="filters__reset"
          data-action="filters-reset"
        >
          Reset
        </button>

        <button
          id="filters-toggle"
          type="button"
          class="filters__toggle"
          aria-controls="filters-panel"
          aria-expanded="false"
          data-action="filters-toggle"
        >
          <span>Search and Filters</span>
        </button>
      </div>

      <div id="filters-panel" class="filters__panel" aria-hidden="true">
        <!-- Search -->
        <label class="fld fld-search">
          <button
            id="flt-q-btn"
            type="button"
            class="fld-search__btn"
            aria-label="Search"
            data-action="search"
          >
            <svg class="ico" aria-hidden="true" width="24" height="24">
              <!-- якщо у тебе inline-спрайт: href="#icon-search"; якщо файл: href="/img/sprite.svg#icon-search" -->
              <use href="#icon-search"></use>
            </svg>
          </button>
          <input id="flt-q" type="search" placeholder="Search" />
        </label>

        <!-- Sorting -->
        <div class="dd" data-dd="sort">
          <button
            class="dd__btn"
            id="dd-sort-btn"
            type="button"
            aria-expanded="false"
            aria-controls="dd-sort-list"
          >
            <span>Sorting</span>
          </button>
          <ul class="dd__list" id="dd-sort-list" role="listbox">
            <li data-val="">Default</li>
            <li data-val="asc">A–Z</li>
            <li data-val="desc">Z–A</li>
          </ul>
        </div>

        <!-- Genre -->
        <div class="dd" data-dd="genre">
          <button
            class="dd__btn"
            id="dd-genre-btn"
            type="button"
            aria-expanded="false"
            aria-controls="dd-genre-list"
          >
            <span>Genre</span>
          </button>
          <ul class="dd__list" id="dd-genre-list" role="listbox"></ul>
        </div>

        <!-- Mix Radio / Next (иконки оставлены) -->
        <button
          id="random-radio"
          type="button"
          class="btn btn--purple"
          data-action="play next"
        >
          <span>Mix Radio</span>
          <svg class="ico" aria-hidden="true" width="24" height="24">
            <use href="/img/sprite.svg#icon-icon_youtube_footer"></use>
          </svg>
          <span>/ Next</span>
          <svg class="ico" aria-hidden="true" width="24" height="24">
            <use
              href="/img/sprite.svg#icon-icon_right_button_feedback_sec"
            ></use>
          </svg>
        </button>

        <button
          id="mixradio-menu-btn"
          type="button"
          class="btn btn--purple"
          data-action="radio-menu"
        >
          <span>Radio Menu</span>
          <svg class="ico" aria-hidden="true" width="24" height="24">
            <use
              href="/img/sprite.svg#icon-icon_right_button_feedback_sec"
            ></use>
          </svg>
        </button>
      </div>
    </aside>

    <!-- CONTENT -->
    <div class="artists1__content">
      <div id="artists-empty" class="empty" hidden>
        <div class="empty__card">
          <div class="empty__icon" aria-hidden="true">!</div>
          <h3 class="empty__title">Silence on the stage…</h3>
          <p class="empty__text">
            Looks like no artists match your filters.<br class="empty__br" />
            Try changing them or hit “Reset Filters” to bring back the beat.
          </p>
          <button class="empty__btn" id="empty-reset" type="button">
            Reset filters
          </button>
        </div>
      </div>

      <div id="artists-loader" class="loader" hidden></div>
      <ul id="artists-grid" class="grid"></ul>
      <nav id="artists-pager" class="pager" aria-label="Pagination"></nav>
    </div>
  </div>
</section>

<div id="artist-modal" class="amodal" hidden>
  <div class="amodal__backdrop"></div>
  <div
    class="amodal__dialog"
    role="dialog"
    aria-modal="true"
    aria-label="Artist details"
  >
    <button
      id="am-close"
      class="amodal__close"
      type="button"
      aria-label="Close"
    >
      ×
    </button>
    <div id="am-body" class="amodal__body">
      <div class="amodal__loader loader"></div>
    </div>
  </div>
</div>

```

---
## assistant_bundle_20250912_153759/_snapshot/src/partials/comments.html

**size:** 1840 bytes &nbsp;&nbsp; **sha1:** `65ab2f5df5a5dfb50dde6dae284a2467cb7d0ddb`

```html
<section id="reviews">
  <div class="feedback-section container">
    <h2 class="hidden">Feedbacks our visitors</h2>
    <div class="swiper">
      <div class="swiper-wrapper"></div>
      <div class="swiper-button-prev">
        <svg class="left-arrow" width="14" height="14">
          <use href="/img/sprite.svg#icon-icon_right_button_feedback_sec"></use>
        </svg>
      </div>
      <div class="swiper-button-next">
        <svg width="14" height="14">
          <use href="/img/sprite.svg#icon-icon_right_button_feedback_sec"></use>
        </svg>
      </div>

      <div class="swiper-pagination"></div>
    </div>
    <button class="review-btn feedback-btn" type="button">
      Leave feedback
    </button>
  </div>
  <div class="overlay hidden">
    <div class="modal">
      <svg class="close-icon" width="14px" height="14px">
        <use href="/img/sprite.svg#icon-icon_close"></use>
      </svg>
      <form id="feedback-form">
        <h3 class="title-modal">Submit feedback</h3>
        <div class="form-name">
          <label>Name</label>
          <input
            class="form-input-name"
            type="text"
            placeholder="Emily"
            required
          />
        </div>
        <div class="form-message">
          <label>Message</label>
          <textarea
            class="form-input-message"
            placeholder="Type your message..."
            required
          ></textarea>
        </div>
        <div
          id="customer-rating"
          class="rating my-rating"
          data-rating="0"
        ></div>
        <div class="send-btn-cont">
          <button class="review-btn send-feedback-btn" type="submit">
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

```

---
## assistant_bundle_20250912_153759/_snapshot/src/partials/footer.html

**size:** 2391 bytes &nbsp;&nbsp; **sha1:** `6ca23fb7de6845a1d498a3a6554b5f4ab255b1bd`

```html
<footer class="footer-section">
  <div class="container footer-container">
    <div class="footer-logo-wrapper">
      <a href="index.html" class="footer-logo">
        <svg class="footer-logo-svg">
          <use href="/img/sprite.svg#icon-logo"></use>
        </svg>
      </a>
    </div>
    <nav class="footer-nav">
      <ul class="footer-nav-list">
        <li class="footer-nav-item">
          <a href="#artists" class="footer-nav-link">Artists</a>
        </li>
        <li class="footer-nav-item">
          <a href="#about" class="footer-nav-link">About us</a>
        </li>
        <li class="footer-nav-item">
          <a href="#reviews" class="footer-nav-link">Reviews</a>
        </li>
      </ul>
    </nav>
    <div class="divider"></div>
    <div class="footer-social-wrapper">
      <div class="footer-social">
        <ul class="footer-social-list">
          <li class="footer-social-item">
            <a
              class="footer-social-link"
              href="https://www.instagram.com/"
              rel="noopener noreferrer"
              target="_blank"
            >
              <svg class="social-icon" width="40" height="40">
                <use href="/img/sprite.svg#icon-icon_inst_footer"></use>
              </svg>
            </a>
          </li>
          <li class="footer-social-item">
            <a
              class="footer-social-link"
              href="https://www.facebook.com/"
              rel="noopener noreferrer"
              target="_blank"
            >
              <svg class="social-icon" width="40" height="40">
                <use href="/img/sprite.svg#icon-icon_facebook_footer"></use>
              </svg>
            </a>
          </li>
          <li class="footer-social-item">
            <a
              class="footer-social-link"
              href="https://www.youtube.com/"
              rel="noopener noreferrer"
              target="_blank"
            >
              <svg class="social-icon" width="40" height="40">
                <use href="/img/sprite.svg#icon-icon_youtube_footer"></use>
              </svg>
            </a>
          </li>
        </ul>
      </div>
      <div class="footer-text-wrapper">
        <p class="footer-text">© 2025 ArtistsHub. All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>

```

---
## assistant_bundle_20250912_153759/_snapshot/src/partials/header.html

**size:** 2430 bytes &nbsp;&nbsp; **sha1:** `b5968c74b9b5c687ed5c90cc3cac8a30649350c0`

```html
<header class="header">
  <div class="header-container container">
    <a href="./index.html" class="header-logo" aria-label="Go to homepage">
      <svg class="header-logo-icon" aria-hidden="true">
        <use href="./img/sprite.svg#icon-logo"></use>
      </svg>
      <span class="sr-only">ArtistsHub</span>
    </a>

    <nav class="header-nav" aria-label="Main navigation">
      <ul class="header-nav-list">
        <li><a href="#artists-section" class="header-nav-link">Artists</a></li>
        <li><a href="#about" class="header-nav-link">About Us</a></li>
        <li><a href="#reviews" class="header-nav-link">Reviews</a></li>
      </ul>
    </nav>

    <button
      type="button"
      class="burger-menu-btn"
      aria-label="Open mobile menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
      data-menu-open
    >
      <svg class="burger-menu-icon" aria-hidden="true">
        <use href="./img/sprite.svg#icon-icon_menu_mobile_navbar"></use>
      </svg>
    </button>
  </div>

  <div class="mobile-menu" id="mobile-menu" data-menu hidden>
    <div class="mobile-menu-container">
      <div class="mobile-menu-top container">
        <a href="./index.html" class="header-logo">
          <svg class="header-logo-icon" aria-hidden="true">
            <use href="./img/sprite.svg#icon-logo"></use>
          </svg>
        </a>

        <button
          type="button"
          class="mobile-menu-close-btn"
          aria-label="Close mobile menu"
          data-menu-close
        >
          <svg class="mobile-menu-close-icon" aria-hidden="true">
            <use href="./img/sprite.svg#icon-icon_close"></use>
          </svg>
        </button>
      </div>

      <nav class="mobile-menu-nav" aria-label="Mobile navigation">
        <ul class="mobile-menu-nav-list">
          <li>
            <a
              href="#artists-section"
              class="mobile-menu-nav-link"
              data-menu-link
              >Artists</a
            >
          </li>
          <li>
            <a href="#about" class="mobile-menu-nav-link" data-menu-link
              >About Us</a
            >
          </li>
          <li>
            <a href="#reviews" class="mobile-menu-nav-link" data-menu-link
              >Reviews</a
            >
          </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

```

---
## assistant_bundle_20250912_153759/_snapshot/src/partials/hero.html

**size:** 775 bytes &nbsp;&nbsp; **sha1:** `306efab19796514d6f8e52ba0044c485077d4ab5`

```html
<section class="hero-section" id="hero">
  <div class="container hero-container">
    <div class="hero-content">
      <h1 class="hero-title">Discover Your Next Favorite Artist Today</h1>
      <p class="hero-subtitle">
        Dive into a world of music discoveries with ArtistsHub – your personal
        guide to the boundless universe of sound. Explore, filter, and learn
        about your favorite artists all in one place.
      </p>
      <a href="#artists-section" id="exploreBtn" class="hero-btn">
        Explore Artists
        <svg class="icon-play-btn" width="24" height="24">
          <use href="/img/sprite.svg#icon-icon_play_hero_section"></use>
        </svg>
      </a>
    </div>
    <div class="hero-img"></div>
  </div>
</section>

```

---
## assistant_bundle_20250912_153759/_snapshot/src/public/logo-icon.svg

**size:** 2890 bytes &nbsp;&nbsp; **sha1:** `82f4dea1e5064b6e5d92db46f9fa37bf762b0abf`

```text
<svg width="80" height="81" viewBox="0 0 80 81" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M43.7517 8.0874C44.7126 7.98445 45.8261 8.18498 46.7517 8.44775C48.8458 9.04219 50.5466 10.3152 51.5564 12.1323C52.6058 13.995 52.8072 16.1729 52.115 18.1753C51.2361 20.6446 49.3518 21.8856 46.9978 23.0269L47.0242 30.229C48.7065 30.7069 50.3433 31.2488 51.8708 32.0737C55.3816 33.9699 57.783 37.167 58.7898 40.8052C59.854 44.6203 59.2489 48.6743 57.1072 52.0747C55.1428 55.1569 52.0103 57.4332 48.2605 58.3052C43.3621 59.4456 39.208 58.2107 34.9978 55.8784C33.1368 57.7325 31.2979 59.6076 29.4832 61.5024C30.2945 63.2857 30.5632 65.1564 30.0251 67.0513C29.4993 68.9038 28.1061 70.4908 26.324 71.4292C24.3271 72.4822 22.0523 72.6741 19.863 72.0903C17.6904 71.511 15.8643 70.2569 14.8025 68.3726C13.7575 66.5201 13.6689 64.3493 14.3464 62.3716C15.1173 60.1237 16.6877 58.7388 18.8953 57.7114C21.2712 56.8455 23.2352 57.1303 25.5544 57.9087C27.4855 56.0153 29.3037 54.0267 31.2546 52.1499C29.1105 48.2321 28.4162 44.8948 29.531 40.5776C27.1036 39.5217 24.7627 38.2926 22.3337 37.2349C21.0359 38.4937 19.4497 39.3568 17.5867 39.6489C15.3649 39.9974 13.0223 39.4327 11.196 38.2173C9.3867 36.9959 8.19637 35.1347 7.90405 33.0708C7.60402 31.0694 8.16903 28.8632 9.54468 27.2837C10.9632 25.6547 13.1655 24.6725 15.3884 24.4556C17.5725 24.2574 19.7514 24.8781 21.4431 26.1802C23.6062 27.8683 24.2306 29.9664 24.4929 32.4673C26.7952 33.7825 29.4319 34.7969 31.8308 35.9712C34.9519 32.5333 37.2319 31.4487 41.781 30.1421L41.7849 22.9946C40.9705 22.691 40.1576 22.3215 39.448 21.8354C37.6532 20.5984 36.4753 18.7348 36.1843 16.6724C35.9152 14.6205 36.5362 12.5527 37.9109 10.9302C39.4133 9.17411 41.4221 8.37465 43.7517 8.0874ZM53.78 43.6431C53.3171 38.7261 48.6816 35.0801 43.4021 35.48C38.075 35.8837 34.118 40.2503 34.5847 45.2104C35.0517 50.1724 39.7643 53.8309 45.0857 53.3647C50.3594 52.9014 54.2428 48.5596 53.78 43.6431Z" fill="white"/>
<path d="M69.043 31.7021C69.2682 31.6917 69.4868 31.6887 69.7109 31.7189C70.4112 31.8135 71.1012 32.1286 71.4869 32.7015C71.8961 33.3093 71.9521 34.1187 72.0081 34.8228C72.2858 38.3074 72.0795 41.9326 72.0786 45.4296C72.0778 48.2855 72.4175 52.1582 71.8483 54.9085C71.6692 55.7729 71.054 56.1863 70.3172 56.654C70.0366 56.6857 69.7429 56.7219 69.4599 56.7068C68.8276 56.6736 68.2287 56.4111 67.8198 55.9615C67.4155 55.5165 67.4272 54.6233 67.3914 54.0651C67.1345 50.0566 67.3517 45.9199 67.3556 41.8994C67.3579 39.6147 67.0208 35.2411 67.5363 33.2022C67.7207 32.4727 68.4264 32.0904 69.043 31.7021Z" fill="white"/>
<path d="M62.5887 37.3008C63.3475 37.4311 64.0188 37.6968 64.461 38.3108C65.143 39.2581 65.1614 48.5389 64.8198 49.8635C64.6329 50.5876 63.9605 50.9406 63.323 51.2891C62.593 51.2484 61.6333 51.188 61.1457 50.5982C60.4202 49.7216 60.4803 39.8579 60.8933 38.621C61.1333 37.9023 61.9263 37.5984 62.5887 37.3008Z" fill="white"/>
</svg>

```

---
## assistant_bundle_20250912_153759/_snapshot/stylelint.config.cjs

**size:** 60 bytes &nbsp;&nbsp; **sha1:** `664ffad81fd9c04a42fb37518726da4ddfa933f2`

```text
module.exports = { extends: ['stylelint-config-standard'] };
```

---
## assistant_bundle_20250912_153759/_snapshot/tts_debug.json

**size:** 180 bytes &nbsp;&nbsp; **sha1:** `96ba8f869ef42c797bfef24e19dbd62cdbe3732d`

```json
{"ok":true,"lang":"en","model":"C:/piper/voices/en_US/lessac/medium/en_US-lessac-medium.onnx","file_size":38048,"note":"WAV written to temp; not returned because debug=1","log":""}
```

---
## assistant_bundle_20250912_153759/_snapshot/types/vite-plugins.d.ts

**size:** 170 bytes &nbsp;&nbsp; **sha1:** `ea028ac0626e3de8f886c06039b3666f63cc9a72`

```typescript
declare module 'vite-plugin-html-inject';
declare module 'vite-plugin-full-reload';
declare module 'vite-plugin-purgecss';
declare module 'rollup-plugin-visualizer';

```

---
## assistant_bundle_20250912_153759/_snapshot/vite.config.js

**size:** 1897 bytes &nbsp;&nbsp; **sha1:** `4766f10771b2775c708c061dfe92722824782516`

```javascript
// vite.config.js
import { defineConfig, loadEnv } from "vite";
import { glob } from "glob";
import injectHTML from "vite-plugin-html-inject";
import FullReload from "vite-plugin-full-reload";
import purgeCss from "vite-plugin-purgecss";
import path from "node:path";
import { fileURLToPath } from "node:url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

export default defineConfig(({ command, mode }) => {
  const env = loadEnv(mode, process.cwd(), "");
  // Для GH Pages обычно: /Artisthub-continuation/
  // Локально удобно: /
  const BASE =
    env.VITE_BASE ?? (command === "build" ? "/Artisthub-continuation/" : "/");

  const contentGlobs = [
    path.resolve(__dirname, "src/**/*.html"),
    path.resolve(__dirname, "src/**/*.js"),
  ];

  return {
    root: "src",
    base: BASE,
    build: {
      sourcemap: true,
      rollupOptions: {
        input: glob.sync("./src/*.html"),
      },
      outDir: "../dist",
      emptyOutDir: true,
    },
    plugins: [
      injectHTML(),
      FullReload(["./src/**/**.html", "./src/**/**.js", "./src/**/**.css"]),
      // Отключить PurgeCSS можно через NO_PURGE=1
      ...(env.NO_PURGE
        ? []
        : [
            purgeCss({
              content: contentGlobs,
              // Селекторы, которые появляются динамически
              safelist: [
                /list-view/,      // режим списка
                /assistant/,      // UI ассистента
                /swiper/,         // Swiper стили
                /iziToast/,       // iziToast
                /tui-/,           // tui-pagination
                /is-on/,          // состояния
              ],
            }),
          ]),
    ],
  };
});

```

---
## eslint.config.js

**size:** 1141 bytes &nbsp;&nbsp; **sha1:** `9c4efdfb845a3572e005fd7700109cfdea0c83f2`

```javascript
// eslint.config.js
import js from "@eslint/js";
import globals from "globals";

export default [
  // игнор сборок/отчётов
  { ignores: ["dist/**", "reports/**", "node_modules/**"] },

  // базовые рекомендации
  js.configs.recommended,

  // конфиги (Node-окружение)
  {
    files: ["vite.config.js", "postcss.config.cjs", "eslint.config.js"],
    languageOptions: {
      ecmaVersion: 2022,
      sourceType: "module",
      globals: { ...globals.node }
    }
  },

  // исходники (браузер)
  {
    files: ["src/**/*.js"],
    languageOptions: {
      ecmaVersion: 2022,
      sourceType: "module",
      globals: { ...globals.browser }
    },
    rules: {
      "no-undef": "error",
      // временно выключаем, чтобы пустые блоки не сыпались ошибками
      "no-empty": "off",
      // предупреждения за неиспользуемые — оставим мягко
      "no-unused-vars": ["warn", { argsIgnorePattern: "^_", varsIgnorePattern: "^_" }]
    }
  }
];

```

---
## jsconfig.json

**size:** 276 bytes &nbsp;&nbsp; **sha1:** `dfc9e9f061f6440d067178ce7c6f73838770c338`

```json
{
  "compilerOptions": {
    "checkJs": true,
    "target": "ES2022",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "allowJs": true,
    "baseUrl": "./src"
  },
  "exclude": ["dist", "node_modules"]
}

```

---
## package-lock.json (skipped, 326341 bytes > 204800)


---
## package.backup.json

**size:** 1937 bytes &nbsp;&nbsp; **sha1:** `87007a1ad8f8612617969e526e68c71b1d234ce3`

```json
{
  "name": "Artisthub-continuation",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "author": "Sergii Pavlov",
  "license": "ISC",
  "browserslist": [
    ">=0.5%",
    "last 2 versions",
    "not dead"
  ],
  "scripts": {
    "dev": "vite",
        "api": "node server/index.mjs",
    "dev:all": "npm run api & npm run dev"
    "dev:host": "vite --host",
    "build": "vite build",
    "build:local": "cross-env VITE_BASE=/ vite build",
    "preview": "vite preview",
    "preview:local": "npm run build:local && vite preview",
    "preview:nopurge": "cross-env NO_PURGE=1 VITE_BASE=/ vite build && vite preview",
    "preview:nosort": "cross-env NO_MQ_SORT=1 VITE_BASE=/ vite build && vite preview",
    "lint:js": "eslint .",
    "lint:css": "stylelint \"src/**/*.css\"",
    "lint:fix": "eslint . --fix",
    "doctor": "npm run lint:js && npm run lint:css && vite build",
    "analyze": "cross-env ANALYZE=1 vite build && node -e \"console.log('Open dist/stats.html')\""
  },
  "dependencies": {
    "axios": "^1.11.0",
    "cors": "^2.8.5",
    "css-star-rating": "^1.3.1",
    "dotenv": "^17.2.2",
    "express": "^5.1.0",
    "izitoast": "^1.4.0",
    "openai": "^5.19.1",
    "swiper": "^11.2.10",
    "tui-pagination": "^3.4.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.11.0",
    "@types/node": "^24.3.1",
    "autoprefixer": "^10.4.20",
    "cross-env": "^10.0.0",
    "cssnano": "^6.1.2",
    "eslint": "^9.11.0",
    "glob": "^11.0.0",
    "globals": "^15.8.0",
    "postcss": "^8.4.41",
    "postcss-discard-duplicates": "^6.0.3",
    "postcss-sort-media-queries": "^5.2.0",
    "rollup-plugin-visualizer": "^6.0.3",
    "stylelint": "^16.8.1",
    "stylelint-config-standard": "^36.0.0",
    "vite": "^5.4.6",
    "vite-plugin-full-reload": "^1.2.0",
    "vite-plugin-html-inject": "^1.1.2",
    "vite-plugin-purgecss": "^0.2.13"
  }
}

```

---
## package.json

**size:** 2039 bytes &nbsp;&nbsp; **sha1:** `47d3684c03c74db764584302b7e97b7e514005a6`

```json
{
  "name": "artisthub",
  "version": "1.0.0",
  "type": "module",
  "private": true,
  "engines": {
    "node": ">=18.17"
  },
  "scripts": {
    "dev": "vite",
    "dev:host": "vite --host",
    "build": "vite build",
    "build:pages": "cross-env VITE_BASE=/Artisthub-continuation/ vite build",
    "build:local": "cross-env VITE_BASE=/ vite build",
    "preview": "vite preview",
    "preview:local": "npm run build:local && vite preview",
    "lint:js": "eslint \"src/**/*.js\" --fix",
    "lint:css": "stylelint \"src/**/*.scss\" --fix",
    "style": "sass src/scss/app.scss:dist/app.css --no-source-map --load-path=node_modules",
    "style:watch": "sass --watch src/scss/app.scss:dist/app.css --no-source-map --load-path=node_modules",
    "svgo": "svgo -f src/img/svg -o src/img/svg",
    "prepare": "husky install",
    "server": "node server/index.mjs",
    "server:watch": "node --watch server/index.mjs",
    "all": "concurrently -n FRONT,API -c cyan,magenta \"npm:dev\" \"npm:server\""
  },
  "overrides": {
    "strip-ansi": "7.1.0"
  },
  "dependencies": {
    "axios": "^1.11.0",
    "cookie-parser": "^1.4.7",
    "cors": "^2.8.5",
    "dotenv": "^16.6.1",
    "express": "^4.21.2",
    "izitoast": "^1.4.0",
    "node-fetch": "^3.3.2",
    "swiper": "^10.3.1"
  },
  "devDependencies": {
    "@csstools/postcss-sass": "^5.1.0",
    "@eslint/js": "^9.9.0",
    "autoprefixer": "^10.4.19",
    "concurrently": "^9.0.0",
    "cross-env": "^10.0.0",
    "eslint": "^9.9.0",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-import": "^2.29.1",
    "eslint-plugin-prettier": "^5.1.3",
    "glob": "^11.0.3",
    "husky": "^9.1.6",
    "postcss": "^8.4.38",
    "prettier": "^3.3.3",
    "sass": "^1.77.6",
    "stylelint": "^16.6.1",
    "stylelint-config-standard-scss": "^14.0.0",
    "svgo": "^3.3.2",
    "vite": "^5.4.2",
    "vite-plugin-full-reload": "^1.2.0",
    "vite-plugin-html-inject": "^1.1.2",
    "vite-plugin-purgecss": "^0.2.13"
  }
}

```

---
## plan.txt

**size:** 7021 bytes &nbsp;&nbsp; **sha1:** `0f4e7786e299855212ad2d7025f0b5d6c7357d6f`

```text
npm run all

План на продукт

Web-приложение сейчас, мобильное потом

Делаем сайт как PWA (офлайн-кэш аудио/UI, быстрый старт).

Потом оборачиваем тот же фронт в Capacitor/React Native → Android/iOS
 (общий кодовый базис, общий бэкенд).

Две ИИ-линии

Free (локальная/дешёвая): LM Studio или Ollama на вашей машине/сервере. 
Никакой поминутной оплаты, скорость/умность зависят от железа и выбранной модели 
(Qwen2 7–14B / Llama3 8B и т.п.).

Pro (облако): OpenAI (например, gpt-4o-mini по умолчанию, опция gpt-4o для “супер-умного”). 
Оплата по токенам — только на вашей стороне, ключ хранится на сервере.

Единый бэкенд с переключателем провайдера

В .env:

PROVIDER=openai|lmstudio|ollama
OPENAI_API_KEY=...
OPENAI_MODEL=gpt-4o-mini
LLM_BASE_URL=http://localhost:1234/v1     # LM Studio (OpenAI-совместим)
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama3:instruct


На сервере одна функция askLLM(messages, {mode}), которая внутри отправляет запрос 
либо в OpenAI, либо в LM Studio (тот же OpenAI-совместимый /v1/chat/completions), либо в Ollama (их формат).

На фронте — маленький переключатель: “Режим: БЕСПЛАТНЫЙ / ПРО” (или “Эконом/Умный”). 
Запрос уходит с флагом, сервер решает, к кому идти.

Память диалогов (короткая + долговременная)

Уже есть cookie-session и оперативная история. Добавим SQLite (или файл JSON) на бэкенде:

sessions(id, created_at, last_seen)

messages(session_id, role, content, ts)

profile(session_id, prefs_json) — жанры/артисты/язык/громкость и т.д.

Раз в N сообщений делаем сжатое резюме (“что любит пользователь, что уже слушал”) и 
подмешиваем в system → ассистент помнит “характер” диалога между заходами.

Кнопка “Очистить память” (GDPR-friendly).

Голос: минимально бесплатно + опции

Сейчас оставляем браузерный TTS/SR (нулевая цена, без серверных затрат).

Опционально для Pro:

STT: локальный Whisper (faster-whisper) или облачный (качественнее).

TTS: Piper (офлайн, RU-голоса ок) или облачный (лучшее качество/голоса).

Музыка/видео и надёжное воспроизведение

YouTube: уже делаем videoEmbeddable=true, чёрный список ID, автопропуск недоступных
 треков → очередь продолжает играть.

Для рекомендаций: ассистент возвращает JSON-действия (мы это примем и выполним),
 а при “включи X” сервер сам добывает ID через YouTube Data API.

Позже можно добавить альтернативные источники (Bandcamp/архивы с встраиванием) — 
главное, чтобы было легально и встраиваемо. Фильмы — отдельная лицензия/провайдер,
 предлагаю отложить до стабильной музыки.

UX и контроль качества

В чате переключатель: “Бесплатный / Умный”, индикатор провайдера (у вас уже есть бейдж “AI”).

Кнопка “Пояснить выбор” (модель даёт краткий мотив — у нас поле explain).

“Играть сразу” vs “Только предложить” — ассистент отдаёт autoplay:true/false.

Для мобильного: крупные кнопки транспорта, кнопка “Микс-радио”, быстрые жанровые пресеты.

Монетизация (на будущее)

Free: локальная модель + браузерный TTS, ограничение длины ответа/частоты.

Pro: OpenAI-модели, облачный TTS, длинные ответы, улучшенная память.

Технически — флаг в JWT/куке; по флагу сервер выбирает провайдера и лимиты.

Что делаем прямо сейчас (без переписывания ваших наработок)

Добавляю в ваш сервер “переключатель провайдера” (OpenAI/LM Studio/Ollama) — 
чтобы вы могли хоть сейчас тестить бесплатную локальную модель и моментально щёлкать в облако.

Оставляю ваш строгий JSON-протокол для действий плеера и автопропуск недоступных роликов — э
то уже работает и не ломаем.

Включаю долговременную память (SQLite-файл рядом с сервером) — с автосжатием истории.

Если готовы — скажите какой бесплатный вариант стартуем:

LM Studio (проще всего, тот же /v1/chat/completions)

Ollama (нужна отдельная ветка запроса, зато очень гибко)

Я подготовлю полные файлы (не урезанные), строго поверх ваших текущих:

server/index.mjs (с провайдерами + JSON-валидацией + долговременной памятью)

.env.example (все ключи/флаги)

при необходимости — минимальные правки в вашем chat.js только для добавления 
UI-переключателя “Бесплатный/Про” (весь файл целиком).

Так мы получим: бесплатный, удобный, расширяемый сайт уже сейчас — и понятный 
путь к “супер-умному” уровню и мобильным приложениям, когда решите включить ПРО-провайдера.

```

---
## postcss.config.cjs

**size:** 1409 bytes &nbsp;&nbsp; **sha1:** `57d956a4b4a46e7097b33dd401f62227ced54ae9`

```text
// postcss.config.cjs
// Флаги (ставь через cross-env в npm-скриптах):
//   NO_MQ_SORT=1     — отключить сортировку медиазапросов
//   MEDIA_SORT=desktop-first | mobile-first (по умолчанию mobile-first)
//   NO_MINIFY=1      — отключить минификацию (cssnano)

function safeRequire(name) {
  try { return require(name); } catch { return null; }
}

const plugins = [];

// 1) Сортировка медиазапросов (может влиять на каскад)
if (process.env.NO_MQ_SORT !== '1') {
  const sortMq = safeRequire('postcss-sort-media-queries');
  if (sortMq) {
    const mode = (process.env.MEDIA_SORT || 'mobile-first').toLowerCase();
    plugins.push(sortMq({ sort: mode }));
  }
}

// 2) Удаление дублей
const discardDuplicates = safeRequire('postcss-discard-duplicates');
if (discardDuplicates) plugins.push(discardDuplicates);

// 3) Autoprefixer (не обязателен; подключится, только если установлен)
const autoprefixer = safeRequire('autoprefixer');
if (autoprefixer) plugins.push(autoprefixer());

// 4) Минификация
if (process.env.NO_MINIFY !== '1') {
  const cssnano = safeRequire('cssnano');
  if (cssnano) plugins.push(cssnano({ preset: 'default' }));
}

module.exports = { plugins };

```

---
## render.yaml

**size:** 782 bytes &nbsp;&nbsp; **sha1:** `ea6d2067acd9918ae20f9fa2ffc17a37601d329c`

```yaml
services:
  - type: web
    name: artisthub-ai
    env: node
    region: frankfurt
    plan: free # можно поднять позже
    buildCommand: npm ci
    startCommand: node server/index.mjs
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      # YouTube (опционально)
      - key: YT_API_KEY
        sync: false
      # PRO (OpenAI/совместимый)
      - key: OPENAI_BASE_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_MODEL
        sync: false
      # FREE (LM Studio/совместимый)
      - key: LMSTUDIO_BASE_URL
        sync: false
      - key: LMSTUDIO_API_KEY
        sync: false
      - key: LMSTUDIO_MODEL
        sync: false

```

---
## reports/README-cleanup.md

**size:** 1616 bytes &nbsp;&nbsp; **sha1:** `a12163f15d5580a6a8f5855b6572803aafa80fba`

```markdown
# Cleanup v1 (auto)

Что сделано:
- Удалены пустые импорты в `src/main.js` (footer.js, modal.js).
- В `src/css/styles.css` удалён пустой импорт `./modal.css`.
- Добавлены базовые конфиги линтеров: ESLint, Stylelint, PostCSS (cssnano).
- Сгенерированы отчёты:
  - `reports/unused_selectors.json` — потенциально неиспользуемые классы/ID (оценка, возможны ложные).
  - `reports/unreachable_js.json` — JS-файлы вне импорт-графа (могут быть задействованы динамически).
  - `reports/zero_size_files.txt` — файлы нулевого размера.

**Примечание:** Никакие стили/модули не удалялись физически (кроме импорт-строк) — чтобы не сломать поведение. Для физического удаления рекомендуем пройтись по отчётам и удалить вручную или доверить ассистенту следующий шаг ("Cleanup v2 — безопасное удаление").

Изменения:
- src/main.js: removed imports of zero-size files (footer.js, modal.js)
- src/css/styles.css: removed empty @import './modal.css'
- eslint.config.js: added basic ESLint flat config
- stylelint.config.cjs: added Stylelint config
- postcss.config.cjs: added CSS minify/duplicate removal
- jsconfig.json: added to enable //@ts-check and better IDE hints

```

---
## reports/unreachable_js.json

**size:** 213 bytes &nbsp;&nbsp; **sha1:** `9dcffef1480390fafc583fdc62fb659308bfc497`

```json
{
  "unreachable_js_files": [
    "src/js/artists/lib/toast.js",
    "src/js/footer.js",
    "src/js/modal.js",
    "src/js/shared/sprite.js"
  ],
  "note": "Dynamic imports/globals may not be detected."
}
```

---
## reports/unused_selectors.json

**size:** 2423 bytes &nbsp;&nbsp; **sha1:** `55edc78c9053d08cfd410a4107bb4df7be7c60ba`

```json
{
  "unused_classes": [
    "01em",
    "02",
    "04",
    "04em",
    "05",
    "05s",
    "06",
    "08",
    "1",
    "12",
    "12s",
    "14",
    "15",
    "16",
    "175",
    "18",
    "1s",
    "2",
    "24",
    "25",
    "25s",
    "275",
    "28",
    "2s",
    "2vw",
    "3",
    "32",
    "35",
    "35s",
    "3s",
    "4",
    "42",
    "45",
    "4s",
    "4vw",
    "5",
    "55",
    "5em",
    "6",
    "65",
    "7",
    "75px",
    "8",
    "885",
    "8s",
    "9",
    "95",
    "98",
    "985",
    "98px",
    "am-album",
    "am-album__title",
    "am-bio",
    "am-meta",
    "am-meta__col",
    "am-meta__item",
    "am-player__bar",
    "am-player__frame",
    "am-player__host",
    "am-player__inner",
    "am-player__left",
    "am-player__progresswrap",
    "am-player__right",
    "am-player__skip",
    "am-player__time",
    "am-tags",
    "am-yt",
    "am-zoom",
    "amodal__albums",
    "amodal__albums-title",
    "amodal__content",
    "amodal__img",
    "amodal__info",
    "amodal__scrolltop",
    "amodal__title",
    "anim",
    "base",
    "card",
    "card--skel",
    "card__link",
    "card__media",
    "card__tags",
    "card__text",
    "card__title",
    "controls",
    "css",
    "customer-feedback",
    "customer-name",
    "dd__loading",
    "dd__spinner",
    "dots",
    "empty-reset",
    "feedback",
    "hidden-container",
    "img-fade",
    "is-visible",
    "lbl",
    "muted",
    "note",
    "player",
    "png",
    "required-text",
    "skel",
    "skel--media",
    "skel--tag",
    "skel--text",
    "skel--title",
    "skeleton",
    "swiper-dots",
    "swiper-slide",
    "tag",
    "tbl",
    "th",
    "toolbar",
    "tr",
    "val",
    "yt-ph",
    "zoom"
  ],
  "unused_ids": [
    "000",
    "060307",
    "06030700",
    "0d0d0d",
    "111",
    "141014",
    "1e1c1f",
    "1e1d24",
    "22132b",
    "25152f",
    "262626",
    "272630",
    "2d2b33",
    "383744",
    "3a2a4f",
    "3c2a58",
    "5f3376",
    "603177",
    "764191",
    "9770ad",
    "9aa0a6",
    "Artist1Button",
    "af0404",
    "artist1Button",
    "b8b9c0",
    "e74c3c",
    "e8e8ec",
    "fff",
    "mixRadioBtn"
  ],
  "note": "This is a static guess. Some selectors may be used dynamically at runtime."
}
```

---
## reports/zero_size_files.txt

**size:** 98 bytes &nbsp;&nbsp; **sha1:** `25590554437d01d9573019c965f5f588d2909d3a`

```text
src/css/artists.css
src/css/modal.css
src/js/footer.js
src/js/modal.js
src/partials/modal.html
```

---
## server/index.mjs

**size:** 26168 bytes &nbsp;&nbsp; **sha1:** `73c4d4b3995b9f9cf50003be92e93a342315a3df`

```text
// server/index.mjs — server-v4.5.4-2025-09-11
// Focus: selectable provider (Pro/OpenAI vs Free/LM Studio) via req.body.provider,
// lang-lock, few-shots, enrich recommend→play (no forced query→id), MixRadio,
// /api/yt/search with exclude/shuffle/cache, and TTS endpoint.

import 'dotenv/config';
import express from 'express';
import cors from 'cors';
import cookieParser from 'cookie-parser';
import { registerTTS } from './tts.mjs';
import { searchIdsFallback, filterEmbeddable } from './search-fallback.mjs';

const app = express();
const PORT = Number(process.env.PORT || 8787);
const VERSION = 'server-v4.5.4-2025-09-11';
const DEBUG_INTENT = String(process.env.DEBUG_INTENT || '') === '1';

// LLM configs (Pro/OpenAI vs Free/LM Studio)
const LLM = {
  pro: {
    base: (process.env.OPENAI_BASE_URL || 'https://api.openai.com/v1').replace(/\/+$/, ''),
    key: process.env.OPENAI_API_KEY || '',
    model: process.env.OPENAI_MODEL || 'gpt-4o-mini',
    name: 'openai',
  },
  free: {
    base: (process.env.LMSTUDIO_BASE_URL || 'http://127.0.0.1:1234/v1').replace(/\/+$/, ''),
    key: process.env.LMSTUDIO_API_KEY || 'lm-studio',
    model: process.env.LMSTUDIO_MODEL || 'qwen2.5-7b-instruct',
    name: 'lmstudio',
  },
};

// YouTube
const YT_API_KEY = process.env.YT_API_KEY || '';

// --- middleware
app.use(cors({ origin: true, credentials: true }));
app.use(express.json({ limit: '1mb' }));
app.use(cookieParser());

// ─── Server TTS (Piper) ────────────────────────────────────────────────
registerTTS(app);

app.get('/api/health', (_req, res) => {
  res.json({
    ok: true,
    version: VERSION,
    llm: {
      pro: { base: LLM.pro.base, model: LLM.pro.model, key_set: !!LLM.pro.key },
      free: { base: LLM.free.base, model: LLM.free.model, key_set: !!LLM.free.key },
    },
  });
});

/* ---------------- Память сессий ---------------- */
const memory = new Map(); // sid -> [{role, content}, ...]
const MAX_SRV_HISTORY = 8;

function getSid(req, res) {
  let sid = req.cookies?.sid;
  if (!sid) {
    sid = Math.random().toString(36).slice(2) + Date.now().toString(36);
    res.cookie('sid', sid, {
      httpOnly: true,
      sameSite: 'lax',
      secure: process.env.NODE_ENV === 'production',
      maxAge: 7 * 864e5,
    });
  }
  return sid;
}
function pushHistory(sid, role, content) {
  const arr = memory.get(sid) || [];
  arr.push({ role, content: String(content || '') });
  while (arr.length > MAX_SRV_HISTORY) arr.shift();
  memory.set(sid, arr);
}

/* ---------------- System + Few-shots (строгий JSON) ------------------ */
const SYSTEM_CORE = `Ты — ассистент музыкальной витрины ArtistsHub.
Отвечай СТРОГО одним JSON-объектом:
{
  "reply": "короткая фраза пользователю",
  "explain": "опционально",
  "actions": [
    {"type":"player","action":"play"|"pause"|"next"|"prev"|"stop"},
    {"type":"mixradio"},
    {"type":"recommend","mood":"happy|calm|sad|energetic","genre":"рок","like":"queen bohemian rhapsody","autoplay":true},
    {"type":"volume","delta":0.1},
    {"type":"play","id":"YOUTUBE_ID_11","query":"artist - song"},
    {"type":"ui","action":"minimize"|"expand"}
  ]
}
Правила:
- «включи <…>» → play.query или recommend.like + autoplay=true.
- «жанр <…>» → recommend.genre (+autoplay=true, если просят включить).
- «пауза/стоп» → player.pause/stop.
- «следующий/предыдущий» → player.next/prev.
- «громче/тише» → volume.delta ±0.1.
- «под настроение» → recommend.mood (+autoplay=true, если это просьба включить).
- «сверни/разверни плеер» → {"type":"ui","action":"minimize|expand"}.
- НЕ выдумывай YouTube ID. Если не уверен — ставь только "query", без "id".
- Никогда не добавляй текст вне JSON. Ответ — только JSON, без пояснений и без тройных бэктиков.
`;

const FEWSHOTS = {
  ru: [
    { role: 'user', content: 'включи джаз' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Включаю джаз.', actions: [{ type: 'recommend', genre: 'джаз', autoplay: true }] }) },
    { role: 'user', content: 'сделай паузу' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Пауза.', actions: [{ type: 'player', action: 'pause' }] }) },
    { role: 'user', content: 'громче' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Громче.', actions: [{ type: 'volume', delta: 0.1 }] }) },
  ],
  en: [
    { role: 'user', content: 'play some jazz' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Playing jazz.', actions: [{ type: 'recommend', genre: 'jazz', autoplay: true }] }) },
    { role: 'user', content: 'pause it' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Paused.', actions: [{ type: 'player', action: 'pause' }] }) },
    { role: 'user', content: 'louder' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Louder.', actions: [{ type: 'volume', delta: 0.1 }] }) },
  ],
  uk: [
    { role: 'user', content: 'увімкни джаз' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Вмикаю джаз.', actions: [{ type: 'recommend', genre: 'джаз', autoplay: true }] }) },
    { role: 'user', content: 'пауза' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Пауза.', actions: [{ type: 'player', action: 'pause' }] }) },
    { role: 'user', content: 'гучніше' },
    { role: 'assistant', content: JSON.stringify({ reply: 'Гучніше.', actions: [{ type: 'volume', delta: 0.1 }] }) },
  ],
};

/* ---------------- Утилиты ---------------- */
function capitalize(s = '') {
  return s ? s[0].toUpperCase() + s.slice(1) : s;
}
function normalizeAggressive(s = '') {
  let t = String(s || '');
  try { t = t.normalize('NFC'); } catch {}
  t = t.replace(/[\u2010-\u2015\u2212]/g, '-').replace(/[“”«»„‟]/g, '"').replace(/[’‘‛]/g, "'");
  t = t.replace(/\u0438\u0306/g, '\u0439').replace(/\u0418\u0306/g, '\u0419');
  t = t.normalize('NFD').replace(/[\u0300-\u036f]/g, '').normalize('NFC');
  t = t.replace(/\u0451/g, '\u0435').replace(/\u0401/g, '\u0415');
  return t.toLowerCase();
}

/* ---------------- Вызов LLM ---------------- */
function pickLLM(provider) {
  const want = String(provider || '').toLowerCase();
  if (want === 'openai' || want === 'pro') {
    return LLM.pro.key ? LLM.pro : LLM.free;
  }
  if (want === 'lmstudio' || want === 'free') {
    return LLM.free;
  }
  // auto
  return LLM.pro.key ? LLM.pro : LLM.free;
}

async function askLLM(messages, cfg) {
  const base = cfg.base;
  const url = `${base}/chat/completions`;
  const payload = { model: cfg.model, messages, temperature: 0.2 };

  const ctrl = new AbortController();
  const to = setTimeout(() => ctrl.abort(), 15000);

  try {
    const r = await fetch(url, {
      method: 'POST',
      headers: { Authorization: `Bearer ${cfg.key || 'no-key'}`, 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
      signal: ctrl.signal,
    });
    clearTimeout(to);

    if (!r.ok) {
      const text = await r.text().catch(() => '');
      return { reply: '', explain: '', actions: [], _error: `LLM HTTP ${r.status}: ${text.slice(0, 200)}` };
    }

    const j = await r.json().catch(() => ({}));
    const content = j?.choices?.[0]?.message?.content ?? '';
    const clipped = String(content).slice(0, 25000);
    const maybeJson = extractJSONObject(clipped) || clipped;
    const repaired = softRepair(maybeJson);
    if (repaired && typeof repaired === 'object') {
      const reply = String(repaired.reply || '').slice(0, 500);
      const explain = String(repaired.explain || '');
      const actions = Array.isArray(repaired.actions) ? repaired.actions : [];
      return { reply, explain, actions };
    }
    return { reply: '', explain: '', actions: [], _error: 'no-json' };
  } catch (e) {
    clearTimeout(to);
    const msg = e && e.name === 'AbortError' ? 'timeout' : String(e.message || e);
    return { reply: '', explain: '', actions: [], _error: msg };
  }
}

/* ---------------- Soft-repair JSON ---------------- */
function extractJSONObject(s = '') {
  if (!s) return null;
  let inStr = false, esc = false, depth = 0, start = -1;
  for (let i = 0; i < s.length; i++) {
    const ch = s[i];
    if (esc) { esc = false; continue; }
    if (ch === '\\') { esc = true; continue; }
    if (ch === '"') { inStr = !inStr; continue; }
    if (inStr) continue;
    if (ch === '{') { if (depth === 0) start = i; depth++; }
    else if (ch === '}') { depth--; if (depth === 0 && start !== -1) return s.slice(start, i + 1); }
  }
  return null;
}
function softRepair(text = '') {
  if (!text || typeof text !== 'string') return null;
  let t = text.trim();
  t = t.replace(/^```(?:json)?/i, '').replace(/```$/, '');
  try { return JSON.parse(t); } catch {}
  t = t
    .replace(/([{,]\s*)'([^']+?)'(\s*:)/g, '$1"$2"$3')
    .replace(/:\s*'([^']*?)'/g, ': "$1"')
    .replace(/(\{|,)\s*actions\s*:/g, '$1 "actions":')
    .replace(/,\s*}/g, '}')
    .replace(/,\s*]/g, ']');
  try { return JSON.parse(t); } catch {}
  return null;
}

/* ---------------- Эвристики намерений ---------------- */
function inferActionsFromUser(text = '') {
  const t = normalizeAggressive(text).trim();
  const actions = [];
  if (DEBUG_INTENT) console.log('[intent:text]', t);

  // Транспорт
  if (/(пауза|стоп|останов|pause)/.test(t)) actions.push({ type: 'player', action: 'pause' });
  if (/выключ(и|ай)/.test(t)) actions.push({ type: 'player', action: 'stop' });
  if (/(следующ|друг(ую|ой)|ин(ую|ой)|нов(ую|ый)|another|next|skip|скип)/.test(t)) actions.push({ type: 'player', action: 'next' });
  if (/предыдущ|предыд|prev/.test(t)) actions.push({ type: 'player', action: 'prev' });

  // Громкость
  if (/(громче|louder|volume up|погромче|\bувелич(ь|и) громк)/.test(t)) actions.push({ type: 'volume', delta: +0.1 });
  if (/(тише|quieter|volume down|поменьше|\bуменьш(ь|и) громк)/.test(t)) actions.push({ type: 'volume', delta: -0.1 });

  // Радио и UI
  if (/(mix ?radio|микс ?радио|радио|random)/.test(t)) actions.push({ type: 'mixradio' });
  if (/сверн(и|уть)|minimi[sz]e/.test(t)) actions.push({ type: 'ui', action: 'minimize' });
  if (/(разверн|покажи плеер|открой плеер|expan[ds])/.test(t)) actions.push({ type: 'ui', action: 'expand' });

  const wantsPlay = /(включ|вруби|постав|поставь|запусти|play|сыграй)/.test(t);

  // Настроение
  const isCalm = /(спок|спокои|calm|lofi|lo-fi|chill|relax|ambient)/.test(t);
  if (isCalm) actions.push({ type: 'recommend', mood: 'calm', autoplay: wantsPlay });

  // Жанры
  const gsyn = [
    ['рок', 'рок|rock|альтернативн|альт|гранж|панк|metal|метал|hard rock|classic rock'],
    ['поп', 'поп|pop|dance pop|euro pop|эстрад'],
    ['рэп', 'рэп|rap|hip[- ]?hop|хип[ -]?хоп|drill'],
    ['электрон', 'электрон|electro|edm|house|techno|trance|dnb|drum and bass|dubstep|breakbeat'],
    ['джаз', 'джаз|jazz|swing|bebop'],
    ['блюз', 'блюз|blues'],
    ['классик', 'классик|classical|барокко|симфоническ|оркестр'],
    ['инди', 'инди|indie'],
    ['lofi', 'lofi|ло[- ]?фай'],
    ['ambient', 'ambient|эмбиент'],
    ['шансон', 'шансон'],
    ['folk', 'folk|фолк|кантри|country'],
    ['rnb', 'rnb|r&b|соул|soul'],
    ['latin', 'latin|латино|сальса|бачата|реггетон'],
    ['reggae', 'reggae|регги|ска|ska'],
    ['k-pop', 'k[- ]?pop|кей[ -]?поп'],
    ['j-pop', 'j[- ]?pop|джей[ -]?поп'],
    ['soundtrack', 'саундтрек|ost|original soundtrack'],
  ];
  for (const [canon, reStr] of gsyn) {
    const re = new RegExp(`\\b(?:${reStr})\\b`, 'i');
    if (re.test(t)) {
      actions.push({ type: 'recommend', genre: canon, autoplay: wantsPlay });
      break;
    }
  }

  // Десятилетия
  const d = t.match(/\b(50|60|70|80|90|2000|2010)(?:-?е|s|х)?\b/);
  if (d) {
    const s = d[1];
    const decade = /^\d{2}$/.test(s) ? `${s}s` : `${s}s`;
    actions.push({ type: 'recommend', decade, autoplay: wantsPlay });
  }

  // Похожее/включи ...
  const like1 = t.match(/(?:похож(ее|е)\s+на|как у|из\s+)(.+)$/i);
  const like2 = t.match(/(?:включи|вруби|поставь|постав|запусти|найди)\s+(.+)/i);
  const like = (like1 && like1[2]) || (like2 && like2[1]);
  if (like) actions.push({ type: 'recommend', like: like.trim(), autoplay: true });

  // Dedup
  const uniq = [];
  const seen = new Set();
  for (const a of actions) {
    const k = JSON.stringify(a);
    if (!seen.has(k)) {
      seen.add(k);
      uniq.push(a);
    }
  }
  return uniq;
}

/* --------- Last-chance fallback if still empty --------- */
function lastChanceActions(text = '') {
  const t = normalizeAggressive(text);
  if (/(спок|спокои|calm|lofi|lo-fi|chill|relax|ambient)/.test(t)) {
    return [{ type: 'play', id: '', query: 'lofi chill beats to relax' }];
  }
  if (/(включ|вруби|постав|поставь|play|сыграй|запусти)/.test(t)) {
    return [{ type: 'mixradio' }];
  }
  return [];
}
function replyForActions(actions = []) {
  if (!actions.length) return '';
  const a = actions[0];
  if (a.type === 'player') {
    if (a.action === 'pause') return 'Пауза.';
    if (a.action === 'stop') return 'Выключаю плеер.';
    if (a.action === 'next') return 'Следующий трек.';
    if (a.action === 'prev') return 'Предыдущий трек.';
    if (a.action === 'play') return 'Играю.';
  }
  if (a.type === 'mixradio') return 'Включаю микс-радио.';
  if (a.type === 'volume') return a.delta > 0 ? 'Громче.' : 'Тише.';
  if (a.type === 'ui') return a.action === 'minimize' ? 'Сворачиваю.' : 'Открываю плеер.';
  if (a.type === 'recommend') {
    if (a.genre) return `Включаю ${capitalize(a.genre)}.`;
    if (a.mood) return `Под настроение: ${capitalize(a.mood)}.`;
    if (a.like) return `Похоже на: ${a.like}.`;
  }
  if (a.type === 'play') return 'Играю.';
  return 'Готово.';
}

/* ---------------- YouTube helpers ---------------- */
async function ytSearchMany(q = '', max = 25) {
  if (!YT_API_KEY || !q) return [];
  const limit = Math.max(1, Math.min(50, Number(max || 25)));
  const u = new URL('https://www.googleapis.com/youtube/v3/search');
  u.searchParams.set('part', 'id');
  u.searchParams.set('type', 'video');
  u.searchParams.set('maxResults', String(limit));
  u.searchParams.set('order', 'relevance');
  u.searchParams.set('videoDuration', 'medium');
  u.searchParams.set('videoEmbeddable', 'true');
  u.searchParams.set('q', q);
  u.searchParams.set('key', YT_API_KEY);
  const r = await fetch(String(u)).catch(() => null);
  if (!r || !r.ok) return [];
  const j = await r.json().catch(() => ({}));
  const items = Array.isArray(j?.items) ? j.items : [];
  const ids = [];
  for (const it of items) {
    const id = it?.id?.videoId;
    if (id && /^[A-Za-z0-9_-]{11}$/.test(id)) ids.push(id);
  }
  return Array.from(new Set(ids)).slice(0, limit);
}

/* ---------------- Cache helpers ------------------ */
const __searchCache = new Map(); // key → { ids, exp }
const SEARCH_TTL_MS = 24 * 60 * 60 * 1000; // 24h
function cacheKey(q, max) { return `${q}\u0001${max}`; }
function cacheGet(k) {
  const rec = __searchCache.get(k);
  if (!rec) return null;
  if (Date.now() > rec.exp) { __searchCache.delete(k); return null; }
  return rec.ids || null;
}
function cacheSet(k, ids) { __searchCache.set(k, { ids, exp: Date.now() + SEARCH_TTL_MS }); }

app.get('/api/yt/cache/clear', (_req, res) => {
  const before = __searchCache.size;
  __searchCache.clear();
  res.json({ ok: true, before, after: __searchCache.size });
});
app.get('/api/yt/cache/stats', (_req, res) => {
  res.json({ ok: true, size: __searchCache.size, ttl_ms: SEARCH_TTL_MS });
});

/* ---------------- /api/yt/search ------------------ */
app.post('/api/yt/search', async (req, res) => {
  const t0 = Date.now();
  try {
    const q = String(req.body?.q || '').trim();
    const max = Math.max(1, Math.min(50, Number(req.body?.max || 25)));
    const exclude = Array.isArray(req.body?.exclude)
      ? req.body.exclude.filter((id) => /^[A-Za-z0-9_-]{11}$/.test(id))
      : [];
    const shuffle = !!req.body?.shuffle;
    if (!q) return res.status(400).json({ ids: [], error: 'no_query' });

    const key = cacheKey(q, max);
    const cached = cacheGet(key);
    let ids = cached ? [...cached] : null;

    if (!ids) {
      ids = [];
      if (typeof YT_API_KEY === 'string' && YT_API_KEY) {
        ids = await ytSearchMany(q, max);
      }
      if (!ids || ids.length < Math.max(3, Math.floor(max / 4))) {
        try {
          const extra = await searchIdsFallback(q, { max });
          const merged = Array.from(new Set([...(ids || []), ...extra]));
          ids = merged.slice(0, max);
        } catch (e) {
          console.warn('[yt.search] fallback failed', e?.message || e);
        }
      }
      try {
        ids = await filterEmbeddable(ids, { max });
      } catch {}
      cacheSet(key, ids);
    }

    let out = Array.isArray(ids) ? ids.filter((id) => !exclude.includes(id)) : [];
    if (shuffle && out.length > 1) {
      for (let i = out.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [out[i], out[j]] = [out[j], out[i]];
      }
    }
    out = out.slice(0, max);

    return res.json({ ids: out, q, took: Date.now() - t0, cached: !!cached, excluded: exclude.length });
  } catch (e) {
    console.error('[yt.search] error', e);
    return res.status(500).json({ ids: [], error: 'server_error', took: Date.now() - t0 });
  }
});

/* ---------------- Микс-сиды (рандом) ---------------- */
const MIX_SEEDS = [
  'lofi hip hop radio',
  'classic rock hits',
  'best jazz music relaxing',
  'indie rock playlist',
  'hip hop playlist',
  'edm house techno mix',
  'ambient music long playlist',
  'pop hits playlist',
  'latin hits playlist',
  'rnb soul classics playlist',
  'best reggae mix',
];
function randomMixSeed() {
  return MIX_SEEDS[(Math.random() * MIX_SEEDS.length) | 0];
}

/* ---------------- /api/chat ---------------- */
app.post('/api/chat', async (req, res) => {
  const t0 = Date.now();
  try {
    const sid = getSid(req, res);
    const userText = String(req.body?.message || '').trim();
    const clientHist = Array.isArray(req.body?.history) ? req.body.history : [];
    const provider = req.body?.provider; // 'openai'|'lmstudio'|undefined
    const cfg = pickLLM(provider);

    if (!userText) return res.json({ reply: 'Скажи, что включить.', actions: [], provider: cfg.name });

    // Жёсткая фиксация языка от клиента (RU/UK/EN)
    const langHint = String(req.body?.langHint || '').toLowerCase();
    const SYS_LANG =
      langHint === 'ru'
        ? 'Отвечай только по-русски. Не меняй язык при любых обстоятельствах.'
        : langHint === 'uk'
        ? 'Відповідай тільки українською. Не змінюй мову за жодних обставин.'
        : langHint === 'en'
        ? 'Answer only in English. Do not switch languages under any circumstances.'
        : 'Answer only in English. Do not switch languages under any circumstances.';

    const srvHist = memory.get(sid) || [];
    const combined = [...srvHist, ...clientHist.slice(-8)];
    const dedup = [];
    const seen = new Set();
    for (const m of combined) {
      const rec = { role: String(m.role || ''), content: String(m.content || '') };
      const k = JSON.stringify(rec);
      if (!seen.has(k)) {
        seen.add(k);
        dedup.push(rec);
      }
    }

    const shots = FEWSHOTS[langHint] || FEWSHOTS.en;
    const messages = [
      { role: 'system', content: SYSTEM_CORE },
      { role: 'system', content: 'Не используй китайский/японский/корейский. Отвечай только на RU/UK/EN.' },
      { role: 'system', content: SYS_LANG },
      ...shots,
      ...dedup.slice(-MAX_SRV_HISTORY),
      { role: 'user', content: userText },
    ];

    // 1) ответ модели
    let data = await askLLM(messages, cfg);

    // 2) эвристика, если пусто
    if (!Array.isArray(data.actions) || data.actions.length === 0) {
      const inferred = inferActionsFromUser(userText);
      if (inferred.length) {
        const reply = replyForActions(inferred);
        data = { reply: reply || data.reply || 'Готово.', explain: data.explain || '', actions: inferred };
        if (DEBUG_INTENT) console.log('[chat:fallback:inferred]', inferred);
      }
    }

    // 3) last-chance
    if (!Array.isArray(data.actions) || data.actions.length === 0) {
      const last = lastChanceActions(userText);
      if (last.length) {
        data = { reply: replyForActions(last) || 'Играю.', explain: data.explain || '', actions: last };
        if (DEBUG_INTENT) console.log('[chat:fallback:lastchance]', last);
      }
    }

    // 4) enrichment recommend→play (как в v4.4.1), БЕЗ принудительного query→id
    const actions = Array.isArray(data.actions) ? data.actions : [];
    const out = [];

    const ensureMoodQuery = (mood) => {
      const mm = normalizeAggressive(mood);
      const map = new Map([
        ['happy', 'upbeat feel good hits'],
        ['calm', 'lofi chill beats to relax'],
        ['sad', 'sad emotional songs playlist'],
        ['energetic', 'high energy workout rock mix'],
      ]);
      return map.get(mm) || 'music playlist';
    };
    const ensureLikeQuery = (like) => {
      const s = (like || '').trim();
      if (!s) return '';
      const words = s.split(/\s+/).filter(Boolean);
      if (words.length <= 2 && !/[-"«»“”„‟]/.test(s)) return `${s} greatest hits playlist`;
      return s;
    };
    const ensureGenreQuery = (genre) => {
      const g = normalizeAggressive(genre);
      const map = new Map([
        ['джаз', 'best jazz music relaxing'],
        ['рок', 'classic rock hits'],
        ['поп', 'pop hits playlist'],
        ['электрон', 'edm house techno mix'],
        ['lofi', 'lofi hip hop radio'],
        ['классик', 'classical symphony playlist'],
        ['рэп', 'hip hop playlist'],
        ['инди', 'indie rock playlist'],
        ['ambient', 'ambient music long playlist'],
        ['блюз', 'best blues songs playlist'],
        ['шансон', 'russian chanson mix'],
        ['folk', 'folk acoustic playlist'],
        ['rnb', 'rnb soul classics playlist'],
        ['latin', 'latin hits playlist'],
        ['reggae', 'best reggae mix'],
        ['k-pop', 'kpop hits playlist'],
        ['j-pop', 'jpop hits playlist'],
        ['soundtrack', 'movie soundtrack playlist'],
      ]);
      return map.get(g) || (g ? `${g} music playlist` : 'music playlist');
    };

    for (const a of actions) {
      if (a?.type === 'mixradio') {
        out.push({ type: 'play', id: '', query: randomMixSeed() });
        continue;
      }
      if (a?.type === 'recommend' && a.like && a.autoplay) {
        const like = ensureLikeQuery(a.like);
        out.push({ type: 'play', id: '', query: like });
        continue;
      }
      if (a?.type === 'recommend' && a.mood && a.autoplay) {
        out.push({ type: 'play', id: '', query: ensureMoodQuery(a.mood) });
        continue;
      }
      if (a?.type === 'recommend' && a.genre && a.autoplay) {
        out.push({ type: 'play', id: '', query: ensureGenreQuery(a.genre) });
        continue;
      }
      out.push(a);
    }

    // 5) запись истории и ответ
    pushHistory(sid, 'user', userText);
    pushHistory(sid, 'assistant', JSON.stringify({ reply: data.reply || replyForActions(out), actions: out }));

    console.log(
      `[chat] ${Date.now() - t0}ms  a=${out.length}  provider=${cfg.name}  err=${data._error || ''}`
    );
    res.json({ reply: data.reply || replyForActions(out) || 'Готово.', explain: data.explain || '', actions: out, provider: cfg.name });
  } catch (e) {
    console.error('[chat] ERROR', e);
    res.status(500).json({
      reply: 'Локальный ИИ не ответил. Я переключусь на простое управление.',
      actions: [],
      provider: 'error',
    });
  }
});

app.listen(PORT, () => {
  console.log(`AI server on http://localhost:${PORT}`);
  console.log(
    `Using PRO(base=${LLM.pro.base}, model=${LLM.pro.model}, key=${LLM.pro.key ? 'set' : 'no'}) | FREE(base=${LLM.free.base}, model=${LLM.free.model})  (${VERSION})`
  );
});

```

---
## server/search-fallback.mjs

**size:** 3640 bytes &nbsp;&nbsp; **sha1:** `c45bb210cac68dbf2fed93fd8245d308a4f9d25b`

```text
// server/search-fallback.mjs — v1.1.1 (2025-09-10)
// YouTube fallback (Piped → HTML) + oEmbed-фильтр на «встраиваемость».
// Экспортирует: searchIdsFallback, filterEmbeddable

const DEFAULT_MAX = 25;
const VALID_ID = /^[A-Za-z0-9_-]{11}$/;

function uniq(arr) {
  const out = [];
  const seen = new Set();
  for (const x of arr) if (!seen.has(x)) { seen.add(x); out.push(x); }
  return out;
}

async function pipedSearch(q, max, signal) {
  const base = (process.env.PIPED_INSTANCE || '').replace(/\/+$/, '') || 'https://piped.video';
  const url = `${base}/api/v1/search?q=${encodeURIComponent(q)}&filter=videos`;
  const r = await fetch(url, { signal }).catch(() => null);
  if (!r || !r.ok) return [];
  const j = await r.json().catch(() => null);
  const items = Array.isArray(j?.items) ? j.items : [];
  const ids = [];
  for (const it of items) {
    const vid = (it?.id && VALID_ID.test(it.id)) ? it.id
      : (typeof it?.url === 'string' && (it.url.match(/v=([A-Za-z0-9_-]{11})/)?.[1] || ''));
    if (vid && VALID_ID.test(vid)) ids.push(vid);
    if (ids.length >= max) break;
  }
  return uniq(ids);
}

async function htmlSearch(q, max, signal) {
  const u = `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`;
  const r = await fetch(u, { headers: { 'Accept-Language': 'en' }, signal }).catch(() => null);
  if (!r || !r.ok) return [];
  const html = await r.text();
  const ids = [];
  // Прямые videoId в JSON
  const reJSON = /"videoId"\s*:\s*"([A-Za-z0-9_-]{11})"/g;
  let m;
  while ((m = reJSON.exec(html)) && ids.length < max) {
    const id = m[1];
    if (VALID_ID.test(id)) ids.push(id);
  }
  // Доп. путь: из ссылок
  if (ids.length < max) {
    const reLink = /\/watch\?v=([A-Za-z0-9_-]{11})/g;
    let m2;
    while ((m2 = reLink.exec(html)) && ids.length < max) {
      const id = m2[1];
      if (VALID_ID.test(id)) ids.push(id);
    }
  }
  return uniq(ids).slice(0, max);
}

// Быстрая проверка «встраиваемости» через oEmbed
async function isEmbeddable(id, signal) {
  const u = `https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`;
  const r = await fetch(u, { signal }).catch(() => null);
  return !!(r && r.ok);
}

// ⬇⬇⬇ ТЕПЕРЬ ЭКСПОРТИРУЕМ
export async function filterEmbeddable(ids, { max, timeoutMs = 6000, concurrency = 3 } = {}) {
  const out = [];
  let i = 0;
  async function worker(signal) {
    while (i < ids.length && out.length < max) {
      const idx = i++;
      const id = ids[idx];
      const ok = await isEmbeddable(id, signal).catch(() => false);
      if (ok) out.push(id);
    }
  }
  const ctrl = new AbortController();
  const to = setTimeout(() => ctrl.abort(), timeoutMs);
  try {
    await Promise.all(Array.from({ length: Math.max(1, concurrency) }, () => worker(ctrl.signal)));
  } finally {
    clearTimeout(to);
  }
  return out.slice(0, max);
}

export async function searchIdsFallback(q, { max = DEFAULT_MAX, timeoutMs = 6000 } = {}) {
  const ctrl = new AbortController();
  const to = setTimeout(() => ctrl.abort(), timeoutMs);
  try {
    const a = await pipedSearch(q, max, ctrl.signal);
    const base = a.length ? a : await htmlSearch(q, max, ctrl.signal);
    if (!base.length) return [];
    // Гарантируем, что вернём только «встраиваемые» ID
    return await filterEmbeddable(base, { max, timeoutMs });
  } finally {
    clearTimeout(to);
  }
}

```

---
## server/tts.mjs

**size:** 5840 bytes &nbsp;&nbsp; **sha1:** `7deb30b4e3dc1ef3c525a00e5b83405433f24fd3`

```text
// server/tts.mjs — v1.3.0 (2025-09-10)
// Piper → ВРЕМЕННЫЙ WAV → отдаём клиенту (никакого stdout-аудио).
//
// POST /api/tts  -> audio/wav
//   body: { text: "...", lang?: "ru"|"uk"|"en" }
//   query:
//     ?debug=1  — вернуть JSON-диагностику (без WAV)
//     ?stream=1 — отдавать файл как поток (чтение с диска), иначе буфером
//
// .env (важное):
//   PIPER_PATH=C:/piper/piper.exe
//   PIPER_VOICE_RU=...onnx
//   PIPER_VOICE_UK=...onnx
//   PIPER_VOICE_EN=...onnx
//   PIPER_VOICE=...onnx (fallback)
//   PIPER_LENGTH_SCALE=1.0
//   PIPER_NOISE_SCALE=0.50
//   PIPER_NOISE_W=0.20
//   PIPER_THREADS=1

import { spawn } from 'child_process';
import os from 'os';
import path from 'path';
import { promises as fs } from 'fs';

function pickLang(text = '') {
  const t = String(text || '');
  const hasUk  = /[ґєіїҐЄІЇ]/.test(t);
  const hasCyr = /[\u0400-\u04FF]/.test(t);
  if (hasUk) return 'uk';
  if (hasCyr) return 'ru';
  return 'en';
}

function voiceFromEnv(lang) {
  const {
    PIPER_VOICE_RU = '',
    PIPER_VOICE_UK = '',
    PIPER_VOICE_EN = '',
    PIPER_VOICE    = '',
  } = process.env;
  if (lang === 'ru' && PIPER_VOICE_RU) return PIPER_VOICE_RU;
  if (lang === 'uk' && PIPER_VOICE_UK) return PIPER_VOICE_UK;
  if (lang === 'en' && PIPER_VOICE_EN) return PIPER_VOICE_EN;
  return PIPER_VOICE || PIPER_VOICE_RU || PIPER_VOICE_EN || PIPER_VOICE_UK || '';
}

function makeTempPath(prefix = 'piper-', ext = '.wav') {
  const name = `${prefix}${Date.now()}-${Math.random().toString(36).slice(2)}${ext}`;
  return path.join(os.tmpdir(), name);
}

export function registerTTS(app) {
  const PIPER_PATH = process.env.PIPER_PATH || 'C:/piper/piper.exe';
  const LENGTH  = String(process.env.PIPER_LENGTH_SCALE || '1.0');
  const NOISE   = String(process.env.PIPER_NOISE_SCALE  || '0.50');
  const NOISE_W = String(process.env.PIPER_NOISE_W      || '0.20');
  const THREADS = String(process.env.PIPER_THREADS      || '1');

  app.post('/api/tts', async (req, res) => {
    const q = req.query || {};
    const debug  = String(q.debug || '').toLowerCase() === '1';
    const stream = String(q.stream || '').toLowerCase() === '1';

    const text = String(req.body?.text || '').trim();
  
       const lang =
      (String(req.body?.lang || '').trim() ||
       String((req.query?.lang || '')).trim() ||
       pickLang(text));


    if (!text) return res.status(400).json({ error: 'no_text' });

    const model = voiceFromEnv(lang);
    if (!model) return res.status(500).json({ error: 'no_voice_model' });

    const outFile = makeTempPath('piper-', '.wav'); // временный WAV
    let stderrBuf = '';

    try {
      const args = [
        '--quiet',
        '-m', model,
        '-f', outFile,                // ← ПИШЕМ В ФАЙЛ
        '--length_scale', LENGTH,
        '--noise_scale', NOISE,
        '--noise_w', NOISE_W,
        '-t', THREADS,
      ];

      const child = spawn(PIPER_PATH, args, { stdio: ['pipe', 'ignore', 'pipe'] });

      child.stderr.on('data', d => { stderrBuf += d.toString('utf8'); });
      child.on('error', e => {
        if (!res.headersSent) res.status(500).json({ error: 'spawn_error', message: String(e) });
      });

      // Текст в stdin (с переводом строки)
      const input = text.endsWith('\n') ? text : (text + '\n');
      child.stdin.write(input);
      child.stdin.end();

      // Ждём завершения Piper
      await new Promise((resolve) => child.once('close', () => resolve()));

      // DEBUG-режим: просто отдадим инфо
      if (debug) {
        let size = 0;
        try {
          const st = await fs.stat(outFile);
          size = st.size | 0;
        } catch {}
        if (!res.headersSent) {
          res.status(200).json({
            ok: size > 44, lang, model,
            file_size: size,
            note: 'WAV written to temp; not returned because debug=1',
            log: stderrBuf,
          });
        }
        try { await fs.unlink(outFile); } catch {}
        return;
      }

      // Проверка файла
      const stat = await fs.stat(outFile).catch(() => null);
      if (!stat || !stat.size || stat.size < 44) {
        if (!res.headersSent) res.status(500).json({ error: 'empty_output', log: stderrBuf });
        try { await fs.unlink(outFile); } catch {}
        return;
      }

      res.setHeader('Content-Type', 'audio/wav');
      res.setHeader('Cache-Control', 'no-store');

      if (stream) {
        // отдать как поток с диска
        res.setHeader('Content-Length', String(stat.size));
        const file = await fs.open(outFile, 'r');
        const streamR = file.createReadStream();
        streamR.pipe(res);
        streamR.on('close', async () => {
          try { await file.close(); } catch {}
          try { await fs.unlink(outFile); } catch {}
        });
        streamR.on('error', async () => {
          if (!res.writableEnded) { try { res.end(); } catch {} }
          try { await file.close(); } catch {}
          try { await fs.unlink(outFile); } catch {}
        });
      } else {
        // буфером
        const buf = await fs.readFile(outFile);
        res.setHeader('Content-Length', String(buf.length));
        res.end(buf);
        try { await fs.unlink(outFile); } catch {}
      }

    } catch (e) {
      if (!res.headersSent) {
        res.status(500).json({ error: 'server_error', message: String(e), log: stderrBuf });
      }
      try { await fs.unlink(outFile); } catch {}
    }
  });
}

```

---
## src/css/about.css

**size:** 2075 bytes &nbsp;&nbsp; **sha1:** `6fbb4a107c1672a0642d0908b9a24cc5b1b32dd6`

```css
.about-section {
    padding: 64px 0;
}

.div-about-section {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 48px;
}

.img-container-about-section {
    border-radius: 16px;
    overflow: hidden;

}

.img-container-about-section img,
.img-container-about-section picture {
    display: block;
    width: 100%;
    height: auto;
}

.logo-svg {
    fill: currentColor;
    color: #fff;
    width: 64px;
    height: 64px;
}

.about-us-content {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
    flex-direction: column;
    gap: 20px;
    max-width: 288px;
}

.about-us-descrp {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
    flex-direction: column;
    width: 280px;
}

.about-section-title {
    font-family: 'Epilogue', sans-serif;
    font-weight: 700;
    font-size: 44px;
    line-height: 1.2;
    letter-spacing: -0.01em;
    color: #fff;
    margin: 0;
}

.about-section-description {
    font-size: 18px;
    line-height: 1.5;
    color: #fff;
    margin: 0;
}

/* Tablet */
@media screen and (min-width: 768px) {



    .img-container-about-section {
        width: 704px;
    }

    .about-us-content {

        max-width: none;
        width: 704px;
    }


    .logo-svg {
        width: 80px;
        height: 80px;
    }

    .about-us-descrp {
        width: 704px;
    }

    .about-section-description {
        font-size: 20px;
    }
}

/* Desktop */
@media screen and (min-width: 1440px) {
    .about-section {
        padding: 112px 0;
    }

  
    .div-about-section {
        flex-direction: row;
        gap: 32px;
    }

    .img-container-about-section {
        width: 640px;
    }

    .about-us-content {
        max-width: none;
        width: 640px;
        gap: 24px;
    }

    .about-us-descrp {
        width: 640px;
    }

    .about-section-title {
        font-size: 60px;
    }
}
```

---
## src/css/artists/artist.zoom.css

**size:** 1457 bytes &nbsp;&nbsp; **sha1:** `e839755351b785bd9e42e4cd6909f6ce41d7dfd0`

```css
/* === Zoom overlay === */
.am-zoom {
  position: fixed;
  inset: 0;
  z-index: 6000; /* выше плеера */
}

.am-zoom__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
}

.am-zoom__dialog {
  position: absolute;
  inset: 0;
  display: grid;
  grid-template-rows: 1fr auto;
  gap: 12px;
  padding: 16px;
}

@media (min-width: 768px) {
  .am-zoom__dialog {
    padding: 24px;
  }
}

.am-zoom__stage {
  position: relative;
  background: #000;
  border-radius: 12px;
  overflow: hidden;

  display: flex;
  align-items: center;
  justify-content: center;

  min-height: 240px;
  height: calc(100vh - 140px);
  touch-action: none; /* жесты pinch/drag — нашими руками */
}

.am-zoom__img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto !important; /* ключ к отсутствию растягивания */
  object-fit: contain;
  transform-origin: center center;
  will-change: transform;
  user-select: none;
  -webkit-user-drag: none;
  pointer-events: auto;
}

.am-zoom__bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
}

.am-zoom__open {
  color: #fff;
  text-decoration: none;
}

.am-zoom__close {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  border: none;
  background: var(--color-affair, #764191);
  color: #fff;
  cursor: pointer;
}

```

---
## src/css/artists/artists.anim.css

**size:** 493 bytes &nbsp;&nbsp; **sha1:** `4ae5859eecaf0b8aa78e4a5e3149b465f6120fdc`

```css
/* спиннер */
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* тосты — на будущее, если понадобятся 
@keyframes toast-in  { to { opacity:1; transform: translateY(0);} }
@keyframes toast-out { to { opacity:0; transform: translateY(8px);} }
*/

/* скелетон (мерцающая полоса) */
@keyframes skel-shine {
  0% {
    background-position: -150% 0;
  }
  100% {
    background-position: 150% 0;
  }
}

```

---
## src/css/artists/artists.base.css

**size:** 3319 bytes &nbsp;&nbsp; **sha1:** `a8c5d0d940fc643c7283dff94c3bd5befdd774b9`

```css
/* ===== Artists Section — Base ===== */

/* Скрытие по [hidden] */
[hidden] {
  display: none !important;
}

/* Секция: управляем ТОЛЬКО вертикальными отступами; горизонтальные паддинги и ширины — из глобального .container */
#artists-section {
  /* обычно у секции: <section id="artists-section" class="artists1 container"> */
  padding-block: 64px; /* мобилка: верх/низ 64px — как было */
}
@media (min-width: 1440px) {
  #artists-section {
    padding-block: 112px; /* десктоп: верх/низ 112px — как было */
  }
}
/* На планшете (768–1439.98) дополнительных паддингов не задаём — как у тебя изначально. */

/* Заголовок секции */
.artists1__head {
  margin: 0 0 24px;
}
.artists1__head .eyebrow {
  color: var(--color-neutral-300, #9aa0a6);
  font: 600 16px/1.5 'IBM Plex Sans', system-ui;
  margin-bottom: 16px;
}
@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1__head {
    max-width: 704px;
    margin: 0 auto 32px;
  }
}
@media (min-width: 1440px) {
  .artists1__head {
    max-width: 863px;
    margin: 0 0 80px;
  }
}
.artists1__head .title {
  color: var(--color-white);
  font-family: 'Epilogue', system-ui;
  font-weight: 700;
  letter-spacing: -0.01em;
  margin: 0;
  font-size: 44px;
  line-height: 1.2;
}
@media (min-width: 1440px) {
  .artists1__head .title {
    font-size: 84px;
    line-height: 1.1;
  }
}

/* ===== Layout секции =====
   На мобилке/планшете — одна колонка: сверху блок фильтров/кнопок, ниже грид.
   НУЖНЫЕ 16px между кнопками и карточками обеспечиваем gap:16px.
*/
#artists-section .artists1__layout {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px; /* << ключевой отступ между .filters и #artists-grid для моб/планшета */
}
@media (min-width: 1440px) {
  #artists-section .artists1__layout {
    grid-template-columns: 304px 1fr;
    gap: 32px; /* десктоп как было */
  }
}

/* Иконки: оставляем твой жёсткий белый (чтобы ничего не «поплыло») */
.artists1 .ico,
.artists1 .ico use,
.artists1 .ico path {
  --color1: var(--color-white);
  fill: var(--color-white) !important;
  color: var(--color-white) !important;
}

/* Лоадер */
.artists1 .loader {
  width: 64px;
  aspect-ratio: 1;
  border-radius: 50%;
  margin: 24px auto;
  border: 6px solid rgba(255, 255, 255, 0.12);
  border-right-color: var(--color-affair, #764191);
  animation: artists_spin 0.8s linear infinite;
}
@keyframes artists_spin {
  to {
    transform: rotate(1turn);
  }
}

/* Доп. тексты */
.artists1 .muted {
  color: var(--color-neutral-300, #b8b9c0);
}

/* Запрет прокрутки (если где-то используешь) */
.no-scroll {
  position: fixed;
  width: 100%;
  overflow: hidden;
}

/* Опечатка исправлена */
.empty-reset {
  font-size: 50px !important;
}

```

---
## src/css/artists/artists.card.css

**size:** 8813 bytes &nbsp;&nbsp; **sha1:** `9fb80d7aac83375892cc9b54162a3192bfdc0c97`

```css
/* =========================
   DEFAULT VIEW (база + фикс мобильной фотки)
   ========================= */

.artists1 .card {
  color: #e8e8ec;
  max-width: 100%;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  will-change: transform;
}

.artists1 .card__media img {
  width: 100%;
  height: 177px;
  display: block;
  border-radius: 16px;
  object-fit: cover;
  object-position: center top;
}

.artists1 .card__tags {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
}

.artists1 .tag {
  display: inline-flex;
  align-items: center;
  height: 32px;
  padding: 4px 10px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  font: 600 16px/1 'IBM Plex Sans';
}

.artists1 .card__title {
  color: var(--color-white);
  font: 700 32px/1.3 'Epilogue', system-ui;
  letter-spacing: -0.01em;
}

.artists1 .card__text {
  color: var(--color-white);
  font: 400 18px/1.5 'IBM Plex Sans';
  display: -webkit-box;
  -webkit-box-orient: vertical;
  overflow: hidden;
  margin-bottom: 0; /* не суммируемся с верхним отступом у кнопки */
}

/* Кнопка Learn More — базовый вариант (Default View) */
.artists1 .card__link {
  -webkit-appearance: none;
  appearance: none;
  border: 1px solid rgba(255, 255, 255, 0.15);
  background: transparent;
  border-radius: 12px;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;

  width: 125px;
  height: 27px;
  padding: 0;
  white-space: nowrap;

  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 500;
  font-size: 18px;
  line-height: 1.5;
  color: #fff;

  cursor: pointer;
}

.artists1 .card__link .ico {
  width: 24px;
  height: 24px;
  flex-shrink: 0;
  fill: currentColor;
  transition: transform 0.2s ease, fill 0.2s ease;
}

/* hover */
@media (hover: hover) {
  .artists1 .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }
  .artists1 .card__link:hover .ico,
  .artists1 .card__link:focus .ico {
    transform: translateX(2px);
    fill: var(--color-affair);
  }
}
@media (prefers-reduced-motion: reduce) {
  .artists1 .card,
  .artists1 .card__link .ico {
    transition: none;
  }
}

/* Высоты медиа по брейкпоинтам */
@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1 .grid .card__media img {
    height: 432px;
  }
}
@media (min-width: 1440px) {
  .artists1 .grid .card__media img {
    height: 393px;
  }
}

/* Ритм Default */
.artists1 .card__media + .card__tags {
  margin-top: 24px;
}
.artists1 .card__tags + .card__title {
  margin-top: 16px;
}
.artists1 .card__title + .card__text {
  margin-top: 8px;
}

/* Вернули 24px над кнопкой */
.artists1:not(.view-list) #artists-grid .card__text + .card__link,
.artists1:not(.view-list) #artists-grid .card__title + .card__link {
  margin-top: 24px !important;
}

/* Грид/центровка карточек */
.artists1 .grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 64px;
  justify-content: center;
}
@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1 .grid {
    grid-template-columns: 1fr;
    gap: 32px;
  }
  .artists1 .grid .card {
    max-width: 704px;
    margin: 0 auto;
  }
}
@media (min-width: 1440px) {
  .artists1 .grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 32px;
  }
}

/* MOBILE Default View: ширина карточки = 288px, фото 288×177 */
@media (max-width: 767.98px) {
  .artists1:not(.view-list) .grid .card {
    max-width: 288px;
    margin: 0 auto;
  }
  .artists1:not(.view-list) .card__media img {
    height: 177px;
    border-radius: 16px;
  }
}

#artists-section .card {
  margin: 0;
}
#artists-section .card + .card {
  margin-top: 0;
}

/* =========================
   LIST VIEW
   ========================= */

/* Контейнер сетки */
.artists1.view-list .grid {
  grid-template-columns: 1fr;
  gap: 24px;
}

/* Карточка: базовая (планшет/десктоп) */
.artists1.view-list .grid .card {
  display: grid;
  grid-template-columns: 208px minmax(0, 1fr) auto; /* << текст сжимается */
  grid-template-areas:
    'media title  action'
    'media tags   action';
  align-items: center;
  column-gap: 16px;
  row-gap: 6px;
  padding: 10px 12px;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.04);
  max-width: 976px;
  margin: 0 auto;
}

/* Превью */
.artists1.view-list .card__media {
  grid-area: media;
}
.artists1.view-list .card__media img {
  display: block;
  width: 208px;
  height: 117px;
  object-fit: cover;
  border-radius: 12px;
}

/* Заголовок/теги — разрешаем сжиматься */
.artists1.view-list .card__title,
.artists1.view-list .card__tags {
  min-width: 0;
}

.artists1.view-list .card__title {
  grid-area: title;
  margin: 0 0 2px;
  color: var(--color-white);
  font-weight: 700;
  font-size: 18px;
  line-height: 1.25;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Жанры — в одну линию, мягкая обрезка справа */
.artists1.view-list .card__tags {
  grid-area: tags;
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  flex-wrap: nowrap;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: clip;
  min-height: 22px;
  max-height: 22px;
  mask-image: linear-gradient(to right, black 92%, transparent);
  -webkit-mask-image: linear-gradient(to right, black 92%, transparent);
}
.artists1.view-list .card__tags .tag {
  display: inline-flex !important;
  align-items: center;
  height: 22px;
  padding: 2px 6px;
  font-size: 10px;
  line-height: 1;
  border-radius: 6px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  opacity: 0.9;
}

/* Текст в ListView — скрыт */
.artists1.view-list .card__text {
  display: none !important;
}

/* Кнопка Learn More */
.artists1.view-list .card__link {
  grid-area: action;
  justify-self: end;
  align-self: center;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 8px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 8px;
  background: transparent;
  font-size: 12px;
  line-height: 1;
  color: var(--color-white);
  white-space: nowrap;
  cursor: pointer;
}
.artists1.view-list .card__link .ico {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
  fill: currentColor;
  transition: transform 0.2s ease, fill 0.2s ease;
}

/* Мобильный ListView */
@media (max-width: 767.98px) {
  .artists1.view-list .grid {
    gap: 24px;
  }

  .artists1.view-list .grid .card {
    grid-template-columns: 64px minmax(0, 1fr) auto; /* << фикс для узких */
    grid-template-areas:
      'media title  action'
      'media tags   action';
    column-gap: 12px;
    row-gap: 2px;
    padding: 8px 10px;
    min-height: 72px;
  }

  .artists1.view-list .card__media {
    width: 64px;
    height: 64px;
    border-radius: 10px;
    overflow: hidden;
  }
  .artists1.view-list .card__media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
  }

  .artists1.view-list .card__title {
    font-size: 16px;
    line-height: 1.25;
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* кнопка — иконка 24×24, строго справа */
  .artists1.view-list .grid .card__link,
  .artists1.view-list #artists-grid .card__link {
    justify-self: end !important;
    align-self: center !important;
    width: 24px !important;
    height: 24px !important;
    padding: 0 !important;
    border: 0 !important;
    border-radius: 6px !important;
    font-size: 0 !important;
    line-height: 0 !important;
    gap: 0 !important;
    overflow: hidden !important;
    display: grid !important;
    place-items: center !important;
    background: transparent !important;
    color: var(--color-white, #fff) !important;
    cursor: pointer !important;
  }
  .artists1.view-list .grid .card__link .ico,
  .artists1.view-list #artists-grid .card__link .ico {
    width: 24px !important;
    height: 24px !important;
    margin-left: 0 !important;
    flex-shrink: 0 !important;
  }
}

/* Широкие (≥1440px) */
@media (min-width: 1440px) {
  .artists1.view-list .grid .card {
    min-height: 84px;
    padding: 10px 12px;
  }
  .artists1.view-list .card__title {
    font-size: 18px;
  }
}

```

---
## src/css/artists/artists.controls.css

**size:** 6352 bytes &nbsp;&nbsp; **sha1:** `bc139747484f0b6909028952f4a11e2f3b38cbfc`

```css
/* ----- Artists: interactive controls (Sort/Genre/Reset/Learn More & ListView) ----- */

#artists-section #dd-sort-btn,
#artists-section [data-dd='sort'] .dd__btn,
#artists-section #dd-genre-btn,
#artists-section [data-dd='genre'] .dd__btn,
#artists-section #filters-reset,
#artists-section #filters-reset-sm,
#artists-section .card__link,
#artists-section #view-toggle,             /* << добавили */
#artists-section .filters__view {
  /* << добавили */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transform-origin: center;
  will-change: transform;
  transition: transform 140ms ease, box-shadow 140ms ease,
    background-color 140ms ease, color 140ms ease;
}

/* Hover */
@media (hover: hover) and (pointer: fine) {
  #artists-section #dd-sort-btn:hover,
  #artists-section [data-dd='sort'] .dd__btn:hover,
  #artists-section #dd-genre-btn:hover,
  #artists-section [data-dd='genre'] .dd__btn:hover,
  #artists-section #filters-reset:hover,
  #artists-section #filters-reset-sm:hover,
  #artists-section .card__link:hover,
  #artists-section #view-toggle:hover,
  #artists-section .filters__view:hover {
    transform: scale(1.06);
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
  }
}

/* Focus */
#artists-section #dd-sort-btn:focus-visible,
#artists-section [data-dd='sort'] .dd__btn:focus-visible,
#artists-section #dd-genre-btn:focus-visible,
#artists-section [data-dd='genre'] .dd__btn:focus-visible,
#artists-section #filters-reset:focus-visible,
#artists-section #filters-reset-sm:focus-visible,
#artists-section .card__link:focus-visible,
#artists-section #view-toggle:focus-visible,
#artists-section .filters__view:focus-visible {
  outline: none;
  transform: scale(1.06);
box-shadow: 0 10px 24px rgba(0, 0, 0, .18),
    0 0 0 3px #9770ad;
  /* было: color-mix(..., white 25%) */
}

/* Active */
#artists-section #dd-sort-btn:active,
#artists-section [data-dd='sort'] .dd__btn:active,
#artists-section #dd-genre-btn:active,
#artists-section [data-dd='genre'] .dd__btn:active,
#artists-section #filters-reset:active,
#artists-section #filters-reset-sm:active,
#artists-section .card__link:active,
#artists-section #view-toggle:active,
#artists-section .filters__view:active {
  transform: scale(0.98);
}

/* Disabled */
#artists-section #dd-sort-btn:disabled,
#artists-section [data-dd='sort'] .dd__btn:disabled,
#artists-section #dd-genre-btn:disabled,
#artists-section [data-dd='genre'] .dd__btn:disabled,
#artists-section #filters-reset:disabled,
#artists-section #filters-reset-sm:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* НЕ красим Learn More: всё берём из базовых */
#artists-section .card__link {
  background: inherit;
  color: inherit;
  border: none;
}

@media (prefers-reduced-motion: reduce) {
  #artists-section #dd-sort-btn,
  #artists-section [data-dd='sort'] .dd__btn,
  #artists-section #dd-genre-btn,
  #artists-section [data-dd='genre'] .dd__btn,
  #artists-section #filters-reset,
  #artists-section #filters-reset-sm,
  #artists-section .card__link,
  #artists-section #view-toggle,
  #artists-section .filters__view {
    transition: none;
  }
}

/* База для всех кнопок секции Artists */
.artists1 .btn {
  -webkit-appearance: none;
  appearance: none;
  border: none;
  cursor: pointer;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 12px;

  height: 47px;
  padding: 10px 24px;
  border-radius: 12px;

  font-family: var(
    --font-sans,
    'IBM Plex Sans',
    system-ui,
    -apple-system,
    Segoe UI,
    Roboto,
    Arial,
    sans-serif
  );
  font-weight: 500;
  font-size: 18px;
  line-height: 1.5;

  color: var(--color-white, #fff);
  background: var(--color-grey-900, #111);

  box-shadow: 0 1px 2px rgba(6, 3, 7, 0.05), inset 0 -2px 1px rgba(0, 0, 0, 0.2),
    inset 0 0 0 1px rgba(6, 3, 7, 0.15),
    inset 0 32px 24px rgba(255, 255, 255, 0.05);
  transition: background-color 0.2s ease, transform 0.12s ease;
}

.artists1 .btn:hover,
.artists1 .btn:focus-visible {
  transform: translateY(-1px);
}

/* Кнопка List view как текст-линк (единый стиль с Reset) */
.artists1 .filters__view {
  appearance: none;
  background: none;
  border: 0;
  padding: 0;
  margin: 0;
  cursor: pointer;
  font-family: 'IBM Plex Sans', sans-serif;
  font-weight: 500;
  font-size: 18px;
  line-height: 1.5;
  text-decoration: underline;
  text-decoration-skip-ink: none;
  text-underline-offset: 3px;
  color: var(--color-white, #fff);
  white-space: nowrap;
}

/* НЕ скрывать на мобилке! (переопределяем старое правило) */
@media (max-width: 767.98px) {
  .artists1 .filters__view {
    display: inline-block !important;
  }
}

/* Desktop раскладка */
@media (min-width: 1440px) {
  .artists1 .filters__bar {
    display: grid;
    grid-template-columns: 1fr auto 1fr; /* Filters | Reset | List view */
    align-items: baseline;
    column-gap: 16px;
  }
  .artists1 .filters__label {
    grid-column: 1;
    justify-self: start;
  }
  .artists1 .filters__reset {
    grid-column: 2;
    justify-self: center;
  }
  .artists1 .filters__view {
    grid-column: 3;
    justify-self: end;
  }
}

/* выпадашки не обрезать */
.artists1 .filters {
  overflow: visible;
}

/* База dropdown */
.artists1 .dd {
  position: relative;
}
.artists1 .dd__list {
  display: none;
  margin-top: 8px;
  background: #141014;
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 12px;
  padding: 8px 0;
  list-style: none;
}
@media (min-width: 1440px) {
  .artists1 .dd__list {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    z-index: 30;
    max-height: 50vh;
    overflow: auto;
  }
  .artists1 .dd.open .dd__list {
    display: block;
  }
}
@media (max-width: 1439.98px) {
  .artists1 .dd {
    position: static;
  }
  .artists1 .dd__list {
    position: static;
    margin-top: 12px;
  }
  .artists1 .dd.open .dd__list {
    display: block;
  }
}

```

---
## src/css/artists/artists.filters.css

**size:** 9835 bytes &nbsp;&nbsp; **sha1:** `ff00ece8f0f02dc6818cff0b7293ab322674e41c`

```css
/* ========= Artists • Filters/Toolbar (clean) ========= */

/* по умолчанию скрываем кнопку поиска-иконки; на десктопе вернём */
#flt-q-btn {
  display: none !important;
}

/* базовый контейнер панели */
.artists1 .filters {
  position: relative;
  z-index: 5;
}

/* верхняя панель-контролы */
.artists1 .filters__bar {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* подпись (если используется) */
.artists1 .filters__label {
  color: #b8b9c0;
  font-weight: 600;
}

/* Reset — всегда толкаем вправо (и на моб/таб, и на десктопе) */
.artists1 .filters__reset {
  margin-left: auto;
  background: none;
  border: 0;
  color: #b8b9c0;
  cursor: pointer;
}

/* кнопка раскрытия панели (моб/таб) */
#filters-toggle {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: #2d2b33;
  border: 0;
  border-radius: 12px;
  color: var(--color-white);
  padding: 10px 14px;
  padding-right: 30px; /* запас под стрелку */
  position: relative;
  cursor: pointer;
}
#filters-toggle .ico {
  display: none !important;
}
#filters-toggle::after {
  content: '';
  position: absolute;
  right: 12px;
  top: 50%;
  width: 8px;
  height: 8px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: translateY(-50%) rotate(45deg);
  transition: transform 0.2s ease;
}
#filters-toggle[aria-expanded='true']::after {
  transform: translateY(-50%) rotate(-135deg);
}

/* сама панель */
#filters-panel {
  background: #1e1d24;
  border: 1px solid #262626;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
  margin-top: 12px;
  overflow: visible;
}

/* ---------- mobile & tablet (<=1439.98px) ---------- */
@media (max-width: 1439.98px) {
  /* показ/скрытие по aria */
  #filters-panel[aria-hidden='true'] {
    display: none;
  }
  #filters-panel[aria-hidden='false'] {
    display: block;
  }

  /* панель — overlay под баром */
  #filters-panel {
    position: absolute;
    top: calc(100% + 12px);
    left: 0;
    right: 0;
    z-index: 20;
    max-height: min(80vh, 720px);
    overflow: auto;
  }

  /* стекло-стили */
  .artists1 #filters-toggle,
  .artists1 #filters-panel .fld,
  .artists1 #filters-panel #flt-q-btn,
  .artists1 #filters-panel .dd {
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
      inset 0 -2px 1px 0 rgba(6, 3, 7, 0.05),
      inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    border: 0;
    color: var(--color-white);
  }
  .artists1 #filters-panel .dd__btn {
    background: transparent;
    color: var(--color-white);
  }
  .artists1 #filters-panel .dd__btn::after {
    border-right-color: var(--color-white);
    border-bottom-color: var(--color-white);
  }

  .artists1 #filters-panel #flt-q {
    background: transparent;
    color: var(--color-white);
  }
  .artists1 #filters-panel #flt-q::placeholder {
    color: rgba(255, 255, 255, 0.8);
  }
}

/* ---------- desktop (>=1440px) ---------- */
@media (min-width: 1440px) {
  /* показываем кнопку-иконку поиска; скрываем toggle */
  .fld-search__btn {
    background: none;
    border: 0;
    padding: 0;
    display: grid;
    place-items: center;
    cursor: pointer;
  }
  #flt-q-btn {
    display: block !important;
  }
  #filters-toggle {
    display: none !important;
  }

  /* панель статична, справа фикс ширина */
  #filters-panel {
    display: block !important;
    background: var(--color-neutral-darkest);
    border: 1px solid rgba(255, 255, 255, 0.12);
    width: 304px;
    overflow: visible;
  }
  #filters-panel .fld,
  #filters-panel .dd {
    width: 100%;
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    margin-bottom: 12px;
  }
  #filters-panel .dd {
    position: static !important;
  }
  #filters-panel .dd__list {
    position: static !important;
    display: none;
    max-height: 320px;
    overflow: auto;
    background: var(--color-neutral-darkest);
    border: 0;
    border-top: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 0 0 12px 12px;
    box-shadow: none;
    padding: 8px 0;
  }
  #filters-panel .dd.open .dd__list {
    display: block;
  }
  #filters-panel .dd.open .dd__btn {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
  }
  #filters-panel .dd__btn {
    height: 43px;
    padding: 8px 12px;
    font: 600 16px/1 'IBM Plex Sans';
    border-radius: 12px;
  }

  /* страховка: на десктопе бар — flex, Reset у правого края */
  .artists1 .filters__bar {
    display: flex !important;
    align-items: center;
    gap: 12px;
  }
  #filters-reset {
    margin-left: auto !important;
  }
}

/* ---------- поля поиска ---------- */
.fld {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #272630;
  border-radius: 12px;
  padding: 12px 14px;
  margin-bottom: 12px;
  min-height: 48px;
}
.fld .ico {
  width: 24px;
  height: 24px;
  fill: var(--color-white);
}
#flt-q {
  flex: 1 1 auto;
  background: transparent;
  border: 0;
  color: var(--color-white);
  outline: 0;
  font-size: 16px;
}
#flt-q::-webkit-search-cancel-button {
  -webkit-appearance: none;
  appearance: none;
  display: none;
}

/* ---------- дропдауны ---------- */
.dd {
  position: relative;
  background: #272630;
  border-radius: 12px;
  margin-bottom: 12px;
}
.dd__btn {
  position: relative;
}
.dd__btn .ico {
  display: none !important;
}
.dd__btn::after {
  content: '';
  position: absolute;
  right: 12px;
  top: 50%;
  width: 8px;
  height: 8px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: translateY(-50%) rotate(45deg);
  transition: transform 0.2s ease;
}
.dd.open .dd__btn::after {
  transform: translateY(-50%) rotate(-135deg);
}

.dd__list {
  position: absolute;
  left: 0;
  right: 0;
  top: calc(100% - 1px);
  z-index: 30;
  display: none;
  max-height: 320px;
  overflow: auto;
  padding: 8px 0;
  background: #0d0d0d;
  border: 1px solid #262626;
  border-top: 0;
  border-radius: 0 0 12px 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
}
.dd.open .dd__list {
  display: block;
}
.dd__list li {
  list-style: none;
  padding: 10px 14px;
  cursor: pointer;
  color: #e8e8ec;
  font-size: 16px;
}
.dd__list li:hover {
  background: #383744;
  border-radius: 10px;
}

/* ---------- mobile layout (<=767.98px) ---------- */
@media (max-width: 767.98px) {
  .artists1 .filters__bar {
    flex-wrap: wrap;
    row-gap: 12px;
  }

  /* toggle — на всю ширину второй строкой */
  #filters-toggle {
    order: 3;
    width: 100%;
    height: 56px;
    padding: 0 16px;
    justify-content: space-between;
    color: var(--color-white);
    text-align: center;
  }
}

/* ---------- tablet layout (768–1439.98px) ---------- */
@media (min-width: 768px) and (max-width: 1439.98px) {
  #filters-panel {
    width: 304px;
    margin: 12px 0 0 auto;
    padding: 12px;
    border-radius: 12px;
    background: #0d0d0d;
    border: 1px solid #262626;
    box-shadow: none;
    overflow: visible;
  }

  .artists1 #filters-panel .fld {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 0;
    background: #272630;
    border: 0;
    border-radius: 12px;
  }
  .artists1 #filters-panel .fld .ico {
    position: absolute;
    left: 12px;
    top: 12px;
    width: 24px;
    height: 24px;
    pointer-events: none;
  }
  #flt-q {
    width: 100%;
    height: 47px;
    padding: 10px 12px 10px 44px;
    border-radius: 12px;
    border: 0;
    background: transparent;
    font-size: 16px;
    color: var(--color-white);
    outline: 0;
  }

  #flt-q-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 233px;
    height: 47px;
    padding: 10px 24px;
    border-radius: 12px;
    border: none;
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
      inset 0 -2px 1px 0 rgba(6, 3, 7, 0.05),
      inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    color: var(--color-white);
    gap: 8px;
    margin-left: auto;
    cursor: pointer;
  }
  #flt-q-btn .ico {
    width: 24px;
    height: 24px;
    fill: currentColor;
  }

  #filters-toggle {
    width: 233px;
    height: 47px;
    padding: 10px 24px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
      inset 0 -2px 1px 0 rgba(6, 3, 7, 0.05),
      inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    border: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-white);
    position: relative;
  }
}

/* мини-лоадер в списке жанров */
.dd__loading {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  color: #e8e8ec;
  font-size: 16px;
}
.dd__spinner {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-top-color: rgba(255, 255, 255, 0.6);
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(1turn);
  }
}

```

---
## src/css/artists/artists.grid.css

**size:** 5097 bytes &nbsp;&nbsp; **sha1:** `fecc054a0a57b13c5b6e1550a000f5e892006466`

```css
/* ===== Grid (общая) ===== */
.artists1 #artists-grid,
.artists1 .grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 64px;
  justify-content: center; /* ширина дорожки */
}

/* Default View: центрируем карточки на мобиле/планшете */
.artists1:not(.view-list) #artists-grid,
.artists1:not(.view-list) .grid {
  justify-items: center; /* ключевой фикс */
}

/* Tablet */
@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1 #artists-grid,
  .artists1 .grid {
    gap: 32px;
  }
}

/* Desktop: две колонки в Default View */
@media (min-width: 1440px) {
  .artists1:not(.view-list) #artists-grid,
  .artists1:not(.view-list) .grid {
    grid-template-columns: repeat(2, 1fr);
    justify-items: stretch;
    gap: 32px;
  }
}

/* List View всегда в одну колонку */
.artists1.view-list #artists-grid,
.artists1.view-list .grid {
  grid-template-columns: 1fr;
  gap: 24px;
}

/* ===== Empty state ===== */
#artists-empty.empty {
  display: block;
  margin: 0;
}
.empty__card {
  width: 288px;
  min-height: 417px;
  box-sizing: border-box;
  background: var(--color-affair-950, #25152f);
  border: 1px solid rgba(255, 255, 255, 0.08);
  color: var(--color-white, #fff);
  border-radius: 16px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 24px;
}
.empty__icon {
  --icon-size: 40px;
  width: var(--icon-size);
  height: var(--icon-size);
  border-radius: 999px;
  display: grid;
  place-items: center;
  background: transparent;
  border: 4px solid var(--color-white, #fff);
  color: var(--color-white, #fff);
  font: 700 22px/1 'IBM Plex Sans', system-ui;
  transform: translateY(-1px);
}
.empty__title {
  margin: 0;
  font-family: 'Epilogue', system-ui;
  font-weight: 700;
  font-size: 32px;
  line-height: 1.2;
  letter-spacing: -0.01em;
}
.empty__text {
  margin: 0;
  font: 400 20px/1.5 'IBM Plex Sans', system-ui;
  opacity: 0.95;
}
.empty__btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 47px;
  padding: 10px 24px;
  width: 100%;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font: 500 18px/1.5 'IBM Plex Sans', system-ui;
  color: var(--color-white, #fff);
  background: var(--color-affair, #764191);
  box-shadow: 0 1px 2px rgba(6, 3, 7, 0.05), inset 0 -2px 1px rgba(0, 0, 0, 0.2),
    inset 0 0 0 1px rgba(6, 3, 7, 0.15),
    inset 0 32px 24px rgba(255, 255, 255, 0.05);
}
.empty__btn:hover,
.empty__btn:focus-visible {
  background: #5f3376;
}

/* ≥768 */
@media (min-width: 768px) {
  .empty__card {
    width: 704px;
    min-height: 341px;
    padding: 32px;
    gap: 24px;
  }
  .empty__title {
    font-size: 48px;
  }
  .empty__btn {
    width: 152px;
  }
}
/* ≥1440 */
@media (min-width: 1440px) {
  .empty__card {
    width: 976px;
    min-height: 341px;
    padding: 32px;
  }
  .empty__title {
    font-size: 48px;
  }
}

/* ==== HARD FIX: ListView не должен «вылезать» за край ==== */

/* 1) Трек сетки не центрируем — это источник «ползаний» при 1 колонке */
#artists-section .grid {
  justify-content: start !important;
  overflow-x: hidden; /* страховка от горизонтального скролла */
}

/* 2) Карточка занимает ширину трека + правильные колонки */
#artists-section.artists1.view-list .grid .card {
  box-sizing: border-box !important;
  width: 100% !important;
  max-width: 976px !important;
  margin: 0 auto !important;

  /* Мобайл: превью 64, середина сжимается, кнопка — авто */
  grid-template-columns: 64px minmax(0, 1fr) auto !important;
}

/* Планшет/десктоп: превью 208 */
@media (min-width: 768px) {
  #artists-section.artists1.view-list .grid .card {
    grid-template-columns: 208px minmax(0, 1fr) auto !important;
  }
}

/* 3) Средняя колонка реально может сжиматься */
#artists-section.artists1.view-list .card__title,
#artists-section.artists1.view-list .card__tags {
  min-width: 0 !important;
  overflow: hidden !important;
}

/* Заголовок — эллипсис; теги — мягкая маска справа */
#artists-section.artists1.view-list .card__title {
  white-space: nowrap !important;
  text-overflow: ellipsis !important;
}
#artists-section.artists1.view-list .card__tags {
  white-space: nowrap !important;
  text-overflow: clip !important;
  mask-image: linear-gradient(to right, black 92%, transparent) !important;
  -webkit-mask-image: linear-gradient(
    to right,
    black 92%,
    transparent
  ) !important;
}

/* 4) Кнопка — строго по правому краю своей колонки */
#artists-section.artists1.view-list .card__link {
  justify-self: end !important;
}

```

---
## src/css/artists/artists.modal.css

**size:** 7035 bytes &nbsp;&nbsp; **sha1:** `c63082796d5fe6c7e7bb73726c43416c79168952`

```css
/* ============ Artists: Modal (очищено) ============ */

.amodal[hidden] {
  display: none !important;
}

.amodal {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  z-index: 1000;
}
.amodal__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
}

/* Диалог */
.amodal__dialog {
  position: relative;
  z-index: 1;
  background: var(--color-neutral-darkest, #0d0d0d);
  color: var(--color-white, #fff);
  border-radius: 16px;
  inline-size: min(360px, calc(100vw - 48px));
  max-block-size: 90vh;
  overflow: auto;
  padding: 52px 8px;
  padding-right: clamp(20px, 2.2vw, 32px);
  overscroll-behavior: contain;
}
@supports (height: 1svh) {
  .amodal__dialog {
    max-block-size: 90svh;
  }
}
@media (min-width: 768px) {
  .amodal__dialog {
    inline-size: min(702px, calc(100vw - 48px));
    padding: 64px 24px;
    padding-right: clamp(24px, 2.2vw, 36px);
  }
}
@media (min-width: 1440px) {
  .amodal__dialog {
    inline-size: min(1312px, calc(100vw - 96px));
    padding: 64px;
    padding-right: clamp(28px, 2.4vw, 40px);
  }
}

/* Крестик */
.amodal__close {
  position: absolute;
  top: 20px;
  right: 34px;
  inline-size: 36px;
  block-size: 36px;
  display: grid;
  place-items: center;
  border: 0;
  background: transparent;
  color: var(--color-white, #fff);
  font-size: 28px;
  line-height: 1;
  cursor: pointer;
  z-index: 10;
}
.amodal__close::after {
  content: '';
  position: absolute;
  inset: -10px;
}
@media (max-width: 767.98px) {
  .amodal__close {
    top: 16px;
    right: 20px;
  }
}

/* Контент */
.amodal__body {
  color: #e8e8ec;
}
.amodal__title {
  margin: 0 0 16px;
  font: 700 20px/1.3 'Epilogue', system-ui;
  color: var(--color-white, #fff);
  text-align: center;
}
@media (min-width: 768px) {
  .amodal__title {
    font-size: 32px;
  }
}

.amodal__content {
  display: flex;
  flex-direction: column;
  gap: 16px;
}
@media (min-width: 1440px) {
  .amodal__content {
    flex-direction: row;
    align-items: flex-start;
    gap: 32px;
  }
}

.amodal__img {
  width: 100%;
  border-radius: 16px;
  object-fit: cover;
  display: block;
}
.amodal__info {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* метаданные */
.am-meta {
  display: flex;
  gap: 16px;
}
.am-meta__col {
  display: flex;
  flex-direction: column;
  gap: 16px;
  min-width: 150px;
}
.am-meta__item {
  display: flex;
  flex-direction: column;
}
.lbl {
  font-weight: 600;
  color: var(--color-white, #fff);
  line-height: 1.5;
}
.val {
  color: #e8e8ec;
}

/* био */
.am-bio .lbl {
  margin-bottom: 8px;
}
.am-bio p {
  margin: 0;
  color: #e8e8ec;
  line-height: 1.5;
  max-height: calc(1.5em * 10);
  overflow: hidden;
}
@media (min-width: 768px) {
  .am-bio p {
    max-height: calc(1.5em * 12);
  }
}
@supports (-webkit-line-clamp: 1) {
  .am-bio p {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 10;
  }
}

/* теги */
.am-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
}
.am-tags .tag {
  display: inline-flex;
  align-items: center;
  height: 32px;
  padding: 4px 10px;
  border-radius: 6px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  font-weight: 600;
  font-size: 16px;
}

/* альбомы */
.amodal__albums-title {
  margin: 16px 0;
  font: 700 24px/1.3 'Epilogue', system-ui;
  color: var(--color-white, #fff);
}
.amodal__albums {
  display: flex;
  flex-direction: column;
  gap: 32px;
}
@media (min-width: 768px) {
  .amodal__albums {
    flex-direction: row;
    flex-wrap: wrap;
  }
  .amodal__albums .am-album {
    width: calc((100% - 32px) / 2);
  }
}
@media (min-width: 1440px) {
  .amodal__albums .am-album {
    width: calc((100% - 96px) / 4);
  }
}

.am-album {
  min-width: 250px;
  background: #1e1c1f;
  border-radius: 16px;
  padding: 14px 11px;
  display: flex;
  flex-direction: column;
}
.am-album__title {
  margin: 0 0 12px;
  color: var(--color-white, #fff);
  font-weight: 600;
  font-size: 16px;
}

/* таблица треков */
.tbl {
  display: flex;
  flex-direction: column;
}
.tbl .th {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 12px;
  color: var(--color-white, #fff);
  font-weight: 600;
  font-size: 12px;
  line-height: 1.5;
}
.tr {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 8px 12px;
  color: #e8e8ec;
  font-size: 12px;
}
.tr:nth-child(2n) {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 8px;
}

/* колонки */
.th span:nth-child(1),
.tr span:nth-child(1) {
  flex-basis: 60%;
}
.th span:nth-child(2),
.tr span:nth-child(2) {
  flex-basis: 20%;
  text-align: left;
}
.th span:nth-child(3),
.tr span:nth-child(3) {
  flex-basis: 10%;
  text-align: right;
}

/* ютуб-иконка */
.am-yt {
  width: 24px;
  height: 24px;
  fill: var(--color-white, #fff);
  display: inline-block;
  transition: fill 0.2s ease;
}
a:hover .am-yt,
a:focus .am-yt {
  fill: var(--color-affair, #764191);
}
.yt-ph {
  display: inline-block;
  width: 24px;
  height: 24px;
}

/* КНОПКА «ВВЕРХ» */
.amodal__scrolltop {
  position: fixed;
  display: none;
  align-items: center;
  justify-content: center;
  width: 56px;
  height: 56px;
  right: 28px;
  bottom: 58px;
  background: rgba(10, 10, 10, 0.55);
  border: 2px solid rgba(255, 255, 255, 0.95);
  border-radius: 999px;
  color: #fff;
  font-weight: 900;
  font-size: 28px;
  line-height: 1;
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35),
    inset 0 0 0 1px rgba(255, 255, 255, 0.08);
  z-index: 1500;
}
.amodal__scrolltop:focus-visible {
  outline: 2px solid rgba(255, 255, 255, 0.65);
  outline-offset: 2px;
}
@media (max-width: 767.98px) {
  .amodal__scrolltop {
    right: 22px;
    bottom: 58px;
  }
}

/* Slim scrollbars */
.amodal__dialog,
.artists1 .dd__list {
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.28) transparent;
}
.amodal__dialog::-webkit-scrollbar,
.artists1 .dd__list::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}
.amodal__dialog::-webkit-scrollbar-track,
.artists1 .dd__list::-webkit-scrollbar-track {
  background: transparent;
}
.amodal__dialog::-webkit-scrollbar-thumb,
.artists1 .dd__list::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.28);
  border-radius: 8px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
.amodal__dialog::-webkit-scrollbar-thumb:hover,
.artists1 .dd__list::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.42);
}
@media (max-width: 480px) {
  .amodal__dialog::-webkit-scrollbar,
  .artists1 .dd__list::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
}

```

---
## src/css/artists/artists.pager.css

**size:** 1267 bytes &nbsp;&nbsp; **sha1:** `758a227b80c126a8f79cfa6e1cf9ca28807b2e23`

```css
/* Artists — Pagination */
.artists1 .pager {
  display: flex;
  justify-content: center;
  gap: 6px;
  margin-top: 64px;
}

.artists1 .pager button {
  min-width: 36px;
  height: 36px;
  border-radius: var(--radius-md, 10px);
  border: 1px solid var(--border-muted, rgba(255, 255, 255, 0.15));
  background: transparent;
  color: var(--color-text, var(--color-white, #fff));
  cursor: pointer;
  transition: background-color 150ms ease, border-color 150ms ease,
    transform 100ms ease;
}

.artists1 .pager button:hover:not([disabled]) {
  background: var(--surface-hover, rgba(255, 255, 255, 0.06));
}

.artists1 .pager button:focus-visible {
outline: 2px solid rgba(151, 112, 173, .9);
  outline-offset: 2px;
}

.artists1 .pager button.active {
  background: var(--color-affair-800, #3c2a58);
  border-color: var(--color-affair-800, #3c2a58);
  color: var(--color-white, #fff);
}

.artists1 .pager button[disabled] {
  opacity: 0.5;
  cursor: not-allowed;
}

.artists1 .pager .dots {
  border: 0;
  background: transparent;
  color: var(--color-text-muted, rgba(255, 255, 255, 0.7));
  pointer-events: none;
}

@media (prefers-reduced-motion: reduce) {
  .artists1 .pager button {
    transition: none;
  }
}

```

---
## src/css/artists/artists.player.css

**size:** 9951 bytes &nbsp;&nbsp; **sha1:** `a361fbb3d01a9fa5c2a34ca663003d89b047a5aa`

```css
/* ====== PLAYER (карточка) ====== */
.am-player {
  position: fixed;
  left: 50%;
  right: auto;
  bottom: 128px;
  width: min(720px, 92vw);
  z-index: 9999;
  transform: translate(-50%, 12px);
  opacity: 0;
  pointer-events: none;
  transition: transform 160ms ease, opacity 160ms ease;
}
.am-player--active {
  transform: translateY(0) translateX(-50%);
  opacity: 1;
  pointer-events: auto;
}

/* Свободное позиционирование после drag (управляется JS) */
.am-player--free {
}

/* Карточка */
.am-player__inner {
  background: #111;
  color: #fff;
  border-radius: 14px;
  overflow: hidden;
  box-shadow: 0 16px 42px rgba(0, 0, 0, 0.5);
  position: relative;
}

/* Верхняя «шапка» для перетаскивания */
.am-player__dragzone {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 44px;
  z-index: 6;
  cursor: grab;
  touch-action: none;
  background: transparent;
}
.am-player__dragzone.dragging {
  cursor: grabbing;
}

.am-player__close,
.am-player__hide {
  position: absolute;
  z-index: 8;
  height: 32px;
  border-radius: 8px;
  border: 0;
  color: #fff;
  cursor: pointer;
}
.am-player__close {
  top: 8px;
  right: 8px;
  width: 32px;
  line-height: 32px;
  text-align: center;
  background: #764191;
}
.am-player__hide {
  top: 8px;
  right: 48px;
  padding: 0 10px;
  background: #3a2a4f;
}
.am-player__hide:hover,
.am-player__hide:focus-visible {
  filter: brightness(1.06);
  outline: none;
}

/* Видео-кадр */
.am-player__frame {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 9;
  background: #000;
}
.am-player__host,
.am-player__frame > div,
.am-player__frame iframe {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border: 0;
  display: block;
}

.am-player__ytlink {
  position: absolute;
  top: 8px;
  left: 8px;
  z-index: 7;
  padding: 6px 10px;
  border-radius: 8px;
  background: rgba(0, 0, 0, 0.45);
  color: #fff;
  text-decoration: none;
  font: 600 12px/1 'IBM Plex Sans', system-ui, -apple-system, Segoe UI, Roboto,
    Arial, sans-serif;
}
.am-player__ytlink:hover {
  background: rgba(0, 0, 0, 0.6);
}

.am-player__bar {
  position: absolute;
  left: 8px;
  right: 8px;
  bottom: 8px;
  z-index: 5;
  display: grid;
  grid-template-columns: auto minmax(140px, 1fr) auto;
  gap: 10px;
  align-items: center;
  background: rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(4px);
  padding: 8px 10px;
  border-radius: 10px;
  box-sizing: border-box;
  cursor: default;
}

.am-player__left,
.am-player__right {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
}

/* Кнопки */
.am-player__skip,
.am-player__play,
.am-player__mute {
  cursor: pointer;
  border: none;
  background: #764191;
  color: #fff;
  width: 32px;
  height: 32px;
  border-radius: 8px;
  line-height: 32px;
  text-align: center;
}

/* Время */
.am-player__time {
  color: #fff;
  font: 500 13px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial,
    sans-serif;
}

/* Центр: прогресс */
.am-player__progresswrap {
  min-width: 0;
  width: 100%;
}
.am-player__progress {
  width: 100%;
  max-width: 440px;
  -webkit-appearance: none;
  appearance: none;
  height: 6px;
  background: rgba(255, 255, 255, 0.35);
  border-radius: 999px;
  outline: none;
  margin: 0;
  vertical-align: middle;
  overflow: hidden;
}
.am-player__progress::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #fff;
  border: 0;
  cursor: pointer;
  box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.2);
}
.am-player__progress::-moz-range-thumb {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #fff;
  border: 0;
  cursor: pointer;
}
.am-player__progress::-moz-range-track {
  height: 6px;
  background: rgba(255, 255, 255, 0.35);
  border: none;
  border-radius: 999px;
}

/* Правый блок: громкость фиксированной ширины */
.am-player__right .am-player__slider {
  flex: 0 0 120px;
  width: 120px;
  -webkit-appearance: none;
  appearance: none;
  height: 6px;
  background: rgba(255, 255, 255, 0.35);
  border-radius: 999px;
  outline: none;
  margin: 0;
  vertical-align: middle;
}
.am-player__right .am-player__slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #fff;
  border: 0;
  cursor: pointer;
  box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.2);
}
.am-player__right .am-player__slider::-moz-range-thumb {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #fff;
  border: 0;
  cursor: pointer;
}
.am-player__right .am-player__slider::-moz-range-track {
  height: 6px;
  background: rgba(255, 255, 255, 0.35);
  border: none;
  border-radius: 999px;
}

/* Мобилка: ниже и уже громкость */
@media (max-width: 480px) {
  .am-player {
    bottom: 110px;
  }
  .am-player__right .am-player__slider {
    flex-basis: 96px;
    width: 96px;
  }
}

/* ====== Свёрнутый режим ====== */
.am-player--min .am-player__inner {
  opacity: 0;
  pointer-events: none;
  transform: translate(-50%, 8px) scale(0.985);
  transition: transform 160ms ease, opacity 160ms ease;
}

/* ====== Пузырь ====== */
.am-player__bubble {
  position: fixed;
  z-index: 10000;
  left: auto;
  top: auto;
  right: auto;
  bottom: auto;

  width: 64px;
  height: 64px;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  display: grid;
  place-items: center;

  color: var(--color-white, #fff);
  background: var(--color-affair, #764191);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35),
    inset 0 0 0 1px rgba(255, 255, 255, 0.1);

  --amp: 1.06;
  --bpmDur: 520ms;
  animation: am-bubble-breathe var(--bpmDur) ease-in-out infinite;
}
.am-player__bubble .note {
  font: 700 18px/1 'IBM Plex Sans', system-ui;
  transform: translateY(-1px);
}
.am-player__bubble::before,
.am-player__bubble::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 999px;
  box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.14);
  pointer-events: none;
  transform: scale(1);
  opacity: 0.9;
  animation: am-bubble-ring var(--bpmDur) linear infinite;
}
.am-player__bubble::after {
  animation-delay: calc(var(--bpmDur) / 2);
  opacity: 0.7;
}
.am-player__bubble.is-paused {
  animation-play-state: paused;
}
.am-player__bubble.is-paused::before,
.am-player__bubble.is-paused::after {
  animation-play-state: paused;
  opacity: 0.35;
}
@keyframes am-bubble-breathe {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(var(--amp));
  }
}
@keyframes am-bubble-ring {
  0% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.16);
  }
  60% {
    transform: scale(1.25);
    box-shadow: 0 0 0 10px rgba(255, 255, 255, 0.08);
  }
  100% {
    transform: scale(1.42);
    box-shadow: 0 0 0 18px rgba(255, 255, 255, 0);
  }
}
@media (max-width: 420px) {
  .am-player__bubble {
    width: 56px;
    height: 56px;
  }
}

/* --- iPhone/узкие: прогресс на вторую строку, кнопки отдельно --- */
@media (max-width: 480px) {
  .am-player__bar {
    grid-template-columns: 1fr auto;
    grid-template-areas:
      'left right'
      'prog prog';
    row-gap: 8px;
  }
  .am-player__left {
    grid-area: left;
  }
  .am-player__right {
    grid-area: right;
    justify-self: end;
  }
  .am-player__progresswrap {
    grid-area: prog;
  }

  /* гарантируем, что слайдер не вылезает за бар */
  .am-player__progresswrap {
    overflow: hidden;
  }
}

/* было: z-index: 10000; */
.am-player__bubble {
  z-index: 2147483647; /* абсолютный верх */
}

/* ===== Патч кликов/слоёв при сворачивании ===== */

/* База (как у тебя): док не ловит клики, пока не активирован */
.am-player {
  pointer-events: none;
}

/* Когда активен — ловит клики */
.am-player--active {
  pointer-events: auto;
}

/* КОГДА СВЁРНУТ (пузырь) — снова не ловим клики,
   иначе невидимый док блокирует интерфейс под собой на мобилке */
.am-player--active.am-player--min {
  pointer-events: none;
}

/* Визуально прячем внутренность дока при сворачивании */
.am-player--min .am-player__inner {
  opacity: 0;
  transform: translate(-50%, 8px) scale(0.985);
  pointer-events: none; /* подстраховка */
}

/* Пузырь: управляем видимостью классом (чтобы не мешал кликам, когда скрыт) */
.am-player__bubble {
  display: none;
}
.am-player__bubble.is-visible {
  display: grid;
}

/* На всякий случай: пузырь ВСЕГДА кликабелен поверх всего */
.am-player__bubble {
  z-index: 2147483647;
  pointer-events: auto;
}

/* разрешаем кастомные жесты без нативного скролла */
.am-player__bubble,
.am-player__dragzone {
  touch-action: none;
}

/* когда плеер свёрнут — клики проходят сквозь док, но не сквозь пузырь */
.am-player--min.am-player--patch-applied {
  pointer-events: none;
}
.am-player--min.am-player--patch-applied .am-player__bubble {
  pointer-events: auto;
}

```

---
## src/css/artists/artists.skeleton.css

**size:** 1022 bytes &nbsp;&nbsp; **sha1:** `2a430670c7f3ab2bc8a83120c9ee1c14312f8253`

```css
/* Fade-in изображений карточек */
.artists1 .img-fade {
  opacity: 0;
  transition: opacity 0.35s ease;
}
.artists1 .img-fade.is-loaded {
  opacity: 1;
}

/* Скелетоны карты */
.artists1 .card--skel .skel {
  display: block;
  border-radius: 12px;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0.06) 25%,
    rgba(255, 255, 255, 0.12) 37%,
    rgba(255, 255, 255, 0.06) 63%
  );
  background-size: 400% 100%;
  animation: skel-shine 1.4s ease infinite;
}
.artists1 .skel--media {
  height: 177px;
  border-radius: 16px;
}
.artists1 .skel--tag {
  width: 72px;
  height: 32px;
  border-radius: 6px;
}
.artists1 .skel--title {
  height: 28px;
  margin: 12px 0 8px;
}
.artists1 .skel--text {
  height: 40px;
  border-radius: 8px;
}

@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1 .skel--media {
    height: 432px;
  }
}
@media (min-width: 1440px) {
  .artists1 .skel--media {
    height: 393px;
  }
}

```

---
## src/css/artists/artists.toolbar.css

**size:** 12219 bytes &nbsp;&nbsp; **sha1:** `08b8da54ea4473fcd1707cbb6b7b5dcb3ad960a0`

```css
/* =========================
   ARTISTS • TOOLBAR (final, no conflicts)
   ========================= */

/* Базовый вид кнопок внутри панели (drop-down + mix radio) */
#artists-section #filters-panel .dd__btn,
#artists-section #filters-panel #random-radio,
#artists-section #filters-panel #mixRadioBtn,
#artists-section #filters-panel #artist1Button,
#artists-section #filters-panel #Artist1Button {
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: space-between; /* текст слева, стрелка справа */
  gap: 12px;

  min-height: 47px;
  height: auto;
  padding: 10px 14px;
  padding-right: 30px; /* запас под стрелку */
  border-radius: 12px;

  width: 100%; /* <— ключевой фикс, без 265/280/304 */
  background: rgba(255, 255, 255, 0);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #e8e8ec;
  font: 600 16px/1 'IBM Plex Sans', system-ui, -apple-system, Segoe UI, Roboto,
    Arial, sans-serif;
}

/* Стрелка на кнопках дропдаунов */
#artists-section #filters-panel .dd__btn {
  position: relative;
}
#artists-section #filters-panel .dd__btn::after {
  content: '';
  position: absolute;
  right: 12px;
  top: 50%;
  width: 8px;
  height: 8px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: translateY(-50%) rotate(45deg);
  transition: transform 0.2s ease;
}
#artists-section #filters-panel .dd.open .dd__btn::after {
  transform: translateY(-50%) rotate(-135deg);
}

/* Иконки в mix-radio/кнопках (если есть) */
#artists-section #filters-panel #random-radio .ico,
#artists-section #filters-panel #mixRadioBtn .ico,
#artists-section #filters-panel #artist1Button .ico,
#artists-section #filters-panel #Artist1Button .ico {
  width: 24px;
  height: 24px;
  display: block;
  flex: 0 0 auto;
  fill: currentColor;
}

/* Hover / Focus */
@media (hover: hover) and (pointer: fine) {
  #artists-section #filters-panel .dd__btn:hover,
  #artists-section #filters-panel #random-radio:hover,
  #artists-section #filters-panel #mixRadioBtn:hover,
  #artists-section #filters-panel #artist1Button:hover,
  #artists-section #filters-panel #Artist1Button:hover {
    transform: scale(1.02);
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
  }
}
#artists-section #filters-panel .dd__btn:focus-visible,
#artists-section #filters-panel #random-radio:focus-visible,
#artists-section #filters-panel #mixRadioBtn:focus-visible,
#artists-section #filters-panel #artist1Button:focus-visible,
#artists-section #filters-panel #Artist1Button:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(151, 112, 173, 0.25);
}

/* Overlay-панель на мобилке — небольшой нижний отступ,
   НО без боковых margin у самих кнопок (чтобы ничего не наползало) */
@media (max-width: 767.98px) {
  #artists-section #filters-panel {
    padding-bottom: 16px;
  }
  #artists-section #filters-panel .dd__btn,
  #artists-section #filters-panel #random-radio,
  #artists-section #filters-panel #mixRadioBtn,
  #artists-section #filters-panel #artist1Button,
  #artists-section #filters-panel #Artist1Button {
    margin: 0; /* <— убираем старые margin-left/right */
  }
}

/* ——— Единый «линк-подчерк» для List view и Reset ——— */
#artists-section #view-toggle,
#artists-section #filters-reset {
  appearance: none;
  background: none;
  border: 0;
  padding: 0;
  margin: 0;
  font: 500 18px/1.5 'IBM Plex Sans', sans-serif;
  color: #fff;
  text-decoration: underline;
  text-decoration-skip-ink: none;
  text-underline-offset: 4px;
  text-decoration-thickness: 1.75px;
  white-space: nowrap;
  cursor: pointer;
}

/* Геометрия Reset из ТЗ — оставляем компактной, но подпись/подчерк остаются */
#artists-section #filters-reset {
  inline-size: 48px; /* ширина кликабельной зоны под текст Reset */
  block-size: 27px;
  display: inline-grid;
  place-items: center;
}

/* Ховер/фокус для текст-кнопок */
#artists-section #filters-reset:hover,
#artists-section #filters-reset:focus-visible,
#artists-section #view-toggle:hover,
#artists-section #view-toggle:focus-visible {
  filter: brightness(1.06);
  outline: none;
}
/* Tablet layout (768–1439.98): Default left, Reset + Search on the right */
@media (min-width: 768px) and (max-width: 1439.98px) {
  .artists1 .filters__bar {
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative; /* на всякий случай */
  }

  /* Default view — СЛЕВА, без абсолютов/центра */
  #view-toggle,
  .artists1 .filters__view {
    order: 1;
    position: static !important;
    left: auto !important;
    transform: none !important;
    margin: 0 !important;
    min-inline-size: 0; /* чтобы ширина текста не влияла */
    white-space: nowrap;
  }

  /* Reset — толкает правую группу вправо */
  #filters-reset {
    order: 2;
    margin-left: auto !important; /* ключ: именно Reset тянет всё вправо */
    margin-right: 0 !important;
    white-space: nowrap;
  }

  /* Search and Filters — крайний справа */
  #filters-toggle {
    order: 3;
    margin-left: 12px !important;
  }
}

/* Mobile fix: ListView слева, Reset крайний справа; Search&Filters — на второй строке, во всю ширину */
@media (max-width: 767.98px) {
  .artists1 .filters__bar {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap; /* 1-я строка: ListView + Reset, 2-я: Search */
  }

  /* ListView — слева, без абсолютных центровок */
  #view-toggle,
  .artists1 .filters__view {
    order: 1;
    position: static !important;
    left: auto !important;
    transform: none !important;
    margin: 0 !important;
    white-space: nowrap;
  }

  /* Reset — крайний справа на первой строке */
  #filters-reset {
    order: 2;
    margin-left: auto !important; /* толкаем к правому краю */
    white-space: nowrap;
  }

  /* Кнопка Search and Filters — целиком второй строкой */
  #filters-toggle {
    order: 3;
    width: 100% !important;
    margin-left: 0 !important;
  }
}

/* === LIST VIEW: железобетонный трек === */
#artists-section.artists1.view-list .grid {
  /* трек не центрируем, чтоб не ловить «ползание» при одной колонке */
  justify-content: start !important;
  overflow-x: clip; /* защита от горизонтальной прокрутки (визуального «вылета») */
}

#artists-section.artists1.view-list .grid .card {
  box-sizing: border-box !important;
  inline-size: 100% !important; /* width */
  max-inline-size: 976px !important; /* max-width */
  margin-inline: auto !important;

  /* мобайл: 64 | гибкая | кнопка */
  grid-template-columns: 64px minmax(0, 1fr) auto !important;
}

/* планшет/десктоп: превью 208 */
@media (min-width: 768px) {
  #artists-section.artists1.view-list .grid .card {
    grid-template-columns: 208px minmax(0, 1fr) auto !important;
  }
}

/* средняя колонка действительно может сжиматься */
#artists-section.artists1.view-list .card__title,
#artists-section.artists1.view-list .card__tags {
  min-width: 0 !important;
  overflow: hidden !important;
}
#artists-section.artists1.view-list .card__title {
  white-space: nowrap !important;
  text-overflow: ellipsis !important;
}
#artists-section.artists1.view-list .card__tags {
  white-space: nowrap !important;
  text-overflow: clip !important;
  mask-image: linear-gradient(to right, black 92%, transparent) !important;
  -webkit-mask-image: linear-gradient(
    to right,
    black 92%,
    transparent
  ) !important;
}

/* кнопка строго справа */
#artists-section.artists1.view-list .card__link {
  justify-self: end !important;
}

/* === ВАЖНО: убираем скейл на hover у .card__link (он визуально «вылезает» за край) === */
@media (hover: hover) and (pointer: fine) {
  /* если где-то выше её включили общим правилом — гасим */
  #artists-section .card__link:hover,
  #artists-section .card__link:focus-visible {
    transform: none !important;
    box-shadow: none !important;
  }
}

/* На мобиле .card__link у нас и так иконка 24×24; подстрахуем */
@media (max-width: 767.98px) {
  #artists-section.artists1.view-list .grid .card__link,
  #artists-section.artists1.view-list #artists-grid .card__link {
    inline-size: 24px !important;
    block-size: 24px !important;
    padding: 0 !important;
    border: 0 !important;
    display: grid !important;
    place-items: center !important;
    font-size: 0 !important;
    line-height: 0 !important;
    gap: 0 !important;
    background: transparent !important;
  }
  #artists-section.artists1.view-list .grid .card__link .ico,
  #artists-section.artists1.view-list #artists-grid .card__link .ico {
    inline-size: 24px !important;
    block-size: 24px !important;
    margin-left: 0 !important;
    flex-shrink: 0 !important;
  }
}

/* Общая страховка секции от X-скролла (лучше clip, чем hidden) */
#artists-section {
  overflow-x: clip;
}

#artists-section #filters-panel .dd__btn,
#artists-section #filters-panel #random-radio,
#artists-section #filters-panel #mixRadioBtn,
#artists-section #filters-panel #artist1Button,
#artists-section #filters-panel #Artist1Button,
#artists-section #filters-panel #mixradio-menu-btn {
  /* <— ДОБАВЛЕНО */
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;

  min-height: 47px;
  padding: 10px 14px;
  padding-right: 30px;
  border-radius: 12px;

  width: 100%;
  background: rgba(255, 255, 255, 0);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #e8e8ec;
  font: 600 16px/1 'IBM Plex Sans', system-ui, -apple-system, Segoe UI, Roboto,
    Arial, sans-serif;
}

@media (hover: hover) and (pointer: fine) {
  #artists-section #filters-panel .dd__btn:hover,
  #artists-section #filters-panel #random-radio:hover,
  #artists-section #filters-panel #mixRadioBtn:hover,
  #artists-section #filters-panel #artist1Button:hover,
  #artists-section #filters-panel #Artist1Button:hover,
  #artists-section #filters-panel #mixradio-menu-btn:hover {
    /* <— ДОБАВЛЕНО */
    transform: scale(1.02);
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
  }
}
#artists-section #filters-panel .dd__btn:focus-visible,
#artists-section #filters-panel #random-radio:focus-visible,
#artists-section #filters-panel #mixRadioBtn:focus-visible,
#artists-section #filters-panel #artist1Button:focus-visible,
#artists-section #filters-panel #Artist1Button:focus-visible,
#artists-section #filters-panel #mixradio-menu-btn:focus-visible {
  /* <— ДОБАВЛЕНО */
  outline: none;
  box-shadow: 0 0 0 3px rgba(151, 112, 173, 0.25);
}

.artists1 #filters-panel .fld,
.artists1 #filters-panel #flt-q-btn,
.artists1 #filters-panel .dd,
.artists1 #filters-toggle,
.artists1 #filters-panel #mixradio-menu-btn {
  /* <— ДОБАВЛЕНО */
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
    inset 0 -2px 1px 0 rgba(6, 3, 7, 0.05),
    inset 0 0 0 1px rgba(255, 255, 255, 0.1);
  border: 0;
  color: var(--color-white);
}

```

---
## src/css/artists/index.css

**size:** 6517 bytes &nbsp;&nbsp; **sha1:** `a25af122fba29d9be3909efd1a2eb6ccc21c27a4`

```css
/* базовые вещи секции (если используешь) */
@import url('./artists.base.css');

/* сетка + карточки */
@import url('./artists.grid.css');
@import url('./artists.card.css');

/* интерактив: ховеры/фокусы/клики */
@import url('./artists.controls.css');

/* модалка, плеер, скелетоны, анимации, фильтры, пагер */
@import url('./artists.modal.css');
@import url('./artists.player.css');
@import url('./artist.zoom.css');
@import url('./artists.skeleton.css');
@import url('./artists.anim.css');
@import url('./artists.filters.css');
@import url('./artists.pager.css');
@import url('./artists.toolbar.css');

/* =========================
   ARTISTS • ZERO-OVERFLOW + SAFE HOVER (v2)
   ========================= */

/* секция не даёт горизонтальный скролл, но не «запаивает» покраску */
#artists-section {
  overflow-x: clip !important;
  /* contain: paint;  ← убираем: мешает теням/hover */
}

/* элементы сетки обязаны сжиматься, ширина не превышает контейнер */
#artists-section .artists1__layout > *,
#artists-section .artists1__content,
#artists-section .grid,
#artists-section #artists-grid {
  min-width: 0 !important;
  max-width: 100% !important;
}

/* ListView трек слева, без x-скролла */
#artists-section.artists1.view-list .grid {
  justify-content: start !important;
  overflow-x: clip !important;
  overflow-y: visible; /* тени видны */
}

/* Карточка в ListView не шире контейнера, горизонтально клипуем, вертикально показываем */
#artists-section.artists1.view-list .grid .card {
  box-sizing: border-box !important;
  inline-size: 100% !important;
  max-inline-size: 976px !important;
  margin-inline: auto !important;

  overflow-x: clip !important; /* защита по X */
  overflow-y: visible !important; /* тень/подъём видны по Y */
  contain: inline-size; /* только по ширине, без paint */

  /* мобайл: превью 64 | гибкая | кнопка */
  grid-template-columns: 64px minmax(0, 1fr) auto !important;
}
@media (min-width: 768px) {
  #artists-section.artists1.view-list .grid .card {
    grid-template-columns: 208px minmax(0, 1fr) auto !important;
  }
}

/* средняя колонка реально сжимается */
#artists-section.artists1.view-list .card__title,
#artists-section.artists1.view-list .card__tags {
  min-width: 0 !important;
  overflow: hidden !important;
  white-space: nowrap !important;
}
#artists-section.artists1.view-list .card__title {
  text-overflow: ellipsis !important;
}
#artists-section.artists1.view-list .card__tags {
  text-overflow: clip !important;
  mask-image: linear-gradient(to right, black 92%, transparent) !important;
  -webkit-mask-image: linear-gradient(
    to right,
    black 92%,
    transparent
  ) !important;
}

/* MOBILE: Learn More = иконка 24×24 строго справа */
@media (max-width: 767.98px) {
  #artists-section.artists1.view-list .grid .card__link,
  #artists-section.artists1.view-list #artists-grid .card__link {
    inline-size: 24px !important;
    block-size: 24px !important;
    padding: 0 !important;
    border: 0 !important;
    display: grid !important;
    place-items: center !important;
    font-size: 0 !important;
    line-height: 0 !important;
    gap: 0 !important;
    background: transparent !important;
  }
  #artists-section.artists1.view-list .grid .card__link .ico,
  #artists-section.artists1.view-list #artists-grid .card__link .ico {
    inline-size: 24px !important;
    block-size: 24px !important;
    margin-left: 0 !important;
    flex-shrink: 0 !important;
  }
}

/* ===== SAFE HOVER (возвращаем «живость», без вылезаний) ===== */
@media (hover: hover) and (pointer: fine) {
  /* карточка: лёгкий подъём + тень */
  #artists-section .grid .card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    will-change: transform;
  }
  #artists-section .grid .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.28);
  }

  /* кнопка Learn More: подсветка + толкание иконки, без scale */
  #artists-section .grid .card__link {
    transition: background-color 0.2s ease, border-color 0.2s ease,
      box-shadow 0.2s ease;
  }
  #artists-section .grid .card__link:hover,
  #artists-section .grid .card__link:focus-visible {
    background: rgba(255, 255, 255, 0.06) !important;
    border-color: rgba(255, 255, 255, 0.28) !important;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.24) !important;
  }
  #artists-section .grid .card__link .ico {
    transition: transform 0.2s ease, fill 0.2s ease;
  }
  #artists-section .grid .card__link:hover .ico,
  #artists-section .grid .card__link:focus-visible .ico {
    transform: translateX(2px);
    fill: var(--color-affair);
  }
}

/* Общая страховка: контейнер клипует только по X, по Y — видим hover-тени */
#artists-section .grid {
  overflow-x: clip;
  overflow-y: visible;
}

/* Модалка: оставь, только если нет собственного modal.css.
   Если модалка уже фиксируется в другом файле — убери дубли. */
#artist-modal.amodal {
  position: fixed;
  inset: 0;
  z-index: 10000;
}
#artist-modal[hidden] {
  display: none !important;
}

/* a) секция больше НЕ запирает слои */
#artists-section {
  contain: none !important;
} /* или initial */

/* b) бекдроп не перехватывает клики — кликается и плеер, и «пузырь» */
.amodal__backdrop {
  pointer-events: none !important;
}
.amodal__dialog {
  pointer-events: auto !important;
}

/* c) явные уровни поверх бекдропа */
.amodal {
  z-index: 10000 !important;
} /* модалка */
.am-player {
  z-index: 11000 !important;
} /* сам плеер */
.am-player__bubble {
  z-index: 2147483647 !important;
} /* у тебя уже так */

```

---
## src/css/assistant/chat.css

**size:** 9619 bytes &nbsp;&nbsp; **sha1:** `4a3dc7a2f7c24d976615344c88adf43fdbb5ad06`

```css
/* =============================
   Chat Assistant (full CSS)
   ============================= */

/* Палитра и размеры */
:root {
  --as-bg: #0f1115; /* фон страницы (на случай растягивания) */
  --as-panel: #171a21; /* фон панели */
  --as-panel-2: #1c2129; /* фон шапки/подложек */
  --as-border: #2a3040; /* линии/границы */
  --as-shadow: 0 12px 40px rgba(0, 0, 0, 0.45);

  --as-text: #e8eef5; /* основной текст */
  --as-muted: #a9b3bf; /* приглушённый текст */
  --as-accent: #66e1ff; /* акцент (кнопки/фокус) */

  --as-bot: #1f2a33; /* пузырь бота */
  --as-user: #23303c; /* пузырь пользователя */

  --as-radius-lg: 16px;
  --as-radius-md: 12px;
  --as-radius-sm: 10px;

  --as-gap: 12px;
  --as-z: 9999;
}

/* Базовые сбросы внутри виджета */
.assistant,
.assistant * {
  box-sizing: border-box;
  font: inherit;
}
.assistant {
  color-scheme: dark;
}

/* ──────────────────────────────────────────────────────────────
   Плавающая toggle-кнопка
   ────────────────────────────────────────────────────────────── */
.assistant__toggle {
  position: fixed;
  right: max(12px, env(safe-area-inset-right));
  bottom: max(12px, env(safe-area-inset-bottom));
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: 1px solid var(--as-border);
  background: radial-gradient(120% 120% at 30% 30%, #202736 0%, #11141a 70%);
  color: var(--as-text);
  display: grid;
  place-items: center;
  cursor: pointer;
  z-index: var(--as-z);
  box-shadow: var(--as-shadow);
  transition:
    transform 0.15s ease,
    opacity 0.15s ease;
}
.assistant__toggle:hover {
  transform: translateY(-1px);
}
.assistant__toggle:active {
  transform: translateY(0);
}

/* ──────────────────────────────────────────────────────────────
   Панель
   ────────────────────────────────────────────────────────────── */
.assistant__panel {
  position: fixed;
  right: max(12px, env(safe-area-inset-right));
  bottom: max(88px, env(safe-area-inset-bottom)); /* над пузырём */
  width: min(420px, 96vw);
  max-height: calc(100vh - 120px);
  background: var(--as-panel);
  color: var(--as-text);
  border: 1px solid var(--as-border);
  border-radius: var(--as-radius-lg);
  box-shadow: var(--as-shadow);
  display: flex;
  flex-direction: column;
  overflow: hidden; /* защита от вылезания */
  z-index: var(--as-z);
}
.assistant__panel[hidden] {
  display: none !important;
}

/* Шапка */
.assistant__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 12px 14px;
  background: var(--as-panel-2);
  border-bottom: 1px solid var(--as-border);
}
.assistant__header strong {
  font-weight: 700;
  letter-spacing: 0.2px;
}
.assistant__close {
  appearance: none;
  border: 1px solid var(--as-border);
  background: #0e1116;
  color: var(--as-muted);
  width: 32px;
  height: 32px;
  border-radius: 8px;
  display: grid;
  place-items: center;
  cursor: pointer;
}
.assistant__close:hover {
  color: var(--as-text);
}

/* Лента сообщений */
.assistant__log {
  flex: 1 1 auto;
  overflow: auto;
  overscroll-behavior: contain;
  padding: 14px;
  display: grid;
  gap: 10px;
  background: linear-gradient(#0000 0, #0000 12px, #12151b 12px);
}

/* Сообщения */
.assistant__msg {
  max-width: 85%;
  padding: 10px 12px;
  line-height: 1.35;
  border-radius: 14px;
  white-space: pre-wrap;
  word-wrap: anywhere;
  border: 1px solid var(--as-border);
  color: var(--as-text);
}
.assistant__msg--bot {
  background: var(--as-bot);
  justify-self: start;
}
.assistant__msg--user {
  background: var(--as-user);
  justify-self: end;
}

/* Подсказки / уведомления */
.assistant__tip {
  font-size: 0.9em;
  color: var(--as-muted);
  text-align: center;
}

/* Блок управления (поле ввода, кнопки) */
.assistant__controls {
  position: sticky;
  bottom: 0;
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 8px;
  padding: 12px;
  background: linear-gradient(180deg, #161a20 0%, #12151b 100%);
  border-top: 1px solid var(--as-border);
}

/* Микрофон */
.assistant__mic {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  border: 1px solid var(--as-border);
  background: #0e1116;
  color: var(--as-text);
  display: grid;
  place-items: center;
  cursor: pointer;
}
.assistant__mic.is-on {
  outline: 2px solid var(--as-accent);
  background: #0c1a21;
}

/* Поле ввода */
.assistant__input {
  height: 40px;
  padding: 0 12px;
  border-radius: 10px;
  border: 1px solid var(--as-border);
  background: #0f1216;
  color: var(--as-text);
  width: 100%;
}
.assistant__input::placeholder {
  color: var(--as-muted);
}

/* Отправка */
.assistant__send {
  min-width: 110px;
  height: 40px;
  padding: 0 14px;
  border-radius: 10px;
  border: 1px solid #0d2a33;
  background: linear-gradient(180deg, #0f3641 0%, #0c252d 100%);
  color: #dff7ff;
  cursor: pointer;
}
.assistant__send:hover {
  filter: brightness(1.05);
}

/* ──────────────────────────────────────────────────────────────
   Настройки (голос, горячая фраза)
   ────────────────────────────────────────────────────────────── */
.assistant__settings {
  padding: 12px;
  border-top: 1px solid var(--as-border);
  background: var(--as-panel);
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  align-items: center;
}
.assistant__settings label {
  display: grid;
  gap: 6px;
  color: var(--as-muted);
  font-size: 0.95em;
}
.assistant__settings select {
  width: 100%;
  height: 38px;
  padding: 0 10px;
  border-radius: 10px;
  border: 1px solid var(--as-border);
  background: #0f1216;
  color: var(--as-text);
  min-width: 0;
}
.assistant__settings .as-row {
  display: flex;
  align-items: center;
  gap: 10px;
}
.assistant__settings .as-switch {
  appearance: none;
  width: 44px;
  height: 24px;
  border-radius: 999px;
  background: #202636;
  position: relative;
  border: 1px solid var(--as-border);
  cursor: pointer;
}
.assistant__settings .as-switch::after {
  content: '';
  position: absolute;
  top: 3px;
  left: 3px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #cfd9e6;
  transition: transform 0.2s ease;
}
.assistant__settings .as-switch:checked {
  background: #0f3a47;
  border-color: #16576b;
}
.assistant__settings .as-switch:checked::after {
  transform: translateX(20px);
}
.assistant__settings .as-btn {
  height: 38px;
  padding: 0 12px;
  border-radius: 10px;
  border: 1px solid var(--as-border);
  background: #0e1116;
  color: var(--as-text);
  cursor: pointer;
}
.assistant__settings .as-btn:hover {
  color: #fff;
}

/* ──────────────────────────────────────────────────────────────
   Доступность и фокусы
   ────────────────────────────────────────────────────────────── */
.assistant__panel :focus {
  outline: 2px solid color-mix(in oklab, var(--as-accent) 70%, #fff 0%);
  outline-offset: 2px;
}

/* ──────────────────────────────────────────────────────────────
   Мобилки/узкие экраны
   ────────────────────────────────────────────────────────────── */
@media (max-width: 480px) {
  .assistant__panel {
    right: 3vw;
    bottom: 84px;
    width: 94vw;
    max-height: calc(100vh - 100px);
  }
  .assistant__settings {
    grid-template-columns: 1fr; /* в столбик */
  }
  .assistant__send {
    min-width: 92px;
  }
}

/* Страховка от горизонтального скролла всей страницы,
   если сайт-лейаут «тесный» */
html,
body {
  overflow-x: hidden;
}

/* Доп. мелочи */
.assistant__msg code {
  background: #101620;
  border: 1px solid var(--as-border);
  padding: 0.1em 0.35em;
  border-radius: 6px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  font-size: 0.92em;
}

```

---
## src/css/base.css

**size:** 1864 bytes &nbsp;&nbsp; **sha1:** `d9de513ed83f2080dd76474cb15e5a1e53e009b8`

```css
:root {

  /* основной текст */
  font-family: "IBM Plex Sans", system-ui, -apple-system, BlinkMacSystemFont,
    "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
    sans-serif;
  font-size: 16px;
  line-height: 1.5;
  font-weight: 400;

  color: var(--color-white,#fff);


  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-text-size-adjust: 100%;


  --color-scheme-1-background: var(--color-neutral-darkest);
  --color-neutral-darkest: #060307;

  --color-scheme-1-text: var(--color-white);
  --color-white: #fff;

  --color-affair: #764191;
  --opacity-white-5: rgba(255, 255, 255, 0.05);
  --color-error-red: #af0404;

  --color-affair-dark-14: #5f3376;
  --color-affair-light-25: #9770ad;
  --color-affair-light-25-rgba25: rgba(151, 112, 173, .25);
}

html,
body {
  overflow-x: clip;
  scroll-behavior: smooth;
  width: 100%;
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
  
}

body {
  display: flex;
  flex-direction: column;
  min-width: 100vw;
  min-height: 100vh;
  margin: 0;
  background-color: var(--color-neutral-darkest,#060307);
  padding-top: 20px;
}


main {
  flex-grow: 1;
}

img {
  height: 100%;
}

@media only screen and (min-width: 768px) {
  body {
    padding-top: 0;
  }
}
/* Минимальный reset без вендорных расширений */
:where(*, *::before, *::after) {
  box-sizing: border-box;
}

:where(html, body) {
  height: 100%;
}

:where(img, picture, video, canvas, svg) {
  display: block;
  max-width: 100%;
}

:where(input, button, textarea, select) {
  font: inherit;
}

:where(p, h1, h2, h3, h4, h5, h6) {
  margin: 0;
}
```

---
## src/css/comments.css

**size:** 9298 bytes &nbsp;&nbsp; **sha1:** `e91e1e87c6aa4704f545fd0de4940fa6238d575a`

```css
/* ====== FEEDBACK SECTION ====== */
.feedback-section {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  flex-direction: column;
  gap: 80px;
  padding: 64px 0;
  width: 100%;
  max-width: 1440px;
  margin: 0 auto;
}

@media (min-width: 1440px) {
  .feedback-section {
    padding: 112px 0;
  }
}

/* ====== SWIPER AREA WIDTHS (288 / 704 / 1312) ====== */
.swiper {
  position: relative;
  width: 100%;
  max-width: 288px;
  /* mobile */
  margin: 0 auto;
  overflow: hidden;
}

@media (min-width: 768px) {
  .swiper {
    max-width: 704px;
  }

}

@media (min-width: 1440px) {
  .swiper {
    max-width: 1312px;
  }

  /* desktop */
}

/* страховка от зазоров между слайдами */
.swiper .swiper-wrapper {
  gap: 0 !important;
}

.swiper .swiper-slide {
  flex: 0 0 100% !important;
  width: 100% !important;
  margin: 0 !important;
  box-sizing: border-box;
}

/* ====== ARROWS ====== */
.swiper-button-prev::after,
.swiper-button-next::after {
  display: none;
  content: none;
}

.swiper-button-prev,
.swiper-button-next {
  width: 48px !important;
  height: 48px !important;
  border: 1px solid rgba(255, 255, 255, 0.5);
  border-radius: 8px;
  background: transparent;
  display: none !important;
  /* показываем только >=768px */
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  /* идеальный центр */
  z-index: 100;
  transition: border-color 0.25s ease;
}

@media (min-width: 768px) {

  .swiper-button-prev,
  .swiper-button-next {
    display: flex !important;
  }
}

.swiper-button-prev {
  left: 0;
}

.swiper-button-next {
  right: 0;
}

.left-arrow {
  transform: rotate(180deg);
}

.swiper-button-prev svg,
.swiper-button-next svg {
  width: 24px;
  height: 24px;
  fill: var(--color-white);
  /* видно всегда */
  transition: fill 0.25s ease;
}

.swiper-button-prev:is(:hover, :focus),
.swiper-button-next:is(:hover, :focus) {
  border-color: var(--color-affair);
}

.swiper-button-prev:is(:hover, :focus) svg,
.swiper-button-next:is(:hover, :focus) svg {
  fill: var(--color-affair);
}

.swiper-button-prev svg use,
.swiper-button-next svg use {
  pointer-events: none;
}

/* ====== PAGINATION (3 точки) ====== */
.swiper-pagination {
  display: flex;
  justify-content: center;
  gap: 9px;
  margin: 0 auto 12px;
  padding: 10px 0;
  position: static !important;
}

.swiper-dots {
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.2);
  cursor: pointer;
}

.swiper-dots.active {
  background: #fff;
}

/* ====== STARS (в строку и по центру) ====== */
.feedback-section .rating,
.modal .rating {
  display: flex !important;
  align-items: center;
  justify-content: center;
  /* по макету — центр; поменяй на flex-start если нужно слева */
  gap: 6px;
  margin-bottom: 24px;
  /* переносим отступ на контейнер */
}
/* Firefox */
.modal {
  scrollbar-width: none;
}

/* Chrome / Edge / Safari */
.modal::-webkit-scrollbar {
  width: 0;
  height: 0;
}
.rating .star {
  cursor: pointer;
  display: inline-block !important;
  /* переопределяем старое display:flex */
  width: 30px;
  height: 28px;
  margin: 0 !important;
  /* убираем «ступеньки» */
  background-color: var(--color-white);
  clip-path: polygon(50% 0%,
      61% 35%,
      98% 35%,
      68% 57%,
      79% 91%,
      50% 70%,
      21% 91%,
      32% 57%,
      2% 35%,
      39% 35%);
}

.rating .star.filled {
  background-color: var(--color-affair);
}

/* ====== TEXTS ====== */
.feedback {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  flex-direction: column;
}

.customer-feedback {
  font-weight: 700;
  font-size: 18px;
  line-height: 1.4;
  letter-spacing: -0.01em;
  text-align: center;
  margin-bottom: 32px;
  color: var(--color-white);
  max-width: 288px;
  /* мобильный текст не шире контейнера */
}

@media (min-width: 768px) {
  .customer-feedback {
    font-size: 26px;
    max-width: 518px;
  }
}

@media (min-width: 1440px) {
  .customer-feedback {
    font-size: 32px;
    line-height: 1.3;
    max-width: 768px;
  }
}

.customer-name {
  font-weight: 600;
  font-size: 18px;
  line-height: 1.5;
  color: var(--color-white);
  margin-bottom: 16px;
}

/* ====== BUTTON ====== */
.review-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 64px;
  border-radius: 12px;
  padding: 10px 14px;
  width: 288px;
  height: 47px;
  box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
    inset 0 -2px 1px 0 rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(6, 3, 7, 0.15),
    inset 0 2px 1px 0 rgba(255, 255, 255, 0.25),
    inset 0 32px 24px 0 rgba(6, 3, 7, 0.05);
  background: var(--color-affair);
  font-weight: 500;
  font-size: 18px;
  color: var(--color-white);
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
}

@media (min-width: 768px) {
  .review-btn {
    width: 158px;
  }
}

@media (min-width: 1440px) {
  .review-btn {
    width: 177px;
  }
}

.review-btn:hover {
  box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
    inset 0 -2px 1px 0 rgba(6, 3, 7, 0.05),
    inset 0 0 0 1px rgba(255, 255, 255, 0.1);
  background: rgba(255, 255, 255, 0.1);
  border: none;
  transform: translateY(-2px);
}

.review-btn:active {
  border: none;
  background: transparent;
}

/* ====== MODAL ====== */
.overlay {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  background: rgba(0, 0, 0, 0.7);
  /* серый полупрозрачный */
  backdrop-filter: blur(2px);
  /* лёгкое размытие фона */
  opacity: 0;
  visibility: hidden;
  transition: opacity .3s ease, visibility .3s ease;
}

.overlay:not(.hidden) {
  opacity: 1;
  visibility: visible;
}

.modal {
  background: #000;
  /* чисто чёрный */
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 24px;
  border-radius: 16px;
  padding: 24px 16px;
  width: 100%;
  max-width: 320px;
  max-height: min(90vh, 740px);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
  overflow: auto;
}

@media (min-width: 768px) {
  .modal {
    padding: 40px 48px;
    max-width: 640px;
  }
}

@media (min-width: 1440px) {
  .modal {
    padding: 48px 64px;
    max-width: 864px;
  }
}

.close-icon {
  position: absolute;
  top: 16px;
  right: 16px;
  cursor: pointer;
  fill: var(--color-white);
  transition: transform .2s ease, fill .2s ease;
}

.close-icon:hover {
  transform: rotate(90deg) scale(1.05);
  fill: var(--color-affair);
}

.title-modal {
  margin-top: 64px;
  font-weight: 700;
  font-size: 24px;
  line-height: 1.3;
  letter-spacing: -0.01em;
  text-align: center;
  color: var(--color-white);
}

@media (min-width: 768px) {
  .title-modal {
    font-size: 44px;
    line-height: 1.2;
    margin: 64px 0;
  }
}

@media (min-width: 1440px) {
  .title-modal {
    font-size: 60px;
  }
}

label {
  display: block;
  margin-bottom: 8px;
  font-weight: 400;
  font-size: 18px;
  line-height: 1.5;
  color: #fff;
}

.form-input-name {
  display: flex;
  align-items: center;
  gap: 8px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 8px 12px;
  width: 100%;
  max-width: 288px;
  height: 43px;
  font-weight: 400;
  font-size: 18px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.6);
  background: transparent;
  margin-bottom: 32px;
}

@media (min-width: 768px) {
  .form-input-name {
    max-width: 640px;
    margin-bottom: 24px;
  }
}

@media (min-width: 1440px) {
  .form-input-name {
    max-width: 736px;
  }
}

textarea {
  display: block;
  margin-bottom: 32px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 8px 12px;
  width: 100%;
  max-width: 288px;
  /* mobile */
  height: 130px;
  font-weight: 400;
  font-size: 18px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.6);
  background: transparent;
  overflow-wrap: anywhere;
  word-break: break-word;
}

@media (min-width: 768px) {
  textarea {
    padding: 12px;
    max-width: 640px;
    height: 180px;
  }
}

@media (min-width: 1440px) {
  textarea {
    max-width: 736px;
    margin-bottom: 24px;
  }
}

/* ====== MISC ====== */
.send-btn-cont {
  display: flex;
  justify-content: center;
  align-items: center;
}

@media (min-width: 768px) {
  .send-feedback-btn {
    width: 340px;
  }
}

@media (min-width: 1440px) {
  .send-feedback-btn {
    width: 108px;
  }
}

.hidden {
  opacity: 0;
  visibility: hidden;
  cursor: none;
}

.hidden-container {
  display: none;
}

.no-scroll {
  overflow: hidden;
}

.required-text {
  border: 1px solid #e74c3c !important;
}
```

---
## src/css/container.css

**size:** 428 bytes &nbsp;&nbsp; **sha1:** `58f7008c5631ff5e6af879c0a0ebfaee222afbc6`

```css
/* Styles for Mobile devices */
.container {
  min-width: 320px;
  max-width: 375px;
  margin: 0 auto;
  padding: 0 16px;
}
/* Styles for Tablet devices */
@media only screen and (min-width: 768px) {
  .container {
    max-width: 768px;
    padding: 0 32px;
  }
}
/* Styles for Desktop devices */
@media only screen and (min-width: 1440px) {
  .container {
    max-width: 1440px;
    padding: 0 64px;
  }
}

```

---
## src/css/footer.css

**size:** 3244 bytes &nbsp;&nbsp; **sha1:** `fcc2f534f8889fc9d1294d85d99e6f8a6b14e69d`

```css
@media only screen and (min-width: 320px) {

    .footer-section {
        padding: 48px 0;
    }

    .footer-logo-wrapper {
        display: flex;
        flex-direction: row;
        gap: 32px;
        justify-content: center;
        align-items: center;
        margin-bottom: 32px;
    }

    .footer-logo {
        width: 84px;
        height: 36px;
    }

    .footer-logo-svg {
        fill: var(--color-affair);
        ;
        width: 84px;
        height: 36px;
    }

    .footer-nav-list {
        display: flex;
        flex-direction: column;
        gap: 32px;
        justify-content: center;
        align-items: center;
        margin-bottom: 48px;
    }

    .footer-nav-item {
        color: #fff;
        font-family: 'IBM Plex Sans';
        font-size: 16px;
        font-style: normal;
        font-weight: 600;
        line-height: 1.5;
    }

    .footer-nav-link:hover,
    .footer-nav-link:focus {
        color: var(--color-affair);
        ;
    }

    .footer-nav-link:active {
        color: var(--color-white);

    }

    .footer-nav-item:hover,
    .footer-nav-item:focus {
        color: var(--color-affair);
        ;
        transition: color 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .divider {
        background: rgba(255, 255, 255, 0.2);
        width: 100%;
        height: 1px;
        margin-bottom: 24px;
    }

    .footer-social-wrapper {
        display: flex;
        flex-direction: column;
        gap: 32px;
        align-items: center;
        margin-bottom: 16px;
    }

    .footer-social-list {
        display: flex;
        gap: 32px;
        justify-content: center;
        align-items: center;
    }

    .social-icon {
        fill: var(--color-white);
        transition: none;
    }

    .social-icon:hover,
    .social-icon:focus {
        fill: var(--color-affair);
        ;
        transition: none;
    }

    .footer-text {
        color: var(--color-white);
        font-family: 'IBM Plex Sans';
        font-size: 16px;
        font-style: normal;
        font-weight: 400;
        line-height: 1.5;
        text-align: center
    }
}

@media only screen and (min-width: 768px) {

    .footer-section {
        padding: 80px 0;
    }

    .footer-logo-svg {
        width: 116px;
        height: 45px;
    }

    .footer-logo-wrapper {
        padding-right: 40px;
    }

    .footer-nav-list {
        flex-direction: row;
        margin-bottom: 80px;
    }

    .divider {
        margin-bottom: 32px;
    }

    .footer-social-wrapper {
        flex-direction: row-reverse;
        gap: 0;
        align-items: center;
        margin-bottom: 0;
    }

    .footer-social-list {
        display: flex;
        gap: 24px;
        justify-content: center;
        align-items: center;
        margin-bottom: 0;
    }

    .footer-text-wrapper {
        margin-bottom: 0;
        margin-right: auto;
    }

    .social-icon {
        width: 32px;
        height: 32px;
    }
}

@media only screen and (min-width: 1440px) {
    .social-icon {
        width: 24px;
        height: 24px;
    }
}
```

---
## src/css/header.css

**size:** 5538 bytes &nbsp;&nbsp; **sha1:** `6b57ad3b306de01cfd269f93b7c60a5694db4a7d`

```css
/* ===========================
   Header
   =========================== */
.header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  min-width: 320px;
  height: 64px;
  background: var(--color-neutral-darkest);
  z-index: 1000;
}

section[id] {
  scroll-margin-top: 64px;
}

.header-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 12px 0 20px;
  height: 100%;
}

/* ---------- LOGO ---------- */
.header-logo,
.mobile-menu-top .header-logo {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  width: 119px;
  height: 51px;
  margin: 0;
  flex: 0 0 auto;
}

.header-logo-icon,
.mobile-menu-top .header-logo-icon {
  width: 106px;
  height: 30px;
  fill: var(--color-white);
  display: block;
}

/* ---------- NAVIGATION ---------- */
.header-nav {
  display: none;
}
.header-nav-list {
  display: flex;
  gap: 32px;
}
.header-nav-link {
  color: var(--color-white);
  font-weight: 400;
  font-size: 18px;
  text-decoration: none;
  transition: color 0.2s ease;
}
.header-nav-link:hover,
.header-nav-link.active {
  color: var(--color-affair);
}

.header-nav-link:focus,
.header-nav-link:active {
  color: inherit;
}

/* ---------- BURGER MENU ---------- */
.burger-menu-btn {
  background: transparent;
  border: 0;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
}
.burger-menu-icon {
  width: 24px;
  height: 24px;
  fill: var(--color-white);
}
.burger-menu-btn:hover .burger-menu-icon,
.burger-menu-btn:focus .burger-menu-icon,
.burger-menu-btn:active .burger-menu-icon {
  fill: var(--color-affair);
}

/* ---------- MOBILE MENU ---------- */
.mobile-menu {
  position: fixed;
  inset: 0;
  background: var(--color-neutral-darkest);
  backdrop-filter: blur(6px);
  z-index: 2000;

  display: flex;
  flex-direction: column;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}
.mobile-menu.show {
  opacity: 1;
  pointer-events: auto;
}

.mobile-menu-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  position: relative;
  transform: translateY(-20px);
  opacity: 0;
  transition: transform 0.4s ease, opacity 0.4s ease;
}
.mobile-menu.show .mobile-menu-container {
  transform: translateY(0);
  opacity: 1;
}

.mobile-menu-top {
  width: 100%;
  height: 64px;
  padding: 0px 12px 0px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--color-neutral-darkest);
}

.mobile-menu-close-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  background: transparent;
  border: 0;
  cursor: pointer;
}
.mobile-menu-close-icon {
  width: 24px;
  height: 24px;
  fill: var(--color-white);
  transition: transform 0.3s ease, fill 0.2s ease;
}
.mobile-menu-close-btn:hover .mobile-menu-close-icon,
.mobile-menu-close-btn:focus .mobile-menu-close-icon,
.mobile-menu-close-btn:active .mobile-menu-close-icon {
  transform: rotate(90deg);
  fill: var(--color-affair);
}

.mobile-menu-nav {
  margin-top: 39px;
  display: flex;
  justify-content: center;
  width: 100%;
}
.mobile-menu-nav-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 32px;
  align-items: center;
}
.mobile-menu-nav-link {
  color: var(--color-white);
  text-decoration: none;
  font-weight: 500;
  font-size: 26px;
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.4s ease, transform 0.4s ease, color 0.2s ease;
}
.mobile-menu.show .mobile-menu-nav-link {
  opacity: 1;
  transform: translateY(0);
}
.mobile-menu.show .mobile-menu-nav-link:nth-child(1) {
  transition-delay: 0.1s;
}
.mobile-menu.show .mobile-menu-nav-link:nth-child(2) {
  transition-delay: 0.2s;
}
.mobile-menu.show .mobile-menu-nav-link:nth-child(3) {
  transition-delay: 0.3s;
}
.mobile-menu-nav-link:hover,
.mobile-menu-nav-link:focus,
.mobile-menu-nav-link:active,
.mobile-menu-nav-link.active {
  color: var(--color-affair);
}

/* ---------- RESPONSIVE ---------- */
@media screen and (min-width: 768px) {
  .header {
    height: 72px;
  }

  section[id] {
    scroll-margin-top: 72px;
  }

  .header-container {
    padding: 0 64px;
  }
  .header-nav {
    display: block;
    margin-left: auto;
  }
  .burger-menu-btn,
  .mobile-menu {
    display: none !important;
  }
}

/* ---------- ACCESSIBILITY ---------- */
a,
button {
  outline: none;
  -webkit-tap-highlight-color: transparent;
}

a:focus-visible,
button:focus-visible {
  outline: 2px solid var(--color-affair);
  outline-offset: 2px;
}

.sr-only {
  position: absolute !important;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0 0 0 0);
  white-space: nowrap;
  border: 0;
}
/* ДЕСKTOP: подсветка только у .active */
@media (min-width: 768px) {

  .header-nav-link.active,
  .header-nav-link.active:hover,
  .header-nav-link.active:focus {
    color: var(--color-affair);
  }

  /* не красим неактивные по hover/focus/active */
  .header-nav-link:not(.active):hover,
  .header-nav-link:not(.active):focus,
  .header-nav-link:not(.active):active {
    color: inherit;
  }
}
```

---
## src/css/hero.css

**size:** 5064 bytes &nbsp;&nbsp; **sha1:** `93c0e5fc9d2d174716aae96fde61ce666fec1666`

```css
.hero-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 64px;
}

.hero-section {
    padding-top: 64px;
    min-width: 320px;
    margin: 0 auto;
    background: linear-gradient(180deg,
            #060307,
            #06030700 20%,
            #06030700 80%,
            #060307),
             #22132b;
    position: relative;
}

.hero-section::before,
.hero-section::after {
    content: '';
    position: absolute;
    left: 0;
    width: 100%;
    height: 100px;
    z-index: 2;
    pointer-events: none;
}

.hero-section::before {
    top: -2px;
    background: linear-gradient(180deg, #060307, rgba(35, 19, 43, 0) 30px);
}

.hero-section::after {
    bottom: -2px;
    background: linear-gradient(180deg, rgba(35, 19, 43, 0), #060307);
}

.hero-title {
    font-family: 'Epilogue', sans-serif;
    font-weight: 700;
    font-size: 48px;
    line-height: 1.1;
    letter-spacing: -0.01em;
    margin-bottom: 20px;
    color: var(--color-white);
}

.hero-subtitle {
    font-weight: 400;
    font-size: 18px;
    line-height: 1.5;
    margin-bottom: 24px;
    max-width: 624px;
    color: var(--color-white);
}

.hero-content {
    width: 280px;
}

.hero-btn {
    box-sizing: border-box;
    margin: 0 auto;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 12px;
    padding: 10px 24px;
    max-width: 280px;
    height: 47px;
    font-size: 18px;
    border: none;
    font-weight: 500;
    line-height: 1.5;
    letter-spacing: 0.04em;
    fill: #fff;
    gap: 12px;
    cursor: pointer;
    text-decoration: none;
    box-shadow: 0 1px 2px 0 rgba(6, 3, 7, 0.05),
        inset 0 -2px 1px 0 rgba(0, 0, 0, 0.2),
        inset 0 0 0 1px rgba(6, 3, 7, 0.15),
        inset 0 2px 1px 0 rgba(255, 255, 255, 0.25),
        inset 0 32px 24px 0 rgba(255, 255, 255, 0.05);
    background: #764191;
    transition: background-color .2s ease, box-shadow .2s ease, transform .05s ease;
}

.hero-btn:hover,
.hero-btn:focus {
    background: #603177;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15),
        inset 0 -2px 1px rgba(0, 0, 0, 0.3),
        inset 0 2px 1px rgba(255, 255, 255, 0.2);
    outline: none;
    transform: translateY(-1px);
}

.hero-btn:active {
    transform: translateY(0);
}

.hero-img {
    box-sizing: border-box;
    background-image: url(../img/hero/hero-mob.png);
    background-repeat: no-repeat;
    background-position: center bottom;
    background-size: contain;
    height: 385px;
    position: relative;
    width: 280px;
}

main {
    margin-top: 40px;
}

@media (min-resolution: 192dpi) and (max-width: 767px) {
    .hero-img {
        background-image: url(../img/hero/hero-mob-2x.png);
    }
}

@media screen and (min-width: 768px) {   
    .hero-container {
        gap: 32px;
    }

   .hero-section {
        padding-top: 32px;
        padding-bottom: 0;
    }

    main {
        margin-top: 70px;
    }

    .hero-title {
        margin-bottom: 24px;
        max-width: 624px;
    }

    .hero-subtitle {
        font-size: 20px;
        margin-bottom: 32px;
    }

    .hero-content {
        width: 704px;
    }

    .hero-btn {
        max-width: 246px;
        margin: 0;
    }

    .hero-img {
        background-image: url(../img/hero/hero-tabl.png);
        background-size: cover;
        background-position: center;
        height: 632px;
        width: 704px;
    }

    .hero-img::after {
        content: '';
        position: absolute;
        pointer-events: none;
        left: 0;
        right: 0;
        bottom: 0;
        height: 120px;
        z-index: 2;
        background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, #060307 100%);
    }
}

@media (min-resolution: 192dpi) and (min-width: 768px) {
    .hero-img {
        background-image: url(../img/hero/hero-tabl-2x.png);
    }
}

@media screen and (min-width: 1440px) {
    .hero-container {
        flex-direction: row;
    }

    .hero-section {
        padding: 0;
    }

    .hero-title {
        font-size: 84px;
    }

    .hero-content {
        width: 640px;
        flex-shrink: 0;
    }

    .hero-btn {
        max-width: 206px;
        padding: 10px 0;
    }

    .hero-img {
        background-image: url(../img/hero/hero-desk.png);
        background-position: center;
        background-size: cover;
        width: 641px;
        height: 900px;
        flex-shrink: 0;
    }

    .hero-img::before {
        content: '';
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        height: 120px;
        background: linear-gradient(to top, rgba(0, 0, 0, 0) 0%, #060307 100%);
        pointer-events: none;
        z-index: 2;
    }
}

@media (min-resolution: 192dpi) and (min-width: 1440px) {
    .hero-img {
        background-image: url(../img/hero/hero-desk-2x.png);
    }
}

```

---
## src/css/reset.css

**size:** 318 bytes &nbsp;&nbsp; **sha1:** `5d43d070dc815f84dd324c88544c4e104f2dbb5f`

```css
h1,
h2,
h3,
h4,
h5,
h6,
p {
  margin: 0;
}

p:last-child {
  margin-bottom: 0;
}

ul {
  margin: 0;
  padding: 0;
  list-style: none;
}

a {
  color: currentColor;
  text-decoration: none;
}

button {
  cursor: pointer;
}

img {
  display: block;
  max-width: 100%;
  height: auto;
}

```

---
## src/css/styles.css

**size:** 1273 bytes &nbsp;&nbsp; **sha1:** `1a88be1185c0312b902a9dc900758c79bbc534d4`

```css
/**
  |============================
  | include css partials with
  | default @import url()
  |============================
*/
/* Common styles */
@import url('./reset.css');
@import url('./base.css');
@import url('./container.css');

/* Sections style */
@import url('./hero.css');
@import url('./artists/index.css');
@import url('./header.css');
@import url('./about.css');
@import url('./comments.css');
@import url('./footer.css');

/* Тёмные скроллы повсюду */
* {
  scrollbar-width: thin;
  scrollbar-color: #2a3040 #0f1115; /* FF */
}
*::-webkit-scrollbar {
  width: 10px;
  height: 10px;
} /* Chrome/Edge */
*::-webkit-scrollbar-track {
  background: #0f1115;
}
*::-webkit-scrollbar-thumb {
  background: #2a3040;
  border-radius: 8px;
}
*::-webkit-scrollbar-thumb:hover {
  background: #3a4358;
}

/* На всякий случай — без горизонтального перелива */
html,
body {
  overflow-x: hidden;
}

/* Если внезапно появится вертикальный «микропротечка» от 1px:
   убрать возможные 100vw-переливы от вложенных блоков */
img,
video {
  max-width: 100%;
  height: auto;
}

```

---
## src/img/sprite.svg

**size:** 22883 bytes &nbsp;&nbsp; **sha1:** `e8b04210c4ceb37a06772d7c0cb844a866a88884`

```text
<svg
  aria-hidden="true"
  style="position: absolute; width: 0; height: 0; overflow: hidden;"
  version="1.1"
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink"
>
  <defs>

    <symbol id="icon-search" viewBox="0 0 31 32">
      <path fill="#fff"
            d="M12.8 23.68c2.272 0 4.478-.761 6.268-2.161l5.627 5.627 1.81-1.81-5.627-5.627a10.184 10.184 0 0 0 2.162-6.269c0-5.646-4.594-10.24-10.24-10.24S2.56 7.794 2.56 13.44 7.154 23.68 12.8 23.68zm0-17.92c4.236 0 7.68 3.444 7.68 7.68s-3.444 7.68-7.68 7.68-7.68-3.444-7.68-7.68 3.444-7.68 7.68-7.68z"
            style="fill:var(--color1, #fff)"/>
    </symbol>

    <symbol id="icon-arrow-up" viewBox="0 0 32 32">
      <path fill="#fff" d="m8.391 19.057 1.885 1.885L16 15.218l5.724 5.724 1.885-1.885L16 11.448l-7.609 7.609z" style="fill:var(--color1, #fff)"/>
    </symbol>

    <symbol id="icon-icon_close" viewBox="0 0 32 32">
      <path d="M29.671 28.728l-0.943 0.943c-0.521 0.521-1.365 0.521-1.886 0l-10.842-10.842-10.842 10.842c-0.521 0.521-1.365 0.521-1.886 0l-0.943-0.943c-0.521-0.521-0.521-1.365 0-1.886l10.842-10.842-10.842-10.842c-0.521-0.521-0.521-1.365 0-1.886l0.943-0.943c0.521-0.521 1.365-0.521 1.886 0l10.842 10.842 10.842-10.842c0.521-0.521 1.365-0.521 1.886 0l0.943 0.943c0.521 0.521 0.521 1.365 0 1.886l-10.842 10.842 10.842 10.842c0.521 0.521 0.521 1.365 0 1.886z"></path>
    </symbol>

    <symbol id="icon-icon_download_load_more_art_sec" viewBox="0 0 32 32">
      <path d="M31.33 15.949l-3.232-3.232-9.813 9.813v-21.911h-4.571v21.911l-9.813-9.813-3.232 3.232 15.33 15.33 15.33-15.33z"></path>
    </symbol>

    <symbol id="icon-icon_facebook_footer" viewBox="0 0 31 32">
      <path d="M28.16 16.51c0-7.112-5.731-12.878-12.8-12.878s-12.8 5.766-12.8 12.878c0 6.428 4.681 11.756 10.8 12.722v-8.999h-3.25v-3.723h3.25v-2.837c0-3.228 1.911-5.010 4.835-5.010 1.401 0 2.865 0.252 2.865 0.252v3.169h-1.614c-1.59 0-2.086 0.993-2.086 2.011v2.416h3.55l-0.567 3.723h-2.983v8.999c6.119-0.966 10.8-6.294 10.8-12.722z"></path>
    </symbol>

    <symbol id="icon-icon_inst_footer" viewBox="0 0 31 32">
      <path d="M15.358 6.676c3.078 0 3.442 0.014 4.652 0.068 1.125 0.050 1.732 0.238 2.137 0.396 0.536 0.207 0.922 0.459 1.323 0.86 0.405 0.405 0.652 0.788 0.864 1.323 0.158 0.405 0.346 1.017 0.396 2.137 0.054 1.215 0.068 1.579 0.068 4.653s-0.014 3.442-0.068 4.653c-0.050 1.125-0.238 1.732-0.396 2.137-0.207 0.536-0.459 0.922-0.86 1.323-0.405 0.405-0.788 0.652-1.323 0.864-0.405 0.158-1.017 0.346-2.137 0.396-1.215 0.054-1.58 0.068-4.653 0.068s-3.442-0.014-4.653-0.068c-1.125-0.050-1.732-0.238-2.137-0.396-0.536-0.207-0.922-0.459-1.323-0.86-0.405-0.405-0.652-0.788-0.864-1.322-0.158-0.405-0.346-1.017-0.396-2.137-0.054-1.215-0.068-1.579-0.068-4.653s0.014-3.442 0.068-4.653c0.050-1.125 0.238-1.732 0.396-2.137 0.207-0.536 0.459-0.922 0.86-1.323 0.405-0.405 0.788-0.652 1.323-0.864 0.405-0.158 1.017-0.346 2.137-0.396 1.21-0.054 1.575-0.068 4.653-0.068h0.001zM15.358 4.602c-3.127 0-3.518 0.014-4.747 0.068-1.224 0.054-2.065 0.252-2.794 0.536-0.76 0.297-1.404 0.688-2.042 1.332-0.644 0.639-1.035 1.282-1.332 2.038-0.284 0.734-0.482 1.57-0.536 2.794-0.054 1.233-0.068 1.624-0.068 4.751s0.014 3.518 0.068 4.747c0.054 1.224 0.252 2.065 0.536 2.794 0.297 0.76 0.688 1.404 1.332 2.042 0.639 0.639 1.282 1.035 2.038 1.328 0.734 0.284 1.57 0.482 2.794 0.536 1.228 0.054 1.62 0.068 4.747 0.068s3.519-0.014 4.747-0.068c1.224-0.054 2.065-0.252 2.794-0.536 0.756-0.292 1.4-0.688 2.038-1.328s1.035-1.282 1.328-2.038c0.284-0.734 0.482-1.57 0.536-2.794 0.054-1.228 0.068-1.62 0.068-4.747s-0.014-3.518-0.068-4.747c-0.054-1.224-0.252-2.065-0.536-2.794-0.284-0.765-0.675-1.408-1.318-2.047-0.639-0.639-1.282-1.035-2.038-1.327-0.734-0.284-1.57-0.482-2.794-0.536-1.233-0.058-1.624-0.072-4.751-0.072l-0.001 0.001z"></path>
      <path d="M15.358 10.204c-3.266 0-5.917 2.65-5.917 5.917s2.65 5.917 5.917 5.917c3.267 0 5.917-2.65 5.917-5.917s-2.65-5.917-5.917-5.917zM15.358 19.958c-2.119 0-3.838-1.718-3.838-3.838s1.718-3.838 3.838-3.838c2.119 0 3.838 1.718 3.838 3.838s-1.718 3.838-3.838 3.838z"></path>
      <path d="M22.889 9.97c0 0.763-0.618 1.381-1.381 1.381s-1.381-0.618-1.381-1.381 0.619-1.381 1.381-1.381c0.763 0 1.381 0.618 1.381 1.381z"></path>
    </symbol>

    <symbol id="icon-icon_left_button_feedback_sec" viewBox="0 0 30 32">
      <path d="M18.575 27.020l-9.158-9.158h20.45v-4.267h-20.45l9.158-9.158-3.017-3.017-14.308 14.308 14.308 14.308 3.017-3.017z"></path>
    </symbol>

    <symbol id="icon-icon_menu_mobile_navbar" viewBox="0 0 32 32">
      <path d="M5.333 8h21.333v2.667h-21.333v-2.667zM10.667 14.667h16v2.667h-16v-2.667zM17.333 21.333h9.333v2.667h-9.333v-2.667z"></path>
    </symbol>

    <symbol id="icon-icon_play_artists_sections" viewBox="0 0 17 32">
      <path d="M0 31.878l17.067-14.933-17.067-14.933v29.867z"></path>
    </symbol>

    <symbol id="icon-icon_play_hero_section" viewBox="0 0 24 32">
      <path d="M0.858 31.818c0.259 0.135 0.549 0.196 0.841 0.178s0.572-0.115 0.812-0.281l20.8-14.4c0.212-0.147 0.386-0.344 0.506-0.573s0.183-0.484 0.183-0.742c0-0.259-0.063-0.513-0.183-0.742s-0.294-0.426-0.506-0.573l-20.8-14.4c-0.24-0.167-0.521-0.266-0.813-0.284s-0.583 0.043-0.842 0.179c-0.259 0.136-0.476 0.34-0.627 0.59s-0.23 0.537-0.229 0.83v28.8c-0 0.292 0.080 0.579 0.231 0.828s0.368 0.454 0.627 0.589zM3.2 4.654l16.389 11.346-16.389 11.346v-22.691z"></path>
    </symbol>

    <symbol id="icon-icon_right_button_feedback_sec" viewBox="0 0 31 32">
      <path d="M14.455 22.612l1.81 1.81 8.585-8.585-8.585-8.585-1.81 1.81 5.495 5.495h-12.27v2.56h12.27l-5.495 5.495z"></path>
    </symbol>

    <symbol id="icon-icon_youtube_footer" viewBox="0 0 31 32">
      <path d="M27.639 9.981c-0.146-0.541-0.431-1.034-0.826-1.431s-0.888-0.683-1.429-0.83c-2.004-0.55-10.024-0.559-10.024-0.559s-8.018-0.009-10.024 0.517c-0.54 0.154-1.032 0.444-1.428 0.842s-0.683 0.892-0.833 1.433c-0.529 2.004-0.534 6.162-0.534 6.162s-0.005 4.178 0.52 6.162c0.294 1.097 1.158 1.964 2.257 2.259 2.025 0.55 10.022 0.559 10.022 0.559s8.019 0.009 10.024-0.516c0.541-0.147 1.034-0.432 1.431-0.828s0.683-0.888 0.831-1.429c0.53-2.003 0.534-6.159 0.534-6.159s0.026-4.179-0.521-6.184zM12.795 19.968l0.006-7.68 6.665 3.846-6.671 3.834z"></path>
    </symbol>

    <symbol id="icon-logo" viewBox="0 0 110 32">
      <path d="M16.403 0.142c0.434-0.050 0.936 0.047 1.354 0.174 0.945 0.288 1.714 0.905 2.169 1.785 0.474 0.902 0.564 1.957 0.252 2.927-0.397 1.196-1.247 1.797-2.309 2.35l0.012 3.489c0.759 0.231 1.498 0.495 2.187 0.894 1.584 0.919 2.669 2.467 3.123 4.23 0.48 1.848 0.207 3.812-0.76 5.459-0.887 1.493-2.3 2.597-3.993 3.019-2.211 0.552-4.086-0.047-5.986-1.176-0.84 0.898-1.67 1.807-2.489 2.725 0.366 0.864 0.487 1.77 0.244 2.687-0.237 0.897-0.866 1.666-1.67 2.121-0.901 0.51-1.928 0.603-2.916 0.321-0.981-0.281-1.805-0.889-2.284-1.801-0.472-0.897-0.511-1.949-0.206-2.907 0.348-1.089 1.057-1.759 2.053-2.257 1.072-0.419 1.958-0.281 3.005 0.096 0.872-0.917 1.693-1.88 2.574-2.789-0.968-1.898-1.281-3.515-0.778-5.606-1.096-0.511-2.153-1.108-3.249-1.62-0.586 0.61-1.301 1.028-2.142 1.169-1.003 0.169-2.061-0.105-2.885-0.694-0.817-0.592-1.354-1.493-1.486-2.493-0.135-0.97 0.12-2.038 0.741-2.803 0.64-0.789 1.634-1.265 2.637-1.37 0.986-0.096 1.97 0.205 2.734 0.836 0.976 0.818 1.258 1.834 1.376 3.045 1.039 0.637 2.229 1.129 3.312 1.698 1.409-1.665 2.439-2.191 4.492-2.824l0.002-3.463c-0.368-0.147-0.735-0.326-1.055-0.561-0.81-0.599-1.341-1.502-1.473-2.501-0.121-0.994 0.159-1.996 0.779-2.782 0.678-0.851 1.585-1.238 2.636-1.377zM20.931 17.367c-0.209-2.382-2.302-4.148-4.686-3.955-2.404 0.196-4.189 2.311-3.979 4.714 0.211 2.404 2.337 4.176 4.739 3.951 2.381-0.224 4.134-2.328 3.925-4.71z"></path>
      <path d="M102.107 11.958c0.708 0.001 1.415 0.011 2.124 0.029l-0.004 3.742c0.546-0.424 1.14-0.739 1.831-0.843 0.933-0.141 1.884 0.1 2.637 0.669 0.908 0.687 1.384 1.844 1.523 2.949 0.175 1.401-0.154 2.749-1.019 3.866-0.574 0.554-1.263 0.941-2.057 1.072-1.165 0.191-2.088-0.216-2.998-0.894l-0.004 0.817-2.032-0.003-0.001-11.404zM105.747 16.862c-0.632 0.21-1.070 0.51-1.378 1.118-0.342 0.675-0.365 1.508-0.099 2.211 0.204 0.538 0.585 1.004 1.118 1.244 0.385 0.175 0.749 0.18 1.164 0.155 0.66-0.249 1.103-0.569 1.402-1.229 0.311-0.689 0.307-1.52 0.011-2.214-0.228-0.533-0.632-0.963-1.177-1.174-0.341-0.131-0.682-0.149-1.042-0.111z"></path>
      <path d="M41.272 11.936c1.246 3.84 2.84 7.575 4.055 11.425l-2.296 0.003c-0.269-0.822-0.529-1.752-0.939-2.512-0.268-0.115-0.586-0.076-0.873-0.073-1.108 0.011-2.215 0.007-3.323-0.012-0.348 0.849-0.628 1.722-0.903 2.596l-2.339-0.002c1.221-3.833 2.677-7.617 3.996-11.42 0.872 0.019 1.749-0.001 2.622-0.005zM39.964 14.775c-0.483 1.374-0.934 2.768-1.464 4.125l1.681-0.001 1.306-0.015c-0.184-0.518-1.25-3.88-1.524-4.109z"></path>
      <path d="M89.685 11.961l2.196 0.013c-0.030 2.647-0.007 5.298-0.007 7.945-0.001 1.093 0.11 2.287-0.013 3.365l-0.121 0.083h-2.058l-0.004-4.889c-1.645-0.046-3.303-0.005-4.949-0.003l0.001 4.894-2.209-0.004 0.009-11.401 2.2 0.005 0.002 4.662h4.957l-0.003-4.67z"></path>
      <path d="M93.202 15.121c0.729 0.021 1.46 0.013 2.188 0.017-0.009 1.165-0.193 4.384 0.089 5.347 0.111 0.38 0.333 0.728 0.693 0.913 0.541 0.278 1.090 0.117 1.628-0.072 0.238-0.266 0.443-0.515 0.561-0.859 0.386-1.123 0.18-4.006 0.174-5.343 0.694 0.019 1.391 0.004 2.085 0-0.016 0.8-0.003 1.603-0.004 2.404l0.011 5.834c-0.683 0.010-1.365 0.005-2.047-0.015l-0.063-0.074c0.010-0.173 0.013-0.314-0.018-0.487-0.639 0.277-1.209 0.697-1.936 0.712-0.843 0.017-1.758-0.245-2.363-0.852-0.459-0.459-0.739-1.076-0.883-1.703-0.31-1.348-0.127-4.332-0.113-5.824z"></path>
      <path d="M63.686 14.891c1.089-0.085 2.224-0.008 3.104 0.725 0.617 0.514 0.816 1.13 0.883 1.897l-1.968-0.002c-0.113-0.21-0.226-0.454-0.404-0.619-0.284-0.262-0.694-0.398-1.078-0.377-0.298 0.016-0.679 0.135-0.865 0.387-0.113 0.154-0.175 0.311-0.132 0.503 0.224 1.009 2.79 0.884 3.607 1.419 0.52 0.341 0.919 0.951 1.034 1.56 0.115 0.623-0.033 1.266-0.409 1.775-0.627 0.865-1.593 1.175-2.599 1.329-0.931 0.056-2.011-0.194-2.756-0.761-0.699-0.532-0.95-1.185-1.045-2.025 0.663 0.001 1.326-0.005 1.989-0.018 0.039 0.125 0.082 0.245 0.145 0.361 0.289 0.533 0.865 0.651 1.4 0.808 0.353-0.081 0.831-0.172 1.082-0.457 0.151-0.172 0.204-0.471 0.14-0.691-0.245-0.843-2.703-0.943-3.556-1.468-0.505-0.311-0.876-0.764-1.011-1.349-0.121-0.53-0.075-1.125 0.223-1.59 0.538-0.84 1.28-1.185 2.216-1.408z"></path>
      <path d="M76.93 14.889c0.62-0.050 1.227-0.047 1.831 0.117 0.697 0.189 1.438 0.578 1.79 1.239 0.169 0.317 0.3 0.886 0.186 1.237-0.565 0.122-1.255 0.040-1.835 0.033-0.085-0.287-0.158-0.509-0.391-0.707-0.295-0.247-0.679-0.364-1.062-0.322-0.3 0.031-0.685 0.178-0.852 0.447-0.1 0.16-0.141 0.325-0.078 0.509 0.362 1.068 2.535 0.814 3.38 1.297 0.538 0.308 0.988 0.848 1.141 1.454 0.164 0.65 0.056 1.372-0.319 1.931-0.56 0.835-1.449 1.149-2.388 1.331-0.922 0.114-1.989-0.082-2.759-0.613-0.791-0.545-1.028-1.229-1.206-2.123l1.973-0.015c0.12 0.302 0.229 0.537 0.485 0.746 0.341 0.279 0.745 0.406 1.184 0.347 0.341-0.045 0.676-0.202 0.88-0.487 0.133-0.187 0.2-0.414 0.136-0.642-0.247-0.878-2.426-0.823-3.29-1.288-0.584-0.315-1.046-0.838-1.231-1.481-0.157-0.544-0.091-1.11 0.196-1.599 0.477-0.81 1.353-1.206 2.231-1.409z"></path>
      <path d="M52.641 12.857c0.655 0.023 1.315 0.009 1.97 0.011-0.007 0.74 0.004 1.48 0.032 2.219l1.944 0.001-0.004 1.694-1.851-0.001c0.001 1.066-0.243 3.817 0.246 4.641 0.382 0.301 1.145 0.189 1.609 0.183l-0.007 1.404c0.004 0.145 0.004 0.218-0.070 0.344-0.259 0.124-0.524 0.152-0.81 0.154-0.752 0.007-1.791-0.129-2.331-0.693-1.086-1.131-0.739-4.457-0.734-6.035l-1.254 0.002 0.004-1.698 1.249 0.008 0.007-2.236z"></path>
      <path d="M69.54 12.848l1.934 0.011c-0.015 0.741 0.016 1.485 0.030 2.226l1.976-0.004-0.003 1.702-1.859-0.001c0.023 1.015-0.226 3.85 0.234 4.617 0.494 0.295 1.113 0.216 1.669 0.215-0.007 0.489 0.003 0.979 0.005 1.469l-0.023 0.186c-0.191 0.202-0.486 0.194-0.747 0.2-0.794 0.019-1.891-0.107-2.467-0.71-1.075-1.126-0.74-4.405-0.731-5.978l-1.323 0.001c-0.017-0.564-0.010-1.129-0.015-1.692l1.318 0.007 0.004-2.249z"></path>
      <path d="M27.821 11.582c0.102-0.005 0.2-0.007 0.302 0.008 0.316 0.046 0.628 0.198 0.802 0.476 0.185 0.294 0.21 0.687 0.235 1.028 0.125 1.688 0.032 3.444 0.032 5.138-0 1.384 0.153 3.26-0.104 4.592-0.081 0.419-0.359 0.619-0.691 0.846-0.127 0.015-0.259 0.033-0.387 0.026-0.285-0.016-0.556-0.143-0.74-0.361-0.183-0.216-0.177-0.648-0.193-0.919-0.116-1.942-0.018-3.946-0.016-5.893 0.001-1.107-0.151-3.225 0.082-4.213 0.083-0.353 0.402-0.539 0.68-0.727z"></path>
      <path d="M50.243 15.058l0.278-0.003c0.329 0.368 0.166 1.535 0.155 2.018-0.696-0.007-1.354-0.035-1.899 0.471-1.023 0.949-0.678 4.425-0.688 5.82-0.548-0.005-1.617 0.195-2.035-0.154l-0.022-0.346c0.010-2.586-0.055-5.169-0.038-7.754 0.664 0.021 1.33 0.007 1.994 0.003l-0.023 1.142c0.123-0.177 0.246-0.366 0.389-0.527 0.503-0.568 1.186-0.619 1.891-0.669z"></path>
      <path d="M57.795 15.092l2.086 0.001 0.005 8.275-2.11-0.003 0.019-8.273z"></path>
      <path d="M24.906 14.293c0.343 0.063 0.645 0.192 0.845 0.489 0.308 0.459 0.316 4.955 0.162 5.596-0.084 0.351-0.388 0.522-0.675 0.691-0.33-0.020-0.763-0.049-0.983-0.335-0.327-0.425-0.3-5.203-0.114-5.802 0.108-0.348 0.466-0.495 0.765-0.639z"></path>
      <path d="M58.701 11.683c0.62-0.073 1.185 0.36 1.276 0.978s-0.325 1.195-0.939 1.304c-0.414 0.073-0.835-0.084-1.099-0.411s-0.33-0.771-0.171-1.161c0.159-0.389 0.516-0.661 0.933-0.71z"></path>
    </symbol>

    <symbol id="icon-logo_footer" viewBox="0 0 110 32">
      <path d="M16.403 0.241c0.434-0.050 0.936 0.047 1.354 0.174 0.945 0.288 1.714 0.904 2.169 1.784 0.474 0.902 0.564 1.958 0.252 2.927-0.397 1.196-1.248 1.798-2.311 2.351l0.012 3.489c0.759 0.231 1.498 0.494 2.187 0.893 1.585 0.918 2.668 2.467 3.123 4.23 0.48 1.848 0.208 3.812-0.759 5.46-0.887 1.493-2.3 2.596-3.993 3.018-2.211 0.553-4.087-0.046-5.987-1.175-0.84 0.898-1.67 1.806-2.489 2.724 0.366 0.864 0.488 1.771 0.245 2.689-0.237 0.897-0.866 1.666-1.67 2.121-0.901 0.51-1.928 0.602-2.916 0.32-0.981-0.281-1.805-0.888-2.284-1.8-0.472-0.897-0.511-1.949-0.206-2.907 0.348-1.089 1.056-1.759 2.052-2.257 1.072-0.419 1.959-0.281 3.006 0.096 0.872-0.917 1.692-1.881 2.573-2.79-0.968-1.898-1.281-3.515-0.778-5.606-1.095-0.511-2.152-1.107-3.248-1.619-0.586 0.61-1.302 1.028-2.143 1.169-1.003 0.169-2.060-0.105-2.884-0.694-0.817-0.592-1.354-1.494-1.486-2.494-0.135-0.969 0.12-2.037 0.741-2.802 0.64-0.789 1.634-1.266 2.637-1.371 0.986-0.096 1.969 0.205 2.733 0.836 0.976 0.818 1.259 1.835 1.377 3.046 1.039 0.637 2.229 1.128 3.312 1.697 1.409-1.665 2.439-2.191 4.492-2.824l0.001-3.463c-0.367-0.147-0.734-0.326-1.054-0.561-0.81-0.599-1.343-1.502-1.474-2.501-0.121-0.994 0.16-1.995 0.78-2.781 0.678-0.851 1.585-1.238 2.636-1.377zM20.931 17.465c-0.209-2.382-2.302-4.149-4.685-3.955-2.404 0.196-4.19 2.311-3.979 4.714s2.337 4.176 4.739 3.951c2.38-0.224 4.134-2.328 3.925-4.71z"></path>
      <path d="M102.108 12.055c0.708 0.001 1.416 0.010 2.124 0.028l-0.004 3.743c0.545-0.424 1.14-0.74 1.83-0.844 0.933-0.141 1.885 0.101 2.637 0.67 0.908 0.687 1.385 1.843 1.523 2.947 0.175 1.402-0.154 2.75-1.019 3.867-0.574 0.554-1.262 0.941-2.056 1.072-1.165 0.191-2.089-0.216-2.998-0.894l-0.004 0.818-2.033-0.004-0.001-11.403zM105.748 16.96c-0.631 0.21-1.070 0.509-1.378 1.117-0.342 0.675-0.365 1.509-0.098 2.212 0.203 0.538 0.585 1.004 1.117 1.244 0.386 0.175 0.749 0.18 1.165 0.155 0.659-0.249 1.102-0.569 1.401-1.229 0.312-0.689 0.307-1.52 0.011-2.214-0.227-0.533-0.632-0.963-1.177-1.174-0.341-0.131-0.682-0.149-1.042-0.111z"></path>
      <path d="M41.271 12.034c1.246 3.84 2.84 7.576 4.056 11.426l-2.296 0.002c-0.269-0.822-0.529-1.752-0.939-2.512-0.268-0.115-0.586-0.076-0.873-0.073-1.108 0.011-2.215 0.008-3.323-0.011-0.348 0.848-0.628 1.721-0.903 2.595l-2.339-0.002c1.221-3.833 2.677-7.617 3.996-11.42 0.872 0.019 1.749-0.002 2.622-0.005zM39.962 14.872c-0.483 1.374-0.934 2.768-1.464 4.125l1.681-0.001 1.307-0.014c-0.184-0.517-1.25-3.881-1.524-4.11z"></path>
      <path d="M89.685 12.058l2.196 0.013c-0.030 2.647-0.007 5.298-0.007 7.945-0.001 1.093 0.11 2.287-0.012 3.365l-0.121 0.083h-2.058l-0.004-4.889c-1.645-0.046-3.303-0.005-4.949-0.003l0.001 4.894-2.209-0.004 0.009-11.401 2.201 0.005 0.001 4.661h4.957l-0.003-4.67z"></path>
      <path d="M93.202 15.219c0.729 0.021 1.459 0.013 2.188 0.017-0.009 1.165-0.193 4.384 0.089 5.347 0.111 0.38 0.333 0.728 0.693 0.913 0.541 0.278 1.090 0.117 1.628-0.072 0.238-0.266 0.443-0.515 0.561-0.859 0.386-1.123 0.18-4.006 0.174-5.343 0.694 0.019 1.391 0.004 2.085 0.001-0.016 0.8-0.003 1.603-0.004 2.404l0.011 5.834c-0.683 0.010-1.365 0.005-2.047-0.015l-0.063-0.074c0.010-0.173 0.012-0.314-0.018-0.487-0.639 0.277-1.209 0.697-1.936 0.712-0.843 0.017-1.758-0.245-2.364-0.851-0.459-0.459-0.739-1.077-0.883-1.703-0.31-1.348-0.127-4.332-0.113-5.824z"></path>
      <path d="M63.686 14.989c1.089-0.085 2.224-0.008 3.104 0.725 0.617 0.514 0.816 1.13 0.883 1.897l-1.968-0.002c-0.113-0.21-0.227-0.455-0.404-0.619-0.284-0.262-0.694-0.398-1.078-0.377-0.298 0.016-0.679 0.135-0.865 0.387-0.113 0.154-0.175 0.311-0.132 0.503 0.224 1.009 2.79 0.884 3.607 1.419 0.52 0.341 0.919 0.951 1.034 1.56 0.115 0.623-0.033 1.266-0.408 1.775-0.627 0.865-1.593 1.175-2.599 1.329-0.931 0.056-2.010-0.194-2.756-0.761-0.699-0.532-0.95-1.185-1.045-2.025 0.663 0.001 1.326-0.005 1.989-0.018 0.039 0.125 0.082 0.246 0.145 0.361 0.289 0.533 0.865 0.651 1.4 0.808 0.353-0.081 0.831-0.172 1.082-0.457 0.151-0.172 0.204-0.471 0.14-0.691-0.245-0.843-2.703-0.943-3.556-1.467-0.505-0.311-0.876-0.764-1.011-1.349-0.121-0.53-0.075-1.125 0.223-1.59 0.538-0.84 1.28-1.185 2.216-1.408z"></path>
      <path d="M76.929 14.987c0.62-0.050 1.227-0.047 1.831 0.117 0.697 0.189 1.438 0.578 1.79 1.238 0.17 0.317 0.3 0.886 0.186 1.237-0.565 0.122-1.255 0.039-1.835 0.033-0.086-0.287-0.158-0.509-0.391-0.707-0.295-0.247-0.679-0.364-1.062-0.322-0.3 0.031-0.685 0.178-0.852 0.447-0.1 0.16-0.141 0.324-0.078 0.509 0.363 1.068 2.535 0.814 3.38 1.297 0.538 0.308 0.988 0.849 1.141 1.454 0.164 0.65 0.056 1.372-0.319 1.931-0.56 0.835-1.449 1.149-2.388 1.331-0.921 0.114-1.989-0.082-2.759-0.613-0.791-0.545-1.028-1.229-1.206-2.123l1.973-0.015c0.12 0.302 0.229 0.537 0.485 0.746 0.341 0.279 0.745 0.406 1.184 0.347 0.341-0.045 0.676-0.202 0.88-0.487 0.133-0.187 0.2-0.414 0.136-0.642-0.247-0.878-2.426-0.823-3.29-1.288-0.584-0.315-1.046-0.838-1.231-1.481-0.157-0.544-0.091-1.11 0.196-1.599 0.477-0.81 1.353-1.206 2.231-1.408z"></path>
      <path d="M52.64 12.955c0.655 0.023 1.315 0.009 1.97 0.011-0.007 0.74 0.004 1.48 0.032 2.219l1.944 0.001-0.004 1.694-1.851-0.001c0.001 1.066-0.243 3.817 0.246 4.641 0.382 0.301 1.145 0.189 1.609 0.183l-0.007 1.404c0.004 0.145 0.004 0.218-0.070 0.344-0.259 0.124-0.524 0.152-0.81 0.154-0.752 0.007-1.791-0.129-2.331-0.693-1.086-1.131-0.739-4.457-0.734-6.035l-1.254 0.002 0.004-1.698 1.249 0.008 0.007-2.236z"></path>
      <path d="M69.539 12.946l1.934 0.011c-0.015 0.741 0.016 1.485 0.030 2.226l1.975-0.004-0.003 1.702-1.859-0.001c0.023 1.015-0.226 3.85 0.234 4.617 0.494 0.295 1.113 0.216 1.668 0.215-0.007 0.489 0.003 0.979 0.005 1.469l-0.023 0.186c-0.191 0.202-0.486 0.194-0.747 0.2-0.794 0.019-1.891-0.107-2.467-0.71-1.075-1.125-0.74-4.405-0.731-5.978l-1.323 0.001c-0.017-0.563-0.010-1.129-0.015-1.692l1.318 0.007 0.004-2.249z"></path>
      <path d="M27.82 11.679c0.102-0.005 0.2-0.007 0.302 0.008 0.316 0.046 0.628 0.198 0.802 0.476 0.185 0.294 0.21 0.687 0.235 1.028 0.125 1.688 0.032 3.444 0.032 5.138-0 1.384 0.153 3.26-0.104 4.592-0.081 0.419-0.358 0.619-0.691 0.846-0.127 0.015-0.259 0.033-0.387 0.026-0.285-0.016-0.556-0.143-0.74-0.361-0.183-0.216-0.177-0.648-0.193-0.919-0.116-1.942-0.018-3.946-0.016-5.893 0.001-1.107-0.151-3.225 0.082-4.213 0.083-0.353 0.402-0.539 0.68-0.727z"></path>
      <path d="M50.244 15.156l0.278-0.003c0.329 0.368 0.166 1.535 0.155 2.018-0.696-0.007-1.354-0.035-1.899 0.471-1.023 0.949-0.678 4.425-0.688 5.82-0.548-0.005-1.617 0.195-2.035-0.154l-0.022-0.346c0.010-2.586-0.055-5.169-0.038-7.754 0.664 0.021 1.33 0.007 1.994 0.003l-0.023 1.142c0.123-0.177 0.245-0.366 0.388-0.527 0.503-0.568 1.186-0.619 1.891-0.669z"></path>
      <path d="M57.795 15.19l2.086 0.001 0.005 8.275-2.11-0.003 0.019-8.273z"></path>
      <path d="M24.906 14.391c0.343 0.063 0.645 0.192 0.845 0.489 0.308 0.459 0.316 4.955 0.162 5.596-0.084 0.351-0.388 0.522-0.675 0.691-0.33-0.020-0.763-0.049-0.983-0.335-0.327-0.425-0.3-5.203-0.114-5.802 0.108-0.348 0.466-0.495 0.765-0.64z"></path>
      <path d="M58.7 11.781c0.62-0.073 1.185 0.36 1.276 0.978s-0.325 1.195-0.939 1.304c-0.414 0.073-0.835-0.084-1.099-0.411s-0.33-0.771-0.171-1.161c0.159-0.389 0.516-0.661 0.933-0.71z"></path>
    </symbol>

    <symbol id="icon-logo_icon_about_us" viewBox="0 0 32 32">
      <path d="M17.285 3.195c0.38-0.041 0.82 0.039 1.185 0.142 0.827 0.235 1.499 0.738 1.898 1.456 0.415 0.736 0.494 1.596 0.221 2.387-0.347 0.976-1.092 1.466-2.022 1.917l0.010 2.845c0.665 0.189 1.311 0.403 1.915 0.729 1.387 0.749 2.336 2.012 2.733 3.449 0.42 1.507 0.181 3.109-0.665 4.452-0.776 1.218-2.014 2.117-3.495 2.461-1.935 0.451-3.576-0.037-5.24-0.959-0.735 0.732-1.462 1.473-2.179 2.222 0.32 0.704 0.427 1.444 0.214 2.192-0.208 0.732-0.758 1.359-1.462 1.73-0.789 0.416-1.688 0.492-2.553 0.261-0.858-0.229-1.58-0.724-1.999-1.469-0.413-0.732-0.448-1.589-0.18-2.371 0.305-0.888 0.925-1.435 1.797-1.841 0.939-0.342 1.715-0.23 2.631 0.078 0.763-0.748 1.481-1.534 2.252-2.275-0.847-1.548-1.121-2.866-0.681-4.572-0.959-0.417-1.884-0.903-2.843-1.321-0.513 0.497-1.139 0.838-1.875 0.954-0.878 0.138-1.803-0.085-2.525-0.566-0.715-0.483-1.185-1.218-1.301-2.033-0.119-0.791 0.105-1.662 0.648-2.286 0.56-0.644 1.43-1.032 2.309-1.117 0.863-0.078 1.724 0.167 2.392 0.681 0.855 0.667 1.101 1.496 1.205 2.484 0.91 0.52 1.951 0.92 2.899 1.384 1.233-1.358 2.134-1.787 3.931-2.303l0.002-2.824c-0.322-0.12-0.643-0.266-0.923-0.458-0.709-0.489-1.174-1.225-1.289-2.040-0.106-0.811 0.139-1.628 0.682-2.269 0.594-0.694 1.387-1.010 2.307-1.123zM21.246 17.242c-0.183-1.943-2.014-3.383-4.1-3.225-2.105 0.159-3.668 1.885-3.483 3.844s2.046 3.406 4.149 3.221c2.083-0.183 3.618-1.898 3.435-3.841z"></path>
      <path d="M27.276 12.524c0.089-0.004 0.175-0.005 0.264 0.007 0.277 0.037 0.549 0.162 0.702 0.388 0.162 0.24 0.184 0.56 0.206 0.838 0.11 1.377 0.028 2.809 0.028 4.19-0 1.128 0.134 2.658-0.091 3.745-0.071 0.341-0.314 0.505-0.605 0.69-0.111 0.013-0.227 0.027-0.339 0.021-0.25-0.013-0.486-0.117-0.648-0.294-0.16-0.176-0.155-0.529-0.169-0.749-0.102-1.584-0.016-3.218-0.014-4.806 0.001-0.903-0.132-2.63 0.071-3.436 0.073-0.288 0.352-0.439 0.595-0.593z"></path>
      <path d="M24.726 14.736c0.3 0.051 0.565 0.156 0.74 0.399 0.269 0.374 0.277 4.041 0.142 4.564-0.074 0.286-0.339 0.426-0.591 0.563-0.288-0.016-0.668-0.040-0.86-0.273-0.287-0.346-0.263-4.243-0.1-4.732 0.095-0.284 0.408-0.404 0.67-0.522z"></path>
    </symbol>
  </defs>
</svg>

```

---
## src/index.html

**size:** 1675 bytes &nbsp;&nbsp; **sha1:** `07669e8091c1d8989728b4f86da91f4ed3dd8103`

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/logo-icon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ArtistsHub | Website</title>

    <!-- fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Epilogue:wght@700&display=swap"
      rel="stylesheet"
    />

    <!-- normalize -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    />
    <!-- def-styles -->
    <link rel="stylesheet" href="./css/styles.css" />
  </head>
  <body>
    <load src="./partials/header.html" icon-path="img/sprite.svg#logo" />

    <main>
      <load src="./partials/hero.html" />
      <load src="./partials/artists.html" />
      <load src="./partials/about.html" />
      <load src="./partials/comments.html" />
    </main>

    <load src="./partials/footer.html" />
    <load src="./partials/modal.html" />

    <!-- ассистенту нужен стиль до появления панели -->
    <link rel="stylesheet" href="./css/assistant/chat.css" />

    <!-- ВАЖНО: убрали bridge.js, чтобы не было двойных слушателей assistant:* -->
    <!-- <script type="module" src="./js/assistant/bridge.js"></script> -->

    <!-- твой основной код сайта -->
    <script type="module" src="./main.js"></script>
  </body>
</html>

```

---
## src/js/api.js

**size:** 6686 bytes &nbsp;&nbsp; **sha1:** `0c01a3e55f4b606e8245de5a3882d962f82ddf0b`

```javascript
// CRC/JS/api.js
// Единая обёртка над REST API проекта.
// Возвращает стабильные структуры, не бросает исключений наружу.
// Совместимо с artists/features/api.js

import axios from "axios";

/* =========================
   ENV / ЛОГИРОВАНИЕ
   ========================= */
const IS_DEV =
  /localhost|127\.0\.0\.1/.test(location.hostname) ||
  (document.documentElement.getAttribute("data-env") || "").toLowerCase() === "dev";

const logWarn = (...args) => { if (IS_DEV) console.warn(...args); };

/* =========================
   BASE URL (с возможностью переопределить)
   ========================= */
// приоритет: <html data-api="..."> → VITE_API_BASE → дефолт
const API_BASE =
  document.documentElement.getAttribute("data-api") ||
  (typeof import.meta !== "undefined" && import.meta.env && import.meta.env.VITE_API_BASE) ||
  "https://sound-wave.b.goit.study/api";

/* =========================
   AXIOS ИНСТАНС
   ========================= */
const api = axios.create({
  baseURL: API_BASE,
  timeout: 15000,
  headers: { "Accept": "application/json" },
});

// перехватчик ответов — ничего «магического» не делаем, только единый warn в DEV
api.interceptors.response.use(
  (res) => res,
  (err) => {
    logWarn("[api] HTTP error:", err?.message || err);
    return Promise.reject(err);
  }
);

/* =========================
   ХЕЛПЕРЫ
   ========================= */
function toastError(msg) {
  try { window.__toast?.error(msg); } catch {}
}

// безопасная нормализация любого значения в число (с минимумом)
function clampNumber(v, min, fallback) {
  const n = Number(v);
  return Number.isFinite(n) ? Math.max(min, n) : fallback;
}

/* =========================
   API ФУНКЦИИ
   ========================= */

/**
 * Список артистов
 * @param {{page?:number,limit?:number,genre?:string,sort?:'asc'|'desc'|'',name?:string}} params
 * @returns {Promise<{artists:Array,totalArtists:number,page:number,limit:number}>}
 */
export async function fetchArtists(
  { page = 1, limit = 8, genre = "", sort = "", name = "" } = {}
) {
  try {
    const params = {
      page: clampNumber(page, 1, 1),
      limit: clampNumber(limit, 1, 8),
    };

    const s = String(sort || "").toLowerCase();
    if (s === "asc" || s === "desc") params.sortName = s;

    const g = String(genre || "").trim();
    if (g && g !== "All Genres") params.genre = g;

    const n = String(name || "").trim();
    if (n.length >= 1) params.name = n;

    const { data } = await api.get("/artists", { params });

    // Нормализация ответа (на случай неожиданных форм)
    const artists = Array.isArray(data?.artists) ? data.artists
                   : Array.isArray(data)          ? data
                   : [];
    const totalArtists = clampNumber(data?.totalArtists, 0, artists.length);
    const pageOut  = clampNumber(data?.page, 1, params.page);
    const limitOut = clampNumber(data?.limit, 1, params.limit);

    return { artists, totalArtists, page: pageOut, limit: limitOut };
  } catch (err) {
    logWarn("[api] fetchArtists failed:", err?.message || err);
    toastError("Не удалось загрузить артистов. Попробуйте позже.");
    return { artists: [], totalArtists: 0, page: 1, limit: clampNumber(limit, 1, 8) };
  }
}

/* ----- кэш жанров (in-memory) на короткое время ----- */
let _genresCache = { ts: 0, list: [] };
const GENRES_TTL = 5 * 60 * 1000; // 5 минут

/**
 * Список жанров
 * @returns {Promise<string[]>} — массив имён жанров (включая "All Genres" первым)
 */
export async function fetchGenres() {
  try {
    const now = Date.now();
    if (_genresCache.list.length && now - _genresCache.ts < GENRES_TTL) {
      return _genresCache.list.slice(); // отдаём копию
    }

    const { data } = await api.get("/genres");
    const raw = Array.isArray(data) ? data : (data?.genres || []);
    const names = raw
      .map((g) =>
        typeof g === "string"
          ? g
          : g?.name || g?.title || g?.genre || g?.label || ""
      )
      .filter(Boolean);
    const uniq = [...new Set(names)];
    const out = ["All Genres", ...uniq];

    _genresCache = { ts: now, list: out };
    return out;
  } catch (err) {
    logWarn("[api] fetchGenres failed:", err?.message || err);
    toastError("Не удалось загрузить жанры.");
    return ["All Genres"];
  }
}

/**
 * Один артист
 * @param {string|number} id
 * @returns {Promise<Object|null>}
 */
export async function fetchArtist(id) {
  if (!id && id !== 0) return null;
  try {
    const { data } = await api.get(`/artists/${id}`);
    // Возможные формы: объект, массив, { artists: [...] }
    if (data && !Array.isArray(data)) return data;
    if (Array.isArray(data) && data.length) return data[0];
    if (Array.isArray(data?.artists) && data.artists.length) return data.artists[0];
    return null;
  } catch (err) {
    logWarn("[api] fetchArtist failed:", err?.message || err);
    toastError("Не удалось загрузить артиста.");
    return null;
  }
}

/**
 * Альбомы артиста (каждый альбом может содержать массив треков)
 * @param {string|number} id
 * @returns {Promise<Array>}
 */
export async function fetchArtistAlbums(id) {
  if (!id && id !== 0) return [];
  try {
    const { data } = await api.get(`/artists/${id}/albums`);

    // Возможные формы от API:
    // - Array
    // - { albumsList: [...] } / { albums: [...] } / { album: [...] }
    if (Array.isArray(data)) return data;
    if (Array.isArray(data?.albumsList)) return data.albumsList;
    if (Array.isArray(data?.albums)) return data.albums;
    if (Array.isArray(data?.album)) return data.album;

    return [];
  } catch (err) {
    logWarn("[api] fetchArtistAlbums failed:", err?.message || err);
    toastError("Не удалось загрузить альбомы.");
    return [];
  }
}

/* =========================
   Доп. экспорт при необходимости
   ========================= */
export { api, API_BASE, IS_DEV };

```

---
## src/js/artists/features/api.js

**size:** 2911 bytes &nbsp;&nbsp; **sha1:** `8b8f794ef5e6f95b6942fea6b99b6f94767a1fb8`

```javascript

import {
  fetchArtists as _fetchArtists,
  fetchGenres  as _fetchGenres,
  fetchArtist  as _fetchArtist,
  fetchArtistAlbums as _fetchArtistAlbums,
} from "../../api.js";

// ---------- helpers ----------
const normId = (o) => o?.idArtist || o?.id || o?._id || o?.artistId || "";

const normGenres = (o) => {
  if (Array.isArray(o?.genres)) return o.genres;
  if (typeof o?.strGenre === "string" && o.strGenre.trim())
    return o.strGenre.split(/,\s*/).filter(Boolean);
  if (o?.genre) return [o.genre];
  return [];
};

const NOPHOTO = "https://via.placeholder.com/960x540?text=No+Image";

const normArtist = (o = {}) => ({
  id: normId(o),
  name: o.strArtist || o.name || "Unknown artist",
  image: o.strArtistThumb || o.thumb || o.photo || o.image || NOPHOTO,
  country: o.strCountry || o.country || "N/A",
  members: o.intMembers || o.members || "N/A",
  gender:  o.strGender || o.sex || "N/A",
  biography: o.strBiographyEN || o.biography || o.about || "",
  genres: normGenres(o),
  formedYear: o.intFormedYear || o.formedYear || o.yearStart || null,
  endedYear:  o.intDisbandedYear || o.intDiedYear || o.disbandedYear || o.yearEnd || null,
});

const normTrack = (t = {}) => ({
  title: t.strTrack || t.title || t.name || "—",
  duration: Number(t.intDuration ?? t.duration ?? t.time ?? 0),
  youtube: t.strMusicVid || t.youtube || t.youtube_url || t.url || t.movie || "",
});

const normAlbum = (a = {}) => {
  const rawTracks =
    Array.isArray(a.tracks) ? a.tracks :
    Array.isArray(a.songs)  ? a.songs  :
    Array.isArray(a.track)  ? a.track  : [];
  return {
    title: a.strAlbum || a.title || a.name || "Album",
    tracks: rawTracks.map(normTrack),
  };
};

// ---------- exported API (normalized) ----------
export async function fetchArtists(params) {
  const res = await _fetchArtists(params);
  const list = Array.isArray(res?.artists) ? res.artists
             : Array.isArray(res)          ? res
             : [];
  const artists = list.map(normArtist);
  const totalArtists = Number(res?.totalArtists ?? res?.total ?? artists.length);
  return { artists, totalArtists };
}

export async function fetchGenres() {
  const res = await _fetchGenres();
  if (Array.isArray(res)) return res;
  if (Array.isArray(res?.genres)) return res.genres;
  return [];
}

export async function fetchArtist(id) {
  const res = await _fetchArtist(id);
  const obj = Array.isArray(res) ? res[0]
            : Array.isArray(res?.artists) ? res.artists[0]
            : res;
  return obj ? normArtist(obj) : null;
}

export async function fetchArtistAlbums(id) {
  const res = await _fetchArtistAlbums(id);
  const list = Array.isArray(res) ? res
             : Array.isArray(res?.albums) ? res.albums
             : Array.isArray(res?.album)  ? res.album
             : [];
  return list.map(normAlbum);
}




```

---
## src/js/artists/features/grid.js

**size:** 20625 bytes &nbsp;&nbsp; **sha1:** `e7ef9cfa1eff616e6819621efa552ffa51648d9f`

```javascript
// src/js/artists/features/grid.js
// Грид артистов: скелетоны, пагинация, поиск/сорт/жанры, модалка, zoom, List/Grid view.
// Плюс: "умная" биография (минимум 3–5 строк), единая высота блоков, data:-плейсхолдер.

import { UISound } from "../lib/sound.js";
import { fetchArtists, fetchGenres } from "./api.js";
import { ArtistState } from "./state.js";
import { createArtistModal } from "./modal.js";
import { openZoom } from "./zoom.js";

// === SVG SPRITE (лежит в CRC/img/sprite.svg) ===
import SPRITE_RAW from "../../../img/sprite.svg?raw";

const SPRITE_CONTAINER_ID = "GLOBAL_SVG_SPRITE";
function ensureSpriteMounted(doc = document) {
  if (doc.getElementById(SPRITE_CONTAINER_ID)) return;
  const wrap = doc.createElement("div");
  wrap.id = SPRITE_CONTAINER_ID;
  wrap.setAttribute("aria-hidden", "true");
  wrap.style.position = "absolute";
  wrap.style.width = "0";
  wrap.style.height = "0";
  wrap.style.overflow = "hidden";
  wrap.innerHTML = SPRITE_RAW;
  doc.body.prepend(wrap);
}
const icon = (id, cls = "ico") =>
  `<svg class="${cls}" aria-hidden="true"><use href="#${id}" xlink:href="#${id}"></use></svg>`;

// === Рантайм-CSS (ровная сетка: 5 строк биографии + фикс высота тегов) ===
const RUNTIME_STYLE_ID = "artists-grid-runtime";
function ensureRuntimeStyles() {
  if (document.getElementById(RUNTIME_STYLE_ID)) return;
  const css = `
  #artists-section .card__tags{min-height:28px;display:flex;flex-wrap:wrap;gap:8px}
  #artists-section .card__text{
    display:-webkit-box;
    -webkit-line-clamp:5;          /* 5 строк по ТЗ */
    -webkit-box-orient:vertical;
    overflow:hidden;
  }`;
  const style = document.createElement("style");
  style.id = RUNTIME_STYLE_ID;
  style.textContent = css;
  document.head.appendChild(style);
}

// ——— параметры рендеринга ———
const DEFAULT_LIMIT = 8;

// Без сетевых запросов → не будет ошибок в консоли
const FALLBACK_IMG =
  "data:image/svg+xml;utf8," +
  encodeURIComponent(
    `<svg xmlns="http://www.w3.org/2000/svg" width="960" height="540">
      <rect width="100%" height="100%" fill="#0b0b0b"/>
      <text x="50%" y="50%" fill="#888" font-family="IBM Plex Sans,Arial,sans-serif"
            font-size="28" text-anchor="middle" dominant-baseline="middle">No image</text>
    </svg>`
  );

// аккуратно отсекаем «странные» URL, чтобы не гонять лишние запросы
function looksLikeImageUrl(u) {
  if (!u || typeof u !== "string") return false;
  if (!/^https?:\/\//i.test(u)) return false;
  if (/null|undefined$/i.test(u)) return false;
  if (!/\.(jpg|jpeg|png|webp|gif|avif|svg)(\?|#|$)/i.test(u)) return false;
  return true;
}

// лимит для List View
function computeListLimit() {
  const w = window.innerWidth || document.documentElement.clientWidth || 0;
  if (w >= 1440) return 16;
  if (w >= 768) return 12;
  return 10;
}

// гарантируем наличие кнопки List view (особенно на мобилке)
function ensureViewToggle(root) {
  let btn = root.querySelector("#view-toggle");
  if (!btn) {
    btn = document.createElement("button");
    btn.id = "view-toggle";
    btn.type = "button";
    btn.className = "filters__view";
    btn.setAttribute("aria-pressed", "false");
    btn.textContent = "List view";
    const mount =
      root.querySelector(".filters__bar") ||
      root.querySelector(".filters") ||
      root;
    mount.appendChild(btn);
  }
  return btn;
}

/* ---------- «умная» биография: добивка фактами, чтобы получить 3–5 строк ---------- */
function cleanText(s = "") {
  return String(s)
    .replace(/\s+/g, " ")
    .replace(/\s*([,.!?;:])\s*/g, "$1 ")
    .trim();
}
function yearsLabel(a = {}) {
  const start = a.intFormedYear || a.formedYear || a.yearStart || "";
  const end   = a.intDisbandedYear || a.intDiedYear || a.disbandedYear || a.yearEnd || "";
  if (start && end) return `${start}–${end}`;
  if (start) return `since ${start}`;
  return "";
}
function topGenres(a) {
  const arr = Array.isArray(a?.genres) ? a.genres : (a?.genre ? [a.genre] : []);
  return arr.map(String).filter(Boolean).slice(0, 2);
}
function composeBio(a) {
  const raw = cleanText(a?.strBiographyEN || a?.biography || a?.about || "");
  const hasJazz = topGenres(a).some(g => /jazz/i.test(g));
  const fallback = hasJazz
    ? "A look at the influential figures who shaped jazz music history."
    : "A look at the influential figures who shaped music history.";

  const facts = [];
  const gs = topGenres(a); if (gs.length) facts.push(`Genres: ${gs.join(", ")}`);
  const country = a.strCountry || a.country; if (country) facts.push(`Country: ${country}`);
  const yrs = yearsLabel(a); if (yrs) facts.push(`Active: ${yrs}`);

  let bio = raw || fallback;
  if (facts.length) bio += " " + facts.join(". ") + ".";

  // корректно «растянем», чтобы чаще было 3–5 строк (при текущей ширине карточки и 16px)
  const MIN_CHARS = 230;
  if (bio.length < MIN_CHARS && raw) {
    bio += " Explore discography, style, and milestones.";
  }
  return bio;
}

/* ====================================================================== */

export function initGrid(root = document.querySelector("#artists-section")) {
  if (!root) return;

  ensureSpriteMounted(document);
  ensureRuntimeStyles();

  // ---------- refs ----------
  const panel      = root.querySelector("#filters-panel");
  const toggleBtn  = root.querySelector("#filters-toggle");
  const resetBtn   = root.querySelector("#filters-reset");
  const resetBtnSm = root.querySelector("#filters-reset-sm");
  const viewToggle = ensureViewToggle(root);

  const searchInput = root.querySelector("#flt-q");
  const searchBtn   = root.querySelector("#flt-q-btn");

  const ddSort      = root.querySelector('.dd[data-dd="sort"]');
  const ddSortBtn   = root.querySelector("#dd-sort-btn")  || ddSort?.querySelector(".dd__btn");
  const ddSortList  = root.querySelector("#dd-sort-list") || ddSort?.querySelector(".dd__list");

  const ddGenre     = root.querySelector('.dd[data-dd="genre"]');
  const ddGenreBtn  = root.querySelector("#dd-genre-btn") || ddGenre?.querySelector(".dd__btn");
  const ddGenreList = root.querySelector("#dd-genre-list")|| ddGenre?.querySelector(".dd__list");

  const grid  = root.querySelector("#artists-grid");
  const pager = root.querySelector("#artists-pager");
  const empty = root.querySelector("#artists-empty");

  if (!grid) {
    console.warn("[artists] #artists-grid not found; abort initGrid");
    return;
  }

  const sectionRoot = root.closest(".artists1") || root;

  // модалка (единый экземпляр)
  const modalApi = createArtistModal(document);

  // защита от гонок API
  let reqId = 0;

  // для слежения за авто-лимитом при ресайзе
  let lastAppliedLimit = null;

  // ---------- utils ----------
  const show = (el) => el && el.removeAttribute("hidden");
  const hide = (el) => el && el.setAttribute("hidden", "");
  const isDesktop = () => matchMedia("(min-width:1440px)").matches;
  const byName = (a) => (a?.strArtist || a?.name || "").toLowerCase();
  const isListMode = () => sectionRoot.classList.contains("view-list");

  function updateViewButtonUI(listOn) {
    viewToggle?.setAttribute("aria-pressed", String(listOn));
    if (viewToggle) viewToggle.textContent = listOn ? "Default view" : "List view";
  }

  function applyAutoLimitForCurrentMode({ resetPage = false } = {}) {
    const want = isListMode() ? computeListLimit() : DEFAULT_LIMIT;
    if (lastAppliedLimit === want) return;
    lastAppliedLimit = want;
    ArtistState.setLimit(want);
    if (resetPage) ArtistState.setPage(1);
    loadArtists();
  }

  function syncPanelMode() {
    const st = ArtistState.get();
    if (isDesktop()) {
      panel?.setAttribute("aria-hidden", "false");
      toggleBtn?.setAttribute("aria-expanded", "false");
      ArtistState.setMobilePanel(false);
    } else {
      panel?.setAttribute("aria-hidden", st.isMobilePanelOpen ? "false" : "true");
      toggleBtn?.setAttribute("aria-expanded", st.isMobilePanelOpen ? "true" : "false");
    }
  }

  function scrollToGridTop() {
    const top = root.getBoundingClientRect().top + window.scrollY - 16;
    window.scrollTo({ top, behavior: "smooth" });
  }

  function applyEmpty(on) {
    if (on) {
      show(empty); hide(grid); hide(pager); resetGridInlineStyles();
    } else {
      hide(empty); show(grid);
    }
  }
  function resetGridInlineStyles() {
    grid.style.height = "";
    grid.style.overflow = "";
    grid.style.transition = "";
    grid.style.willChange = "";
  }

  // ---------- skeleton + fade-in ----------
  function buildSkeletonCard() {
    return `
      <li class="card card--skel">
        <div class="card__media skel skel--media"></div>
        <div class="card__tags">
          <span class="tag skel skel--tag"></span>
          <span class="tag skel skel--tag"></span>
        </div>
        <div class="skel skel--title"></div>
        <div class="skel skel--text"></div>
      </li>`;
  }
  function renderSkeleton(count) {
    const n = Math.max(1, Number(count) || DEFAULT_LIMIT);
    grid.innerHTML = new Array(n).fill(0).map(buildSkeletonCard).join("");
    show(grid); hide(empty); hide(pager);
  }
  function afterImagesFadeIn() {
    const imgs = grid.querySelectorAll("img.img-fade");
    imgs.forEach((img) => {
      const done = () => img.classList.add("is-loaded");
      if (img.complete && img.naturalWidth > 0) done();
      else img.addEventListener("load", done, { once: true });
    });
  }
  function attachImgFallbacks() {
    grid.querySelectorAll("img").forEach(img => {
      img.onerror = () => { img.onerror = null; img.src = FALLBACK_IMG; };
    });
  }

  // удержание высоты на время перерендера
  let gridCleanupTimer = null;
  function lockGridHeight(h) {
    const hh = h ?? grid.getBoundingClientRect().height;
    grid.style.willChange = "height";
    grid.style.overflow = "hidden";
    grid.style.transition = "none";
    grid.style.height = `${Math.max(1, Math.round(hh || 0))}px`;
  }
  function unlockGridHeight() { resetGridInlineStyles(); }
  function swapGridContent(renderFn) {
    renderFn();
    void grid.offsetHeight;
    const newH = grid.scrollHeight;
    grid.style.transition = "height 200ms ease";
    grid.style.height = `${newH}px`;
    const onEnd = (e) => {
      if (e.target !== grid || e.propertyName !== "height") return;
      grid.removeEventListener("transitionend", onEnd);
      unlockGridHeight();
    };
    grid.addEventListener("transitionend", onEnd);
    clearTimeout(gridCleanupTimer);
    gridCleanupTimer = setTimeout(unlockGridHeight, 400);
  }

  // ---------- rendering ----------
  function buildCard(a) {
    const id    = a?.id || a?._id || a?.artistId || "";
    const name  = a?.strArtist || a?.name || "Unknown";
    const rawImg= a?.strArtistThumb || a?.photo || a?.image || "";
    const img   = looksLikeImageUrl(rawImg) ? rawImg : FALLBACK_IMG;

    const bio   = composeBio(a);
    const tags  = Array.isArray(a?.genres) ? a.genres : (a?.genre ? [a.genre] : []);

    return `
      <li class="card" data-id="${id}">
        <div class="card__media">
          <img
            class="img-fade"
            src="${img}"
            alt="${name}"
            loading="lazy"
            onerror="this.onerror=null;this.src='${FALLBACK_IMG}'"
          >
        </div>
        <div class="card__tags">${tags.map(t => `<span class="tag">${t}</span>`).join("")}</div>
        <h3 class="card__title">${name}</h3>
        <p class="card__text">${bio}</p>
        <button class="card__link" data-action="more">
          Learn More
          ${icon("icon-icon_play_artists_sections")}
        </button>
      </li>`;
  }
  function renderGrid(arr) {
    grid.innerHTML = arr.map(buildCard).join("");
    attachImgFallbacks();
    afterImagesFadeIn();
  }

  function renderPager(page, totalPages) {
    if (totalPages <= 0) { pager.innerHTML = ""; hide(pager); return; }
    if (totalPages === 1) {
      pager.innerHTML = `<button class="active" data-page="1" disabled>1</button>`;
      show(pager); return;
    }
    const btn = (label, p, dis = false, act = false) =>
      `<button ${dis ? "disabled" : ""} data-page="${p}" class="${act ? "active" : ""}">${label}</button>`;

    const win = 2;
    const from = Math.max(1, page - win);
    const to = Math.min(totalPages, page + win);
    const out = [];

    out.push(btn("‹", Math.max(1, page - 1), page === 1, false));
    if (from > 1) {
      out.push(btn("1", 1, false, page === 1));
      if (from > 2) out.push(`<button class="dots" disabled>…</button>`);
    }
    for (let p = from; p <= to; p++) out.push(btn(String(p), p, false, p === page));
    if (to < totalPages) {
      if (to < totalPages - 1) out.push(`<button class="dots" disabled>…</button>`);
      out.push(btn(String(totalPages), totalPages, false, page === totalPages));
    }
    out.push(btn("›", Math.min(totalPages, page + 1), page === totalPages, false));

    pager.innerHTML = out.join("");
    show(pager);
  }

  // ---------- data ----------
  async function loadGenres() {
    try {
      ddGenre?.classList.add("loading");
      ddGenreBtn?.setAttribute("aria-busy", "true");
      if (ddGenreBtn) ddGenreBtn.disabled = true;
      if (ddGenreList) {
        ddGenreList.innerHTML = `
          <li class="dd__loading">
            <span class="dd__spinner" aria-hidden="true"></span>
            <span>Loading…</span>
          </li>`;
      }
      const list = await fetchGenres();
      if (ddGenreList) ddGenreList.innerHTML = list.map((g) => `<li data-val="${g}">${g}</li>`).join("");
    } catch {
      if (ddGenreList) ddGenreList.innerHTML = `<li data-val="">All Genres</li>`;
    } finally {
      ddGenre?.classList.remove("loading");
      ddGenreBtn?.removeAttribute("aria-busy");
      if (ddGenreBtn) ddGenreBtn.disabled = false;
    }
  }

  async function loadArtists(allowRetry = true) {
    const myId = ++reqId;

    const { page, limit, genre, sort, q } = ArtistState.get();

    lockGridHeight(grid.getBoundingClientRect().height);
    renderSkeleton(limit);
    hide(pager);

    let list = [];
    let total = 0;

    try {
      const server = await fetchArtists({
        page, limit,
        genre: genre || "",
        sort:  sort  || "",
        name:  q?.trim?.() || "",
      });
      if (myId !== reqId) return;
      list  = Array.isArray(server.artists) ? server.artists : (Array.isArray(server) ? server : []);
      total = Number(server.totalArtists ?? server.total ?? list.length ?? 0);
    } catch {
      if (myId !== reqId) return;
      list = []; total = 0;
    }

    let totalPages = Math.max(1, Math.ceil(total / Math.max(1, Number(limit) || DEFAULT_LIMIT)));
    if (page > totalPages && allowRetry) { ArtistState.setPage(totalPages); return loadArtists(false); }
    if (page < 1 && allowRetry)          { ArtistState.setPage(1);         return loadArtists(false); }

    if (sort === "asc")  list = list.slice().sort((a, b) => byName(a).localeCompare(byName(b)));
    if (sort === "desc") list = list.slice().sort((a, b) => byName(b).localeCompare(byName(a)));

    if (myId !== reqId) return;

    if (!list.length) {
      grid.innerHTML = "";
      applyEmpty(true);
      unlockGridHeight();
      return;
    }

    applyEmpty(false);
    swapGridContent(() => renderGrid(list));
    renderPager(ArtistState.get().page, totalPages);
  }

  // ---------- dropdowns ----------
  function closeDropdowns(except) {
    [ddSort, ddGenre].forEach((dd) => {
      if (dd && dd !== except) {
        dd.classList.remove("open");
        const ul = dd.querySelector(".dd__list");
        if (ul) ul.style.display = "none";
      }
    });
  }
  function toggleDropdown(dd) {
    if (!dd) return;
    const open = !dd.classList.contains("open");
    closeDropdowns(dd);
    dd.classList.toggle("open", open);
    const ul = dd.querySelector(".dd__list");
    if (ul) ul.style.display = open ? "block" : "none";
  }

  // ---------- UI events ----------
  toggleBtn?.addEventListener("click", () => {
    try { UISound?.tap?.(); } catch {}
    const st = ArtistState.get();
    ArtistState.setMobilePanel(!st.isMobilePanelOpen);
    syncPanelMode();
  });
  addEventListener("resize", () => {
    syncPanelMode();
    if (isListMode()) applyAutoLimitForCurrentMode({ resetPage: true });
  });

  ddSortBtn?.addEventListener("click", () => { try { UISound?.tap?.(); } catch {} toggleDropdown(ddSort); });
  ddGenreBtn?.addEventListener("click", () => { try { UISound?.tap?.(); } catch {} toggleDropdown(ddGenre); });
  document.addEventListener("click", (e) => { if (!e.target.closest(".dd")) closeDropdowns(); });

  ddSortList?.addEventListener("click", (e) => {
    const li = e.target.closest("li"); if (!li) return;
    try { UISound?.tap?.(); } catch {}
    ArtistState.setSort(li.dataset.val || "");
    toggleDropdown(ddSort);
    loadArtists();
  });

  ddGenreList?.addEventListener("click", (e) => {
    const li = e.target.closest("li"); if (!li) return;
    try { UISound?.tap?.(); } catch {}
    const v = li.dataset.val || "";
    ArtistState.setGenre(v === "All Genres" ? "" : v);
    toggleDropdown(ddGenre);
    loadArtists();
    ddSortBtn?.focus();
  });

  function doSearch() {
    try { UISound?.tap?.(); } catch {}
    ArtistState.setQuery(searchInput?.value.trim() || "");
    ArtistState.setPage(1);
    loadArtists();
  }
  searchBtn?.addEventListener("click", doSearch);
  searchInput?.addEventListener("keydown", (e) => { if (e.key === "Enter") doSearch(); });

  function resetAll() {
    ArtistState.reset();
    if (searchInput) searchInput.value = "";
    closeDropdowns();
    lastAppliedLimit = null;
    applyAutoLimitForCurrentMode({ resetPage: true });
  }
  resetBtn?.addEventListener("click", () => { try { UISound?.tap?.(); } catch {} resetAll(); });
  resetBtnSm?.addEventListener("click", () => {
    try { UISound?.tap?.(); } catch {}
    resetAll();
    ArtistState.setMobilePanel(false);
    syncPanelMode();
  });
  root.querySelector("#empty-reset")?.addEventListener("click", () => { try { UISound?.tap?.(); } catch {} resetAll(); });

  pager?.addEventListener("click", (e) => {
    const b = e.target.closest("button[data-page]");
    if (!b || b.disabled) return;
    const p = Number(b.dataset.page) || 1;
    if (p === ArtistState.get().page) return;
    try { UISound?.page?.(); } catch {}
    scrollToGridTop();
    ArtistState.setPage(p);
    loadArtists();
  });

  // Learn More + Zoom
  grid?.addEventListener("click", (e) => {
    const btn = e.target.closest(".card__link, [data-action='more']");
    if (btn) {
      const id = btn.closest(".card")?.dataset?.id;
      if (!id) return;
      try { UISound?.tap?.(); } catch {}
      modalApi.openFor(id);
      return;
    }
    const img = e.target.closest(".card__media img");
    if (img) {
      try { UISound?.tap?.(); } catch {}
      const src = img.currentSrc || img.src || img.getAttribute("src") || "";
      openZoom(src, img.getAttribute("alt") || "");
    }
  });

  // List/Grid view
  viewToggle?.addEventListener("click", () => {
    try { UISound?.tap?.(); } catch {}
    const listOn = !isListMode();
    sectionRoot.classList.toggle("view-list", listOn);
    sectionRoot.classList.toggle("view-grid", !listOn);
    updateViewButtonUI(listOn);
    lastAppliedLimit = null;
    applyAutoLimitForCurrentMode({ resetPage: true });
  });

  // init
  updateViewButtonUI(isListMode());
  syncPanelMode();
  lastAppliedLimit = null;
  applyAutoLimitForCurrentMode({ resetPage: false });
  loadGenres();
  loadArtists();
}

```

---
## src/js/artists/features/init.js

**size:** 749 bytes &nbsp;&nbsp; **sha1:** `04f7c5fee8d19fa8fe3ebe0354b60262af0a6913`

```javascript
import { initGrid } from "./grid.js";
import { createArtistModal } from "./modal.js";
import { initRouter } from "./router.js";
import { initPrefetch } from "./prefetch.js";

export function initArtists(root = document.querySelector("#artists-section")) {
  if (!root) return;

  // URL-sync сначала (восстановит состояние до начальной загрузки)
  initRouter(root);

  // Модалка (возвращает open/close)
  const modal = createArtistModal(root);

  // Prefetch "Learn more" (ускоряет открытие модалки)
  initPrefetch(root);

  // Грид (передаём модалку для открытия)
  initGrid(root, { openModal: modal.open });
}

```

---
## src/js/artists/features/mixradio-menu.js

**size:** 5940 bytes &nbsp;&nbsp; **sha1:** `cbcb3f4274d3ccf21a96811b1beab2cc95813238`

```javascript
// Кнопка "Radio Menu": кликом открывает поповер под кнопкой, шириной = ширине кнопки.
// Экспорт: installMixRadioMenu(selector, player)

export function installMixRadioMenu(buttonSelector = "#mixradio-menu-btn", player) {
  const btn = document.querySelector(buttonSelector);
  if (!btn || btn.dataset.mrxInited) return;
  btn.dataset.mrxInited = "1";

  // ---- Inline CSS (один раз) ----
  const STYLE_ID = "mixradio-menu-style";
  if (!document.getElementById(STYLE_ID)) {
    const st = document.createElement("style");
    st.id = STYLE_ID;
    st.textContent = `
      .am-mrx-pop{
        position:fixed; z-index:3000; background:#0f0f10;
        border:1px solid rgba(255,255,255,.12); border-radius:12px;
        box-shadow:0 12px 32px rgba(0,0,0,.4); padding:8px; color:#e8e8ec;
        font:500 14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif
      }
      .am-mrx-pop__grp{padding:6px 6px 4px 6px}
      .am-mrx-pop__hdr{font-weight:700;color:#fff;margin:4px 6px 6px}
      .am-mrx-pop__btn{display:flex;align-items:center;gap:8px;width:100%;
        padding:8px 10px;border:0;background:transparent;color:#e8e8ec;border-radius:8px;cursor:pointer}
      .am-mrx-pop__btn:hover,.am-mrx-pop__btn:focus-visible{background:rgba(255,255,255,.08);outline:none}
      .am-mrx-pop__sep{height:1px;background:rgba(255,255,255,.12);margin:6px 0}
      .am-mrx-pop__row{display:flex;gap:6px;flex-wrap:wrap}
      .am-mrx-pop__chip{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.18);
        background:transparent;color:#fff;cursor:pointer}
      .am-mrx-pop__chip:hover,.am-mrx-pop__chip:focus-visible{background:rgba(255,255,255,.08);outline:none}
      .am-mrx-pop__muted{opacity:.8}
    `;
    document.head.appendChild(st);
  }

  let pop = null;
  let sleepTimer = null;

  function closePop() {
    if (pop && pop.parentNode) pop.parentNode.removeChild(pop);
    pop = null;
    document.removeEventListener("click", onDocClick, true);
    window.removeEventListener("scroll", placeUnderButton);
    window.removeEventListener("resize", placeUnderButton);
    document.removeEventListener("keydown", onEsc);
  }
  function onEsc(e){ if(e.key==="Escape") closePop(); }
  function onDocClick(e){
    if (!pop) return;
    if (e.target === btn) return;          // повторный клик по кнопке — пусть обрабатывается её хэндлером
    if (!pop.contains(e.target)) closePop();
  }

  function placeUnderButton() {
    if (!pop) return;
    const r = btn.getBoundingClientRect();
    const w = Math.max(160, Math.round(r.width));
    pop.style.width = w + "px";
    pop.style.minWidth = w + "px";

    const vw = window.innerWidth;
    const px8 = 8;
    const left = Math.min(Math.max(px8, r.left), vw - w - px8);
    const top  = r.bottom + 6;

    // ВАЖНО: позиционирование fixed — координаты по вьюпорту, БЕЗ скролл-офсетов
    pop.style.left = left + "px";
    pop.style.top  = top + "px";
  }

  function setSleep(minutes) {
    if (sleepTimer) { clearTimeout(sleepTimer); sleepTimer = null; }
    if (!minutes) { closePop(); return; }
    sleepTimer = setTimeout(() => {
      try {
        if (player?.pause) player.pause();
        else if (player?.stop) player.stop();
        else if (player?.close) player.close();
      } catch {}
      sleepTimer = null;
    }, minutes * 60 * 1000);
    closePop();
  }

  function clickGenre(name) {
    const li =
      document.querySelector(`#dd-genre-list li[data-val="${name}"]`) ||
      Array.from(document.querySelectorAll("#dd-genre-list li"))
        .find(x => (x.textContent||"").trim().toLowerCase() === String(name).toLowerCase());
    if (li) li.click();
    closePop();
  }

  function buildPop() {
    closePop();
    pop = document.createElement("div");
    pop.className = "am-mrx-pop";
    pop.innerHTML = `
      <div class="am-mrx-pop__grp">
        <div class="am-mrx-pop__hdr">Popular styles</div>
        <div class="am-mrx-pop__row">
          ${["Pop","Rock","Jazz","Hip-Hop","Electronic","Classical"].map(g =>
            `<button type="button" class="am-mrx-pop__chip" data-genre="${g}">${g}</button>`
          ).join("")}
        </div>
      </div>
      <div class="am-mrx-pop__sep"></div>
      <div class="am-mrx-pop__grp">
        <div class="am-mrx-pop__hdr">Sleep timer</div>
        <button type="button" class="am-mrx-pop__btn" data-sleep="20">Stop after 20 min</button>
        <button type="button" class="am-mrx-pop__btn" data-sleep="40">Stop after 40 min</button>
        <button type="button" class="am-mrx-pop__btn" data-sleep="60">Stop after 60 min</button>
        <button type="button" class="am-mrx-pop__btn am-mrx-pop__muted" data-sleep="0">Cancel timer</button>
      </div>
    `;
    document.body.appendChild(pop);

    pop.addEventListener("click", (e) => {
      const chip = e.target.closest(".am-mrx-pop__chip");
      if (chip) { clickGenre(chip.dataset.genre); return; }
      const b = e.target.closest("[data-sleep]");
      if (b) { setSleep(Number(b.dataset.sleep) || 0); return; }
    });

    // позиционируем и подписываемся на изменения
    requestAnimationFrame(placeUnderButton);
    window.addEventListener("scroll", placeUnderButton, { passive: true });
    window.addEventListener("resize", placeUnderButton);
    document.addEventListener("click", onDocClick, true);
    document.addEventListener("keydown", onEsc);
  }

  // Клик по кнопке — открыть/закрыть
  btn.addEventListener("click", (e) => {
    e.preventDefault();
    if (pop) { closePop(); return; }
    buildPop();
  });
}

```

---
## src/js/artists/features/modal.js

**size:** 11692 bytes &nbsp;&nbsp; **sha1:** `5e400c38554e7ef0bcacb117a202700162e24285`

```javascript
import { lockScroll, unlockScroll } from "../lib/scroll-lock.js";
import { UISound } from "../lib/sound.js";
import { fetchArtist, fetchArtistAlbums } from "./api.js";
import { createMiniPlayer } from "./player.js";
import { openZoom } from "./zoom.js";
import { getPrefetched } from "./prefetch.js";

import SPRITE_RAW from "../../../img/sprite.svg?raw";
const SPRITE_CONTAINER_ID = "GLOBAL_SVG_SPRITE";
function ensureSpriteMounted(doc = document) {
  if (doc.getElementById(SPRITE_CONTAINER_ID)) return;
  const wrap = doc.createElement("div");
  wrap.id = SPRITE_CONTAINER_ID;
  wrap.setAttribute("aria-hidden", "true");
  wrap.style.position = "absolute";
  wrap.style.width = "0";
  wrap.style.height = "0";
  wrap.style.overflow = "hidden";
  wrap.innerHTML = SPRITE_RAW;
  doc.body.prepend(wrap);
}
const icon = (id, cls = "ico") =>
  `<svg class="${cls}" aria-hidden="true"><use href="#${id}" xlink:href="#${id}"></use></svg>`;

const FALLBACK_IMG =
  "data:image/svg+xml;utf8," +
  encodeURIComponent(
    `<svg xmlns="http://www.w3.org/2000/svg" width="960" height="540">
      <rect width="100%" height="100%" fill="#0b0b0b"/>
      <text x="50%" y="50%" fill="#888" font-family="IBM Plex Sans,Arial,sans-serif"
            font-size="28" text-anchor="middle" dominant-baseline="middle">No image</text>
    </svg>`
  );

/* ---------- ensure modal shell ---------- */
function ensureModalShell(doc = document) {
  let modal = doc.querySelector("#artist-modal");
  if (modal) return modal;

  modal = doc.createElement("div");
  modal.id = "artist-modal";
  modal.className = "amodal";
  modal.setAttribute("hidden", "");
  modal.innerHTML = `
    <div class="amodal__backdrop"></div>
    <div class="amodal__dialog" role="dialog" aria-modal="true" aria-label="Artist details">
      <button id="am-close" class="amodal__close" type="button" aria-label="Close">×</button>
      <div id="am-body" class="amodal__body">
        <div class="amodal__loader loader"></div>
      </div>
    </div>`;
  doc.body.appendChild(modal);
  return modal;
}

/* ----------------- helpers ----------------- */
function fmtTime(msLike) {
  const ms = Number(msLike);
  if (!Number.isFinite(ms)) return "—";
  const total = Math.round(ms / 1000);
  const m = Math.floor(total / 60);
  const s = String(total % 60).padStart(2, "0");
  return `${m}:${s}`;
}
function years(d = {}) {
  const s = d.formedYear || d.intFormedYear || d.yearStart;
  const e = d.endedYear || d.intDisbandedYear || d.intDiedYear || d.yearEnd;
  if (s && e) return `${s}–${e}`;
  if (s) return `${s}–present`;
  return "information missing";
}
function trackRow(t = {}) {
  const title = t.title || t.strTrack || t.name || "—";
  const dur   = fmtTime(t.duration ?? t.intDuration ?? t.time);
  const link  = t.youtube || t.youtube_url || t.url || t.movie || t.strMusicVid || "";
  return `
    <li class="tr">
      <span>${title}</span>
      <span>${dur}</span>
      <span>${
        link
          ? `<a class="yt" href="${link}" target="_blank" rel="noopener noreferrer" aria-label="Play">
               ${icon("icon-icon_youtube_footer", "ico am-yt")}
             </a>`
          : `<span class="yt-ph"></span>`
      }</span>
    </li>`;
}
function dedupe(arr){const s=new Set(),r=[];for(const x of arr){if(x&&!s.has(x)){s.add(x);r.push(x)}}return r;}
function isMixRadioOn(){
  return !!document.querySelector('#random-radio[aria-pressed="true"], .toolbar__mixradio.is-active, body.mixradio-on');
}

/* ----------------- main ----------------- */
export function createArtistModal(rootEl = document) {
  ensureSpriteMounted(document);

  const modal =
    (rootEl && rootEl.querySelector ? rootEl.querySelector("#artist-modal") : null) ||
    document.querySelector("#artist-modal") ||
    ensureModalShell(document);

  const modalBody  = modal.querySelector("#am-body");
  const modalClose = modal.querySelector("#am-close");
  const dialog     = modal.querySelector(".amodal__dialog");

  // ЕДИНЫЙ мини-плеер для сайта:
  // 1) используем уже созданный глобально в index.js
  // 2) если его ещё нет (например, модалку открыли раньше) — создаём и регистрируем
  let player = (window.AM && window.AM.player) || null;
  if (!player) {
    player = createMiniPlayer();
    window.AM = window.AM || {};
    window.AM.player = player;
    document.dispatchEvent(new CustomEvent("am:player-ready", { detail: { player } }));
  }

  // Scroll-to-top в диалоге
  let scrollTopBtn = null;
  let onDialogScroll = null;
  let onWinResize    = null;

  function placeScrollTop() {
    try {
      const pad = 24;
      const r = dialog.getBoundingClientRect();
      const right = Math.max(pad, window.innerWidth - (r.left + r.width) + pad);
      scrollTopBtn.style.right  = `${right}px`;
      scrollTopBtn.style.bottom = `58px`;
    } catch {}
  }
  function ensureScrollTop() {
    if (!scrollTopBtn) {
      scrollTopBtn = document.createElement("button");
      scrollTopBtn.type = "button";
      scrollTopBtn.className = "amodal__scrolltop";
      scrollTopBtn.setAttribute("aria-label", "Scroll to top");
      scrollTopBtn.textContent = "↑";
      dialog.appendChild(scrollTopBtn);
      scrollTopBtn.addEventListener("click", () => {
        try { UISound?.tap?.(); } catch {}
        dialog.scrollTo({ top: 0, behavior: "smooth" });
      });
    }
    if (onDialogScroll) dialog.removeEventListener("scroll", onDialogScroll);
    if (onWinResize) {
      window.removeEventListener("resize", onWinResize);
      window.visualViewport?.removeEventListener("resize", onWinResize);
      window.removeEventListener("orientationchange", onWinResize);
    }
    onDialogScroll = () => {
      try {
        scrollTopBtn.style.display = (dialog.scrollTop || 0) > 220 ? "flex" : "none";
        placeScrollTop();
      } catch {}
    };
    dialog.addEventListener("scroll", onDialogScroll);

    onWinResize = () => { placeScrollTop(); };
    window.addEventListener("resize", onWinResize);
    window.visualViewport?.addEventListener("resize", onWinResize);
    window.addEventListener("orientationchange", onWinResize);

    placeScrollTop();
  }

  const onEsc = (e) => { if (e.key === "Escape") { try { UISound?.tap?.(); } catch {} close(); } };

  function open() {
    modal.removeAttribute("hidden");
    lockScroll();
    ensureScrollTop();
    if (scrollTopBtn) scrollTopBtn.style.display = "none";
    modalBody.innerHTML = `<div class="amodal__loader loader"></div>`;
    document.addEventListener("keydown", onEsc);
  }

  function close() {
    modal.setAttribute("hidden", "");
    unlockScroll();
    modalBody.innerHTML = "";
    document.removeEventListener("keydown", onEsc);

    if (onDialogScroll) { dialog.removeEventListener("scroll", onDialogScroll); onDialogScroll = null; }
    if (onWinResize) {
      window.removeEventListener("resize", onWinResize);
      window.visualViewport?.removeEventListener("resize", onWinResize);
      window.removeEventListener("orientationchange", onWinResize);
      onWinResize = null;
    }
    if (scrollTopBtn) scrollTopBtn.style.display = "none";
  }

  modalClose.addEventListener("click", () => { try { UISound?.tap?.(); } catch {} close(); });
  modal.addEventListener("click", (e) => {
    if (e.target.classList.contains("amodal__backdrop")) {
      try { UISound?.tap?.(); } catch {}
      close();
    }
  });

  // Делегирование: YouTube (очередь) и Zoom по картинке
  modal.addEventListener("click", (e) => {
    const a = e.target.closest("a.yt");
    if (a) {
      e.preventDefault();
      try { UISound?.tap?.(); } catch {}

      const links = Array.from(modal.querySelectorAll("a.yt"));
      const hrefs = dedupe(links.map((x) => x.href).filter(Boolean));
      let start = hrefs.indexOf(a.href);
      if (start < 0) start = 0;

      if (!hrefs.length) { player.open(a.href); return; }

      const mix = isMixRadioOn();
      player.openQueue(hrefs, { startIndex: start, shuffle: mix, loop: mix });
      return;
    }
    const zoomImg = e.target.closest(".amodal__img");
    if (zoomImg) {
      try { UISound?.tap?.(); } catch {}
      const src =
        zoomImg.currentSrc ||
        zoomImg.getAttribute("src") ||
        zoomImg.getAttribute("data-src") ||
        "";
      openZoom(src, zoomImg.getAttribute("alt") || "");
    }
  });

  async function render(artistId) {
    const cached = getPrefetched?.(String(artistId));

    const [artist, albums] = await Promise.all([
      cached?.artist ?? fetchArtist(artistId).catch(() => null),
      cached?.albums ?? fetchArtistAlbums(artistId).catch(() => []),
    ]);

    const d = artist || {};
    const name    = d.name || d.strArtist || "Unknown artist";
    const img     = d.image || d.strArtistThumb || FALLBACK_IMG;
    const country = d.country || d.strCountry || "N/A";
    const members = d.members || d.intMembers || "N/A";
    const sex     = d.gender  || d.strGender  || "N/A";
    const bio     = d.biography || d.strBiographyEN || "";
    const genres  = Array.isArray(d.genres) ? d.genres :
                    (d.genre ? [d.genre] : []);

    const albumsArr = Array.isArray(albums) ? albums : [];
    const albumsMarkup = albumsArr.map(alb => {
      const title  = alb?.title || alb?.strAlbum || alb?.name || "Album";
      const tracks = Array.isArray(alb?.tracks) ? alb.tracks :
                     (Array.isArray(alb?.songs) ? alb.songs : []);
      return `
        <div class="am-album">
          <div class="am-album__title">${title}</div>
          <ul class="tbl">
            <li class="th"><span>Track</span><span>Time</span><span>Link</span></li>
            ${tracks.map(trackRow).join("")}
          </ul>
        </div>`;
    }).join("");

    modalBody.innerHTML = `
      <h3 class="amodal__title">${name}</h3>

      <div class="amodal__content">
        <img class="amodal__img" src="${img}" alt="${name}" loading="lazy"
             onerror="this.onerror=null;this.src='${FALLBACK_IMG}'">
        <div class="amodal__info">
          <div class="am-meta">
            <div class="am-meta__col">
              <div class="am-meta__item"><span class="lbl">Years active</span><span class="val">${years(d)}</span></div>
              <div class="am-meta__item"><span class="lbl">Sex</span><span class="val">${sex}</span></div>
            </div>
            <div class="am-meta__col">
              <div class="am-meta__item"><span class="lbl">Members</span><span class="val">${members}</span></div>
              <div class="am-meta__item"><span class="lbl">Country</span><span class="val">${country}</span></div>
            </div>
          </div>

          <div class="am-bio">
            <div class="lbl">Biography</div>
            <p>${bio || "—"}</p>
          </div>

          ${genres.length ? `<div class="am-tags">${genres.map(g => `<span class="tag">${g}</span>`).join("")}</div>` : ""}
        </div>
      </div>

      <h4 class="amodal__albums-title">Albums</h4>
      <div class="amodal__albums">
        ${albumsMarkup || "<p class='muted'>No albums found for this artist.</p>"}
      </div>`;
  }

  async function openFor(id) {
    try { UISound?.tap?.(); } catch {}
    open();
    await render(id);
  }

  return { openFor, close };
}

```

---
## src/js/artists/features/player-patch.js

**size:** 7661 bytes &nbsp;&nbsp; **sha1:** `047646082143b5815c8006f9ae046de4106d082a`

```javascript
/*
  player-patch.js — patch-v1.4.0-2025-09-09
  Мост assistant:* ↔ публичное API плеера.
  Важно: не ломаем контракт событий и Player API.
*/

export default function mountPlayerPatch(player) {
  try { window.__AM_PLAYER_PATCH_INSTALLED__ = true; } catch {}

  if (!player || typeof player !== "object") {
    console.warn("[player-patch] No player instance provided");
    return;
  }

  const clamp01 = (x) => Math.max(0, Math.min(1, Number(x) || 0));

  // Разбор ID/URL
  function toVideoId(urlOrId) {
    const s = String(urlOrId || "").trim();
    if (!s) return "";
    if (/^[A-Za-z0-9_-]{11}$/.test(s)) return s;
    try {
      const u = new URL(s, location.href);
      if (/(^|\.)youtu\.be$/i.test(u.hostname)) {
        const cand = u.pathname.replace(/^\/+/, "");
        return /^[A-Za-z0-9_-]{11}$/.test(cand) ? cand : "";
      }
      const v = u.searchParams.get("v");
      if (v && /^[A-Za-z0-9_-]{11}$/.test(v)) return v;
      const m = u.pathname.match(/\/(?:embed|v|shorts)\/([^/?#]+)/i);
      if (m && m[1] && /^[A-Za-z0-9_-]{11}$/.test(m[1])) return m[1];
    } catch {}
    return "";
  }

  const MIX_SEEDS = [
    "random music mix",
    "popular hits playlist",
    "indie rock mix",
    "classic rock hits",
    "lofi chill beats to relax",
    "jazz essentials playlist",
    "hip hop classic mix",
    "ambient focus music long"
  ];

  const call = (name, ...args) => {
    const fn = player?.[name];
    if (typeof fn === "function") {
      try { return fn.apply(player, args); }
      catch (e) { console.warn(`[player-patch] ${name} failed`, e); }
    }
  };

  // Антидубль
  const recently = new Map();
  function dedup(key, ttl = 350) {
    const now = Date.now();
    const last = recently.get(key) || 0;
    if (now - last < ttl) return true;
    recently.set(key, now);
    return false;
  }

  // === PLAY ===
  window.addEventListener("assistant:play", (e) => {
    const rawId  = e?.detail?.id ?? "";
    const query  = e?.detail?.query ?? "";
    const key    = "play|" + JSON.stringify({ rawId, query });
    if (dedup(key)) return;

    const vid = toVideoId(rawId);
    if (vid) {
      call("open", vid);
    } else if (query && player.playSearch) {
      call("playSearch", String(query));
    } else if (rawId) {
      call("playSearch", String(rawId));
    }
  });

  // === MIXRADIO ===
  window.addEventListener("assistant:mixradio", () => {
    if (document.querySelector("#random-radio")) return;
    const seed = MIX_SEEDS[(Math.random() * MIX_SEEDS.length) | 0];
    if (player.playSearch) call("playSearch", seed);
  });

  // === TRANSPORT ===
  window.addEventListener("assistant:player-play",  () => call("play"));
  window.addEventListener("assistant:player-pause", () => call("pause"));
  window.addEventListener("assistant:player-stop",  () => call("stop"));
  window.addEventListener("assistant:player-next",  () => call("next"));
  window.addEventListener("assistant:player-prev",  () => call("prev"));

  // === UI ===
  window.addEventListener("assistant:minimize", () => call("minimize"));
  window.addEventListener("assistant:expand",   () => call("expand"));

  // === ГРОМКОСТЬ ===
  window.addEventListener("assistant:volume", (e) => {
    const d = Number(e?.detail?.delta || 0);
    if (!Number.isFinite(d)) return;
    if (typeof player.getVolume === "function" && typeof player.setVolume === "function") {
      const cur = Number(player.getVolume() || 0);
      call("setVolume", clamp01(cur + d));
    }
  });

  // === RECOMMEND (autoplay) ===
  window.addEventListener("assistant:recommend", (e) => {
    const a = e?.detail || {};
    if (!a || a.autoplay !== true) return;

    const looksLikeTrack = (s) => {
      const t = String(s || "").toLowerCase();
      return /["«»“”„‟]/.test(s) || t.includes(' - ') || /(official|audio|video|lyrics|remaster)/.test(t);
    };

    let q = "";
    if (a.like) {
      const like = String(a.like).trim();
      if (!like) return;
      // если похоже на конкретный трек → одиночный трек
      // иначе — хиты артиста (плейлист)
      q = looksLikeTrack(like)
        ? `${like} official audio`
        : `${like} greatest hits playlist`;
    } else if (a.genre) {
      const map = new Map([
        ["джаз", "best jazz music relaxing"],
        ["рок", "classic rock hits"],
        ["поп", "pop hits playlist"],
        ["электрон", "edm house techno mix"],
        ["lofi", "lofi hip hop radio"],
        ["классик", "classical symphony playlist"],
        ["рэп", "hip hop playlist"],
        ["инди", "indie rock playlist"],
        ["ambient", "ambient music long playlist"],
        ["блюз", "best blues songs playlist"],
        ["шансон", "russian chanson mix"],
        ["folk", "folk acoustic playlist"],
        ["rnb", "rnb soul classics playlist"],
        ["latin", "latin hits playlist"],
        ["reggae", "best reggae mix"],
        ["k-pop", "kpop hits playlist"],
        ["j-pop", "jpop hits playlist"],
        ["soundtrack", "movie soundtrack playlist"]
      ]);
      q = map.get(String(a.genre).toLowerCase()) || `${a.genre} music playlist`;
    } else if (a.mood) {
      const moods = new Map([
        ["happy", "upbeat feel good hits"],
        ["calm", "chillout ambient relaxing playlist"],
        ["sad", "sad indie playlist"],
        ["energetic", "energetic edm gym playlist"]
      ]);
      q = moods.get(String(a.mood).toLowerCase()) || "music playlist";
    }

    if (q && player.playSearch) call("playSearch", q);
  });

  // Совместимость doc→win, если нет внешнего bridge
  if (!(typeof window !== 'undefined' && window.__AH_BRIDGE_PRESENT === true)) {
    document.addEventListener("assistant:play",       (e) => window.dispatchEvent(new CustomEvent("assistant:play",       { detail: e.detail })));
    document.addEventListener("assistant:mixradio",   (e) => window.dispatchEvent(new CustomEvent("assistant:mixradio",   { detail: e.detail })));
    document.addEventListener("assistant:player-play",(e) => window.dispatchEvent(new CustomEvent("assistant:player-play",{ detail: e.detail })));
    document.addEventListener("assistant:player-pause",(e)=> window.dispatchEvent(new CustomEvent("assistant:player-pause",{ detail: e.detail })));
    document.addEventListener("assistant:player-stop",(e) => window.dispatchEvent(new CustomEvent("assistant:player-stop",{ detail: e.detail })));
    document.addEventListener("assistant:player-next",(e) => window.dispatchEvent(new CustomEvent("assistant:player-next",{ detail: e.detail })));
    document.addEventListener("assistant:player-prev",(e) => window.dispatchEvent(new CustomEvent("assistant:player-prev",{ detail: e.detail })));
    document.addEventListener("assistant:minimize",   (e) => window.dispatchEvent(new CustomEvent("assistant:minimize",   { detail: e.detail })));
    document.addEventListener("assistant:expand",     (e) => window.dispatchEvent(new CustomEvent("assistant:expand",     { detail: e.detail })));
    document.addEventListener("assistant:volume",     (e) => window.dispatchEvent(new CustomEvent("assistant:volume",     { detail: e.detail })));
    document.addEventListener("assistant:recommend",  (e) => window.dispatchEvent(new CustomEvent("assistant:recommend",  { detail: e.detail })));
  }
}


```

---
## src/js/artists/features/player.js

**size:** 36050 bytes &nbsp;&nbsp; **sha1:** `76631a3becc3a7971606ebeeb94fe193b868b66f`

```javascript
/* eslint-env browser */
/* global YT */

/**
 * Mini YouTube player (superset, v2.3.6)
 *
 * Что нового vs 2.3.5:
 * - Больше не передаём videoId в конструктор, если его нет (фикс "Invalid video id").
 * - Не передаём playerVars.origin, если origin === "null"/file://.
 * - В searchMode используем host https://www.youtube.com (а не nocookie) — стабильнее для listType:"search".
 * - Таймер прогресса работает без проверки ready; duration подтягивается на PLAYING.
 * - При переключении loadVideoById() не сбивает ready, не пересоздаёт iframe лишний раз.
 * - Autoplay helper: на старте делаем soft-автозапуск через mute→play, с безопасными повторными попытками.
 * - Stuck-guard: если PLAYING, но прогресс «не едет» — форсируем next(); ротация запросов в searchMode.
 * - Smart next: для одиночного видео без очереди — ре-поиск по артисту.
 * - Глобалка window.Player для консоли.
 */

let _instance = null;

/* -------------------- Debug -------------------- */
function dbg(...a) {
  try {
    if (typeof window !== 'undefined' && window.__AM_DEBUG__ === true) {
      // eslint-disable-next-line no-console
      console.log('[player]', ...a);
    }
  } catch {}
}

/* -------------------- Events -------------------- */
function emit(name, detail = {}) {
  try { window.dispatchEvent(new CustomEvent(`AM.player.${name}`, { detail })); } catch {}
}

/* -------------------- YT API -------------------- */
function loadYTAPI() {
  if (window.YT && window.YT.Player) return Promise.resolve();
  if (loadYTAPI._p) return loadYTAPI._p;
  loadYTAPI._p = new Promise((res, rej) => {
    const s = document.createElement("script");
    s.src = "https://www.youtube.com/iframe_api";
    s.onerror = () => rej(new Error("YT API load failed"));
    document.head.appendChild(s);
    const t = setTimeout(() => rej(new Error("YT API timeout")), 15000);
    window.onYouTubeIframeAPIReady = () => { clearTimeout(t); res(); };
  });
  return loadYTAPI._p;
}

const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

function getYouTubeId(urlOrId) {
  if (!urlOrId) return "";
  const s = String(urlOrId).trim();
  if (/^[A-Za-z0-9_-]{11}$/.test(s)) return s;
  try {
    const u = new URL(s, location.href);
    if (/(^|\.)youtu\.be$/i.test(u.hostname)) {
      const cand = u.pathname.replace(/^\/+/, "");
      return /^[A-Za-z0-9_-]{11}$/.test(cand) ? cand : "";
    }
    const v = u.searchParams.get("v");
    if (v && /^[A-Za-z0-9_-]{11}$/.test(v)) return v;
    const m = u.pathname.match(/\/(?:embed|shorts|v)\/([^/?#]+)/i);
    if (m && m[1] && /^[A-Za-z0-9_-]{11}$/.test(m[1])) return m[1];
  } catch {}
  return "";
}
const clamp = (v, a, b) => Math.min(b, Math.max(a, v));
const shuffleArr = (arr) => {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = (Math.random() * (i + 1)) | 0;
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
};
function fmtTimeSec(sec) {
  sec = Math.max(0, Math.round(Number(sec) || 0));
  const m = Math.floor(sec / 60);
  const s = String(sec % 60).padStart(2, "0");
  return `${m}:${s}`;
}

/* -------------------- Server search -------------------- */
const API_BASE =
  (import.meta?.env?.VITE_API_URL && import.meta.env.VITE_API_URL.replace(/\/+$/, "")) ||
  (location.hostname === "localhost" ? "http://localhost:8787" : "");

async function fetchYTSearchIds(q, max = 25) {
  if (!API_BASE) return [];
  try {
    const r = await fetch(`${API_BASE}/api/yt/search`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ q, max })
    });
    if (!r.ok) return [];
    const j = await r.json();
    const ids = Array.isArray(j?.ids) ? j.ids.filter(x => /^[A-Za-z0-9_-]{11}$/.test(x)) : [];
    dbg('server-search ids:', ids.length);
    return ids;
  } catch (e) {
    dbg('server-search error', e);
    return [];
  }
}

/* -------------------- Exported factory -------------------- */
export function createMiniPlayer() {
  if (_instance) return _instance;

  /* ---------- DOM ---------- */
  const dock = document.createElement("div");
  dock.className = "am-player";
  dock.innerHTML = `
    <div class="am-player__inner">
      <div class="am-player__dragzone" aria-hidden="true" title="Drag the player"></div>
      <button class="am-player__hide" type="button" aria-label="Hide">Hide</button>
      <button class="am-player__close" type="button" aria-label="Close">×</button>

      <div class="am-player__frame">
        <div class="am-player__host" id="am-player-host"></div>
        <a class="am-player__ytlink" href="#" target="_blank" rel="noopener noreferrer" aria-label="Open on YouTube">YouTube ↗</a>
      </div>

      <div class="am-player__bar">
        <div class="am-player__left">
          <button class="am-player__skip am-player__prev" type="button" aria-label="Previous">⏮</button>
          <button class="am-player__play" type="button" aria-label="Play/Pause">▶</button>
          <button class="am-player__skip am-player__next" type="button" aria-label="Next">⏭</button>
          <span class="am-player__time"><span class="am-player__cur">0:00</span> / <span class="am-player__dur">0:00</span></span>
        </div>

        <div class="am-player__progresswrap">
          <input class="am-player__progress" type="range" min="0" max="1000" value="0" step="1" aria-label="Seek">
        </div>

        <div class="am-player__right">
          <button class="am-player__mute" type="button" aria-label="Mute/Unmute">🔈</button>
          <input class="am-player__slider" type="range" min="0" max="100" value="60" step="1" aria-label="Volume">
        </div>
      </div>
    </div>
  `;
  document.body.appendChild(dock);

  let bubble = null;

  // refs
  const host     = dock.querySelector("#am-player-host");
  const btnClose = dock.querySelector(".am-player__close");
  const btnHide  = dock.querySelector(".am-player__hide");
  const btnPlay  = dock.querySelector(".am-player__play");
  const btnPrev  = dock.querySelector(".am-player__prev");
  const btnNext  = dock.querySelector(".am-player__next");
  const btnMute  = dock.querySelector(".am-player__mute");
  const vol      = dock.querySelector(".am-player__slider");
  const prog     = dock.querySelector(".am-player__progress");
  const tCur     = dock.querySelector(".am-player__cur");
  const tDur     = dock.querySelector(".am-player__dur");
  const dragzone = dock.querySelector(".am-player__dragzone");
  const aYTlink  = dock.querySelector(".am-player__ytlink");

  /* ---------- state ---------- */
  let yt = null;
  let ready = false;            // логический ready экземпляра
  let duration = 0;
  let timer = null;
  let muted = false;
  let volVal = 60;
  let userSeeking = false;

  let queue = [];
  let qi = -1;
  let loop = false;

  // searchMode — при фоллбэке на YT search playlist
  let searchMode = false;

  // анти-зацикливание / stuck-control
  let lastVidId = null;
  let sameIdPlays = 0;
  let lastQuery = '';
  let variantIndex = 0;
  let stuckTimer = null;
  let lastProgressT = 0;
  let lastProgressV = 0;

  // autoplay helper
  let autoplayTimer = null;

  const DOCK_KEY = "amPlayerPos";
  let dockDrag = null;

  const BUBBLE_KEY = "amBubblePos2";
  let bubbleDragging = false;
  let bubbleStart = null;
  let _bubblePos = null;

  let recentBubbleDrag = false;
  let watchdogId = null;
  let searchWatchdogId = null;

  if (isIOS) {
    vol.disabled = true;
    vol.title = "On iOS the volume is hardware-only";
  }

  /* ---------- UI helpers ---------- */
  function showBubble(useSaved = true) {
    if (!bubble) {
      bubble = document.createElement("button");
      bubble.className = "am-player__bubble is-paused";
      bubble.type = "button";
      bubble.setAttribute("aria-label", "Open player");
      bubble.style.display = "none";
      bubble.innerHTML = `<span class="note">♪</span>`;
      document.body.appendChild(bubble);

      bubble.addEventListener("click", (e) => {
        if (recentBubbleDrag) {
          recentBubbleDrag = false;
          e.preventDefault();
          e.stopPropagation();
          return;
        }
        uiMin(false);
      });

      bubble.addEventListener("pointerdown", (e) => {
        bubbleDragging = false;
        recentBubbleDrag = false;
        try { bubble.setPointerCapture(e.pointerId); } catch {}
        const r = bubble.getBoundingClientRect();
        bubbleStart = { x: e.clientX, y: e.clientY, left: r.left, top: r.top };
      });
      bubble.addEventListener("pointermove", (e) => {
        if (!bubbleStart) return;
        const dx = e.clientX - bubbleStart.x;
        const dy = e.clientY - bubbleStart.y;
        if (Math.abs(dx) + Math.abs(dy) > 3) bubbleDragging = true;
        bubble.style.left = `${(bubbleStart.left + dx) | 0}px`;
        bubble.style.top  = `${(bubbleStart.top  + dy) | 0}px`;
      });
      bubble.addEventListener("pointerup", (e) => {
        try { bubble.releasePointerCapture(e.pointerId); } catch {}
        recentBubbleDrag = !!bubbleDragging;
        bubbleStart = null;
        bubbleDragging = false;
        clampBubbleToViewport(); persistBubblePos();
      });
      bubble.addEventListener("pointercancel", () => {
        recentBubbleDrag = !!bubbleDragging;
        bubbleStart = null;
        bubbleDragging = false;
      });
      window.addEventListener("resize", () => { clampBubbleToViewport(); persistBubblePos(); });
      window.visualViewport?.addEventListener("resize", () => { clampBubbleToViewport(); persistBubblePos(); });
      window.addEventListener("orientationchange", () => { clampBubbleToViewport(); persistBubblePos(); });
    }
    bubble.style.display = "grid";
    restoreBubblePos(useSaved);
  }
  function hideBubble() { if (bubble) bubble.style.display = "none"; }
  function setBubblePulse(isPlaying) {
    if (!bubble) return;
    bubble.classList.toggle("is-paused", !isPlaying);
  }
  function setBubbleAmp(v) {
    if (!bubble) return;
    const amp = 1.02 + (Math.max(0, Math.min(100, v)) / 100) * 0.08;
    bubble.style.setProperty("--amp", amp.toFixed(3));
  }
  function clampBubbleToViewport(margin = 8) {
    if (!bubble || bubble.style.display === "none") return;
    const w = window.innerWidth, h = window.innerHeight;
    const r = bubble.getBoundingClientRect();
    let left = clamp(r.left, margin, Math.max(margin, w - r.width - margin));
    let top  = clamp(r.top,  margin, Math.max(margin, h - r.height - margin));
    bubble.style.left = `${left}px`;
    bubble.style.top  = `${top}px`;
  }
  function persistBubblePos() {
    if (!bubble || bubble.style.display === "none") return;
    const r = bubble.getBoundingClientRect();
    const w = Math.max(1, window.innerWidth  - r.width);
    const h = Math.max(1, window.innerHeight - r.height);
    _bubblePos = { rx: clamp(r.left / w, 0, 1), ry: clamp(r.top / h, 0, 1) };
    try { localStorage.setItem(BUBBLE_KEY, JSON.stringify(_bubblePos)); } catch {}
  }
  function restoreBubblePos(useSaved = true) {
    if (!bubble) return;
    const r0 = bubble.getBoundingClientRect();
    let left, top;
    if (useSaved) {
      try {
        const pos = JSON.parse(localStorage.getItem(BUBBLE_KEY) || "null");
        if (pos && Number.isFinite(pos.rx) && Number.isFinite(pos.ry)) {
          const w = Math.max(1, window.innerWidth  - r0.width);
          const h = Math.max(1, window.innerHeight - r0.height);
          left = clamp(Math.round(pos.rx * w), 8, w);
          top  = clamp(Math.round(pos.ry * h), 8, h);
        }
      } catch {}
    }
    if (!Number.isFinite(left) || !Number.isFinite(top)) {
      const w = window.innerWidth, h = window.innerHeight;
      const size = r0.width || 64;
      left = Math.max(8, Math.round((w - size) / 2));
      top  = Math.max(8, Math.round(h - size - 24));
    }
    bubble.style.left = `${left}px`;
    bubble.style.top  = `${top}px`;
    clampBubbleToViewport();
  }

  function uiPlayIcon(isPlaying) { btnPlay.textContent = isPlaying ? "⏸" : "▶"; }
  function uiMuteIcon(isMuted)   { btnMute.textContent = isMuted ? "🔇" : "🔈"; }

  function uiShow(on) {
    dock.classList.toggle("am-player--active", !!on);
    const isMin = dock.classList.contains("am-player--min");
    if (on) {
      if (!isMin) hideBubble();
    } else {
      hideBubble();
    }
    emit("state", { active: !!on });
  }
  function uiMin(on) {
    dock.classList.toggle("am-player--min", !!on);
    if (on) showBubble(true);
    else hideBubble();
    emit(on ? "minimized" : "expanded", {});
  }

  function uiSetTime(cur, dur) {
    tCur.textContent = fmtTimeSec(cur);
    tDur.textContent = fmtTimeSec(dur);
    if (!userSeeking) {
      const v = dur > 0 ? Math.round((cur / dur) * 1000) : 0;
      prog.value = String(v);
    }
  }
  function clearTimer() { if (timer) { clearInterval(timer); timer = null; } }
  function startTimer() {
    clearTimer();
    timer = setInterval(() => {
      if (!yt || typeof yt.getCurrentTime !== "function") return;
      const cur = yt.getCurrentTime() || 0;
      const d = (typeof yt.getDuration === "function" ? yt.getDuration() : 0) || duration || 0;
      if (d > 0) duration = d;
      uiSetTime(cur, duration);
      lastProgressT = Date.now();
      lastProgressV = cur;
    }, 250);
  }
  function clearWatchdog() { if (watchdogId) { clearTimeout(watchdogId); watchdogId = null; } }
  function clearSearchWatch() { if (searchWatchdogId) { clearTimeout(searchWatchdogId); searchWatchdogId = null; } }
  function clearStuckGuard() { if (stuckTimer) { clearTimeout(stuckTimer); stuckTimer = null; } }
  function clearAutoplayTimer() { if (autoplayTimer) { clearTimeout(autoplayTimer); autoplayTimer = null; } }

  /* ---------- playlist hydrate ---------- */
  function hydrateFromYTPlaylist() {
    if (searchMode) return;
    if (!yt || typeof yt.getPlaylist !== "function") return;
    try {
      const pl = yt.getPlaylist() || [];
      if (Array.isArray(pl) && pl.length) {
        queue = pl.slice();
        qi = typeof yt.getPlaylistIndex === "function" ? (yt.getPlaylistIndex() | 0) : 0;
      }
    } catch {}
  }

  /* ---------- stuck helpers ---------- */
  const VARIANTS = (base) => [
    `${base} official audio`,
    `${base} greatest hits playlist`,
    `${base} mix`,
    `${base}`
  ];

  function armStuckGuard() {
    clearStuckGuard();
    stuckTimer = setTimeout(() => {
      try {
        const s = yt?.getPlayerState?.();
        const cur = yt?.getCurrentTime?.() || 0;
        const idle = Date.now() - (lastProgressT || 0);
        if (s === YT.PlayerState.PLAYING && idle > 6000 && Math.abs(cur - (lastProgressV || 0)) < 1) {
          dbg('stuck-guard: forcing next');
          if (searchMode) yt?.nextVideo?.(); else smartNextFromCurrent();
        }
      } catch {}
    }, 7000);
  }

  function markIdAndMaybeRotate(id) {
    if (!id) return;
    if (id === lastVidId) sameIdPlays++;
    else { lastVidId = id; sameIdPlays = 1; }
    dbg('PLAYING id:', id, 'same plays:', sameIdPlays, 'searchMode:', searchMode);

    if (searchMode && sameIdPlays >= 3) {
      sameIdPlays = 0;
      dbg('dup id → next/rotate');
      yt?.nextVideo?.();
      setTimeout(() => {
        try {
          const curId = yt?.getVideoData?.()?.video_id || '';
          if (curId === id && lastQuery) {
            variantIndex = (variantIndex + 1) % VARIANTS(lastQuery).length;
            const alt = VARIANTS(lastQuery)[variantIndex];
            dbg('rotate variant →', alt);
            playSearch(alt);
          }
        } catch {}
      }, 1200);
    }
  }

  /* ---------- autoplay helper ---------- */
  function tryAutoplaySoft() {
    clearAutoplayTimer();
    autoplayTimer = setTimeout(() => {
      try {
        const st = yt?.getPlayerState?.();
        if (st !== YT.PlayerState.PLAYING) {
          // soft-автостарт: mute → play
          const wasMuted = yt?.isMuted?.() || false;
          yt?.mute?.();
          yt?.playVideo?.();
          setTimeout(() => { if (!wasMuted) yt?.unMute?.(); }, 600);
        }
      } catch {}
    }, 450);
  }

  /* ---------- YT ---------- */
  function skipWithDelay(ms = 2000) { setTimeout(autoNext, ms); }

  function currentHostForMode() {
    // searchMode требует обычный youtube-хост
    return searchMode ? "https://www.youtube.com" : "https://www.youtube-nocookie.com";
  }

  function safePlayerVars(hasInitialId) {
    const pv = {
      rel: 0,
      modestbranding: 1,
      controls: 1,
      enablejsapi: 1
    };
    // autoplay в конструкторе — только если есть валидный id
    if (hasInitialId) pv.autoplay = 1;

    // origin не указываем на file:// и "null"
    try {
      const isFile = location.protocol === 'file:' || location.origin === 'null';
      if (!isFile) pv.origin = location.origin;
    } catch {}
    return pv;
  }

  async function ensureYT(initialVideoId) {
    await loadYTAPI();

    // Если уже есть плеер, но хост не совпадает с нужным для режима — пересоздадим
    const needHost = currentHostForMode();
    const mustRecreate = !yt || !yt?.getIframe || (() => {
      try {
        const iframe = yt.getIframe();
        const url = new URL(iframe?.src || '', location.href);
        return !url.origin || !url.origin.startsWith(needHost);
      } catch { return true; }
    })();

    if (mustRecreate) {
      if (yt) { try { yt.destroy(); } catch {} yt = null; }
      host.innerHTML = `<div id="am-player-yt"></div>`;
      const cfg = {
        host: needHost,
        playerVars: safePlayerVars(!!initialVideoId),
        events: {
          onReady: () => {
            ready = true;
            duration = yt.getDuration?.() || 0;
            uiSetTime(0, duration);
            if (!isIOS && typeof yt.setVolume === "function") yt.setVolume(volVal);
            if (muted && yt.mute) yt.mute();
            uiPlayIcon(!!initialVideoId);
            setBubblePulse(!!initialVideoId);
            setBubbleAmp(volVal);
            startTimer();
            emit("ready", {});
            armStuckGuard();
            tryAutoplaySoft();

            clearWatchdog();
            if (initialVideoId) {
              watchdogId = setTimeout(() => {
                try {
                  if (yt && yt.getPlayerState && yt.getPlayerState() !== YT.PlayerState.PLAYING) {
                    setBubblePulse(false);
                    skipWithDelay(0);
                  }
                } catch {}
              }, 6000);
            }
          },
          onStateChange: (e) => {
            emit("state", { state: e.data });

            if (e.data === YT.PlayerState.PLAYING) {
              clearWatchdog();
              clearSearchWatch();
              clearStuckGuard();
              clearAutoplayTimer();
              uiPlayIcon(true);
              setBubblePulse(true);
              // duration часто инициализируется только тут
              const d = yt.getDuration?.() || 0;
              if (d > 0) duration = d;
              startTimer();
              try {
                const url = yt.getVideoUrl?.();
                if (url) aYTlink.href = url;
                const vd = yt.getVideoData?.();
                if (vd && vd.video_id) {
                  emit("track", { id: vd.video_id, title: vd.title || "" });
                  markIdAndMaybeRotate(vd.video_id);
                }
                hydrateFromYTPlaylist();
              } catch {}
            } else if (e.data === YT.PlayerState.PAUSED) {
              uiPlayIcon(false);
              setBubblePulse(false);
              clearTimer();
              emit("pause", {});
            } else if (e.data === YT.PlayerState.ENDED) {
              uiPlayIcon(false);
              setBubblePulse(false);
              clearTimer();
              clearWatchdog();
              clearStuckGuard();
              clearAutoplayTimer();
              emit("ended", {});
              if (window.__AM_SLEEP_AFTER__) {
                try { window.__AM_SLEEP_AFTER__ = false; } catch {}
                stop();
                return;
              }
              autoNext();
            }
          },
          // ⬇⬇⬇ ИЗМЕНЕНО: обработка ошибок с мгновенным skip для embed-кодов 2/5/100/101/150
          onError: (e) => {
            const code = (e && (e.data ?? e.code)) ?? 0;
            emit("error", { code });
            dbg('YT error', code, e);
            uiPlayIcon(false);
            setBubblePulse(false);
            clearTimer();
            clearWatchdog();
            clearSearchWatch();
            clearStuckGuard();
            clearAutoplayTimer();

            // Эти коды почти всегда означают "невстраиваемо/заблокировано"
            if ([2, 5, 100, 101, 150].includes(code)) {
              try {
                if (searchMode) { yt?.nextVideo?.(); } else { next(); }
              } catch {
                skipWithDelay(0);
              }
              return;
            }

            // Прочие ошибки — мягкий skip с небольшой задержкой
            skipWithDelay(1200);
          }
          // ▲▲▲ КОНЕЦ ИЗМЕНЕНИЙ
        }
      };
      // Добавляем videoId ТОЛЬКО если он валидный
      if (initialVideoId && /^[\w-]{11}$/.test(initialVideoId)) {
        cfg.videoId = initialVideoId;
        cfg.playerVars.autoplay = 1;
      }
      yt = new YT.Player("am-player-yt", cfg);
    } else {
      // Плеер уже подходящий — просто убедимся что ready и таймер крутится
      ready = true;
      startTimer();
      tryAutoplaySoft();
    }
  }

  /* ---------- Queue ---------- */
  async function playByIndex(idx, opts = {}) {
    if (!queue.length) return;

    // Явный переход по индексам — это локальная очередь → выключаем searchMode
    searchMode = false;

    qi = clamp(idx, 0, queue.length - 1);
    const id = queue[qi];
    if (!id || !/^[\w-]{11}$/.test(id)) {
      return skipWithDelay(0);
    }
    aYTlink.href = `https://www.youtube.com/watch?v=${id}`;

    const reveal = opts.reveal ?? true;
    if (reveal) {
      uiMin(false);
      uiShow(true);
      restoreDockPos();
    } else {
      if (!dock.classList.contains("am-player--active")) uiShow(true);
    }

    duration = 0; clearTimer(); clearWatchdog(); clearStuckGuard(); clearAutoplayTimer();
    try {
      await ensureYT(null); // НЕ передаём videoId здесь, будем грузить loadVideoById
      ready = true;
      yt.loadVideoById({ videoId: id });
      tryAutoplaySoft();
    } catch { skipWithDelay(1200); }
  }

  function autoNext() {
    if (queue.length && !searchMode) {
      if (qi < queue.length - 1) playByIndex(qi + 1, { reveal: false });
      else if (loop) playByIndex(0, { reveal: false });
      else if (yt && yt.nextVideo) yt.nextVideo();
    } else if (yt && yt.nextVideo) {
      yt.nextVideo();
      armStuckGuard();
    }
  }

  /* ---------- Drag Dock ---------- */
  function getVP() {
    const w = window.visualViewport?.width || document.documentElement.clientWidth || window.innerWidth;
    const h = window.visualViewport?.height || document.documentElement.clientHeight || window.innerHeight;
    return { w, h };
  }
  function clampDock() {
    if (!dock.classList.contains("am-player--free")) return;
    const rect = dock.getBoundingClientRect();
    const { w, h } = getVP();
    let left = clamp(rect.left, 8, Math.max(8, w - rect.width - 8));
    let top  = clamp(rect.top,  8, Math.max(8, h - rect.height - 8));
    dock.style.left = `${left}px`;
    dock.style.top  = `${top}px`;
    try { localStorage.setItem(DOCK_KEY, JSON.stringify({ left, top })); } catch {}
  }
  function restoreDockPos() {
    let pos = null;
    try { pos = JSON.parse(localStorage.getItem(DOCK_KEY) || "null"); } catch {}
    if (pos && Number.isFinite(pos.left) && Number.isFinite(pos.top)) {
      dock.classList.add("am-player--free");
      dock.style.transform = "none";
      dock.style.left = `${pos.left}px`;
      dock.style.top  = `${pos.top}px`;
      dock.style.right = "auto";
      dock.style.bottom = "auto";
      clampDock();
    } else {
      dock.classList.remove("am-player--free");
      dock.style.left = dock.style.top = dock.style.right = dock.style.bottom = "";
      dock.style.transform = "";
    }
  }
  function beginDockDrag(e) {
    if (!dock.classList.contains("am-player--free")) {
      const r = dock.getBoundingClientRect();
      dock.classList.add("am-player--free");
      dock.style.transform = "none";
      dock.style.left = `${r.left}px`;
      dock.style.top  = `${r.top}px`;
      dock.style.right = "auto";
      dock.style.bottom = "auto";
    }
    dockDrag = {
      startX: e.clientX,
      startY: e.clientY,
      baseLeft: parseFloat(dock.style.left || "0"),
      baseTop:  parseFloat(dock.style.top || "0"),
    };
    dragzone.classList.add("dragging");
    try { dragzone.setPointerCapture?.(e.pointerId); } catch {}
  }
  function moveDockDrag(e) {
    if (!dockDrag) return;
    let left = dockDrag.baseLeft + (e.clientX - dockDrag.startX);
    let top  = dockDrag.baseTop  + (e.clientY - dockDrag.startY);
    const r = dock.getBoundingClientRect();
    const { w, h } = getVP();
    left = clamp(left, 8, Math.max(8, w - r.width - 8));
    top  = clamp(top,  8, Math.max(8, h - r.height - 8));
    dock.style.left = `${left}px`;
    dock.style.top  = `${top}px`;
  }
  function endDockDrag(e) {
    if (!dockDrag) return;
    try { dragzone.releasePointerCapture?.(e.pointerId); } catch {}
    dragzone.classList.remove("dragging");
    dockDrag = null;
    clampDock();
  }
  dragzone.addEventListener("pointerdown", beginDockDrag);
  window.addEventListener("pointermove", moveDockDrag);
  window.addEventListener("pointerup", endDockDrag);
  window.addEventListener("resize", clampDock);
  window.visualViewport?.addEventListener("resize", clampDock);
  window.addEventListener("orientationchange", clampDock);

  /* ---------- Buttons ---------- */
  btnClose.addEventListener("click", () => {
    try { yt?.stopVideo?.(); yt?.destroy?.(); } catch {}
    yt = null; ready = false; duration = 0; clearTimer(); clearWatchdog(); clearSearchWatch(); clearStuckGuard(); clearAutoplayTimer();
    uiShow(false); uiMin(false);
    queue = []; qi = -1;
    searchMode = false;
    lastVidId = null; sameIdPlays = 0; lastQuery = ''; variantIndex = 0;
    setBubblePulse(false);
  });
  btnHide.addEventListener("click", () => { uiMin(true); });

  aYTlink.addEventListener("click", () => {
    try { yt?.stopVideo?.(); yt?.destroy?.(); } catch {}
    yt = null; ready = false; duration = 0; clearTimer(); clearWatchdog(); clearSearchWatch(); clearStuckGuard(); clearAutoplayTimer();
    uiShow(false); uiMin(false);
    queue = []; qi = -1;
    searchMode = false;
    lastVidId = null; sameIdPlays = 0; lastQuery = ''; variantIndex = 0;
    setBubblePulse(false);
  });

  btnPlay.addEventListener("click", () => {
    if (!yt) return;
    const s = yt.getPlayerState ? yt.getPlayerState() : -1;
    if (s === YT.PlayerState.PLAYING) { yt.pauseVideo?.(); uiPlayIcon(false); setBubblePulse(false); }
    else { yt.playVideo?.(); uiPlayIcon(true); setBubblePulse(true); armStuckGuard(); }
  });
  btnPrev.addEventListener("click", () => {
    if (queue.length && !searchMode) { playByIndex(qi > 0 ? qi - 1 : (loop ? queue.length - 1 : 0), { reveal: true }); }
    else { yt?.previousVideo?.(); armStuckGuard(); }
  });
  btnNext.addEventListener("click", () => { next(); });

  btnMute.addEventListener("click", () => {
    if (!yt) return;
    muted = !muted;
    if (muted) yt.mute?.(); else yt.unMute?.();
    uiMuteIcon(muted);
  });
  vol.addEventListener("input", () => {
    const v = Number(vol.value) || 0;
    volVal = v;
    if (!isIOS) yt?.setVolume?.(v);
    if (v === 0 && !muted) { muted = true; yt?.mute?.(); uiMuteIcon(true); }
    else if (v > 0 && muted) { muted = false; yt?.unMute?.(); uiMuteIcon(false); }
    setBubbleAmp(v);
  });
  prog.addEventListener("input", () => {
    userSeeking = true;
    const v = Number(prog.value) || 0;
    const sec = duration > 0 ? (v / 1000) * duration : 0;
    tCur.textContent = fmtTimeSec(sec);
  });
  prog.addEventListener("change", () => {
    userSeeking = false;
    if (!yt || !duration) return;
    const v = Number(prog.value) || 0;
    const sec = (v / 1000) * duration;
    yt.seekTo?.(sec, true);
  });

  /* ---------- Public API ---------- */
  async function open(urlOrId) {
    const id = getYouTubeId(urlOrId);
    if (!id) {
      const q = String(urlOrId || "").trim();
      if (q) return playSearch(q);
      return;
    }
    searchMode = false;
    lastQuery = ''; variantIndex = 0;
    queue = [id]; qi = 0;
    uiMin(false); uiShow(true); restoreDockPos();
    await playByIndex(0, { reveal: true });
  }

  async function openQueue(list, opts = {}) {
    const ids = (list || []).map(getYouTubeId).filter(Boolean);
    if (!ids.length) return;
    searchMode = false;
    lastQuery = ''; variantIndex = 0;
    loop = !!opts.loop;
    const arr = opts.shuffle ? shuffleArr(ids) : ids.slice();
    queue = arr;
    const start = clamp(Number(opts.startIndex ?? 0) || 0, 0, queue.length - 1);
    uiMin(false); uiShow(true); restoreDockPos();
    await playByIndex(start, { reveal: true });
  }

  async function smartNextFromCurrent() {
    try {
      const vd = yt?.getVideoData?.();
      const title = (vd?.title || "").trim();
      const author = (vd?.author || "").trim();
      const artist = title.includes('-') ? title.split('-')[0].trim() : author;
      if (artist) {
        dbg('smartNextFromCurrent(): re-search by', artist);
        await playSearch(artist);
      } else if (author) {
        await playSearch(author);
      }
    } catch (e) {
      dbg('smartNextFromCurrent() failed', e);
    }
  }

  function next() {
    if (queue.length && !searchMode) {
      const reveal = !dock.classList.contains("am-player--min");
      playByIndex(qi < queue.length - 1 ? qi + 1 : (loop ? 0 : qi), { reveal });
    } else {
      if (searchMode) {
        yt?.nextVideo?.();
        armStuckGuard();
      } else {
        smartNextFromCurrent();
      }
    }
  }
  function prev() {
    if (queue.length && !searchMode) {
      const reveal = !dock.classList.contains("am-player--min");
      playByIndex(qi > 0 ? qi - 1 : (loop ? queue.length - 1 : 0), { reveal });
    } else {
      yt?.previousVideo?.();
      armStuckGuard();
    }
  }

  function play() {
    if (yt && ready) { yt.playVideo?.(); uiPlayIcon(true); setBubblePulse(true); armStuckGuard(); return; }
    if (queue.length && !searchMode) { playByIndex(qi < 0 ? 0 : qi, { reveal: false }); return; }
  }
  function pause() {
    try { yt?.pauseVideo?.(); } catch {}
    uiPlayIcon(false); setBubblePulse(false);
  }
  function stop() {
    try { yt?.stopVideo?.(); } catch {}
    uiPlayIcon(false); setBubblePulse(false);
  }
  function setVolume01(x) {
    const v = clamp(Math.round((Number(x)||0)*100), 0, 100);
    volVal = v; vol.value = String(v);
    if (!isIOS) yt?.setVolume?.(v);
    if (v === 0 && !muted) { muted = true; yt?.mute?.(); uiMuteIcon(true); }
    else if (v > 0 && muted) { muted = false; yt?.unMute?.(); uiMuteIcon(false); }
    setBubbleAmp(v);
  }
  function getVolume01() { return (volVal||0)/100; }
  function minimize()     { if (dock.classList.contains("am-player--active")) uiMin(true); }
  function expand()       { uiMin(false); uiShow(true); restoreDockPos(); }

  function isActive()     { return dock.classList.contains("am-player--active"); }
  function isMinimized()  { return isActive() && dock.classList.contains("am-player--min"); }
  function hasQueue()     { return Array.isArray(queue) && queue.length > 0; }
  function close()        { btnClose.click(); }

  async function playSearch(query) {
    const q = String(query || "").trim();
    if (!q) return;
    uiMin(false); uiShow(true); restoreDockPos();

    lastQuery = q; variantIndex = 0; sameIdPlays = 0; lastVidId = null;

    // 1) Серверный поиск с кэшем и фильтрами
    const ids = await fetchYTSearchIds(q, 25);
    if (ids.length > 1) {
      await openQueue(ids, { shuffle: false, startIndex: 0 });
      return;
    } else if (ids.length === 1) {
      await open(ids[0]);
      return;
    }

    // 2) Фоллбэк — встроенный поисковый плейлист YouTube
    searchMode = true;
    queue = []; qi = -1;
    await ensureYT(null);
    try {
      yt.loadPlaylist({ listType: "search", list: q, index: 0 });
      yt.playVideo?.();
      clearSearchWatch();
      searchWatchdogId = setTimeout(() => {
        try {
          const st = yt.getPlayerState?.();
          if (st !== YT.PlayerState.PLAYING) yt.playVideo?.();
        } catch {}
      }, 1000);
      aYTlink.href = "#";
      uiPlayIcon(true);
      setBubblePulse(true);
      startTimer();
      tryAutoplaySoft();
      armStuckGuard();
    } catch (e) {
      dbg("[player.playSearch] loadPlaylist failed, try cuePlaylist()", e);
      try { yt.cuePlaylist?.({ listType: "search", list: q, index: 0 }); yt.playVideo?.(); armStuckGuard(); } catch {}
    }
  }

  _instance = {
    open, openQueue, next, prev,
    play, pause, stop, setVolume: setVolume01, getVolume: getVolume01, expand,
    minimize, isActive, isMinimized, hasQueue, close,
    playSearch
  };
  return _instance;
}

/* ---------- Default export & global ---------- */
function get() { return _instance || createMiniPlayer(); }

const Player = {
  open:       (x) => get().open(x),
  openQueue:  (l,o) => get().openQueue(l,o),
  next:       () => get().next(),
  prev:       () => get().prev(),
  play:       () => get().play(),
  pause:      () => get().pause(),
  stop:       () => get().stop(),
  setVolume:  (x) => get().setVolume(x),
  getVolume:  () => get().getVolume(),
  minimize:   () => get().minimize(),
  expand:     () => get().expand(),
  isActive:   () => get().isActive(),
  isMinimized:() => get().isMinimized(),
  hasQueue:   () => get().hasQueue(),
  close:      () => get().close(),
  playSearch: (q) => get().playSearch(q),
};

export default Player;

// Глобалка для консоли и внешних скриптов
if (typeof window !== 'undefined') { window.Player = Player; }



```

---
## src/js/artists/features/prefetch.js

**size:** 1367 bytes &nbsp;&nbsp; **sha1:** `886f15a116070d118e77fbe29e03f1187fa8a045`

```javascript
// Предзагрузка данных артиста при hover на “Learn more” >150мс.

import { fetchArtist, fetchArtistAlbums } from "./api.js";

const cache = new Map(); // id -> { artist, albums, ts }

export function getPrefetched(id) {
  return cache.get(String(id));
}

export function initPrefetch(root) {
  const grid = root.querySelector("#artists-grid");
  if (!grid) return;

  let hoverTimer = null;
  let hoverId = null;

  function schedulePrefetch(id) {
    clearTimeout(hoverTimer);
    hoverTimer = setTimeout(async () => {
      try {
        if (cache.has(id)) return;
        const [artist, albums] = await Promise.all([
          fetchArtist(id),
          fetchArtistAlbums(id),
        ]);
        cache.set(id, { artist, albums, ts: Date.now() });
      } catch { /* тихо игнорим */ }
    }, 150);
  }

  grid.addEventListener("mouseenter", (e) => {
    const btn = e.target.closest('[data-action="more"]');
    if (!btn) return;
    const id = btn.closest(".card")?.dataset?.id;
    if (!id) return;
    hoverId = String(id);
    schedulePrefetch(hoverId);
  }, true);

  grid.addEventListener("mouseleave", (e) => {
    if (e.target.closest('[data-action="more"]')) {
      clearTimeout(hoverTimer);
      hoverTimer = null;
      hoverId = null;
    }
  }, true);
}

```

---
## src/js/artists/features/router.js

**size:** 1419 bytes &nbsp;&nbsp; **sha1:** `a2572fe65e8b6bc170a4e4f76cc086a0344cc717`

```javascript
// URL-sync для секции Artists: читает состояние из query при старте,
// и поддерживает актуальный query при изменении state (replaceState).

import { getState, setState, subscribe } from "./state.js";

function parseQuery() {
  const p = new URLSearchParams(location.search);
  const q = (p.get("q") || "").trim();
  const genre = p.get("genre") || "";
  const sort = p.get("sort") || "";
  const page = Math.max(1, Number(p.get("page") || 1));
  return { q, genre, sort, page };
}

function buildQuery(s) {
  const p = new URLSearchParams();
  if (s.q) p.set("q", s.q);
  if (s.genre) p.set("genre", s.genre);
  if (s.sort) p.set("sort", s.sort);
  if (s.page && s.page !== 1) p.set("page", String(s.page));
  return p.toString();
}

export function initRouter() {
  
  const urlState = parseQuery();
  const cur = getState();
  const patch = {};
  let changed = false;
  for (const k of ["q","genre","sort","page"]) {
    if (urlState[k] !== undefined && urlState[k] !== cur[k]) {
      patch[k] = urlState[k];
      changed = true;
    }
  }
  if (changed) setState(patch);

  
  let lastQS = null;
  subscribe((s) => {
    const qs = buildQuery(s);
    if (qs === lastQS) return;
    lastQS = qs;
    const url = qs ? `?${qs}` : location.pathname;
    history.replaceState(null, "", url);
  });
}

```

---
## src/js/artists/features/state.js

**size:** 4969 bytes &nbsp;&nbsp; **sha1:** `39bf1a97bd78559d76218eb4fd4002d91fa5809e`

```javascript
// src/js/artists/features/state.js

const STORAGE_KEY = "artistsStateV2";

const initial = {
  page: 1,
  limit: 8,            // базовый лимит для Default
  genre: "",
  sort: "",
  q: "",
  isMobilePanelOpen: false,
};

// Текущее состояние
let state = { ...initial };

// Флаг и слушатели
let storageLoaded = false;
const listeners = new Set();

/* ---------------- storage helpers ---------------- */
function canUseStorage() {
  try {
    const k = "__probe__";
    localStorage.setItem(k, "1");
    localStorage.removeItem(k);
    return true;
  } catch {
    return false;
  }
}

function loadFromStorage() {
  if (storageLoaded) return;
  storageLoaded = true;
  if (!canUseStorage()) return;

  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    const obj = JSON.parse(raw);
    state = {
      page: Math.max(1, Number(obj?.page) || initial.page),
      limit: Math.max(1, Number(obj?.limit) || initial.limit),
      genre: String(obj?.genre ?? initial.genre),
      sort: String(obj?.sort ?? initial.sort),
      q: String(obj?.q ?? initial.q),
      isMobilePanelOpen: !!obj?.isMobilePanelOpen,
    };
  } catch {
    // игнор
  }
}

function saveToStorage() {
  if (!storageLoaded || !canUseStorage()) return;
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  } catch {
    // квота/приватный режим — молча
  }
}

/* ---------------- pub/sub ---------------- */
function notify() {
  const snap = { ...state };
  for (const fn of listeners) {
    try { fn(snap); } catch {}
  }
}

/** Подписка на изменения состояния. Возвращает функцию отписки. */
export function subscribe(fn) {
  if (typeof fn !== "function") return () => {};
  listeners.add(fn);
  return () => listeners.delete(fn);
}

/** Явная отписка (альтернатива функции, возвращаемой subscribe) */
export function unsubscribe(fn) {
  listeners.delete(fn);
}

// на всякий случай алиас, если где-то импортируется другое имя
export const onChange = subscribe;

/* ---------------- современный API ---------------- */
const ArtistState = {
  get() {
    loadFromStorage();
    return { ...state };
  },
  setPage(p) {
    loadFromStorage();
    state.page = Math.max(1, Number(p) || 1);
    saveToStorage(); notify();
  },
  setLimit(n) {
    loadFromStorage();
    state.limit = Math.max(1, Number(n) || initial.limit);
    saveToStorage(); notify();
  },
  setGenre(v) {
    loadFromStorage();
    state.genre = v || "";
    saveToStorage(); notify();
  },
  setSort(v) {
    loadFromStorage();
    state.sort = v || "";
    saveToStorage(); notify();
  },
  setQuery(v) {
    loadFromStorage();
    state.q = v || "";
    saveToStorage(); notify();
  },
  setMobilePanel(on) {
    loadFromStorage();
    state.isMobilePanelOpen = !!on;
    saveToStorage(); notify();
  },
  reset() {
    loadFromStorage();
    state = { ...initial };
    saveToStorage(); notify();
  },
};

export { ArtistState };
export default ArtistState;

/* ---------------- back-compat экспорт ---------------- */
// Старые импорты могли использовать эти функции.
export const getState = () => ArtistState.get();

export const setState = (patch = {}) => {
  loadFromStorage();
  const next = { ...state };

  if ("page" in patch)  next.page  = Math.max(1, Number(patch.page)  || 1);
  if ("limit" in patch) next.limit = Math.max(1, Number(patch.limit) || initial.limit);
  if ("genre" in patch) next.genre = String(patch.genre || "");
  if ("sort" in patch)  next.sort  = String(patch.sort  || "");
  if ("q" in patch)     next.q     = String(patch.q     || "");
  if ("isMobilePanelOpen" in patch) next.isMobilePanelOpen = !!patch.isMobilePanelOpen;

  state = next;
  saveToStorage(); notify();
  return ArtistState.get();
};

export const resetState = () => { ArtistState.reset(); return ArtistState.get(); };

// Пробрасываем поименованные сеттеры, если где-то импортируются напрямую
export const setPage        = (p)  => ArtistState.setPage(p);
export const setLimit       = (n)  => ArtistState.setLimit(n);
export const setGenre       = (v)  => ArtistState.setGenre(v);
export const setSort        = (v)  => ArtistState.setSort(v);
export const setQuery       = (v)  => ArtistState.setQuery(v);
export const setMobilePanel = (on) => ArtistState.setMobilePanel(on);

/* ---------------- первичная загрузка ---------------- */
loadFromStorage(); // чтобы состояние было готово до первых подписок



```

---
## src/js/artists/features/yt-catalog-provider.js

**size:** 6833 bytes &nbsp;&nbsp; **sha1:** `9d0c85b5f48a6e3c62db42044e08f2f91e9a598f`

```javascript
/* eslint-env browser */

/**
 * Каталожный провайдер YouTube-ID без API-ключа.
 *
 * Идея: использовать локальную БД артиста/альбомов/треков (то, что уже есть у тебя в проекте),
 * находить в ней youtube-ссылки и извлекать 11-символьные videoId.
 *
 * Безопасность:
 * - Никаких сетевых запросов к YouTube.
 * - Работает даже при исчерпанной квоте Data API.
 *
 * Гибкость:
 * - Пытается динамически импортировать один из модулей каталога:
 *   ./api.js, ../api.js, ./modal.js — и аккуратно ищет знакомые функции/структуры.
 * - Если ничего не нашлось, пытается воспользоваться глобалками window.__ARTISTS_DB__ / window.Artists.
 *
 * Кэш:
 * - localStorage ("amCatCacheV1") с TTL по умолчанию 7 дней.
 */

const YT_ID_RE = /(?:v=|\/(?:embed|shorts|v)\/|youtu\.be\/)([A-Za-z0-9_-]{11})/i;
const RAW_ID_RE = /\b([A-Za-z0-9_-]{11})\b/;

function getYouTubeIdFromString(s) {
  if (!s) return '';
  const str = String(s);
  const m1 = str.match(YT_ID_RE);
  if (m1 && m1[1]) return m1[1];
  const m2 = str.match(RAW_ID_RE);
  if (m2 && m2[1]) return m2[1];
  return '';
}

function normalize(q) {
  return String(q || '').trim().toLowerCase();
}

function readCache() {
  try {
    return JSON.parse(localStorage.getItem('amCatCacheV1') || '{}');
  } catch { return {}; }
}

function writeCache(obj) {
  try { localStorage.setItem('amCatCacheV1', JSON.stringify(obj)); } catch {}
}

function collectIdsFromArtist(artistObj) {
  const out = new Set();
  if (!artistObj || typeof artistObj !== 'object') return out;

  // 1) прямые поля
  for (const k of ['yt', 'youtube', 'url', 'video', 'link']) {
    const id = getYouTubeIdFromString(artistObj[k]);
    if (id) out.add(id);
  }

  // 2) альбомы → треки
  const albums = artistObj.albums || artistObj.discography || [];
  if (Array.isArray(albums)) {
    for (const al of albums) {
      for (const k of ['yt', 'youtube', 'url', 'video', 'link']) {
        const id = getYouTubeIdFromString(al?.[k]);
        if (id) out.add(id);
      }
      const tracks = al?.tracks || al?.songs || [];
      if (Array.isArray(tracks)) {
        for (const tr of tracks) {
          for (const k of ['yt', 'youtube', 'url', 'video', 'link']) {
            const id = getYouTubeIdFromString(tr?.[k]);
            if (id) out.add(id);
          }
        }
      }
    }
  }

  // 3) иногда встречаются «extras»/«links»
  const links = artistObj.links || artistObj.extra || [];
  if (Array.isArray(links)) {
    for (const x of links) {
      const id = getYouTubeIdFromString(x);
      if (id) out.add(id);
    }
  }

  return out;
}

async function tryImport(path) {
  try { return await import(/* @vite-ignore */ path); }
  catch { return null; }
}

async function findArtistCandidates(query) {
  const q = normalize(query);
  const out = [];

  // Пытаемся разные модули (на твой проект часто подходит ./api.js)
  const mod1 = await tryImport('./api.js');
  const mod2 = await tryImport('../api.js');
  const mod3 = await tryImport('./modal.js'); // вдруг там экспортятся данные
  const mods = [mod1, mod2, mod3].filter(Boolean);

  for (const m of mods) {
    // Наиболее частые варианты API:
    const fns = [
      m.searchArtists, m.findArtists, m.lookupArtist, m.findArtistByName,
      m.getArtistBySlug, m.getArtist, m.getArtists, m.getAllArtists
    ].filter(Boolean);

    // 1) функции поиска
    for (const fn of fns) {
      try {
        const res = await fn(q);
        if (Array.isArray(res)) {
          for (const a of res) out.push(a);
        } else if (res && typeof res === 'object') {
          out.push(res);
        }
      } catch { /* no-op */ }
    }

    // 2) экспортированные индексы
    for (const key of Object.keys(m)) {
      const val = m[key];
      if (Array.isArray(val) && val.length && typeof val[0] === 'object') {
        // массив артистов
        for (const a of val) {
          const name = (a.name || a.title || a.artist || '').toLowerCase();
          const slug = (a.slug || '').toLowerCase();
          if (name.includes(q) || slug === q) out.push(a);
        }
      }
    }
  }

  // 3) глобалки как fallback
  const globals = [window.__ARTISTS_DB__, window.Artists, window.APP_CATALOG].filter(Boolean);
  for (const g of globals) {
    if (Array.isArray(g)) {
      for (const a of g) {
        const name = (a?.name || a?.title || a?.artist || '').toLowerCase();
        const slug = (a?.slug || '').toLowerCase();
        if (name.includes(q) || slug === q) out.push(a);
      }
    } else if (g && typeof g === 'object') {
      // объект вида { slug: artist }
      for (const k of Object.keys(g)) {
        const a = g[k];
        const name = (a?.name || a?.title || a?.artist || '').toLowerCase();
        const slug = String(k || '').toLowerCase();
        if (name.includes(q) || slug.includes(q)) out.push(a);
      }
    }
  }

  // легкая нормализация
  const unique = [];
  const seen = new Set();
  for (const a of out) {
    if (!a) continue;
    const key = (a.slug || a.name || a.title || JSON.stringify(a)).toLowerCase();
    if (seen.has(key)) continue;
    seen.add(key);
    unique.push(a);
  }
  return unique;
}

/**
 * Возвращает массив YouTube videoId (строки по 11 символов) из локального каталога
 * по текстовому запросу. Кэширует результат в localStorage.
 */
export async function idsFromCatalog(query, { ttlMs = 7 * 24 * 3600 * 1000 } = {}) {
  const q = normalize(query);
  if (!q) return [];

  // cache
  const cache = readCache();
  const now = Date.now();
  const cval = cache[q];
  if (cval && Array.isArray(cval.ids) && (now - (cval.ts || 0) < ttlMs)) {
    return cval.ids.slice();
  }

  const artists = await findArtistCandidates(q);
  const bag = new Set();
  for (const a of artists) {
    const ids = collectIdsFromArtist(a);
    ids.forEach(id => bag.add(id));
  }

  const res = Array.from(bag);
  cache[q] = { ids: res, ts: now };
  writeCache(cache);
  return res;
}

export default { idsFromCatalog };

```

---
## src/js/artists/features/zoom.js

**size:** 8612 bytes &nbsp;&nbsp; **sha1:** `cc6d1e09b877394f9c34c4c08787c59e1549256c`

```javascript

// Оверлей зума: без искажений на моб/таб + pinch/zoom/pan + колесо/двойной клик

let overlay, dialogEl, stageEl, imgEl, linkEl, closeBtn, backdropEl;
let isPanning = false, startX = 0, startY = 0, curX = 0, curY = 0, scale = 1;
let baseW = 0, baseH = 0, stageW = 0, stageH = 0;
const activePointers = new Map();
let pinchActive = false, pinchBaseDist = 0, pinchBaseScale = 1;

const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
const dist = (a, b) => Math.hypot(a.x - b.x, a.y - b.y);
const midpoint = (a, b) => ({ x: (a.x + b.x) / 2, y: (a.y + b.y) / 2 });

/* ---------- ensure ---------- */
function ensureZoom() {
  if (overlay) return;

  overlay = document.createElement("div");
  overlay.className = "am-zoom";
  overlay.innerHTML = `
    <div class="am-zoom__backdrop"></div>
    <div class="am-zoom__dialog" role="dialog" aria-modal="true" aria-label="Image preview">
      <div class="am-zoom__stage">
        <img class="am-zoom__img" alt="">
      </div>
      <div class="am-zoom__bar">
        <a class="am-zoom__open" href="#" target="_blank" rel="noopener noreferrer">Open original ↗</a>
        <button class="am-zoom__close" type="button" aria-label="Close">×</button>
      </div>
    </div>`;
  document.body.appendChild(overlay);

  // базовые стилевые фолбэки (если вдруг профильный CSS не подключен)
  Object.assign(overlay.style, { position: "fixed", inset: "0", zIndex: "6000", display: "none" });
  dialogEl = overlay.querySelector(".am-zoom__dialog");
  Object.assign(dialogEl.style, {
    position: "absolute", inset: "0", display: "grid",
    gridTemplateRows: "1fr auto", gap: "12px", padding: "16px"
  });

  backdropEl = overlay.querySelector(".am-zoom__backdrop");
  Object.assign(backdropEl.style, { position: "absolute", inset: "0", background: "rgba(0,0,0,.7)" });

  stageEl = overlay.querySelector(".am-zoom__stage");
  Object.assign(stageEl.style, {
    position: "relative",
    background: "#000",
    borderRadius: "12px",
    overflow: "hidden",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    minHeight: "240px",
    height: "calc(100vh - 140px)",
    touchAction: "none" // жесты — нашими руками
  });

  imgEl = overlay.querySelector(".am-zoom__img");
  // важные анти-искажения + перехват global img{height:100%}
  imgEl.style.maxWidth = "100%";
  imgEl.style.maxHeight = "100%";
  imgEl.style.width = "auto";
  imgEl.style.setProperty("height", "auto", "important");
  imgEl.style.objectFit = "contain";
  imgEl.style.transformOrigin = "center center";
  imgEl.style.willChange = "transform";
  imgEl.style.userSelect = "none";
  imgEl.style.webkitUserDrag = "none";
  imgEl.style.pointerEvents = "auto";

  const bar = overlay.querySelector(".am-zoom__bar");
  Object.assign(bar.style, {
    display: "flex", justifyContent: "space-between",
    alignItems: "center", gap: "12px"
  });

  linkEl = overlay.querySelector(".am-zoom__open");
  linkEl.style.color = "#fff";
  closeBtn = overlay.querySelector(".am-zoom__close");
  Object.assign(closeBtn.style, {
    width: "40px", height: "40px", borderRadius: "10px",
    border: "none", background: "var(--color-affair, #764191)", color: "#fff", cursor: "pointer"
  });

  // события
  backdropEl.addEventListener("click", closeZoom);
  closeBtn.addEventListener("click", closeZoom);

  overlay.addEventListener("wheel", onWheel, { passive: false });
  imgEl.addEventListener("dblclick", toggleZoom);

  imgEl.addEventListener("pointerdown", onPointerDown);
  imgEl.addEventListener("pointermove", onPointerMove);
  imgEl.addEventListener("pointerup", onPointerUpCancel);
  imgEl.addEventListener("pointercancel", onPointerUpCancel);

  document.addEventListener("keydown", (e) => { if (e.key === "Escape" && isZoomOpen()) closeZoom(); });
  window.addEventListener("resize", () => { if (isZoomOpen()) { measureStage(); applyTransform(); } });
}

/* ---------- measurements ---------- */
function measureBase() {
  const prev = imgEl.style.transform;
  imgEl.style.transform = "translate3d(0,0,0) scale(1)";
  const r = imgEl.getBoundingClientRect();
  imgEl.style.transform = prev;
  baseW = r.width; baseH = r.height;
}
function measureStage() {
  const s = stageEl.getBoundingClientRect();
  stageW = s.width; stageH = s.height;
}
function clampPan() {
  if (!baseW || !baseH || !stageW || !stageH) return;
  const contentW = baseW * scale, contentH = baseH * scale;
  if (contentW <= stageW) curX = 0;
  else { const maxX = (contentW - stageW) / 2; curX = clamp(curX, -maxX, maxX); }
  if (contentH <= stageH) curY = 0;
  else { const maxY = (contentH - stageH) / 2; curY = clamp(curY, -maxY, maxY); }
}
function applyTransform() {
  clampPan();
  imgEl.style.transform = `translate3d(${curX}px, ${curY}px, 0) scale(${scale})`;
  imgEl.style.cursor = scale > 1 ? (isPanning ? "grabbing" : "grab") : "zoom-in";
}

/* ---------- API ---------- */
export function openZoom(src, alt = "") {
  if (!src) return;
  ensureZoom();

  // сброс состояния
  activePointers.clear();
  pinchActive = false; pinchBaseDist = 0; pinchBaseScale = 1;
  isPanning = false; startX = startY = 0; curX = curY = 0; scale = 1;

  imgEl.src = src;
  imgEl.alt = alt || "";
  linkEl.href = src;

  overlay.style.display = "block";

  const doMeasure = () => { measureStage(); measureBase(); clampPan(); applyTransform(); };
  if (imgEl.complete && imgEl.naturalWidth > 0) requestAnimationFrame(doMeasure);
  else imgEl.onload = () => requestAnimationFrame(doMeasure);
}

export function closeZoom() {
  if (!overlay) return;
  overlay.style.display = "none";
  imgEl.src = "";
  activePointers.clear();
  pinchActive = false;
}

export function isZoomOpen() {
  return !!(overlay && overlay.style.display !== "none");
}

/* ---------- gestures ---------- */
function toggleZoom() {
  const prev = scale;
  scale = prev > 1 ? 1 : 2;
  if (scale === 1) { curX = 0; curY = 0; }
  applyTransform();
}
function onWheel(e) {
  if (!isZoomOpen()) return;
  e.preventDefault();
  const newScale = clamp(scale + (e.deltaY > 0 ? -0.15 : 0.15), 1, 3);

  const rect = imgEl.getBoundingClientRect();
  const pivot = { x: e.clientX, y: e.clientY };
  const center = { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
  const factor = newScale / scale;
  curX += (center.x - pivot.x) * (1 - factor);
  curY += (center.y - pivot.y) * (1 - factor);

  scale = newScale;
  if (scale === 1) { curX = 0; curY = 0; }
  applyTransform();
}
function onPointerDown(e) {
  activePointers.set(e.pointerId, { x: e.clientX, y: e.clientY });
  imgEl.setPointerCapture(e.pointerId);

  if (activePointers.size === 2) {
    const [p1, p2] = Array.from(activePointers.values());
    pinchActive = true;
    pinchBaseDist = dist(p1, p2) || 1;
    pinchBaseScale = scale;
    isPanning = false;
    return;
  }
  if (activePointers.size === 1 && scale > 1) {
    isPanning = true;
    startX = e.clientX - curX;
    startY = e.clientY - curY;
    applyTransform();
  }
}
function onPointerMove(e) {
  if (!activePointers.has(e.pointerId)) return;
  activePointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

  if (pinchActive && activePointers.size >= 2) {
    const [p1, p2] = Array.from(activePointers.values());
    const d = dist(p1, p2) || 1;
    let newScale = clamp(pinchBaseScale * (d / pinchBaseDist), 1, 3);

    const mid = midpoint(p1, p2);
    const rect = imgEl.getBoundingClientRect();
    const center = { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
    const factor = newScale / scale;
    curX += (center.x - mid.x) * (1 - factor);
    curY += (center.y - mid.y) * (1 - factor);

    scale = newScale;
    if (scale === 1) { curX = 0; curY = 0; }
    applyTransform();
    return;
  }

  if (isPanning && activePointers.size === 1 && scale > 1) {
    curX = e.clientX - startX;
    curY = e.clientY - startY;
    applyTransform();
  }
}
function onPointerUpCancel(e) {
  if (activePointers.has(e.pointerId)) activePointers.delete(e.pointerId);
  try { imgEl.releasePointerCapture(e.pointerId); } catch {}
  if (activePointers.size < 2) { pinchActive = false; pinchBaseDist = 0; }
  if (activePointers.size === 0) { isPanning = false; applyTransform(); }
}

```

---
## src/js/artists/index.js

**size:** 10071 bytes &nbsp;&nbsp; **sha1:** `ca5a1ea384009c5cdada763b7003b092d9027e7d`

```javascript
// --------------------------------------------------
// Artists: точка входа
// - initArtists(): инициализация сетки/фильтров/модалок
// - createMiniPlayer(): создаёт мини-плеер
// - mountPlayerPatch(player): навешивает события управления с ассистента
// - installMixRadioMenu(btnSelector, player): поповер меню под Mix Radio
// --------------------------------------------------

import { initArtists } from "./features/init.js";
import { createMiniPlayer } from "./features/player.js";
import mountPlayerPatch from "./features/player-patch.js";
import { installMixRadioMenu } from "./features/mixradio-menu.js";

/* =========================
   Утилиты
   ========================= */

/** Достаёт YouTube ID из ID или URL (youtu.be, /embed, /shorts, ?v=) */
function getYouTubeId(urlOrId) {
  if (!urlOrId) return "";
  if (/^[\w-]{11}$/.test(urlOrId)) return urlOrId; // уже ID

  try {
    const u = new URL(urlOrId, location.href);
    if (/youtu\.be$/i.test(u.hostname)) return u.pathname.slice(1);
    const v = u.searchParams.get("v");
    if (v && /^[\w-]{11}$/.test(v)) return v;
    const m = u.pathname.match(/\/(?:embed|v|shorts)\/([^/?#]+)/i);
    if (m && m[1] && /^[\w-]{11}$/.test(m[1])) return m[1];
  } catch { /* ignore */ }
  return "";
}

const uniq = (arr) => Array.from(new Set((arr || []).filter(Boolean)));
function shuffle(a) {
  const arr = a.slice();
  for (let i = arr.length - 1; i > 0; i--) {
    const j = (Math.random() * (i + 1)) | 0;
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* =========================
   Seed-пул видео (можно дополнять)
   ========================= */

const SEED_IDS = uniq([
  // базовый набор
  "Zi_XLOBDo_Y","3JZ_D3ELwOQ","fRh_vgS2dFE","OPf0YbXqDm0","60ItHLz5WEA",
  "2Vv-BfVoq4g","kXYiU_JCYtU","UceaB4D0jpo","RubBzkZzpUA","kJQP7kiw5Fk",
  "CevxZvSJLk8","pRpeEdMmmQ0","IcrbM1l_BoI","YVkUvmDQ3HY","hT_nvWreIhg",
  "09R8_2nJtjg","uelHwf8o7_U","JGwWNGJdvx8","YQHsXMglC9A","NmugSMBh_iI",
  "LrUvu1mlWco","hLQl3WQQoQ0","RgKAFK5djSk","SlPhMPnQ58k","oRdxUFDoQe0",
  "Pkh8UtuejGw","tt2k8PGm-TI","lY2yjAdbvdQ","pXRviuL6vMY","nfs8NYg7yQM",
  "nCkpzqqog4k","M7lc1UVf-VE",
  // расширение
  "fLexgOxsZu0","2vjPBrBU-TM","9bZkp7q19f0","e-ORhEE9VVg","gCYcHz2k5x0",
  "ktvTqknDobU","ub82Xb1C8os","fKopy74weus","Qv5fqunQ_4I","vNoKguSdy4Y",
  "0KSOMA3QBU0","lp-EO5I60KA","DK_0jXPuIr0","tVj0ZTS4WF4","6fVE8kSM43I",
  "6Ejga4kJUts","gGdGFtwCNBE","rYEDA3JcQqw","AtKZKl7Bgu0","eVTXPUF4Oz4",
  "kffacxfA7G4"
]);

/* =========================
   localStorage: кэш пула
   ========================= */

const LS_KEY_POOL = "am.radio.pool";
const LS_KEY_LAST = "am.radio.last";

function readPoolLS() {
  try {
    const raw = localStorage.getItem(LS_KEY_POOL);
    const arr = raw ? JSON.parse(raw) : [];
    return Array.isArray(arr) ? uniq(arr) : [];
  } catch { return []; }
}
function savePoolLS(arr) {
  try {
    localStorage.setItem(LS_KEY_POOL, JSON.stringify(uniq(arr).slice(0, 800)));
  } catch { /* ignore */ }
}
function addToPoolLS(ids) {
  if (!ids?.length) return;
  const cur = new Set(readPoolLS());
  ids.forEach((id) => cur.add(id));
  savePoolLS([...cur]);
}

/* =========================
   Сбор ID из DOM
   ========================= */

function collectFromDOM(root = document) {
  const out = new Set();

  // Ссылки на YouTube
  root.querySelectorAll('a[href*="youtu"], a.yt').forEach((a) => {
    const href = a.getAttribute("href") || "";
    const id = getYouTubeId(href);
    if (id) out.add(id);
  });

  // Возможные data-атрибуты
  root.querySelectorAll("[data-yt],[data-youtube],[data-ytid]").forEach((el) => {
    const raw =
      el.getAttribute("data-yt") ||
      el.getAttribute("data-youtube") ||
      el.getAttribute("data-ytid") ||
      "";
    const id = getYouTubeId(raw);
    if (id) out.add(id);
  });

  return [...out];
}

function installCollector() {
  // стартовая выборка
  addToPoolLS(collectFromDOM());

  // наблюдаем за добавлениями (модалки, подгрузки и т.п.)
  const mo = new MutationObserver((mutations) => {
    let added = [];
    for (const m of mutations) {
      if (!m.addedNodes) continue;
      m.addedNodes.forEach((n) => {
        if (n.nodeType !== 1) return; // ELEMENT_NODE
        added = added.concat(collectFromDOM(n));
      });
    }
    if (added.length) addToPoolLS(added);
  });
  mo.observe(document.documentElement, { childList: true, subtree: true });
}

/* =========================
   Построение итогового пула
   ========================= */

function buildPool() {
  const mem = readPoolLS();
  const dom = collectFromDOM();
  return uniq([...SEED_IDS, ...mem, ...dom]);
}

/* =========================
   Mix Radio
   ========================= */

function startMixRadio(player) {
  const pool = buildPool();
  if (!pool.length || !player) return;

  // большая перемешанная очередь
  let order = shuffle(pool);

  // анти-повтор стартового
  const last = localStorage.getItem(LS_KEY_LAST);
  if (last && order.length > 1 && order[0] === last) {
    order.push(order.shift());
  }
  localStorage.setItem(LS_KEY_LAST, order[0]);

  // отдаём очередь плееру (API нашего мини-плеера)
  if (typeof player.openQueue === "function") {
    player.openQueue(order, { shuffle: false, loop: true, startIndex: 0 });
  } else {
    // фолбэк: просто сыграть первый ID, если есть метод playYouTube/id
    if (typeof player.playYouTube === "function") player.playYouTube(order[0]);
    else if (typeof player.play === "function") player.play(order[0]);
  }
}

/* =========================
   Привязка ассистента к каталогу
   ========================= */

function bindAssistantToCatalog(player) {
  // Рекомендации (жанр/настроение/поиск по слову)
  document.addEventListener("assistant:recommend", (e) => {
    const { mood, genre, decade, like } = e.detail || {};

    // ЖАНР — кликаем существующий пункт дропа
    if (genre) {
      const item = document.querySelector(
        '#dd-genre-list li[data-val="' + genre + '"]'
      );
      if (item) item.click();
    }

    // ПОИСК — вписываем в поле и триггерим input
    if (like) {
      const q = document.getElementById("flt-q");
      if (q) {
        q.value = like;
        q.dispatchEvent(new Event("input", { bubbles: true }));
      }
    }

    // mood/decade — под твой реальный маппинг тегов/чекбоксов
    // После выставления фильтров можно дёрнуть свою refresh():
    // try { refresh(); } catch {}
  });

  // Фолбэки на случай, если player-patch не подхватился:
  const safe = (fn) => { try { fn && fn(); } catch {} };

  document.addEventListener("assistant:player-play", () => {
    safe(() => {
      if (player?.isActive?.()) player.play?.();
      else if (player?.hasQueue?.()) player.play?.();
      else startMixRadio(player);
    });
  });
  document.addEventListener("assistant:player-pause", () => safe(() => player?.pause?.()));
  document.addEventListener("assistant:player-next",  () => safe(() => {
    if (player?.hasQueue?.()) player.next?.(); else startMixRadio(player);
  }));
  document.addEventListener("assistant:player-prev",  () => safe(() => player?.prev?.()));
  document.addEventListener("assistant:volume", (e) => safe(() => {
    const d = e.detail?.delta ?? 0;
    if (typeof player?.setVolume === "function") {
      const v = Math.max(0, Math.min(1, (player.getVolume?.() ?? 0.7) + d));
      player.setVolume(v);
    }
  }));
}

/* =========================
   Bootstrap
   ========================= */

document.addEventListener("DOMContentLoaded", () => {
  // Инициализация секции/грида/модалок (как было)
  try { initArtists(); } catch { /* ignore */ }

  // Создаём мини-плеер
  const player = (typeof createMiniPlayer === "function") ? createMiniPlayer() : null;

  // Патч — строго после создания плеера
  try { if (player) mountPlayerPatch(player); } catch { /* ignore */ }

  // Сбор ID на лету (модалки, динамика)
  installCollector();

  // Кнопка «Mix Radio / Next»
  const btn = document.querySelector("#random-radio");
  if (btn) {
    btn.addEventListener("click", (e) => {
      e.preventDefault();
      if (!player) return;

      // Если свернут (пузырь) — просто next, не раскрывая плеер
      if (player.isMinimized?.()) { player.next?.(); return; }

      // Если ещё не активен — стартуем радио или next по готовой очереди
      if (!player.isActive?.()) {
        if (player.hasQueue?.()) player.next?.();
        else startMixRadio(player);
        return;
      }

      // Если активен — просто next
      player.next?.();
    });
  }

  // Радио-меню (доп. кнопка под MixRadio)
  const ensureMenu = () => installMixRadioMenu("#mixradio-menu-btn", player);
  ensureMenu();
  window.addEventListener("load", ensureMenu);
  document.getElementById("filters-toggle")?.addEventListener("click", () => {
    setTimeout(ensureMenu, 0);
  });

  // Привязка ассистента
  bindAssistantToCatalog(player);
});

```

---
## src/js/artists/lib/scroll-lock.js

**size:** 1292 bytes &nbsp;&nbsp; **sha1:** `18ed610d66bd9f9b9602d1d40a1e018aef33c26b`

```javascript
// Реф-счётчик + «аварийная» разблокировка
let depth = 0;
let savedY = 0;

export function lockScroll() {
  if (depth++ === 0) {
    savedY = window.scrollY || document.documentElement.scrollTop || 0;
    const s = document.body.style;
    s.position = "fixed";
    s.top = `-${savedY}px`;
    s.left = "0";
    s.right = "0";
    s.width = "100%";
    document.body.classList.add("scroll-locked");
  }
}

export function unlockScroll(force = false) {
  if (force) depth = 1;                // принудительно «свести» к нулю
  if (depth > 0 && --depth === 0) {
    const s = document.body.style;
    s.position = s.top = s.left = s.right = s.width = "";
    window.scrollTo(0, savedY);
    document.body.classList.remove("scroll-locked");
  }
}

// на всякий случай — доступно из консоли: window.__unlockScroll()
export function emergencyUnlock() { unlockScroll(true); }
if (typeof window !== "undefined") {
  window.__unlockScroll = emergencyUnlock;
  // если страница перегружается в зафиксированном состоянии — снимем блокировку
  window.addEventListener("pageshow", () => emergencyUnlock());
}

```

---
## src/js/artists/lib/sound.js

**size:** 3822 bytes &nbsp;&nbsp; **sha1:** `08ad23667a1f493c41e3f2d95ec59d55c1ef502d`

```javascript

// Мягкий «клац» (tap) и чуть иной звук для пагинации (page)
let ctx, master, comp, postLP;
let inited = false;

function init() {
  if (inited) return;
  const AC = window.AudioContext || window.webkitAudioContext;
  if (!AC) return;
  ctx = new AC();

  comp = ctx.createDynamicsCompressor();
  comp.threshold.value = -26;
  comp.knee.value = 22;
  comp.ratio.value = 6;
  comp.attack.value = 0.004;
  comp.release.value = 0.08;

  postLP = ctx.createBiquadFilter();
  postLP.type = "lowpass";
  postLP.frequency.value = 2300;
  postLP.Q.value = 0.6;

  master = ctx.createGain();
  master.gain.value = 0.11;

  master.connect(postLP);
  postLP.connect(comp);
  comp.connect(ctx.destination);

  // Разблокировка на первом жесте
  const unlock = () => {
    try { ctx.resume(); } catch {}
    window.removeEventListener("pointerdown", unlock);
    window.removeEventListener("keydown", unlock);
    window.removeEventListener("touchstart", unlock);
  };
  window.addEventListener("pointerdown", unlock, { once: true, passive: true });
  window.addEventListener("keydown", unlock, { once: true });
  window.addEventListener("touchstart", unlock, { once: true, passive: true });

  inited = true;
}

function resume() { if (ctx && ctx.state === "suspended") ctx.resume(); }

function tap() {
  if (!inited) init();
  if (!ctx) return;
  resume();
  const now = ctx.currentTime + 0.004;

  // шумовой щелчок
  const durNoise = 0.055;
  const nsrc = ctx.createBufferSource();
  const nbuf = ctx.createBuffer(1, Math.max(32, (ctx.sampleRate * durNoise) | 0), ctx.sampleRate);
  const ch = nbuf.getChannelData(0);
  for (let i = 0; i < ch.length; i++) {
    const t = i / ch.length;
    ch[i] = (Math.random() * 2 - 1) * Math.pow(1 - t, 2);
  }
  nsrc.buffer = nbuf;

  const bp = ctx.createBiquadFilter();
  bp.type = "bandpass"; bp.frequency.value = 2050; bp.Q.value = 0.9;
  const hp = ctx.createBiquadFilter();
  hp.type = "highpass"; hp.frequency.value = 360; hp.Q.value = 0.7;

  const ng = ctx.createGain();
  ng.gain.setValueAtTime(0.0001, now);
  ng.gain.linearRampToValueAtTime(0.45, now + 0.004);
  ng.gain.exponentialRampToValueAtTime(0.0001, now + 0.055);

  nsrc.connect(bp); bp.connect(hp); hp.connect(ng); ng.connect(master);
  nsrc.start(now); nsrc.stop(now + 0.06);

  // лёгкий верхний обертон
  const osc = ctx.createOscillator();
  osc.type = "triangle"; osc.frequency.setValueAtTime(2100, now);
  const og = ctx.createGain();
  og.gain.setValueAtTime(0.0001, now);
  og.gain.linearRampToValueAtTime(0.20, now + 0.003);
  og.gain.exponentialRampToValueAtTime(0.0001, now + 0.05);
  osc.connect(og); og.connect(master);
  osc.start(now); osc.stop(now + 0.055);

  // чуть «тела»
  const low = ctx.createOscillator();
  low.type = "sine"; low.frequency.setValueAtTime(165, now);
  const lg = ctx.createGain();
  lg.gain.setValueAtTime(0.0001, now);
  lg.gain.linearRampToValueAtTime(0.05, now + 0.003);
  lg.gain.exponentialRampToValueAtTime(0.0001, now + 0.042);
  low.connect(lg); lg.connect(master);
  low.start(now); low.stop(now + 0.045);
}

function page() {
  if (!inited) init();
  if (!ctx) return;
  resume();
  const now = ctx.currentTime + 0.003;
  const osc = ctx.createOscillator();
  osc.type = "triangle"; osc.frequency.setValueAtTime(1750, now);
  const g = ctx.createGain();
  g.gain.setValueAtTime(0.0001, now);
  g.gain.linearRampToValueAtTime(0.17, now + 0.003);
  g.gain.exponentialRampToValueAtTime(0.0001, now + 0.06);
  osc.connect(g); g.connect(master);
  osc.start(now); osc.stop(now + 0.065);
}

export const UISound = { tap, page };
export default UISound;

```

---
## src/js/artists/lib/toast.js

**size:** 1105 bytes &nbsp;&nbsp; **sha1:** `74b455fddcd2e40a485d4f95087f4a12afc24f45`

```javascript

let box = null;

function ensureBox() {
  if (box) return box;
  box = document.createElement("div");
  box.className = "toast-container";
  document.body.appendChild(box);
  return box;
}

function show(message, kind = "info", timeout = 3000) {
  ensureBox();
  const item = document.createElement("div");
  item.className = `toast toast--${kind}`;
  item.setAttribute("role", "status");
  item.textContent = String(message || "");
  box.appendChild(item);

  const t = setTimeout(() => hide(item), timeout);
  item.addEventListener("click", () => { clearTimeout(t); hide(item); });
}

function hide(item) {
  item.classList.add("toast--hide");
  item.addEventListener("animationend", () => item.remove(), { once: true });
}

export const toast = {
  show,
  info: (m, t) => show(m, "info", t),
  success: (m, t) => show(m, "success", t),
  error: (m, t) => show(m, "error", t),
};

// Для обратной совместимости, если что-то ещё дергает window.__toast
if (!window.__toast) window.__toast = toast;

export default toast;

```

---
## src/js/assistant/apiBase.js

**size:** 276 bytes &nbsp;&nbsp; **sha1:** `26d92e5e0bab543e9ee50ba2cbe268f8835d8e2a`

```javascript
// src/js/assistant/apiBase.js
// Единая точка правды для базового URL API
export const API_BASE =
  (import.meta.env.VITE_AI_BASE_URL?.replace(/\/+$/, '')) ||
  (location.hostname === 'localhost'
    ? 'http://localhost:8787'
    : ''); 


```

---
## src/js/assistant/assistant-hooks.js

**size:** 2251 bytes &nbsp;&nbsp; **sha1:** `3da9584bb2d1beda81451e495b4523eebaf5cfa4`

```javascript
// lightweight hooks for Assistant UI
// normalize timing phrases & small utilities
(() => {
  const W = (window.Assistant = window.Assistant || {});

  function normalizeDashes(s) {
    return String(s || "").replace(/[–—]/g, "-");
  }

  function normalizeTimingPhrases(s0) {
    let s = normalizeDashes(String(s0 || "")).toLowerCase();

    // "через полминуты" -> "через 30 секунд"; "через пол часа" -> "через 30 минут"
    s = s.replace(/через\s+пол ?минут[ыи]/g, "через 30 секунд");
    s = s.replace(/через\s+пол ?часа/g, "через 30 минут");

    // "через минуту/секунду/час" -> явная единица (поможет простым парсерам)
    s = s.replace(/через\s+минут[уы]/g, "через 1 минуту");
    s = s.replace(/через\s+секунд[уы]/g, "через 1 секунду");
    s = s.replace(/через\s+час[ау]?/g, "через 1 час");

    // "через 15–20 секунд" -> берём правую границу
    s = s.replace(/через\s+(\d{1,3})\s*-\s*(\d{1,3})\s*(секунд\w*|минут\w*|час\w*|s|m|h|min|sec|hour|minutes?)/g,
      (_m, a, b, u) => `через ${b} ${u}`);

    // "через 10, 15, 20 секунд" -> последняя величина
    s = s.replace(
      /через\s+(\d{1,3}(?:\s*,\s*\d{1,3})+)\s*(секунд\w*|минут\w*|час\w*|s|m|h|min|sec|hour|minutes?)/g,
      (_m, list, u) => {
        const parts = list.split(/\s*,\s*/).map(Number).filter((n) => Number.isFinite(n));
        const last = parts[parts.length - 1] || 0;
        return `через ${last} ${u}`;
      }
    );

    // разговорные уменьшительные → нормальная форма
    s = s.replace(/секундочк[ауи]/g, "секунду").replace(/минутк[ауи]/g, "минуту");

    return s0 && s !== s0 ? s : s0;
  }

  // Можно расширять обработчик дальше по необходимости
  W.preprocessText = function (text) {
    const t1 = normalizeTimingPhrases(text);
    return t1;
  };
})();

```

---
## src/js/assistant/bridge.js

**size:** 5019 bytes &nbsp;&nbsp; **sha1:** `75dfcf1fef9e3fd09aea3ed96b39cd9d1e75d108`

```javascript
/* Bridge: превращаем события assistant:* в реальные действия плеера/интерфейса */
(() => {
  // Signal presence of assistant bridge to avoid duplicate wiring
  try { window.__AH_BRIDGE_PRESENT = true; } catch {}
  // If the dedicated player patch is installed, skip this bridge to avoid double-handling.
  if (typeof window !== 'undefined' && window.__AM_PLAYER_PATCH_INSTALLED__) {
    return;
  }

  const q = (sel) => document.querySelector(sel);

  function safeCall(method, ...args) {
    try { return method?.(...args); } catch { /* no-op */ }
  }
  function clickFirst(...selectors) {
    for (const s of selectors) {
      const el = q(s);
      if (el) { el.click(); return true; }
    }
    return false;
  }

  function player() { return (window.AM && window.AM.player) || null; }

  // Вид (list/grid)
  document.addEventListener("assistant:view", (e) => {
    const mode = e?.detail?.mode;
    const isList = mode === "list";
    document.documentElement.classList.toggle("list-view", !!isList);
  });

  // Прямой запуск по ID/URL (если ассистент прислал конкретную песню)
  document.addEventListener("assistant:play", (e) => {
    const id = e?.detail?.id;
    const query = e?.detail?.query;
    const p = player();
    const ytid = (s) => {
      if (!s) return "";
      if (/^[\w-]{11}$/.test(s)) return s;
      try {
        const u = new URL(s, location.href);
        if (/youtu\.be$/i.test(u.hostname)) return u.pathname.slice(1);
        const m = u.pathname.match(/\/(?:embed|v|shorts)\/([^/?#]+)/i);
        if (m && m[1] && /^[\w-]{11}$/.test(m[1])) return m[1];
        const v = u.searchParams.get("v");
        if (v && /^[\w-]{11}$/.test(v)) return v;
      } catch {}
      return "";
    };

    const tid = id || ytid(query);
    if (p && tid && typeof p.openQueue === "function") {
      p.openQueue([tid], { startIndex: 0, shuffle: false, loop: true });
    } else if (tid) {
      // как фоллбэк — попробуем просто кликнуть на ссылку в DOM, если она есть
      const link = document.querySelector(`a[href*="${tid}"]`);
      if (link) link.click();
    }
  });

  // Транспорт
  document.addEventListener("assistant:player-play", () => {
    const p = player();
    if (!p || !safeCall(p.play)) {
      clickFirst(".am-player [data-action='play']",
                 ".am-player__btn--play",
                 "button[aria-label='Play']");
    }
  });

  document.addEventListener("assistant:player-pause", () => {
    const p = player();
    if (!p || !safeCall(p.pause)) {
      clickFirst(".am-player [data-action='pause']",
                 ".am-player__btn--pause",
                 "button[aria-label='Pause']");
    }
  });

  document.addEventListener("assistant:player-stop", () => {
    const p = player();
     if (p && safeCall(p.stop)) return;
    // 2) пробуем кнопки стопа
    if (clickFirst(".am-player [data-action='stop']", "button[aria-label='Stop']")) return;
    // 3) деградация в паузу
    if (p && safeCall(p.pause)) return;
    clickFirst(".am-player [data-action='pause']", "button[aria-label='Pause']");
  });

  document.addEventListener("assistant:player-next", () => {
    const p = player();
    if (!p || !safeCall(p.next)) {
      clickFirst(".am-player [data-action='next']",
                 ".am-player__btn--next",
                 "button[aria-label='Next']");
    }
  });

  document.addEventListener("assistant:player-prev", () => {
    const p = player();
    if (!p || !safeCall(p.prev)) {
      clickFirst(".am-player [data-action='prev']",
                 ".am-player__btn--prev",
                 "button[aria-label='Previous']", "button[aria-label='Prev']");
    }
  });

  // Громкость
  document.addEventListener("assistant:volume", (e) => {
    const delta = Number(e?.detail?.delta ?? 0);
    const p = player();
    if (p && typeof p.setVolume === "function") {
      const cur = p.getVolume?.() ?? 0.7;
      const next = Math.max(0, Math.min(1, cur + delta));
      p.setVolume(next);
      return;
    }

    // Фоллбэк по слайдеру громкости в DOM
    const slider = document.querySelector(".am-player input[type='range'][name='volume'], .am-player .volume input[type='range']");
    if (slider) {
      const cur = Number(slider.value || 70) / 100;
      const next = Math.max(0, Math.min(1, cur + delta));
      slider.value = String(Math.round(next * 100));
      slider.dispatchEvent(new Event("input", { bubbles: true }));
    }
  });

  // MixRadio — отдаём в index.js, там есть buildPool/startMixRadio
  document.addEventListener("assistant:mixradio", () => {
    const btn = q("#random-radio");
    if (btn) btn.click();
  });
})();

```

---
## src/js/assistant/chat.js

**size:** 60807 bytes &nbsp;&nbsp; **sha1:** `178382235193088c9c9dc22c15f34e30c3ca2292`

```javascript
// Chat Friend + AI bridge with memory + Provider + Server/Browser TTS
// VERSION: chat.js v2.8.8
// (stronger delay parser + ms validation + action sanitization + logs)
// — 2025-09-11
(() => {
  if (window.__ASSISTANT_UI_INIT__) return;
  window.__ASSISTANT_UI_INIT__ = true;

  const API_BASE =
    (import.meta?.env?.VITE_API_URL && import.meta.env.VITE_API_URL.replace(/\/+$/, "")) ||
    (location.hostname === "localhost" ? "http://localhost:8787" : "");

  // ─── helpers ─────────────────────────────────────────────────────────
  function getYouTubeId(urlOrId) {
    if (!urlOrId) return "";
    if (/^[\w-]{11}$/.test(urlOrId)) return urlOrId;
    try {
      const u = new URL(urlOrId, location.href);
      if (/youtu\.be$/i.test(u.hostname)) return u.pathname.slice(1);
      const v = u.searchParams.get("v");
      if (v && /^[\w-]{11}$/.test(v)) return v;
      const m = u.pathname.match(/\/(?:embed|v|shorts)\/([^/?#]+)/i);
      if (m && m[1] && /^[A-Za-z0-9_-]{11}$/.test(m[1])) return m[1];
    } catch {}
    return "";
  }
  const isStr = (v) => typeof v === "string" && v.length > 0;
  const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

  // всё, что похоже на «следующая/другая/another/next/skip»
  const NEXT_RE = /\b(следующ(ую|ий|ая)|друг(ую|ой)|ин(ую|ой)|нов(ую|ый)|another|next|skip|скип)\b/i;

  // ─── language lock (только из настроек) ──────────────────────────────
  const state = {
    langPref:
      (localStorage.getItem("assistant.lang") || "").toLowerCase() ||
      ((navigator.language || "").toLowerCase().startsWith("uk")
        ? "uk"
        : (navigator.language || "").toLowerCase().startsWith("en")
        ? "en"
        : "ru"),
  };
  function pinLang(lang) {
    const v = (lang || "").toLowerCase();
    if (v === "ru" || v === "uk" || v === "en") {
      state.langPref = v;
      try {
        localStorage.setItem("assistant.lang", v);
      } catch {}
      addMsg("note", `Язык речи закреплён: ${v.toUpperCase()}`);
    }
  }
  function codeToBCP47(v) {
    return v === "uk" ? "uk-UA" : v === "ru" ? "ru-RU" : "en-US";
  }

  // ─── UI ──────────────────────────────────────────────────────────────
  const root = document.createElement("div");
  root.id = "assistant-root";
  root.className = "assistant";
  root.innerHTML = `
    <button class="assistant__toggle" aria-label="Чат-ассистент">🤖</button>
    <div class="assistant__panel" hidden>
      <div class="assistant__header">
        <strong>Чат-друг</strong>
        <div class="assistant__hdr-actions">
          <span class="assistant__ai-badge">${API_BASE ? "AI" : ""}</span>
          <label class="assistant__prov-wrap" title="Режим ИИ">
            <span class="assistant__prov-label">Режим</span>
            <select id="as-provider">
              <option value="auto">Auto</option>
              <option value="free">Free</option>
              <option value="pro">Pro</option>
            </select>
          </label>
          <button class="assistant__gear" aria-label="Настройки">⚙️</button>
          <button class="assistant__close" aria-label="Закрыть">✕</button>
        </div>
      </div>
      <div class="assistant__log" id="assistantLog"></div>
      <div class="assistant__controls">
        <button class="assistant__mic" aria-label="Голос">🎤</button>
        <input class="assistant__input" type="text" placeholder="Скажи або напиши…"/>
        <button class="assistant__send">Отправить</button>
      </div>
      <div class="assistant__settings" hidden>
        <label class="assistant__row">
          <span>Язык (RU/UK/EN)</span>
          <select id="as-lang">
            <option value="ru">Русский</option>
            <option value="uk">Українська</option>
            <option value="en">English</option>
          </select>
        </label>
        <label class="assistant__row">
          <span>Голос озвучки</span>
          <select id="as-voice"></select>
        </label>
        <label class="assistant__row">
          <span>Серверный TTS (Piper)</span>
          <input id="as-tts-server" type="checkbox" />
          <small class="assistant__hint">Нужно настроить /api/tts на сервере. Иначе будет браузерный голос.</small>
        </label>
        <label class="assistant__row">
          <span>Пост. прослушивание (wake word)</span>
          <input id="as-wake-on" type="checkbox" />
        </label>
        <label class="assistant__row">
          <span>Фраза активации</span>
          <input id="as-wake-phrase" type="text" value="диджей,dj" />
        </label>
        <div class="assistant__row">
          <button id="as-test-voice" type="button">Проба голоса</button>
          <button id="as-clear-log" type="button">Очистить чат</button>
          <button id="as-hide-settings" type="button">Свернуть настройки</button>
        </div>
        <div class="assistant__row">
          <small class="assistant__hint">
            Фоновое прослушивание работает только при активной вкладке и выданном доступе к микрофону.
          </small>
        </div>
      </div>
    </div>`;
  document.body.appendChild(root);

  const style = document.createElement("style");
  style.textContent = `
    .assistant{position:fixed;right:18px;bottom:18px;z-index:9999}
    .assistant__toggle{width:48px;height:48px;border-radius:50%;border:none;background:#0ea5e9;color:#fff;font-size:22px;box-shadow:0 8px 20px rgba(0,0,0,.35);cursor:pointer}
    .assistant__panel{position:fixed;right:18px;bottom:84px;width:min(92vw,520px);max-height:min(80vh,720px);display:flex;flex-direction:column;background:#111418;border:1px solid rgba(255,255,255,.06);border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.6);overflow:hidden}
    .assistant__header{display:flex;align-items:center;gap:.75rem;padding:.8rem 1rem;background:linear-gradient(180deg,#121821,#0e1318);border-bottom:1px solid rgba(255,255,255,.06)}
    .assistant__hdr-actions{margin-left:auto;display:flex;gap:.5rem;align-items:center}
    .assistant__ai-badge{font:600 12px;color:#9ae6b4;background:#203021;border:1px solid #2b4a2d;padding:.25rem .4rem;border-radius:6px}
    .assistant__prov-wrap{display:flex;align-items:center;gap:.35rem;color:#cbd5e1}
    .assistant__prov-wrap select{background:#0b0f14;border:1px solid #263142;color:#e8f1ff;border-radius:8px;padding:.2rem .35rem}
    .assistant__close,.assistant__gear{background:none;border:1px solid rgba(255,255,255,.14);color:#cbd5e1;width:32px;height:32px;border-radius:8px;cursor:pointer}
    .assistant__log{padding:10px 12px;overflow:auto;display:flex;flex-direction:column;gap:8px;flex:1;min-height:160px}
    .assistant__msg{padding:.6rem .9rem;border-radius:12px;max-width:85%;white-space:pre-wrap}
    .assistant__msg--user{margin-left:auto;background:#243244;color:#e7f0ff}
    .assistant__msg--bot{background:#171b21;color:#dfe6ef}
    .assistant__msg--note{align-self:center;opacity:.7;font-size:.9em}
    .assistant__controls{display:flex;gap:8px;padding:10px;border-top:1px solid rgba(255,255,255,.08);background:#0f1216}
    .assistant__controls input{flex:1;min-width:0;padding:.65rem .8rem;border-radius:10px;background:#0b0f14;border:1px solid #263142;color:#e8f1ff}
    .assistant__controls button{border-radius:10px;background:#0ea5e9;color:#fff;border:none;padding:.65rem .9rem;cursor:pointer}
    .assistant__mic{background:#1f2836 !important;border:1px solid #2a3a52 !important;color:#cbd5e1 !important}
    .assistant__mic.is-on{outline:2px solid #0ea5e9}
    .assistant__settings{padding:.75rem;border-top:1px solid rgba(255,255,255,.08);background:#0f1216}
    .assistant__row{display:flex;align-items:center;gap:.5rem;margin:.45rem 0}
    .assistant__row > span{min-width:150px;opacity:.85}
    .assistant__hint{opacity:.7}
    #as-voice,#as-lang{flex:1;min-width:0;padding:.45rem .55rem;border-radius:8px;background:#0b0f14;border:1px solid #263142;color:#e8f1ff}
  `;
  document.head.appendChild(style);

  // refs
  const panel = root.querySelector(".assistant__panel");
  const btnClose = root.querySelector(".assistant__close");
  const btnGear = root.querySelector(".assistant__gear");
  const logEl = root.querySelector("#assistantLog");
  const inputEl = root.querySelector(".assistant__input");
  const btnSend = root.querySelector(".assistant__send");
  const btnMic = root.querySelector(".assistant__mic");
  const selLang = root.querySelector("#as-lang");
  const selVoice = root.querySelector("#as-voice");
  const selProv = root.querySelector("#as-provider");
  const chkTTS = root.querySelector("#as-tts-server");
  const btnTest = root.querySelector("#as-test-voice");
  const btnClr = root.querySelector("#as-clear-log");
  const btnHideSettings = root.querySelector("#as-hide-settings");
  const chkWake = root.querySelector("#as-wake-on");
  const inpWake = root.querySelector("#as-wake-phrase");

  // ─── memory ───────────────────────────────────────────────────────────
  const chat = {
    history: [],
    lastIds: [],
    lastGenre: null,
    lastMood: null,
    nowPlaying: null,
    lastQuery: "",
  };

  // кольцо последних ID (до 25) для exclude
  const recent = {
    ids: [],
    add(id) {
      if (!id) return;
      this.ids = this.ids.filter((x) => x !== id);
      this.ids.push(id);
      if (this.ids.length > 25) this.ids.shift();
    },
    has(id) {
      return this.ids.includes(id);
    },
    list() {
      return [...this.ids];
    },
  };

  // клиентская очередь (управляем сами)
  const cQueue = {
    ids: [],
    seed: "",
    busy: false,
    clear() {
      this.ids = [];
      this.seed = "";
    },
    async refill(q) {
      if (!API_BASE || this.busy) return;
      this.busy = true;
      try {
        const r = await fetch(`${API_BASE}/api/yt/search`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ q, max: 30, exclude: recent.list(), shuffle: true }),
        });
        const j = await r.json().catch(() => ({ ids: [] }));
        const got = Array.isArray(j.ids) ? j.ids : [];
        this.seed = q;
        // жёсткий дедуп: выкидываем недавние
        this.ids = got.filter((id) => /^[A-Za-z0-9_-]{11}$/.test(id) && !recent.has(id));
      } catch (e) {
        console.warn("[queue] refill failed", e);
      } finally {
        this.busy = false;
      }
    },
    take() {
      while (this.ids.length) {
        const id = this.ids.shift();
        if (!recent.has(id)) return id;
      }
      return "";
    },
    dropCurrent(id) {
      if (!id) return;
      this.ids = this.ids.filter((x) => x !== id);
    },
  };

  // ─── Anti AB-loop detector ───────────────────────────────────────────
  const loop = {
    last: [],
    lastBreak: 0,
    push(id) {
      if (!id) return;
      this.last.push(id);
      if (this.last.length > 8) this.last.shift();
    },
    isABPattern() {
      if (this.last.length < 6) return false;
      const a = this.last.slice(-6);
      const uniq = Array.from(new Set(a));
      if (uniq.length !== 2) return false;
      if (a[0] === a[1]) return false;
      for (let i = 2; i < a.length; i++) {
        if (a[i] !== a[i - 2]) return false;
      }
      return true; // A,B,A,B,A,B
    },
  };

  window.addEventListener("AM.player.track", (e) => {
    const id = e?.detail?.id || "";
    const title = String(e?.detail?.title || "");
    let artist = "",
      song = "";
    const m = title.split(" - ");
    if (m.length >= 2) {
      artist = m[0].trim();
      song = m.slice(1).join(" - ").trim();
    }
    chat.nowPlaying = { id, title, artist, song };
    if (id) {
      recent.add(id);
      chat.lastIds = [id];
      cQueue.dropCurrent(id);
      loop.push(id);

      // разрыв «A-B-A-B» зацикливания
      if (loop.isABPattern() && Date.now() - loop.lastBreak > 5000) {
        loop.lastBreak = Date.now();
        const seed = chat.lastQuery || randomMixSeed();
        (async () => {
          await cQueue.refill(seed);
          const nid = cQueue.take();
          if (nid) dispatch("play", { id: nid });
          else dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
          addMsg("note", "[anti-loop] Пересобрал поток, чтобы не заедало.");
        })();
      }
    }
  });

  // ─── Provider pref ───────────────────────────────────────────────────
  const provPref = localStorage.getItem("assistant.provider") || "auto";
  selProv.value = provPref;
  selProv.addEventListener("change", () => {
    localStorage.setItem("assistant.provider", selProv.value);
    addMsg(
      "note",
      `Режим: ${selProv.value === "pro" ? "Pro (OpenAI)" : selProv.value === "free" ? "Free (локально)" : "Auto"}`
    );
  });
  function providerToSend() {
    const p = localStorage.getItem("assistant.provider") || "auto";
    if (p === "pro") return "openai";
    if (p === "free") return "lmstudio";
    return undefined; // auto
  }

  // ─── Language select ─────────────────────────────────────────────────
  if (selLang) {
    selLang.value = state.langPref;
    selLang.addEventListener("change", () => {
      pinLang(selLang.value);
      speak(sampleByLang(state.langPref));
      // перезапуск wake-word с новым языком
      if (SR && isWakeOn()) startWakeLoop(true);
    });
  }

  // ─── Server TTS pref ─────────────────────────────────────────────────
  chkTTS.checked = localStorage.getItem("assistant.ttsServer") === "1";
  chkTTS.addEventListener("change", () => {
    localStorage.setItem("assistant.ttsServer", chkTTS.checked ? "1" : "0");
    addMsg("note", chkTTS.checked ? "Серверный TTS включён" : "Серверный TTS выключен");
  });

  // ─── Voices list (browser) ───────────────────────────────────────────
  const tts = { voiceName: localStorage.getItem("assistant.voice") || "" };
  function populateVoices() {
    try {
      const V = window.speechSynthesis?.getVoices?.() || [];
      selVoice.innerHTML =
        `<option value="">Системный / лучший доступный</option>` +
        V.map((v) => `<option value="${v.name}">${v.name} — ${v.lang}</option>`).join("");
      if (tts.voiceName) selVoice.value = tts.voiceName;
    } catch {}
  }
  if ("speechSynthesis" in window) {
    try {
      window.speechSynthesis.onvoiceschanged = populateVoices;
    } catch {}
    setTimeout(populateVoices, 300);
  }
  selVoice?.addEventListener("change", () => {
    tts.voiceName = selVoice.value || "";
    localStorage.setItem("assistant.voice", tts.voiceName);
    speak(sampleByLang(state.langPref));
  });

  // ─── server TTS (buffered, explicit lang) ────────────────────────────
  async function speakServer(text, lang) {
    if (!API_BASE) throw new Error("no API");
    const url = `${API_BASE}/api/tts?lang=${encodeURIComponent(lang || "")}`;
    const r = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json; charset=utf-8" },
      body: JSON.stringify({ text, lang }),
    });
    if (!r.ok) {
      let msg = `tts ${r.status}`;
      try {
        const j = await r.json();
        if (j?.error) msg += ` ${j.error}`;
      } catch {}
      throw new Error(msg);
    }
    const buf = await r.arrayBuffer();
    const urlObj = URL.createObjectURL(new Blob([buf], { type: "audio/wav" }));
    const audio = new Audio(urlObj);
    audio.preload = "auto";
    try {
      await audio.play();
    } catch (e) {
      console.warn("[tts] play() blocked:", e);
    }
    audio.onended = () => URL.revokeObjectURL(urlObj);
    audio.onerror = () => console.error("[tts] audio error:", audio.error);
  }
  async function ttsServerSpeak(text, lang) {
    return speakServer(text, lang);
  }

  // ─── browser TTS (strict voice match) ────────────────────────────────
  function speakBrowser(text, lang) {
    try {
      if (!("speechSynthesis" in window)) return;
      try {
        window.speechSynthesis.cancel();
      } catch {}
      const u = new SpeechSynthesisUtterance(text);
      const want = codeToBCP47(lang);
      const wantPrefix = want.slice(0, 2);
      const voices = (window.speechSynthesis.getVoices?.() || []).filter((v) =>
        String(v.lang || "").toLowerCase().startsWith(wantPrefix)
      );
      let v = voices.find((v) => v.name === tts.voiceName);
      if (!v) v = voices[0];
      if (v) u.voice = v;
      u.lang = want;
      u.rate = 1;
      u.pitch = 1;
      window.speechSynthesis.speak(u);
    } catch {}
  }

  // ─── public speak() ──────────────────────────────────────────────────
  function speak(text) {
    const lang = state.langPref;
    const useServer = chkTTS.checked && !!API_BASE;
    if (useServer) {
      speakServer(text, lang).catch((err) => {
        console.warn("[tts] server failed → browser fallback:", err?.message || err);
        addMsg("note", `[TTS fallback → ${lang}]`);
        speakBrowser(text, lang);
      });
    } else {
      speakBrowser(text, lang);
    }
  }
  function sampleByLang(lang) {
    return lang === "uk"
      ? "Привіт! Перевірка голосу."
      : lang === "en"
      ? "Hello! This is a voice test."
      : "Привет! Проверка голоса.";
  }

  btnTest?.addEventListener("click", () => speak(sampleByLang(state.langPref)));
  btnClr?.addEventListener("click", () => {
    logEl.innerHTML = "";
    chat.history = [];
  });
  btnHideSettings?.addEventListener("click", () => {
    const s = root.querySelector(".assistant__settings");
    if (s) s.hidden = true;
  });

  // === Sleep timer (helpers) ===========================================
  let sleepTimerId = null,
    sleepAfterTrack = false,
    sleepAfterAction = "stop";

  // защита от авто-next после намеренной паузы
  let manualPauseGuardUntil = 0; // пока > now — не авто-Next на paused
  function markManualPauseGuard(ms = 60 * 60 * 1000) {
    manualPauseGuardUntil = Date.now() + ms;
  }

  function clearSleepTimer() {
    if (sleepTimerId) {
      clearTimeout(sleepTimerId);
      sleepTimerId = null;
    }
  }
  function scheduleActionLater(ms, op) {
    clearSleepTimer();
    // валидация и минимальный разумный порог
    if (!Number.isFinite(ms) || ms <= 0) {
      console.warn("[timer] invalid ms:", ms);
      addMsg("note", "⏱ Не понял время для таймера. Скажи, например, «через 20 секунд» или «через 1:30».");
      return;
    }
    const msSafe = Math.max(500, Math.round(ms));
    addMsg("note", `⏱ Таймер установлен: ${Math.round(msSafe / 1000)} сек → ${op === "pause" ? "пауза" : "стоп"}.`);
    sleepTimerId = setTimeout(() => {
      if (op === "pause") {
        dispatch("player-pause");
        markManualPauseGuard(12 * 60 * 60 * 1000); // 12 ч защиты от авто-next
        addMsg("note", "⏰ Таймер: пауза.");
      } else {
        dispatch("player-stop");
        addMsg("note", "⏰ Таймер: стоп.");
      }
    }, msSafe);
  }
  function parseSleepDuration(s) {
    const r =
      /(\d{1,3})\s*(час(?:ов|а)?|h|hour|hours|минут(?:ы|у)?|мин|m|min|minutes|секунд(?:ы|у)?|сек|s|sec|seconds)/i;
    const m = String(s || "").toLowerCase().match(r);
    if (!m) return null;
    const n = Number(m[1] || 0);
    const unit = (m[2] || "").toLowerCase();
    if (/^час|h|hour/.test(unit)) return n * 3600 * 1000;
    if (/^мин|minutes?/.test(unit) || /^минут/.test(unit) || unit === "m" || unit === "min") return n * 60 * 1000;
    return n * 1000;
  }
  const DASH = /[–—-]/; // en dash / em dash / hyphen

  // авто-продолжение по окончанию трека + «после текущего»
  let lastEndedNextAt = 0;
  window.addEventListener("AM.player.ended", () => {
    if (sleepAfterTrack) {
      sleepAfterTrack = false;
      clearSleepTimer();
      if (sleepAfterAction === "pause") {
        dispatch("player-pause");
        markManualPauseGuard(12 * 60 * 60 * 1000);
      } else {
        dispatch("player-stop");
      }
      addMsg(
        "note",
        sleepAfterAction === "pause" ? "⏰ Пауза после текущего трека." : "⏰ Остановлено после текущего трека."
      );
      return;
    }
    // авто-next, если пользователь не просил «после текущего»
    if (Date.now() - lastEndedNextAt > 1000) {
      lastEndedNextAt = Date.now();
      nextWithGuard();
    }
  });

  // страховка тишины
  let silenceTimer = null;
  window.addEventListener("AM.player.state", (e) => {
    const st = String(e?.detail?.state || "").toLowerCase(); // "paused"/"stopped"/"ended"
    clearTimeout(silenceTimer);
    if (!sleepAfterTrack && (st === "stopped" || st === "ended" || st === "paused")) {
      if (st === "paused" && Date.now() < manualPauseGuardUntil) return;
      silenceTimer = setTimeout(() => {
        if (!sleepAfterTrack && !(st === "paused" && Date.now() < manualPauseGuardUntil)) {
          nextWithGuard();
        }
      }, 3000);
    }
  });

  // ─── log/history ─────────────────────────────────────────────────────
  function addMsg(role, content) {
    const cls =
      role === "user"
        ? "assistant__msg--user"
        : role === "bot"
        ? "assistant__msg--bot"
        : "assistant__msg--note";
    const d = document.createElement("div");
    d.className = `assistant__msg ${cls}`;
    d.textContent = String(content || "");
    logEl.appendChild(d);
    logEl.scrollTop = logEl.scrollHeight;
    if (role !== "note") {
      chat.history.push({ role: role === "user" ? "user" : "assistant", content: String(content || "") });
      chat.history = chat.history.slice(-10);
    }
  }

  function dispatch(name, detail = {}) {
    const ev = new CustomEvent(`assistant:${name}`, { detail, bubbles: true, composed: true });
    window.dispatchEvent(ev);
    document.dispatchEvent(new CustomEvent(`assistant:${name}`, { detail, bubbles: true, composed: true }));
  }

  // ─── mix seeds ───────────────────────────────────────────────────────
  const MIX_SEEDS = [
    "lofi hip hop radio",
    "classic rock hits",
    "best jazz music relaxing",
    "indie rock playlist",
    "hip hop playlist",
    "edm house techno mix",
    "ambient music long playlist",
    "pop hits playlist",
    "latin hits playlist",
    "rnb soul classics playlist",
    "best reggae mix",
  ];
  let lastMixSeed = "";
  function randomMixSeed() {
    if (!MIX_SEEDS.length) return "music radio mix";
    let tries = 0,
      seed = MIX_SEEDS[(Math.random() * MIX_SEEDS.length) | 0];
    while (MIX_SEEDS.length > 1 && seed === lastMixSeed && tries < 6) {
      seed = MIX_SEEDS[(Math.random() * MIX_SEEDS.length) | 0];
      tries++;
    }
    lastMixSeed = seed;
    return seed;
  }
  function ensureMoodQuery(mood) {
    const m = String(mood || "").toLowerCase();
    if (m === "happy") return "upbeat feel good hits";
    if (m === "calm") return "lofi chill beats to relax";
    if (m === "sad") return "sad emotional songs playlist";
    if (m === "energetic") return "high energy workout rock mix";
    return "music radio mix";
  }
  function ensureGenreQuery(genre) {
    const g = String(genre || "").toLowerCase();
    const map = {
      джаз: "best jazz music relaxing",
      рок: "classic rock hits",
      поп: "pop hits playlist",
      электрон: "edm house techno mix",
      lofi: "lofi hip hop radio",
      классик: "classical symphony playlist",
      рэп: "hip hop playlist",
      инди: "indie rock playlist",
      ambient: "ambient music long playlist",
      блюз: "best blues songs playlist",
      шансон: "russian chanson mix",
      folk: "folk acoustic playlist",
      rnb: "rnb soul classics playlist",
      latin: "latin hits playlist",
      reggae: "best reggae mix",
      "k-pop": "kpop hits playlist",
      "j-pop": "jpop hits playlist",
      soundtrack: "movie soundtrack playlist",
    };
    return map[g] || `${g} music playlist`;
  }

  // ─── mood suggestions ────────────────────────────────────────────────
  const MOOD_SUGGEST = {
    ru: {
      calm: {
        genres: ["lofi", "ambient", "джаз", "чилаут", "неоклассика"],
        artists: ["Nujabes", "Bonobo", "Brian Eno", "Massive Attack", "Ludovico Einaudi"],
      },
      happy: {
        genres: ["поп", "инди-поп", "фанк", "диско"],
        artists: ["Dua Lipa", "Pharrell Williams", "Daft Punk", "Maroon 5", "Foster The People"],
      },
      sad: {
        genres: ["инди", "альт-рок", "акустика", "singer-songwriter"],
        artists: ["Radiohead", "Billie Eilish", "Coldplay", "Damien Rice", "Adele"],
      },
      energetic: {
        genres: ["рок", "панк", "EDM", "drum & bass"],
        artists: ["The Prodigy", "Skrillex", "Rage Against The Machine", "Linkin Park", "Pendulum"],
      },
    },
    uk: {
      calm: {
        genres: ["lofi", "ambient", "джаз", "чилаут", "неокласика"],
        artists: ["Nujabes", "Bonobo", "Brian Eno", "Massive Attack", "Ludovico Einaudi"],
      },
      happy: {
        genres: ["поп", "інді-поп", "фанк", "диско"],
        artists: ["Dua Lipa", "Pharrell Williams", "Daft Punk", "Maroon 5", "Foster The People"],
      },
      sad: {
        genres: ["інді", "альт-рок", "акустика", "singer-songwriter"],
        artists: ["Radiohead", "Billie Eilish", "Coldplay", "Damien Rice", "Adele"],
      },
      energetic: {
        genres: ["рок", "панк", "EDM", "drum & bass"],
        artists: ["The Prodigy", "Skrillex", "Rage Against The Machine", "Linkin Park", "Pendulum"],
      },
    },
    en: {
      calm: {
        genres: ["lofi", "ambient", "jazz", "chillout", "neoclassical"],
        artists: ["Nujabes", "Bonobo", "Brian Eno", "Massive Attack", "Ludovico Einaudi"],
      },
      happy: {
        genres: ["pop", "indie pop", "funk", "disco"],
        artists: ["Dua Lipa", "Pharrell Williams", "Daft Punk", "Maroon 5", "Foster The People"],
      },
      sad: {
        genres: ["indie", "alt rock", "acoustic", "singer-songwriter"],
        artists: ["Radiohead", "Billie Eilish", "Coldplay", "Damien Rice", "Adele"],
      },
      energetic: {
        genres: ["rock", "punk", "EDM", "drum & bass"],
        artists: ["The Prodigy", "Skrillex", "Rage Against The Machine", "Linkin Park", "Pendulum"],
      },
    },
  };

  // ─── NEXT with guard ─────────────────────────────────────────────────
  async function nextWithGuard() {
    let id = cQueue.take();
    if (!id && chat.lastQuery) {
      await cQueue.refill(chat.lastQuery);
      id = cQueue.take();
    }
    if (id) {
      dispatch("play", { id });
      return;
    }

    const prevId = chat.nowPlaying?.id || "";
    dispatch("player-next");
    await sleep(700);
    const cur1 = chat.nowPlaying?.id || "";
    if (cur1 && cur1 !== prevId) return;

    dispatch("player-next");
    await sleep(1200);
    const cur2 = chat.nowPlaying?.id || "";
    if (cur2 && cur2 !== prevId) return;

    const seed = chat.lastQuery || randomMixSeed();
    dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
    await sleep(750);
    dispatch("player-next");
  }

  // ─── actions runner ──────────────────────────────────────────────────
  async function runActions(actions = []) {
    for (const a of actions) {
      if (a?.type === "player" && a.action) {
        if (a.action === "next") await nextWithGuard();
        else dispatch("player-" + a.action);
      } else if (a?.type === "view" && a.mode) {
        dispatch("view", { mode: a.mode });
      } else if (a?.type === "recommend") {
        dispatch("recommend", a);
        if (a.genre) chat.lastGenre = a.genre;
        if (a.mood) chat.lastMood = a.mood;
        if (a.autoplay && (a.genre || a.mood || a.like)) {
          const q = a.like ? a.like : a.genre ? ensureGenreQuery(a.genre) : ensureMoodQuery(a.mood);
          chat.lastQuery = q;
          await cQueue.refill(q);
          const id = cQueue.take();
          if (id) dispatch("play", { id });
          else dispatch("play", { query: q, exclude: recent.list(), shuffle: true });
        }
      } else if (a?.type === "volume") {
        dispatch("volume", a);
      } else if (a?.type === "mixradio") {
        const seed = randomMixSeed();
        chat.lastQuery = seed;
        await cQueue.refill(seed);
        const id = cQueue.take();
        if (id) dispatch("play", { id });
        else dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
      } else if (a?.type === "ui" && a.action) {
        if (a.action === "minimize") dispatch("minimize");
        else if (a.action === "expand") dispatch("expand");
      } else if (a?.type === "play" && (a.id || a.query)) {
        if (a.query) {
          chat.lastQuery = a.query;
          await cQueue.refill(a.query);
          const id = cQueue.take();
          if (id) {
            dispatch("play", { id });
            continue;
          }
        }
        dispatch("play", { id: a.id, query: a.query, exclude: recent.list(), shuffle: true });
        const idd = getYouTubeId(a.id || a.query);
        if (idd) {
          chat.lastIds = [idd];
          recent.add(idd);
          cQueue.dropCurrent(idd);
        }
      }
    }
  }

  function harvestIdsFromReply(txt = "") {
    const ids = new Set();
    const urlRe =
      /\bhttps?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/shorts\/)([A-Za-z0-9_-]{11})\b/g;
    let m;
    while ((m = urlRe.exec(txt))) ids.add(m[1]);
    const idRe = /\b([A-Za-z0-9_-]{11})\b/g;
    while ((m = idRe.exec(txt))) ids.add(m[1]);
    return Array.from(ids);
  }

  // ─── numbers-by-words → number ───────────────────────────────────────
  function parseNumberWords(str) {
    const s = String(str || "").toLowerCase().trim();
    if (!s) return null;
    const map = new Map(
      Object.entries({
        // RU
        "ноль": 0,
        "один": 1,
        "одна": 1,
        "одной": 1,
        "одну": 1,
        "два": 2,
        "две": 2,
        "три": 3,
        "четыре": 4,
        "пять": 5,
        "шесть": 6,
        "семь": 7,
        "восемь": 8,
        "девять": 9,
        "десять": 10,
        "одиннадцать": 11,
        "двенадцать": 12,
        "тринадцать": 13,
        "четырнадцать": 14,
        "пятнадцать": 15,
        "шестнадцать": 16,
        "семнадцать": 17,
        "восемнадцать": 18,
        "девятнадцать": 19,
        "двадцать": 20,
        "тридцать": 30,
        "сорок": 40,
        "пятьдесят": 50,
        "шестьдесят": 60,
        "полминуты": 30,
        "полчаса": 1800,
        "полторы": 1.5,
        "полтора": 1.5,
        "несколько": 5,
        "пару": 2,
        "пара": 2,
        // UK (минимальный набор)
        "нуль": 0,
        "дві": 2,
        "чотири": 4,
        "п’ять": 5,
        "вісім": 8,
        "дев’ять": 9,
        "кілька": 5,
        "півхвилини": 30,
        "півгодини": 1800,
        // EN
        "zero": 0,
        "one": 1,
        "two": 2,
        "three": 3,
        "four": 4,
        "five": 5,
        "six": 6,
        "seven": 7,
        "eight": 8,
        "nine": 9,
        "ten": 10,
        "eleven": 11,
        "twelve": 12,
        "thirteen": 13,
        "fourteen": 14,
        "fifteen": 15,
        "sixteen": 16,
        "seventeen": 17,
        "eighteen": 18,
        "nineteen": 19,
        "twenty": 20,
        "thirty": 30,
        "forty": 40,
        "fifty": 50,
        "sixty": 60,
        "half-minute": 30,
        "half an hour": 1800,
        "couple": 2,
        "few": 5,
      })
    );
    if (map.has(s)) return map.get(s);
    const tokens = s.split(/[\s-]+/g).filter(Boolean);
    let total = 0,
      had = false;
    for (const t of tokens) {
      if (map.has(t)) {
        total += map.get(t);
        had = true;
        continue;
      }
      const n = Number(t.replace(",", "."));
      if (!Number.isNaN(n)) {
        total += n;
        had = true;
      }
    }
    return had ? total : null;
  }

  // ─── Delay/After-current parsing (расширенный) ───────────────────────
  function toMs(n, unit) {
    const u = String(unit || "").toLowerCase().replace(/[.,;:!?)+\]\s]+$/g, "");
    if (/^час|h|hour/.test(u)) return n * 3600 * 1000;
    if (/^мин|m|min|minutes?/.test(u) || /^минут/.test(u)) return n * 60 * 1000;
    if (/^сек|s|sec|seconds?/.test(u) || /^секунд/.test(u)) return n * 1000;
    return n * 1000;
  }

  function parseDelaySpec(input = "") {
    const t = String(input || "").toLowerCase().replace(/[–—]/g, "-");

    const wantsPause = /(постав(ь|ить).+пауз|на пауз|пауз(а|у)\b|пауза\b|pause)/.test(t);
    const wantsStop = /(выключ|останов|стоп\b|stop)/.test(t);
    const op = wantsPause ? "pause" : wantsStop ? "stop" : null;

    const afterCurrent =
      /(после\s+(этой|текущей)\s+(песни|композиции|трека)|after\s+(this|current)\s+(song|track))/.test(t);

    // mm:ss
    let m = t.match(/(?:через|за)\s+(\d{1,2}):(\d{2})/);
    if (m) {
      const mm = Number(m[1] || 0),
        ss = Number(m[2] || 0);
      const ms = (mm * 60 + ss) * 1000;
      return { ms, afterCurrent: false, op: op || "pause" };
    }

    // перечисления/диапазоны: "через 10, 15, 20 секунд" / "через 15-20 секунд"
    m = t.match(
      /(?:через|за|на)\s+([0-9 ,.-]{1,20})\s*(сек(?:унд\w*)?|s|sec|seconds|мин(?:ут\w*)?|m|min|minutes|час(?:\w*)?|h|hour|hours)\b/i
    );
    if (m) {
      const seq = String(m[1]).split(/[^\d]+/).filter(Boolean).map(Number);
      const n = seq.length ? seq[seq.length - 1] : NaN;
      if (Number.isFinite(n)) return { ms: toMs(n, m[2]), afterCurrent: false, op: op || "pause" };
    }

    // цифрами: «через 10 секунд»
    m = t.match(/(?:через|за|на)\s+(\d{1,3})\s*([a-zа-яёіїє.]+)/i);
    if (m) {
      const n = Number(m[1]);
      const u = String(m[2] || "");
      if (!Number.isNaN(n)) return { ms: toMs(n, u), afterCurrent: false, op: op || "pause" };
    }

    // словами: «через десять секунд», «через одну минуту»
    m = t.match(/(?:через|за|на)\s+([a-zа-яёіїє \-]+)\s*([a-zа-яёіїє.]+)/i);
    if (m) {
      const num = parseNumberWords(m[1]);
      if (num !== null) return { ms: toMs(num, m[2]), afterCurrent: false, op: op || "pause" };
    }

    // неявная 1: «через минуту/секунду/час»
    m = t.match(/(?:через|за|на)\s*(минут[ауы]?|секунд[ауы]?|час[ауы]?)/i);
    if (m) return { ms: toMs(1, m[1]), afterCurrent: false, op: op || "pause" };

    if (afterCurrent) return { ms: null, afterCurrent: true, op: op || "stop" };
    return null;
  }

  // ─── Local intents (таймер/«после текущего»/хиты N часов) ────────────
  function tryAdvancedLocalIntents(traw) {
    const text = String(traw || "");
    const ds = parseDelaySpec(text);
    if (ds?.ms) {
      const secs = Math.round(ds.ms / 1000);
      const verb = ds.op === "pause" ? "поставлю на паузу" : "выключу";
      addMsg("bot", `Ок, ${verb} через ${secs} сек.`);
      speak(`${verb} через ${secs} секунд`);
      scheduleActionLater(ds.ms, ds.op);
      return true;
    }
    if (ds?.afterCurrent) {
      sleepAfterTrack = true;
      sleepAfterAction = ds.op || "stop";
      clearSleepTimer();
      addMsg(
        "bot",
        ds.op === "pause" ? "Ок, поставлю на паузу после текущего трека." : "Ок, выключу после текущего трека."
      );
      speak(ds.op === "pause" ? "Поставлю на паузу после текущего трека" : "Выключу после текущего трека");
      try {
        window.__AM_SLEEP_AFTER__ = true;
      } catch {}
      return true;
    }

    // «хиты <артист> на 2 часа»
    const reThisArtist = /(хит(?:ов|ы)|лучшие|best of|hits).*(этого артиста).*(\d{1,2}.*(час|мин))/i;
    const reNamed =
      /(хит(?:ов|ы)|лучшие|best of|hits)\s+([a-zа-яёіїє .'\-]+?)\s+(?:на|в течение|напротяжении)?\s*(\d{1,2}\s*(?:час|часа|часов|мин|минут|minutes?|hours?))/i;
    let artist = "",
      durStr = "";
    let m = text.toLowerCase().match(reThisArtist);
    if (m && chat.nowPlaying?.artist) {
      artist = chat.nowPlaying.artist;
      durStr = m[3] || "";
    } else {
      m = text.toLowerCase().match(reNamed);
      if (m) {
        artist = (m[2] || "").trim();
        durStr = m[3] || "";
      }
    }
    if (artist && durStr) {
      const ms = parseSleepDuration(durStr);
      if (ms) {
        const q = `${artist} greatest hits playlist`;
        chat.lastQuery = q;
        addMsg("bot", `Ок, хиты ${artist} — поехали. Выключу через ${Math.round(ms / 60000)} мин.`);
        speak(`Включаю хиты ${artist}. Выключу через ${Math.round(ms / 60000)} минут`);
        (async () => {
          await cQueue.refill(q);
          const id = cQueue.take();
          if (id) dispatch("play", { id });
          else dispatch("play", { query: q, exclude: recent.list(), shuffle: true });
        })();
        scheduleActionLater(ms, "stop");
        return true;
      }
    }
    return false;
  }

  // ─── API ─────────────────────────────────────────────────────────────
  async function callAI(message) {
    if (!API_BASE) return null;
    const r = await fetch(`${API_BASE}/api/chat`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message,
        history: chat.history,
        provider: providerToSend(),
        langHint: state.langPref,
      }),
    });
    if (!r.ok) throw new Error(`API ${r.status}`);
    return r.json();
  }

  async function handleUserText(text) {
    let v = String(text || "").trim();
    if (!v) return;

    // внешний препроцессор (без редактирования chat.js)
    try {
      if (window.Assistant?.preprocessText) {
        const res = window.Assistant.preprocessText(v);
        if (res && typeof res === "object" && res.handled) return;
        if (typeof res === "string") v = res;
      }
    } catch {}

    addMsg("user", v);

    // Локальный "что сейчас играет?"
    if (/(что\s+(сейчас\s+)?играет|что за трек|какой трек|what'?s\s+playing)/i.test(v)) {
      const np = chat.nowPlaying;
      const msg = np?.id
        ? np.title
          ? `Сейчас играет: ${np.title}`
          : (np.artist || np.song)
          ? `Сейчас играет: ${[np.artist, np.song].filter(Boolean).join(" - ")}`
          : "Сейчас что-то играет."
        : "Сейчас ничего не играет.";
      addMsg("bot", msg);
      speak(msg);
      return;
    }

    if (tryAdvancedLocalIntents(v)) return;

    // таймер авто-стоп/паузы в тексте
    const delaySpec = parseDelaySpec(v);
    const hasDelayWords = /(через|после\s+(этой|текущей))/i.test(v);
    const suppressImmediatePauseStop = !!(delaySpec && (delaySpec.ms || delaySpec.afterCurrent)) || hasDelayWords;
    const forcedNext = NEXT_RE.test(v);

    try {
      const data = await callAI(v);
      if (data && isStr(data.reply)) {
        const harvested = harvestIdsFromReply(data.reply);
        if (harvested.length) {
          chat.lastIds = harvested;
          harvested.forEach((id) => recent.add(id));
        }

        addMsg("bot", data.reply);
        speak(data.reply);

        let actions = Array.isArray(data.actions) ? data.actions : [];

        // SANITIZE: если пользователь сказал «пауза», заменяем любые stop-акшены модели на pause
        const askedPause = /\b(пауза|pause)\b/i.test(v);
        const askedStop = /\b(стоп|выключ|останов|stop)\b/i.test(v);
        if (askedPause && !askedStop && actions.length) {
          actions = actions.map((a) =>
            a?.type === "player" && a.action === "stop" ? { ...a, action: "pause" } : a
          );
        }

        if (forcedNext) {
          await nextWithGuard();
        } else if (actions.length) {
          // не делать немедленный pause/stop, если просили задержку
          if (suppressImmediatePauseStop) {
            actions = actions.filter(
              (a) => !(a?.type === "player" && (a.action === "stop" || a.action === "pause"))
            );
          }
          const aPlay = actions.find((a) => a.type === "play" && (a.id || a.query));
          if (aPlay) {
            const id = getYouTubeId(aPlay.id || aPlay.query);
            if (id) {
              chat.lastIds = [id];
              recent.add(id);
              cQueue.dropCurrent(id);
            }
            if (aPlay.query) chat.lastQuery = aPlay.query;
          }
          await runActions(actions);

          if (delaySpec?.ms) {
            const secs = Math.round(delaySpec.ms / 1000);
            addMsg(
              "note",
              delaySpec.op === "pause"
                ? `⏰ Поставлю на паузу через ~${secs} сек.`
                : `⏰ Выключусь через ~${secs} сек.`
            );
            scheduleActionLater(delaySpec.ms, delaySpec.op);
          } else if (delaySpec?.afterCurrent) {
            sleepAfterTrack = true;
            sleepAfterAction = delaySpec.op || "stop";
            clearSleepTimer();
            addMsg(
              "note",
              sleepAfterAction === "pause" ? "⏰ Пауза после текущего трека." : "⏰ Выключусь после текущего трека."
            );
            try {
              window.__AM_SLEEP_AFTER__ = true;
            } catch {}
          }
        } else {
          const localReply = await handleCommandLocal(v, /*suppressInstant*/ suppressImmediatePauseStop);
          addMsg("note", "[" + localReply + "]");
          if (delaySpec?.ms) scheduleActionLater(delaySpec.ms, delaySpec.op);
          else if (delaySpec?.afterCurrent) {
            sleepAfterTrack = true;
            sleepAfterAction = delaySpec.op || "stop";
            clearSleepTimer();
            addMsg(
              "note",
              sleepAfterAction === "pause" ? "⏰ Пауза после текущего трека." : "⏰ Выключусь после текущего трека."
            );
            try {
              window.__AM_SLEEP_AFTER__ = true;
            } catch {}
          }
        }

        if (isStr(data.explain)) addMsg("note", "[" + data.explain + "]");
        return;
      }
    } catch (e) {
      console.warn("AI API error", e);
    }

    const reply = await handleCommandLocal(v, /*suppressInstant*/ suppressImmediatePauseStop);
    addMsg("bot", reply);
    speak(reply);
  }

  // ─── local fallback for simple commands ──────────────────────────────
  async function handleCommandLocal(t, suppressInstantPauseStop = false) {
    const text = (t || "").toLowerCase();
    const wantsPlay = /включ|поставь|play|запусти|вруби|сыграй/.test(text);
    const hasDelayWords = /(через|после\s+(этой|текущей))/i.test(text);

    if (/list|список|лист ?вью/.test(text)) {
      dispatch("view", { mode: "list" });
      return "Включаю список";
    }
    if (/grid|сетка|карточк/.test(text)) {
      dispatch("view", { mode: "grid" });
      return "Включаю сетку";
    }

    if (NEXT_RE.test(text)) {
      await nextWithGuard();
      return "Следующий трек";
    }

    if (/prev|пред/.test(text)) {
      dispatch("player-prev");
      return "Предыдущий трек";
    }

    // Мгновенные pause/stop — только если НЕ просили задержку
    if (!suppressInstantPauseStop && !hasDelayWords) {
      if (/\b(пауза|pause)\b/.test(text)) {
        dispatch("player-pause");
        markManualPauseGuard(); // 1 час по умолчанию
        return "Пауза";
      }
      if (/\b(стоп|выключи|останови|stop)\b/.test(text)) {
        dispatch("player-stop");
        return "Стоп";
      }
    }

    if (/(отмени|сбрось|cancel).*(таймер|timer)/.test(text)) {
      clearSleepTimer();
      sleepAfterTrack = false;
      manualPauseGuardUntil = 0;
      return "Таймер отменён";
    }

    if (/play|плей|включи|вруби|сыграй/.test(text)) {
      if (chat.lastIds.length) {
        dispatch("play", { id: chat.lastIds[0] });
      } else {
        const seed = randomMixSeed();
        chat.lastQuery = seed;
        await cQueue.refill(seed);
        const id = cQueue.take();
        if (id) dispatch("play", { id });
        else dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
      }
      manualPauseGuardUntil = 0;
      return "Играю";
    }

    if (/тише|quieter|volume down|поменьше/.test(text)) {
      dispatch("volume", { delta: -0.1 });
      return "Тише";
    }
    if (/громче|louder|volume up|погромче/.test(text)) {
      dispatch("volume", { delta: +0.1 });
      return "Громче";
    }
    if (/(mix ?radio|микс|радио|random)/.test(text)) {
      const seed = randomMixSeed();
      chat.lastQuery = seed;
      await cQueue.refill(seed);
      const id = cQueue.take();
      if (id) dispatch("play", { id });
      else dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
      manualPauseGuardUntil = 0;
      return "Mix Radio";
    }

    if (/^(?:включи|поставь|запусти|найди|знайди)\s+.+/i.test(text)) {
      const like = text.replace(/^(?:включи|поставь|запусти|найди|знайди)\s+/i, "").trim();
      if (like) {
        chat.lastQuery = like;
        await cQueue.refill(like);
        const id = cQueue.take();
        if (id) dispatch("play", { id });
        else dispatch("play", { query: like, exclude: recent.list(), shuffle: true });
        manualPauseGuardUntil = 0;
        return "Шукаю та вмикаю…";
      }
    }

    const moods = [
      { re: /(весел|радіс|радост|happy|joy)/, mood: "happy" },
      { re: /(спок|calm|chill|relax)/, mood: "calm" },
      { re: /(сум|sad|minor)/, mood: "sad" },
      { re: /(енерг|drive|бадьор|рок|rock|energy|energetic)/, mood: "energetic" },
    ];
    const m = moods.find((m) => m.re.test(text));
    if (m) {
      const q = ensureMoodQuery(m.mood);
      chat.lastQuery = q;

      if (wantsPlay) {
        await cQueue.refill(q);
        const id = cQueue.take();
        if (id) dispatch("play", { id });
        else dispatch("play", { query: q, exclude: recent.list(), shuffle: true });
        return "Підбираю та вмикаю…";
      } else {
        const dict = MOOD_SUGGEST[state.langPref] || MOOD_SUGGEST.ru;
        const sug = dict[m.mood];
        if (sug) {
          addMsg(
            "bot",
            state.langPref === "en"
              ? `For a ${m.mood} mood I can play genres: ${sug.genres.join(", ")}. Sample artists: ${sug.artists.join(
                  ", "
                )}. Say “play [genre/artist]” or “mix radio”.`
              : state.langPref === "uk"
              ? `Під ${m.mood} настрій можу запропонувати жанри: ${sug.genres.join(
                  ", "
                )}. Виконавці: ${sug.artists.join(
                  ", "
                )}. Скажи «включи [жанр/артиста]» або «мікс радіо».`
              : `Под ${m.mood} настроение могу предложить жанры: ${sug.genres.join(
                  ", "
                )}. Исполнители: ${sug.artists.join(
                  ", "
                )}. Скажи «включи [жанр/исполнителя]» или «микс радио».`
          );
          return "Підбираю під настрій";
        }
        return "Підбираю під настрій";
      }
    }

    const g = text.match(/жанр\s*([a-zа-яёіїє-]+)/i);
    if (g && g[1]) {
      const q = ensureGenreQuery(g[1]);
      chat.lastQuery = q;
      await cQueue.refill(q);
      const id = cQueue.take();
      if (id) dispatch("play", { id });
      else dispatch("play", { query: q, exclude: recent.list(), shuffle: true });
      return wantsPlay ? `Жанр ${g[1]}, запускаю…` : `Жанр: ${g[1]}`;
    }

    if (/из (этого|того) списка|из предложенного|любой из списка/.test(text)) {
      if (chat.lastIds.length) {
        dispatch("play", { id: chat.lastIds[0] });
        return "Запускаю из последнего списка";
      }
      const seed = randomMixSeed();
      chat.lastQuery = seed;
      await cQueue.refill(seed);
      const id = cQueue.take();
      if (id) dispatch("play", { id });
      else dispatch("play", { query: seed, exclude: recent.list(), shuffle: true });
      return "Включаю из своих рекомендаций";
    }

    return "Я тут. Могу переключать вид, управлять треком и подбирать музыку по настроению.";
  }

  // ─── Mic + Wake word (с дебаунсом результатов SR) ────────────────────
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  function isWakeOn() {
    return !!chkWake?.checked;
  }
  function wakePhrases() {
    return String(inpWake?.value || "")
      .toLowerCase()
      .split(/[,\|]/)
      .map((s) => s.trim())
      .filter(Boolean);
  }

  const micAgg = { buf: "", timer: null };
  const wakeAgg = { buf: "", timer: null };
  function debouncedPush(agg, phrase, delay = 800) {
    const s = String(phrase || "").trim();
    if (!s) return;
    agg.buf = agg.buf ? agg.buf + " " + s : s;
    clearTimeout(agg.timer);
    agg.timer = setTimeout(() => {
      const payload = agg.buf.trim();
      agg.buf = "";
      handleUserText(payload);
    }, delay);
  }

  let wakeRec = null,
    wakeStopReq = false,
    wakeRestartTimer = null;
  let wakePausedForMic = false,
    wakeActive = false,
    wakeLogShown = false;

  async function startWakeLoop(force = false) {
    if (!SR) {
      addMsg("note", "[Wake] Браузер не поддерживает распознавание речи.");
      return;
    }
    if (!isWakeOn() && !force) return;
    if (wakeActive && !force) return;

    stopWakeLoop(true);
    try {
      const rec = new SR();
      rec.lang = codeToBCP47(state.langPref);
      rec.continuous = true;
      rec.interimResults = false;
      rec.maxAlternatives = 1;
      wakeRec = rec;

      rec.onstart = () => {
        wakeActive = true;
        if (!wakeLogShown) {
          addMsg("note", "[Wake] Фоновое прослушивание включено.");
          wakeLogShown = true;
        }
      };

      rec.onresult = (ev) => {
        const t = (ev.results?.[ev.results.length - 1]?.[0]?.transcript || "").toLowerCase().trim();
        const hot = wakePhrases().find((ph) => t.startsWith(ph) || t.includes(" " + ph + " "));
        if (hot) {
          let cmd = t;
          for (const ph of wakePhrases()) cmd = cmd.replace(new RegExp("^\\s*" + ph + "\\s*"), "").trim();
          if (!cmd) {
            addMsg("note", "[Wake] Слушаю.");
            return;
          }
          if (!wakeAgg.buf) clearTimeout(wakeAgg.timer);
          debouncedPush(wakeAgg, cmd, 800);
          return;
        }
      };

      rec.onerror = () => {};
      rec.onend = () => {
        wakeActive = false;
        if (wakeStopReq) return;
        if (!isWakeOn() || wakePausedForMic) return;
        clearTimeout(wakeRestartTimer);
        wakeRestartTimer = setTimeout(() => startWakeLoop(true), 600);
      };

      rec.start();
    } catch (e) {
      addMsg("note", "[Wake] Не удалось запустить прослушивание.");
    }
  }

  function stopWakeLoop(silent = false) {
    wakeStopReq = true;
    clearTimeout(wakeRestartTimer);
    if (wakeRec) {
      try {
        wakeRec.onend = null;
        wakeRec.stop();
      } catch {}
      wakeRec = null;
    }
    wakeStopReq = false;
    wakeActive = false;
    if (!silent) {
      addMsg("note", "[Wake] Выключено.");
      wakeLogShown = false;
    }
  }

  if (chkWake) {
    chkWake.addEventListener("change", () => {
      if (isWakeOn()) startWakeLoop(true);
      else stopWakeLoop(false);
    });
  }
  if (inpWake) {
    inpWake.addEventListener("change", () => {
      if (SR && isWakeOn()) startWakeLoop(true);
    });
  }

  // Кнопка микрофона — разовый слушатель (коэкзистенция с wake)
  if (btnMic && SR) {
    btnMic.addEventListener("click", () => {
      try {
        if (isWakeOn() && wakeActive) {
          wakePausedForMic = true;
          stopWakeLoop(true);
        }

        const rec = new SR();
        rec.lang = codeToBCP47(state.langPref);
        rec.interimResults = false;
        rec.maxAlternatives = 1;
        btnMic.classList.add("is-on");

        rec.onresult = (ev) => {
          // Берём последний финальный результат текущей сессии
          const t = (ev.results?.[ev.results.length - 1]?.[0]?.transcript || "");
          if (!micAgg.buf) clearTimeout(micAgg.timer);
          debouncedPush(micAgg, t, 800);
        };

        rec.onerror = () => {
          addMsg("bot", "Не вышло распознать голос");
        };
        rec.onend = () => {
          btnMic.classList.remove("is-on");
          if (isWakeOn()) {
            wakePausedForMic = false;
            startWakeLoop(true);
          }
        };
        rec.start();
      } catch {
        addMsg("bot", "Розпізнавач недоступний");
      }
    });
  }

  // ─── wiring ──────────────────────────────────────────────────────────
  root.querySelector(".assistant__toggle").addEventListener("click", () => {
    panel.hidden = !panel.hidden;
  });
  btnClose.addEventListener("click", () => {
    panel.hidden = true;
  });
  btnGear.addEventListener("click", () => {
    const s = root.querySelector(".assistant__settings");
    if (s) s.hidden = !s.hidden;
  });
  btnSend.addEventListener("click", () => {
    const t = inputEl.value;
    inputEl.value = "";
    handleUserText(t);
  });
  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      const t = inputEl.value;
      inputEl.value = "";
      handleUserText(t);
    }
  });

  // автозапуск wake-loop, если включён
  if (SR && isWakeOn()) startWakeLoop();

  // ─── лёгкие внешние хуки ─────────────────────────────────────────────
  window.Assistant = window.Assistant || {};
  window.Assistant.enqueueText = (txt) => handleUserText(String(txt || ""));
  window.Assistant.nowPlaying = () => ({ ...(chat.nowPlaying || {}) });
  // window.Assistant.preprocessText = (text) => text;
})();

```

---
## src/js/assistant/hooks.js

**size:** 1551 bytes &nbsp;&nbsp; **sha1:** `858b1de20e159de45ba5431b6fb3b7ac687c6225`

```javascript
// alias of assistant-hooks.js
(() => {
  const W = (window.Assistant = window.Assistant || {});

  function normalizeDashes(s) {
    return String(s || "").replace(/[–—]/g, "-");
  }
  function normalizeTimingPhrases(s0) {
    let s = normalizeDashes(String(s0 || "")).toLowerCase();
    s = s.replace(/через\s+пол ?минут[ыи]/g, "через 30 секунд");
    s = s.replace(/через\s+пол ?часа/g, "через 30 минут");
    s = s.replace(/через\s+минут[уы]/g, "через 1 минуту");
    s = s.replace(/через\s+секунд[уы]/g, "через 1 секунду");
    s = s.replace(/через\s+час[ау]?/g, "через 1 час");
    s = s.replace(/через\s+(\d{1,3})\s*-\s*(\d{1,3})\s*(секунд\w*|минут\w*|час\w*|s|m|h|min|sec|hour|minutes?)/g,
      (_m, a, b, u) => `через ${b} ${u}`);
    s = s.replace(
      /через\s+(\d{1,3}(?:\s*,\s*\d{1,3})+)\s*(секунд\w*|минут\w*|час\w*|s|m|h|min|sec|hour|minutes?)/g,
      (_m, list, u) => {
        const parts = list.split(/\s*,\s*/).map(Number).filter((n) => Number.isFinite(n));
        const last = parts[parts.length - 1] || 0;
        return `через ${last} ${u}`;
      }
    );
    s = s.replace(/секундочк[ауи]/g, "секунду").replace(/минутк[ауи]/g, "минуту");
    return s0 && s !== s0 ? s : s0;
  }

  W.preprocessText = function (text) {
    const t1 = normalizeTimingPhrases(text);
    return t1;
  };
})();

```

---
## src/js/comments.js

**size:** 10562 bytes &nbsp;&nbsp; **sha1:** `2cb2bce8223c513ad35109201787a2f160c55b64`

```javascript
// ===== Imports =====
import Swiper from 'swiper/bundle';
import 'swiper/swiper-bundle.css';
import iziToast from 'izitoast';
import 'izitoast/dist/css/iziToast.min.css';

// ===== Constants / State =====
const STORAGE_KEY = 'myFeedback';
let scrollY = 0;
let swiper = null;

// ===== DOM refs (назначим после DOMContentLoaded) =====
let overlay, openBtn, closeBtn, form, container, inputName, inputMessage, formRating;

// ===== Utils =====
function debounce(fn, delay = 400) {
  let t;
  return (...args) => {
    clearTimeout(t);
    t = setTimeout(() => fn(...args), delay);
  };
}

// ===== Stars =====
function createStars(container, rating) {
  if (!container) return;
  container.innerHTML = '';

  for (let i = 1; i <= 5; i++) {
    const star = document.createElement('span');
    star.classList.add('star');
    if (i <= rating) star.classList.add('filled');
    container.appendChild(star);

    // Интерактив — только у рейтинга формы
    if (container.id === 'customer-rating') {
      star.addEventListener('click', () => {
        container.dataset.rating = String(i);
        createStars(container, i);
        saveToLocalStorage(); // сразу запишем рейтинг
      });
      star.addEventListener('mouseenter', () => hoveredStar(container, i));
      star.addEventListener('mouseleave', () => {
        const savedRating = parseInt(formRating.dataset.rating) || 0;
        createStars(container, savedRating);
      });
    }
  }
}

function hoveredStar(container, upTo) {
  const stars = container.querySelectorAll('.star');
  stars.forEach((star, index) => {
    if (index < upTo) star.classList.add('filled');
    else star.classList.remove('filled');
  });
}

// ===== LocalStorage (draft) =====
function saveToLocalStorage() {
  const name = inputName?.value?.trim() || '';
  const message = inputMessage?.value?.trim() || '';
  const rating = Number(formRating?.dataset?.rating || 0);

  // Всё пусто? Удаляем ключ.
  if (!name && !message && rating === 0) {
    localStorage.removeItem(STORAGE_KEY);
    return;
  }

  const draft = { name, message, rating };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(draft));
}

const saveDraftDebounced = debounce(saveToLocalStorage, 400);

function dataFromLocalStorage() {
  let saved = null;
  try {
    saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
  } catch {
    saved = null;
  }

  if (!saved) {
    // На всякий случай визуально сбросим рейтинг
    if (formRating) {
      formRating.dataset.rating = '0';
      createStars(formRating, 0);
    }
    return;
  }

  if (inputName) inputName.value = saved.name || '';
  if (inputMessage) inputMessage.value = saved.message || '';
  if (formRating) {
    formRating.dataset.rating = String(saved.rating ?? 0);
    createStars(formRating, saved.rating ?? 0);
  }
}

function resetLocalStorage() {
  localStorage.removeItem(STORAGE_KEY);
  form?.reset();
  if (formRating) {
    formRating.dataset.rating = '0';
    createStars(formRating, 0);
  }
}

// ===== Modal =====
function openModal(e) {
  e?.preventDefault?.();
  scrollY = window.scrollY;
  document.body.style.position = 'fixed';
  document.body.style.top = `-${scrollY}px`;
  document.body.style.left = '0';
  document.body.style.right = '0';

  overlay.classList.remove('hidden');
  container.classList.add('hidden');

  dataFromLocalStorage(); // подхватим драфт при каждом открытии
}

function closeModal() {
  overlay.classList.add('hidden');
  container.classList.remove('hidden');

  document.body.style.position = '';
  window.scrollTo(0, scrollY);

  // Синхронно сбросим рейтинг визуально
  if (formRating) {
    formRating.dataset.rating = '0';
    createStars(formRating, 0);
  }

  // Сохраним/удалим актуальный драфт после закрытия
  saveToLocalStorage();
}

// ===== Swiper =====
function initSwiper() {
  // если уже был — уничтожим
  if (swiper) {
    swiper.destroy(true, true);
    swiper = null;
  }

  swiper = new Swiper('.swiper', {
    slidesPerView: 1,
    spaceBetween: 0,
    loop: false,
    grabCursor: true,
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    centeredSlides: false,

    // 3 точки: первый / середина / последний
    pagination: {
      el: '.swiper-pagination',
      type: 'custom',
      clickable: true,
      renderCustom: (sw, _current, total) => {
        const first = 0;
        const last = total - 1;
        const middle = Math.floor(total / 2);
        const curr = sw.realIndex;

        const isActive = (i) =>
          (i === first && curr === first) ||
          (i === last && curr === last) ||
          (i === middle && curr !== first && curr !== last);

        const dot = (i) =>
          `<span class="swiper-dots ${isActive(i) ? 'active' : ''}" data-i="${i}"></span>`;

        return dot(first) + dot(middle) + dot(last);
      },
    },
  });

  // клики по кастомным точкам
  const pag = document.querySelector('.swiper-pagination');
  if (pag) {
    pag.onclick = (e) => {
      const dot = e.target.closest('.swiper-dots');
      if (!dot) return;
      swiper.slideTo(Number(dot.dataset.i));
    };
  }

  // при смене слайда — перерисовать кастомные точки
  swiper.on('slideChange', () => swiper.pagination.render());
}

// ===== Fetch & render feedbacks =====
async function loadReviews() {
  const wrapper = document.querySelector('.swiper-wrapper');
  if (!wrapper) return;
  wrapper.innerHTML = '';

  try {
    const res = await fetch('https://sound-wave.b.goit.study/api/feedbacks');
    const ct = res.headers.get('content-type') || '';
    if (!res.ok || !ct.includes('audio')) {
    // попробуем показать причину
     let msg = 'TTS server error';
     try { msg = (await res.clone().json()).error || msg; } catch {}
     console.warn('[tts] non-audio response', msg);
     throw new Error(msg);
    }

    const json = await res.json();
    const feedbacks = (json?.data || []).slice(0, 10); // РОВНО 10

    feedbacks.forEach((fb, index) => {
      const stars = Math.round(fb.rating || 0);

      const slide = document.createElement('div');
      slide.className = 'swiper-slide';
      slide.innerHTML = `
        <div class="rating my-rating" id="rating-${index}" data-rating="${stars}"></div>
        <div class="feedback">
          <p class="customer-feedback">${fb.descr}</p>
          <h3 class="customer-name">${fb.name}</h3>
        </div>
      `;

      wrapper.appendChild(slide);
      createStars(slide.querySelector('.rating'), stars); // звёзды в слайдах статичны
    });

    // инициализируем Swiper только после вставки слайдов
    initSwiper();
  } catch (err) {
    iziToast.error({
      title: 'Error',
      message: 'Bad request (invalid request params)',
    });
  }
}

// ===== Submit =====
function attachSubmitHandler() {
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = inputName.value.trim();
    const message = inputMessage.value.trim();
    const rating = Math.round(formRating.dataset.rating) || 0;

    if (!name || name.length < 2 || name.length > 16) {
      iziToast.error({ message: 'Shortest name - 2 letters; Largest name - 16 letters' });
      return;
    }
    if (!message || message.length < 10 || message.length > 512) {
      iziToast.error({ message: 'Min message - 10 symbols; Max message - 512 symbols' });
      return;
    }
    if (rating < 1 || rating > 5) {
      iziToast.error({ message: "Rating must be between '1' and '5'" });
      return;
    }

    try {
      const response = await fetch('https://sound-wave.b.goit.study/api/feedbacks', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Accept: 'application/json',
        },
        body: JSON.stringify({ name, descr: message, rating }),
      });

      if (!response.ok) {
        iziToast.error({ title: 'Error:', message: `${response.status}` });
        return;
      }

      iziToast.success({ message: "Success! You're comment posted" });
      resetLocalStorage();
      closeModal();
      document.body.classList.remove('no-scroll');

      loadReviews();
    } catch (err) {
      iziToast.error({ message: 'Bad request (invalid request body)' });
    }
  });
}

// ===== Init =====
function initApp() {
  // Присваиваем DOM-элементы
  overlay = document.querySelector('.overlay');
  openBtn = document.querySelector('.feedback-btn');
  closeBtn = document.querySelector('.close-icon');
  form = document.querySelector('#feedback-form');
  container = document.querySelector('.feedback-section');
  inputName = document.querySelector('.form-input-name');
  inputMessage = document.querySelector('.form-input-message');
  formRating = document.getElementById('customer-rating');

  // Безопасные проверки
  if (!overlay || !container) {
    console.warn('Overlay or container not found');
  }

  // Звёзды в форме (интерактив)
  createStars(formRating, parseInt(formRating?.dataset?.rating) || 0);

  // Навешиваем обработчики модалки
  openBtn?.addEventListener('click', openModal);
  closeBtn?.addEventListener('click', closeModal);

  overlay?.addEventListener('click', (e) => {
    if (e.target === overlay) closeModal();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !overlay.classList.contains('hidden')) closeModal();
  });

  // Автосохранение драфта при наборе
  inputName?.addEventListener('input', saveDraftDebounced);
  inputMessage?.addEventListener('input', saveDraftDebounced);

  // Сабмит
  attachSubmitHandler();

  // Первичная загрузка отзывов
  loadReviews();
}

document.addEventListener('DOMContentLoaded', initApp);

```

---
## src/js/global-sfx.js

**size:** 3160 bytes &nbsp;&nbsp; **sha1:** `53f2e663eed1e45124a8fcb78216f2dd2a2a3499`

```javascript
// ГЛОБАЛЬНЫЕ SFX ДЛЯ ВСЕГО САЙТА
// Подключите один раз в main.js:  import "./js/global-sfx.js";
import { UISound } from "./artists/lib/sound.js"; // путь под ваш проект

// ===== Конфиг =====
const CLICKABLE_SELECTOR = [
  'a[href]',
  'button',
  '[role="button"]',
  'input[type="button"]',
  'input[type="submit"]',
  'input[type="reset"]',
  'summary',
  '.sfx-click'          // опциональный «маркер-класс»
].join(',');

// Где НЕ играть (ползунки, драг-зоны и т.п.)
const IGNORE_SELECTOR = [
  '.no-sfx',
  '[data-sfx="off"]',
  '[disabled],[aria-disabled="true"]',
  'input[type="range"]',
  '.am-player__dragzone', // ваша верхняя зона перетаскивания плеера
].join(',');

// ===== Сервис =====
const SFX = {
  enabled: localStorage.getItem('sfx') !== 'off',
  lastAt: 0,
  playOnce() {
    if (!this.enabled) return;
    const now = performance.now();
    if (now - this.lastAt < 80) return; // анти-дубль
    this.lastAt = now;
    try {
      UISound?.tap?.(); // ваш текущий звук
    } catch {
      // Фолбэк мини-бипом (если вдруг UISound не инициализирован)
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'triangle'; o.frequency.value = 660;
        g.gain.setValueAtTime(0.06, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.06);
        o.connect(g).connect(ctx.destination); o.start(); o.stop(ctx.currentTime + 0.07);
      } catch {}
    }
  },
};

// Глобальный обработчик кликов
document.addEventListener('click', (e) => {
  // только «настоящие» левые клики
  if (!e.isTrusted || e.button !== 0 || e.metaKey || e.ctrlKey || e.altKey) return;

  const el = e.target.closest(CLICKABLE_SELECTOR);
  if (!el) return;
  if (el.matches(IGNORE_SELECTOR)) return;

  // Если элемент тащили (drag), браузер обычно не кидает click — но на всякий случай:
  if (Math.abs((e.movementX || 0)) > 2 || Math.abs((e.movementY || 0)) > 2) return;

  SFX.playOnce();
}, { capture: true });

// Клавиатурная активация (Enter/Space) — для a11y
document.addEventListener('keydown', (e) => {
  if (!SFX.enabled) return;
  if (!(e.key === 'Enter' || e.key === ' ')) return;

  const el = e.target.closest(CLICKABLE_SELECTOR);
  if (!el || el.matches(IGNORE_SELECTOR)) return;

  SFX.playOnce();
}, { capture: true });

// Публичный тумблер (можно привязать к настройкам)
window.SFX = {
  enable()  { SFX.enabled = true;  localStorage.setItem('sfx', 'on');  },
  disable() { SFX.enabled = false; localStorage.setItem('sfx', 'off'); },
  toggle()  { SFX.enabled ? this.disable() : this.enable(); },
};

```

---
## src/js/header.js

**size:** 7165 bytes &nbsp;&nbsp; **sha1:** `cf6a27edff25b05b90c5dcf1345564ff4725794e`

```javascript
const refs = {
  openBtn: document.querySelector('[data-menu-open]'),
  closeBtn: document.querySelector('[data-menu-close]'),
  menu: document.querySelector('[data-menu]'),
  links: document.querySelectorAll('[data-menu-link]'),
  logos: document.querySelectorAll('.header-logo'),
  header: document.querySelector('.header'),
};

function openMenu() {
  if (!refs.menu) return;
  refs.menu.hidden = false;
  refs.menu.classList.add('show');
  document.body.style.overflow = 'hidden';
  refs.openBtn?.setAttribute('aria-expanded', 'true');
}

function closeMenu() {
  return new Promise(resolve => {
    if (!refs.menu) return resolve();
    refs.menu.classList.remove('show');
    setTimeout(() => {
      refs.menu.hidden = true;
      document.body.style.overflow = '';
      refs.openBtn?.setAttribute('aria-expanded', 'false');
      resolve();
    }, 400);
  });
}

/* ---------- header offset helpers ---------- */
function getHeaderOffset() {
  return (refs.header?.offsetHeight || 80) + 8;
}
function applyScrollPadding() {
  document.documentElement.style.scrollPaddingTop = `${getHeaderOffset()}px`;
}
applyScrollPadding();
window.addEventListener('resize', () => requestAnimationFrame(applyScrollPadding));

/* ---------- custom smooth scroll (no teleports) ---------- */
function smoothScroll(targetHref, duration = 500) {
  const raw = (targetHref || '').replace('#', '');
  const el = document.getElementById(raw) || document.getElementById(`${raw}-section`);
  if (!el) return;

  const headerOffset = getHeaderOffset();
  const targetY = el.getBoundingClientRect().top + window.pageYOffset - headerOffset;

  const startY = window.pageYOffset;
  const diff = targetY - startY;
  let t0 = null;

  const ease = t => (t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2);

  function step(ts) {
    if (t0 === null) t0 = ts;
    const p = Math.min(1, (ts - t0) / duration);
    window.scrollTo(0, startY + diff * ease(p));
    if (p < 1) {
      requestAnimationFrame(step);
    } else {
      // NEW: переносим фокус на секцию, чтобы ссылка потеряла :focus
      el.setAttribute('tabindex', '-1');
      el.focus({ preventScroll: true });
      setTimeout(() => el.removeAttribute('tabindex'), 0);
    }
  }
  requestAnimationFrame(step);
}

/* ---------- menu events ---------- */
refs.openBtn?.addEventListener('click', openMenu);
refs.closeBtn?.addEventListener('click', closeMenu);

refs.logos.forEach(logo => {
  logo.addEventListener('click', e => {
    if (logo.closest('.mobile-menu')) {
      e.preventDefault();
      closeMenu();
      setTimeout(() => {
        window.location.href = logo.getAttribute('href');
      }, 400);
    }
  });
});

refs.menu?.addEventListener('click', e => {
  if (e.target === refs.menu) {
    closeMenu();
  }
});

document.addEventListener('keydown', e => {
  if (e.key === 'Escape' && refs.menu?.classList.contains('show')) {
    closeMenu();
  }
});

/* ---------- scroll-spy with IO ---------- */
const navLinks = document.querySelectorAll('.header-nav-link, .mobile-menu-nav-link');

const linkTargets = new Map();
navLinks.forEach(a => {
  const href = (a.getAttribute('href') || '').trim();
  if (!href.startsWith('#')) return;
  const rawId = href.slice(1);
  const el = document.getElementById(rawId) || document.getElementById(`${rawId}-section`);
  if (!el) return;
  if (!linkTargets.has(el)) linkTargets.set(el, []);
  linkTargets.get(el).push(a);
});

let currentEl = null;
function setActiveByEl(el) {
  if (!el || currentEl === el) return;
  navLinks.forEach(a => a.classList.remove('active'));
  (linkTargets.get(el) || []).forEach(a => a.classList.add('active'));
  currentEl = el;
}

let lockUntil = 0;
const LOCK_MS = 700;
const isLocked = () => Date.now() < lockUntil;

let io;
function initScrollSpy() {
  if (io) io.disconnect();

  const rootMargin = `-${getHeaderOffset()}px 0px -55% 0px`;
  const visibleRatio = new Map();

  io = new IntersectionObserver(
    entries => {
      entries.forEach(en => {
        visibleRatio.set(en.target, en.isIntersecting ? en.intersectionRatio : 0);
      });
      if (isLocked()) return;
      const best = [...visibleRatio.entries()].sort((a, b) => b[1] - a[1])[0];
      if (best && best[1] > 0) setActiveByEl(best[0]);
    },
    { root: null, rootMargin, threshold: [0, 0.25, 0.5, 0.75, 1] }
  );

  linkTargets.forEach((_, el) => io.observe(el));
}
initScrollSpy();
window.addEventListener('resize', () => requestAnimationFrame(initScrollSpy));

// ---------- HERO "Explore Artists" button smooth scroll ----------
const exploreBtn = document.getElementById('exploreBtn');

if (exploreBtn) {
  exploreBtn.addEventListener('click', async (e) => {
    e.preventDefault();
    exploreBtn.blur();

    const href = exploreBtn.getAttribute('href') || '#artists-section';
    const raw  = href.replace('#', '');
    const el   = document.getElementById(raw) || document.getElementById(`${raw}-section`);
    if (!el) return;

    // если вдруг открыт мобильный бургер — прикрываем перед скроллом
    if (refs.menu?.classList.contains('show')) {
      await closeMenu();
    }

    // подсветим активный пункт в хедере (если такой есть)
    setActiveByEl(el);

    // слегка «заблокируем» scroll-spy, чтобы он не перебил активный пункт во время анимации
    lockUntil = Date.now() + LOCK_MS;

    // плавный скролл с учётом высоты хедера
    smoothScroll(href, 600); // можешь подправить длительность
  });
}

/* ---------- nav handlers ---------- */
// Desktop: не трогаем мобильные (у них есть data-menu-link)
navLinks.forEach(a => {
  a.addEventListener('click', (e) => {
    if (a.matches('[data-menu-link]')) return;
    const href = (a.getAttribute('href') || '').trim();
    if (!href.startsWith('#')) return;

    e.preventDefault();
    a.blur();                      // NEW: снимаем :focus с кликнутой ссылки

    const raw = href.slice(1);
    const el = document.getElementById(raw) || document.getElementById(`${raw}-section`);
    if (!el) return;

    setActiveByEl(el);
    lockUntil = Date.now() + LOCK_MS;
    smoothScroll(href);
  });
});

// Mobile: ждём закрытие меню, снимаем фокус, потом скроллим
refs.links.forEach(link =>
  link.addEventListener('click', async e => {
    e.preventDefault();
    link.blur();                   // NEW: снимаем :focus с мобильной ссылки
    const targetId = link.getAttribute('href');
    await closeMenu();
    smoothScroll(targetId);
  })
);

window.addEventListener('load', () => {
  applyScrollPadding();
  if (location.hash) {
    setTimeout(() => smoothScroll(location.hash), 0);
  }
});

```

---
## src/js/shared/sprite.js

**size:** 219 bytes &nbsp;&nbsp; **sha1:** `9a1fd48bf33ab7f30d5cd29568449bb5624e18b4`

```javascript

import spriteUrl from '../../img/sprite.svg?url';

export const SPRITE = spriteUrl;

export const icon = (id, cls = 'ico') =>
  `<svg class="${cls}" aria-hidden="true"><use href="${SPRITE}#${id}"></use></svg>`;

```

---
## src/main.js

**size:** 517 bytes &nbsp;&nbsp; **sha1:** `69f42ec2151deeeb106b69c33541fe193d3ddf04`

```javascript
import './js/api.js';                 
import './js/artists/index.js';  

import './js/assistant/chat.js';
import './js/assistant/assistant-hooks.js'; 


import './js/header.js';
import './js/hero.js';
import './js/comments.js';
import "./js/global-sfx.js";
// Важно: чат подключается через <script type="module" src="./js/assistant/chat.js"> в index.html
// Здесь его не импортируем, чтобы не было двойной инициализации.



```

---
## src/partials/about.html

**size:** 1403 bytes &nbsp;&nbsp; **sha1:** `d13913ebc3f51f7b64c71bd8ec46ca34e3e8af0c`

```html
<section id="about" class="about-section">
  <div class="container div-about-section">
    <div class="img-container-about-section">
      <picture>
        <source
          media="(min-width: 1440px)"
          srcset="/img/about/about-desk.png 1x, /img/about/about-desk-2x.png 2x"
        />
        <source
          media="(min-width: 768px)"
          srcset="/img/about/about-tabl.png 1x, /img/about/about-tabl-2x.png 2x"
        />
        <source
          media="(max-width: 767px)"
          srcset="/img/about/about-mob.png 1x, /img/about/about-mob-2x.png 2x"
        />
        <img
          src="/img/about/about-mob.png"
          srcset="/img/about/about-mob.png 1x, /img/about/about-mob-2x.png 2x"
          alt="Team"
        />
      </picture>
    </div>

    <div class="about-us-content">
      <svg class="logo-svg" width="64" height="64">
        <use href="/img/sprite.svg#icon-logo_icon_about_us"></use>
      </svg>

      <div class="about-us-descrp">
        <h2 class="about-section-title">About ArtistsHub</h2>
        <p class="about-section-description">
          At ArtistsHub, our mission is to connect music lovers with the artists
          they adore. We strive to create a vibrant community where discovering
          new music is as enjoyable as listening to it.
        </p>
      </div>
    </div>
  </div>
</section>

```

---
## src/partials/artists.html

**size:** 5277 bytes &nbsp;&nbsp; **sha1:** `d090c1a50f4408fd5a2126bc3c3ef84903a4c4ae`

```html
<section id="artists-section" class="artists1 container">
  <div class="artists1__head">
    <p class="eyebrow">Artists</p>
    <h2 class="title">Explore Your New Favorite Artists</h2>
  </div>

  <div class="artists1__layout">
    <!-- TOOLBAR / FILTERS -->
    <aside class="filters" id="filters">
      <div class="filters__bar">
        <!-- <span class="filters__label">Filters</span> -->

        <button
          id="view-toggle"
          class="filters__view"
          type="button"
          aria-pressed="false"
          data-action="view-list"
          data-view="list"
        >
          List view
        </button>

        <button
          id="filters-reset"
          type="button"
          class="filters__reset"
          data-action="filters-reset"
        >
          Reset
        </button>

        <button
          id="filters-toggle"
          type="button"
          class="filters__toggle"
          aria-controls="filters-panel"
          aria-expanded="false"
          data-action="filters-toggle"
        >
          <span>Search and Filters</span>
        </button>
      </div>

      <div id="filters-panel" class="filters__panel" aria-hidden="true">
        <!-- Search -->
        <label class="fld fld-search">
          <button
            id="flt-q-btn"
            type="button"
            class="fld-search__btn"
            aria-label="Search"
            data-action="search"
          >
            <svg class="ico" aria-hidden="true" width="24" height="24">
              <!-- якщо у тебе inline-спрайт: href="#icon-search"; якщо файл: href="/img/sprite.svg#icon-search" -->
              <use href="#icon-search"></use>
            </svg>
          </button>
          <input id="flt-q" type="search" placeholder="Search" />
        </label>

        <!-- Sorting -->
        <div class="dd" data-dd="sort">
          <button
            class="dd__btn"
            id="dd-sort-btn"
            type="button"
            aria-expanded="false"
            aria-controls="dd-sort-list"
          >
            <span>Sorting</span>
          </button>
          <ul class="dd__list" id="dd-sort-list" role="listbox">
            <li data-val="">Default</li>
            <li data-val="asc">A–Z</li>
            <li data-val="desc">Z–A</li>
          </ul>
        </div>

        <!-- Genre -->
        <div class="dd" data-dd="genre">
          <button
            class="dd__btn"
            id="dd-genre-btn"
            type="button"
            aria-expanded="false"
            aria-controls="dd-genre-list"
          >
            <span>Genre</span>
          </button>
          <ul class="dd__list" id="dd-genre-list" role="listbox"></ul>
        </div>

        <!-- Mix Radio / Next (иконки оставлены) -->
        <button
          id="random-radio"
          type="button"
          class="btn btn--purple"
          data-action="play next"
        >
          <span>Mix Radio</span>
          <svg class="ico" aria-hidden="true" width="24" height="24">
            <use href="/img/sprite.svg#icon-icon_youtube_footer"></use>
          </svg>
          <span>/ Next</span>
          <svg class="ico" aria-hidden="true" width="24" height="24">
            <use
              href="/img/sprite.svg#icon-icon_right_button_feedback_sec"
            ></use>
          </svg>
        </button>

        <button
          id="mixradio-menu-btn"
          type="button"
          class="btn btn--purple"
          data-action="radio-menu"
        >
          <span>Radio Menu</span>
          <svg class="ico" aria-hidden="true" width="24" height="24">
            <use
              href="/img/sprite.svg#icon-icon_right_button_feedback_sec"
            ></use>
          </svg>
        </button>
      </div>
    </aside>

    <!-- CONTENT -->
    <div class="artists1__content">
      <div id="artists-empty" class="empty" hidden>
        <div class="empty__card">
          <div class="empty__icon" aria-hidden="true">!</div>
          <h3 class="empty__title">Silence on the stage…</h3>
          <p class="empty__text">
            Looks like no artists match your filters.<br class="empty__br" />
            Try changing them or hit “Reset Filters” to bring back the beat.
          </p>
          <button class="empty__btn" id="empty-reset" type="button">
            Reset filters
          </button>
        </div>
      </div>

      <div id="artists-loader" class="loader" hidden></div>
      <ul id="artists-grid" class="grid"></ul>
      <nav id="artists-pager" class="pager" aria-label="Pagination"></nav>
    </div>
  </div>
</section>

<div id="artist-modal" class="amodal" hidden>
  <div class="amodal__backdrop"></div>
  <div
    class="amodal__dialog"
    role="dialog"
    aria-modal="true"
    aria-label="Artist details"
  >
    <button
      id="am-close"
      class="amodal__close"
      type="button"
      aria-label="Close"
    >
      ×
    </button>
    <div id="am-body" class="amodal__body">
      <div class="amodal__loader loader"></div>
    </div>
  </div>
</div>

```

---
## src/partials/comments.html

**size:** 1840 bytes &nbsp;&nbsp; **sha1:** `65ab2f5df5a5dfb50dde6dae284a2467cb7d0ddb`

```html
<section id="reviews">
  <div class="feedback-section container">
    <h2 class="hidden">Feedbacks our visitors</h2>
    <div class="swiper">
      <div class="swiper-wrapper"></div>
      <div class="swiper-button-prev">
        <svg class="left-arrow" width="14" height="14">
          <use href="/img/sprite.svg#icon-icon_right_button_feedback_sec"></use>
        </svg>
      </div>
      <div class="swiper-button-next">
        <svg width="14" height="14">
          <use href="/img/sprite.svg#icon-icon_right_button_feedback_sec"></use>
        </svg>
      </div>

      <div class="swiper-pagination"></div>
    </div>
    <button class="review-btn feedback-btn" type="button">
      Leave feedback
    </button>
  </div>
  <div class="overlay hidden">
    <div class="modal">
      <svg class="close-icon" width="14px" height="14px">
        <use href="/img/sprite.svg#icon-icon_close"></use>
      </svg>
      <form id="feedback-form">
        <h3 class="title-modal">Submit feedback</h3>
        <div class="form-name">
          <label>Name</label>
          <input
            class="form-input-name"
            type="text"
            placeholder="Emily"
            required
          />
        </div>
        <div class="form-message">
          <label>Message</label>
          <textarea
            class="form-input-message"
            placeholder="Type your message..."
            required
          ></textarea>
        </div>
        <div
          id="customer-rating"
          class="rating my-rating"
          data-rating="0"
        ></div>
        <div class="send-btn-cont">
          <button class="review-btn send-feedback-btn" type="submit">
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

```

---
## src/partials/footer.html

**size:** 2391 bytes &nbsp;&nbsp; **sha1:** `6ca23fb7de6845a1d498a3a6554b5f4ab255b1bd`

```html
<footer class="footer-section">
  <div class="container footer-container">
    <div class="footer-logo-wrapper">
      <a href="index.html" class="footer-logo">
        <svg class="footer-logo-svg">
          <use href="/img/sprite.svg#icon-logo"></use>
        </svg>
      </a>
    </div>
    <nav class="footer-nav">
      <ul class="footer-nav-list">
        <li class="footer-nav-item">
          <a href="#artists" class="footer-nav-link">Artists</a>
        </li>
        <li class="footer-nav-item">
          <a href="#about" class="footer-nav-link">About us</a>
        </li>
        <li class="footer-nav-item">
          <a href="#reviews" class="footer-nav-link">Reviews</a>
        </li>
      </ul>
    </nav>
    <div class="divider"></div>
    <div class="footer-social-wrapper">
      <div class="footer-social">
        <ul class="footer-social-list">
          <li class="footer-social-item">
            <a
              class="footer-social-link"
              href="https://www.instagram.com/"
              rel="noopener noreferrer"
              target="_blank"
            >
              <svg class="social-icon" width="40" height="40">
                <use href="/img/sprite.svg#icon-icon_inst_footer"></use>
              </svg>
            </a>
          </li>
          <li class="footer-social-item">
            <a
              class="footer-social-link"
              href="https://www.facebook.com/"
              rel="noopener noreferrer"
              target="_blank"
            >
              <svg class="social-icon" width="40" height="40">
                <use href="/img/sprite.svg#icon-icon_facebook_footer"></use>
              </svg>
            </a>
          </li>
          <li class="footer-social-item">
            <a
              class="footer-social-link"
              href="https://www.youtube.com/"
              rel="noopener noreferrer"
              target="_blank"
            >
              <svg class="social-icon" width="40" height="40">
                <use href="/img/sprite.svg#icon-icon_youtube_footer"></use>
              </svg>
            </a>
          </li>
        </ul>
      </div>
      <div class="footer-text-wrapper">
        <p class="footer-text">© 2025 ArtistsHub. All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>

```

---
## src/partials/header.html

**size:** 2430 bytes &nbsp;&nbsp; **sha1:** `b5968c74b9b5c687ed5c90cc3cac8a30649350c0`

```html
<header class="header">
  <div class="header-container container">
    <a href="./index.html" class="header-logo" aria-label="Go to homepage">
      <svg class="header-logo-icon" aria-hidden="true">
        <use href="./img/sprite.svg#icon-logo"></use>
      </svg>
      <span class="sr-only">ArtistsHub</span>
    </a>

    <nav class="header-nav" aria-label="Main navigation">
      <ul class="header-nav-list">
        <li><a href="#artists-section" class="header-nav-link">Artists</a></li>
        <li><a href="#about" class="header-nav-link">About Us</a></li>
        <li><a href="#reviews" class="header-nav-link">Reviews</a></li>
      </ul>
    </nav>

    <button
      type="button"
      class="burger-menu-btn"
      aria-label="Open mobile menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
      data-menu-open
    >
      <svg class="burger-menu-icon" aria-hidden="true">
        <use href="./img/sprite.svg#icon-icon_menu_mobile_navbar"></use>
      </svg>
    </button>
  </div>

  <div class="mobile-menu" id="mobile-menu" data-menu hidden>
    <div class="mobile-menu-container">
      <div class="mobile-menu-top container">
        <a href="./index.html" class="header-logo">
          <svg class="header-logo-icon" aria-hidden="true">
            <use href="./img/sprite.svg#icon-logo"></use>
          </svg>
        </a>

        <button
          type="button"
          class="mobile-menu-close-btn"
          aria-label="Close mobile menu"
          data-menu-close
        >
          <svg class="mobile-menu-close-icon" aria-hidden="true">
            <use href="./img/sprite.svg#icon-icon_close"></use>
          </svg>
        </button>
      </div>

      <nav class="mobile-menu-nav" aria-label="Mobile navigation">
        <ul class="mobile-menu-nav-list">
          <li>
            <a
              href="#artists-section"
              class="mobile-menu-nav-link"
              data-menu-link
              >Artists</a
            >
          </li>
          <li>
            <a href="#about" class="mobile-menu-nav-link" data-menu-link
              >About Us</a
            >
          </li>
          <li>
            <a href="#reviews" class="mobile-menu-nav-link" data-menu-link
              >Reviews</a
            >
          </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

```

---
## src/partials/hero.html

**size:** 775 bytes &nbsp;&nbsp; **sha1:** `306efab19796514d6f8e52ba0044c485077d4ab5`

```html
<section class="hero-section" id="hero">
  <div class="container hero-container">
    <div class="hero-content">
      <h1 class="hero-title">Discover Your Next Favorite Artist Today</h1>
      <p class="hero-subtitle">
        Dive into a world of music discoveries with ArtistsHub – your personal
        guide to the boundless universe of sound. Explore, filter, and learn
        about your favorite artists all in one place.
      </p>
      <a href="#artists-section" id="exploreBtn" class="hero-btn">
        Explore Artists
        <svg class="icon-play-btn" width="24" height="24">
          <use href="/img/sprite.svg#icon-icon_play_hero_section"></use>
        </svg>
      </a>
    </div>
    <div class="hero-img"></div>
  </div>
</section>

```

---
## src/public/logo-icon.svg

**size:** 2890 bytes &nbsp;&nbsp; **sha1:** `82f4dea1e5064b6e5d92db46f9fa37bf762b0abf`

```text
<svg width="80" height="81" viewBox="0 0 80 81" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M43.7517 8.0874C44.7126 7.98445 45.8261 8.18498 46.7517 8.44775C48.8458 9.04219 50.5466 10.3152 51.5564 12.1323C52.6058 13.995 52.8072 16.1729 52.115 18.1753C51.2361 20.6446 49.3518 21.8856 46.9978 23.0269L47.0242 30.229C48.7065 30.7069 50.3433 31.2488 51.8708 32.0737C55.3816 33.9699 57.783 37.167 58.7898 40.8052C59.854 44.6203 59.2489 48.6743 57.1072 52.0747C55.1428 55.1569 52.0103 57.4332 48.2605 58.3052C43.3621 59.4456 39.208 58.2107 34.9978 55.8784C33.1368 57.7325 31.2979 59.6076 29.4832 61.5024C30.2945 63.2857 30.5632 65.1564 30.0251 67.0513C29.4993 68.9038 28.1061 70.4908 26.324 71.4292C24.3271 72.4822 22.0523 72.6741 19.863 72.0903C17.6904 71.511 15.8643 70.2569 14.8025 68.3726C13.7575 66.5201 13.6689 64.3493 14.3464 62.3716C15.1173 60.1237 16.6877 58.7388 18.8953 57.7114C21.2712 56.8455 23.2352 57.1303 25.5544 57.9087C27.4855 56.0153 29.3037 54.0267 31.2546 52.1499C29.1105 48.2321 28.4162 44.8948 29.531 40.5776C27.1036 39.5217 24.7627 38.2926 22.3337 37.2349C21.0359 38.4937 19.4497 39.3568 17.5867 39.6489C15.3649 39.9974 13.0223 39.4327 11.196 38.2173C9.3867 36.9959 8.19637 35.1347 7.90405 33.0708C7.60402 31.0694 8.16903 28.8632 9.54468 27.2837C10.9632 25.6547 13.1655 24.6725 15.3884 24.4556C17.5725 24.2574 19.7514 24.8781 21.4431 26.1802C23.6062 27.8683 24.2306 29.9664 24.4929 32.4673C26.7952 33.7825 29.4319 34.7969 31.8308 35.9712C34.9519 32.5333 37.2319 31.4487 41.781 30.1421L41.7849 22.9946C40.9705 22.691 40.1576 22.3215 39.448 21.8354C37.6532 20.5984 36.4753 18.7348 36.1843 16.6724C35.9152 14.6205 36.5362 12.5527 37.9109 10.9302C39.4133 9.17411 41.4221 8.37465 43.7517 8.0874ZM53.78 43.6431C53.3171 38.7261 48.6816 35.0801 43.4021 35.48C38.075 35.8837 34.118 40.2503 34.5847 45.2104C35.0517 50.1724 39.7643 53.8309 45.0857 53.3647C50.3594 52.9014 54.2428 48.5596 53.78 43.6431Z" fill="white"/>
<path d="M69.043 31.7021C69.2682 31.6917 69.4868 31.6887 69.7109 31.7189C70.4112 31.8135 71.1012 32.1286 71.4869 32.7015C71.8961 33.3093 71.9521 34.1187 72.0081 34.8228C72.2858 38.3074 72.0795 41.9326 72.0786 45.4296C72.0778 48.2855 72.4175 52.1582 71.8483 54.9085C71.6692 55.7729 71.054 56.1863 70.3172 56.654C70.0366 56.6857 69.7429 56.7219 69.4599 56.7068C68.8276 56.6736 68.2287 56.4111 67.8198 55.9615C67.4155 55.5165 67.4272 54.6233 67.3914 54.0651C67.1345 50.0566 67.3517 45.9199 67.3556 41.8994C67.3579 39.6147 67.0208 35.2411 67.5363 33.2022C67.7207 32.4727 68.4264 32.0904 69.043 31.7021Z" fill="white"/>
<path d="M62.5887 37.3008C63.3475 37.4311 64.0188 37.6968 64.461 38.3108C65.143 39.2581 65.1614 48.5389 64.8198 49.8635C64.6329 50.5876 63.9605 50.9406 63.323 51.2891C62.593 51.2484 61.6333 51.188 61.1457 50.5982C60.4202 49.7216 60.4803 39.8579 60.8933 38.621C61.1333 37.9023 61.9263 37.5984 62.5887 37.3008Z" fill="white"/>
</svg>

```

---
## stylelint.config.cjs

**size:** 60 bytes &nbsp;&nbsp; **sha1:** `664ffad81fd9c04a42fb37518726da4ddfa933f2`

```text
module.exports = { extends: ['stylelint-config-standard'] };
```

---
## tts_debug.json

**size:** 180 bytes &nbsp;&nbsp; **sha1:** `96ba8f869ef42c797bfef24e19dbd62cdbe3732d`

```json
{"ok":true,"lang":"en","model":"C:/piper/voices/en_US/lessac/medium/en_US-lessac-medium.onnx","file_size":38048,"note":"WAV written to temp; not returned because debug=1","log":""}
```

---
## types/vite-plugins.d.ts

**size:** 170 bytes &nbsp;&nbsp; **sha1:** `ea028ac0626e3de8f886c06039b3666f63cc9a72`

```typescript
declare module 'vite-plugin-html-inject';
declare module 'vite-plugin-full-reload';
declare module 'vite-plugin-purgecss';
declare module 'rollup-plugin-visualizer';

```

---
## vite.config.js

**size:** 1897 bytes &nbsp;&nbsp; **sha1:** `4766f10771b2775c708c061dfe92722824782516`

```javascript
// vite.config.js
import { defineConfig, loadEnv } from "vite";
import { glob } from "glob";
import injectHTML from "vite-plugin-html-inject";
import FullReload from "vite-plugin-full-reload";
import purgeCss from "vite-plugin-purgecss";
import path from "node:path";
import { fileURLToPath } from "node:url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

export default defineConfig(({ command, mode }) => {
  const env = loadEnv(mode, process.cwd(), "");
  // Для GH Pages обычно: /Artisthub-continuation/
  // Локально удобно: /
  const BASE =
    env.VITE_BASE ?? (command === "build" ? "/Artisthub-continuation/" : "/");

  const contentGlobs = [
    path.resolve(__dirname, "src/**/*.html"),
    path.resolve(__dirname, "src/**/*.js"),
  ];

  return {
    root: "src",
    base: BASE,
    build: {
      sourcemap: true,
      rollupOptions: {
        input: glob.sync("./src/*.html"),
      },
      outDir: "../dist",
      emptyOutDir: true,
    },
    plugins: [
      injectHTML(),
      FullReload(["./src/**/**.html", "./src/**/**.js", "./src/**/**.css"]),
      // Отключить PurgeCSS можно через NO_PURGE=1
      ...(env.NO_PURGE
        ? []
        : [
            purgeCss({
              content: contentGlobs,
              // Селекторы, которые появляются динамически
              safelist: [
                /list-view/,      // режим списка
                /assistant/,      // UI ассистента
                /swiper/,         // Swiper стили
                /iziToast/,       // iziToast
                /tui-/,           // tui-pagination
                /is-on/,          // состояния
              ],
            }),
          ]),
    ],
  };
});

```
